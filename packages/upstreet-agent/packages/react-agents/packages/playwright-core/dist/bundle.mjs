var bg=Object.create;var io=Object.defineProperty;var yg=Object.getOwnPropertyDescriptor;var _g=Object.getOwnPropertyNames;var vg=Object.getPrototypeOf,xg=Object.prototype.hasOwnProperty;var ku=(i=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(i,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):i)(function(i){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+i+'" is not supported')});var x=(i,e)=>()=>(i&&(e=i(i=0)),e);var so=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),Sg=(i,e)=>{for(var t in e)io(i,t,{get:e[t],enumerable:!0})},Eu=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of _g(e))!xg.call(i,r)&&r!==t&&io(i,r,{get:()=>e[r],enumerable:!(n=yg(e,r))||n.enumerable});return i};var Pg=(i,e,t)=>(t=i!=null?bg(vg(i)):{},Eu(e||!i||!i.__esModule?io(t,"default",{value:i,enumerable:!0}):t,i)),Cg=i=>Eu(io({},"__esModule",{value:!0}),i);function Tu(i,e,t){let n=url.parse(i.url),r={...n,agent:n.protocol==="https:"?httpsHappyEyeballsAgent:httpHappyEyeballsAgent,method:i.method||"GET",headers:i.headers};i.rejectUnauthorized!==void 0&&(r.rejectUnauthorized=i.rejectUnauthorized);let s=i.timeout??3e4,o=getProxyForUrl(i.url);if(o){let h=url.parse(o);i.url.startsWith("http:")?r={path:n.href,host:h.hostname,port:h.port,headers:r.headers,method:r.method}:(h.secureProxy=h.protocol==="https:",r.agent=new HttpsProxyAgent(h),r.rejectUnauthorized=!1)}let l=h=>{let m=h.statusCode||0;m>=300&&m<400&&h.headers.location?Tu({...i,url:new URL(h.headers.location,i.url).toString()},e,t):e(h)},c=r.protocol==="https:"?https.request(r,l):http.request(r,l);if(c.on("error",t),s!==void 0){let h=()=>{t(new Error(`Request to ${i.url} timed out after ${s}ms`)),c.abort()};if(s<=0){h();return}c.setTimeout(s,h)}c.end(i.data)}function ln(i,e){return new Promise((t,n)=>{Tu(i,async r=>{if(r.statusCode!==200){let o=e?await e(i,r):new Error(`fetch failed: server returned code ${r.statusCode}. URL: ${i.url}`);n(o);return}let s="";r.on("data",o=>s+=o),r.on("error",o=>n(o)),r.on("end",()=>t(s))},n)})}function Dl(...i){let e=http.createServer(...i);return kg(e),e}function kg(i){let e=new Set;i.on("connection",n=>{e.add(n),n.once("close",()=>e.delete(n))});let t=i.close;i.close=n=>{for(let r of e)r.destroy();return e.clear(),t.call(i,n)}}var kr=x(()=>{});function Au(){if(process.platform==="linux"){if(!Bl&&!Ru)try{let i=fs.readFileSync("/etc/os-release","utf8"),e=Eg(i);Bl={id:e.get("id")??"",version:e.get("version_id")??""}}catch{Ru=!0}return Bl}}function Eg(i){let e=new Map;for(let t of i.split(`
`)){let n=t.split("="),r=n.shift(),s=n.join("=").trim();s.startsWith('"')&&s.endsWith('"')&&(s=s.substring(1,s.length-1)),r&&e.set(r.toLowerCase(),s)}return e}var Ru,Bl,Fu=x(()=>{Ru=!1});function cn(i,e=0){let t=i.split(`
`),n=Math.max(...t.map(r=>r.length));return["\u2554"+"\u2550".repeat(n+e*2)+"\u2557",...t.map(r=>"\u2551"+" ".repeat(e)+r+" ".repeat(n-r.length+e)+"\u2551"),"\u255A"+"\u2550".repeat(n+e*2)+"\u255D"].join(`
`)}var oo=x(()=>{});var $l=so(($y,Tg)=>{Tg.exports={name:"playwright-core",version:"1.48.0-next",description:"A high-level API to automate web browsers",repository:{type:"git",url:"git+https://github.com/microsoft/playwright.git"},homepage:"https://playwright.dev",engines:{node:">=18"},author:{name:"Microsoft Corporation"},license:"Apache-2.0",main:"dist/bundle.mjs",bin:{"playwright-core":"cli.js"},scripts:{build:"npx esbuild ./index.mjs --bundle --outfile=dist/bundle.mjs --format=esm --platform=node --minify"},types:"types/types.d.ts"}});import Iu from"os";function qt(){if(Ti)return Ti;try{Ti=Rg()}catch{Ti="Playwright/unknown"}return Ti}function Rg(){let i="unknown",e="unknown";if(process.platform==="win32"){let o=Iu.release().split(".");i="windows",e=`${o[0]}.${o[1]}`}else if(process.platform==="darwin"){let o=execSync("sw_vers -productVersion",{stdio:["ignore","pipe","ignore"]}).toString().trim().split(".");i="macOS",e=`${o[0]}.${o[1]}`}else if(process.platform==="linux"){let o=Au();o?(i=o.id||"linux",e=o.version||"unknown"):i="linux"}let t=[];process.env.CI&&t.push("CI/1");let n=t.length?" "+t.join(" "):"",{embedderName:r,embedderVersion:s}=jl();return`Playwright/${Ri()} (${Iu.arch()}; ${i} ${e}) ${r}/${s}${n}`}function jl(){let i="unknown",e="unknown";return process.env.PW_LANG_NAME?["node","python","java","csharp"].includes(process.env.PW_LANG_NAME)&&(i=process.env.PW_LANG_NAME,e=process.env.PW_LANG_NAME_VERSION??"unknown"):(i="node",e=process.version.substring(1).split(".").slice(0,2).join(".")),{embedderName:i,embedderVersion:e}}function Ri(i=!1){let e=process.env.PW_VERSION_OVERRIDE||$l().version;return i?e.split(".").slice(0,2).join("."):e}function Lu(i){let e=i.match(/^Playwright\/(\d+\.\d+\.\d+)/);if(!e)return;let t=e[1].split(".").slice(0,2).join("."),n=Ri(!0);if(t!==n)return cn(["Playwright version mismatch:",`  - server version: v${n}`,`  - client version: v${t}`,"","If you are using VSCode extension, restart VSCode.","","If you are connecting to a remote service,","keep your local Playwright version in sync","with the remote service version.","","<3 Playwright Team"].join(`
`),1)}var Ti,Rn=x(()=>{Fu();oo()});function Er(i,e){return 255+(i-255)*e}function Nu(i,e,t){return 77*i+150*e+29*t+128>>8}function Hu(i,e){let[t,n,r]=Mu(Ou(i)),[s,o,l]=Mu(Ou(e)),c=t-s,h=n-o,m=r-l,f=Math.sqrt(n**2+r**2),g=Math.sqrt(o**2+l**2),b=f-g,v=h**2+m**2-b**2;v=v<0?0:Math.sqrt(v);let S=.045,_=.015,k=1,D=1,H=1,A=1+S*f,I=1+_*f;return Math.sqrt((c/1/k)**2+(b/A/D)**2+(v/I/H)**2)}function Ou(i){let e=i[0]/255,t=i[1]/255,n=i[2]/255;return e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,[e*.4124+t*.3576+n*.1805,e*.2126+t*.7152+n*.0722,e*.0193+t*.1192+n*.9505]}function Mu(i){let e=i[0]/.950489,t=i[1],n=i[2]/1.08884,r=e>Wl?e**(1/3):e/3/ql+4/29,s=t>Wl?t**(1/3):t/3/ql+4/29,o=n>Wl?n**(1/3):n/3/ql+4/29,l=116*s-16,c=500*(r-s),h=200*(s-o);return[l,c,h]}var ql,Wl,zl=x(()=>{ql=6*6/29/29,Wl=6*6*6/29/29/29});var Ai,Du=x(()=>{zl();Ai=class i{data;width;height;static intoRGB(e,t,n,r={}){let{paddingSize:s=0,paddingColorOdd:o=[255,0,255],paddingColorEven:l=[0,255,0]}=r,c=e+2*s,h=t+2*s,m=new Uint8Array(c*h),f=new Uint8Array(c*h),g=new Uint8Array(c*h);for(let b=0;b<h;++b)for(let v=0;v<c;++v){let S=b*c+v;if(b>=s&&b<h-s&&v>=s&&v<c-s){let _=((b-s)*e+(v-s))*4,k=n[_+3]===255?1:n[_+3]/255;m[S]=Er(n[_],k),f[S]=Er(n[_+1],k),g[S]=Er(n[_+2],k)}else{let _=(b+v)%2===0?l:o;m[S]=_[0],f[S]=_[1],g[S]=_[2]}}return[new i(c,h,m),new i(c,h,f),new i(c,h,g)]}constructor(e,t,n){this.data=n,this.width=e,this.height=t}get(e,t){return this.data[t*this.width+e]}boundXY(e,t){return[Math.min(Math.max(e,0),this.width-1),Math.min(Math.max(t,0),this.height-1)]}}});function ao(i,e,t,n,r){let s=i.meanC1(e,t,n,r),o=i.meanC2(e,t,n,r),l=i.varianceC1(e,t,n,r),c=i.varianceC2(e,t,n,r),h=i.covariance(e,t,n,r),m=(.01*255)**2,f=(.03*255)**2;return(2*s*o+m)*(2*h+f)/(s**2+o**2+m)/(l+c+f)}var Tr,Bu=x(()=>{Tr=class{c1;c2;_partialSumC1;_partialSumC2;_partialSumMult;_partialSumSq1;_partialSumSq2;constructor(e,t){this.c1=e,this.c2=t;let{width:n,height:r}=e;this._partialSumC1=new Array(n*r),this._partialSumC2=new Array(n*r),this._partialSumSq1=new Array(n*r),this._partialSumSq2=new Array(n*r),this._partialSumMult=new Array(n*r);let s=(o,l,c,h,m)=>{o[l]=c,m>0&&(o[l]+=o[(m-1)*n+h]),h>0&&(o[l]+=o[m*n+h-1]),h>0&&m>0&&(o[l]-=o[(m-1)*n+h-1])};for(let o=0;o<r;++o)for(let l=0;l<n;++l){let c=o*n+l;s(this._partialSumC1,c,this.c1.data[c],l,o),s(this._partialSumC2,c,this.c2.data[c],l,o),s(this._partialSumSq1,c,this.c1.data[c]*this.c1.data[c],l,o),s(this._partialSumSq2,c,this.c2.data[c]*this.c2.data[c],l,o),s(this._partialSumMult,c,this.c1.data[c]*this.c2.data[c],l,o)}}_sum(e,t,n,r,s){let o=this.c1.width,l=e[s*o+r];return n>0&&(l-=e[(n-1)*o+r]),t>0&&(l-=e[s*o+t-1]),t>0&&n>0&&(l+=e[(n-1)*o+t-1]),l}meanC1(e,t,n,r){let s=(r-t+1)*(n-e+1);return this._sum(this._partialSumC1,e,t,n,r)/s}meanC2(e,t,n,r){let s=(r-t+1)*(n-e+1);return this._sum(this._partialSumC2,e,t,n,r)/s}varianceC1(e,t,n,r){let s=(r-t+1)*(n-e+1);return(this._sum(this._partialSumSq1,e,t,n,r)-this._sum(this._partialSumC1,e,t,n,r)**2/s)/s}varianceC2(e,t,n,r){let s=(r-t+1)*(n-e+1);return(this._sum(this._partialSumSq2,e,t,n,r)-this._sum(this._partialSumC2,e,t,n,r)**2/s)/s}covariance(e,t,n,r){let s=(r-t+1)*(n-e+1);return(this._sum(this._partialSumMult,e,t,n,r)-this._sum(this._partialSumC1,e,t,n,r)*this._sum(this._partialSumC2,e,t,n,r)/s)/s}}});function Ul(i,e,t,n,r,s,o){let l=(n*i+t)*4;e[l+0]=r,e[l+1]=s,e[l+2]=o,e[l+3]=255}function $u(i,e,t,n,r,s={}){let{maxColorDeltaE94:o=1}=s,l=Math.max(Ii,Fi),c=[255,0,255],h=[0,255,0],[m,f,g]=Ai.intoRGB(n,r,e,{paddingSize:l,paddingColorEven:c,paddingColorOdd:h}),[b,v,S]=Ai.intoRGB(n,r,i,{paddingSize:l,paddingColorEven:c,paddingColorOdd:h}),_=(W,C)=>{},k=t?(W,C)=>Ul(n,t,W-l,C-l,255,0,0):_,D=t?(W,C)=>Ul(n,t,W-l,C-l,255,255,0):_,H=t?(W,C)=>{let J=Nu(m.get(W,C),f.get(W,C),g.get(W,C)),oe=Er(J,.1);Ul(n,t,W-l,C-l,oe,oe,oe)}:_,A,I,F,q=0;for(let W=l;W<m.height-l;++W)for(let C=l;C<m.width-l;++C){if(m.get(C,W)===b.get(C,W)&&f.get(C,W)===v.get(C,W)&&g.get(C,W)===S.get(C,W)){H(C,W);continue}if(Hu([m.get(C,W),f.get(C,W),g.get(C,W)],[b.get(C,W),v.get(C,W),S.get(C,W)])<=o){H(C,W);continue}(!A||!I||!F)&&(A=new Tr(m,b),I=new Tr(f,v),F=new Tr(g,S));let[oe,Ze]=m.boundXY(C-Ii,W-Ii),[$e,te]=m.boundXY(C+Ii,W+Ii),Se=A.varianceC1(oe,Ze,$e,te)+I.varianceC1(oe,Ze,$e,te)+F.varianceC1(oe,Ze,$e,te),ie=A.varianceC2(oe,Ze,$e,te)+I.varianceC2(oe,Ze,$e,te)+F.varianceC2(oe,Ze,$e,te);if(Se===0||ie===0){k(C,W),++q;continue}let[Pe,jt]=m.boundXY(C-Fi,W-Fi),[M,Q]=m.boundXY(C+Fi,W+Fi);(ao(A,Pe,jt,M,Q)+ao(I,Pe,jt,M,Q)+ao(F,Pe,jt,M,Q))/3>=.99?D(C,W):(k(C,W),++q)}return q}var Fi,Ii,ju=x(()=>{zl();Du();Bu();Fi=15,Ii=1});function Uu(i){return i==="image/png"?Wu.bind(null,"image/png"):i==="image/jpeg"?Wu.bind(null,"image/jpeg"):i==="text/plain"?Vu:Ag}function Ag(i,e){return typeof i=="string"?Vu(i,e):!i||!(i instanceof Buffer)?{errorMessage:"Actual result should be a Buffer or a string."}:Buffer.compare(i,e)?{errorMessage:"Buffers differ"}:null}function Wu(i,e,t,n={}){if(!e||!(e instanceof Buffer))return{errorMessage:"Actual result should be a Buffer."};Fg(t,i);let r=i==="image/png"?PNG.sync.read(e):jpegjs.decode(e,{maxMemoryUsageInMB:qu}),s=i==="image/png"?PNG.sync.read(t):jpegjs.decode(t,{maxMemoryUsageInMB:qu}),o={width:Math.max(s.width,r.width),height:Math.max(s.height,r.height)},l="";(s.width!==r.width||s.height!==r.height)&&(l=`Expected an image ${s.width}px by ${s.height}px, received ${r.width}px by ${r.height}px. `,r=zu(r,o),s=zu(s,o));let c=new PNG({width:o.width,height:o.height}),h;if(n.comparator==="ssim-cie94")h=$u(s.data,r.data,c.data,o.width,o.height,{maxColorDeltaE94:1});else if((n.comparator??"pixelmatch")==="pixelmatch")h=pixelmatch(s.data,r.data,c.data,o.width,o.height,{threshold:n.threshold??.2});else throw new Error(`Configuration specifies unknown comparator "${n.comparator}"`);let m=n.maxDiffPixels,f=n.maxDiffPixelRatio!==void 0?s.width*s.height*n.maxDiffPixelRatio:void 0,g;m!==void 0&&f!==void 0?g=Math.min(m,f):g=m??f??0;let b=Math.ceil(h/(s.width*s.height)*100)/100,v=h>g?`${h} pixels (ratio ${b.toFixed(2)} of all image pixels) are different.`:"";return v||l?{errorMessage:l+v,diff:PNG.sync.write(c)}:null}function Fg(i,e){if(e==="image/png"){let t=[137,80,78,71,13,10,26,10];if(i.length<t.length||!t.every((n,r)=>i[r]===n))throw new Error("could not decode image as PNG.")}else if(e==="image/jpeg"){let t=[255,216];if(i.length<t.length||!t.every((n,r)=>i[r]===n))throw new Error("could not decode image as JPEG.")}}function Vu(i,e){if(typeof i!="string")return{errorMessage:"Actual result should be a string"};let t=e.toString("utf-8");if(t===i)return null;let n=new diff_match_patch,r=n.diff_main(t,i);return n.diff_cleanupSemantic(r),{errorMessage:Ig(r)}}function Ig(i){let e=[];for(let t=0;t<i.length;t++){let n=i[t][0],s=i[t][1];switch(n){case DIFF_INSERT:e[t]=colors.green(s);break;case DIFF_DELETE:e[t]=colors.reset(colors.strikethrough(colors.red(s)));break;case DIFF_EQUAL:e[t]=s;break}}return e.join("")}function zu(i,e){if(i.width===e.width&&i.height===e.height)return i;let t=new Uint8Array(e.width*e.height*4);for(let n=0;n<e.height;n++)for(let r=0;r<e.width;r++){let s=(n*e.width+r)*4;if(n<i.height&&r<i.width){let o=(n*i.width+r)*4;t[s]=i.data[o],t[s+1]=i.data[o+1],t[s+2]=i.data[o+2],t[s+3]=i.data[o+3]}else t[s]=0,t[s+1]=0,t[s+2]=0,t[s+3]=0}return{data:Buffer.from(t),width:e.width,height:e.height}}var qu,Vl=x(()=>{ju();qu=5*1024});function dn(i){let e=process.env[i];return e=e===void 0?process.env[`npm_config_${i.toLowerCase()}`]:e,e=e===void 0?process.env[`npm_package_config_${i.toLowerCase()}`]:e,e}function lo(i,e){let t=dn(i);return t==="false"||t==="0"?!1:t?!0:!!e}function Lg(){let i=process.env.npm_config_user_agent||"";return i.includes("yarn")?"yarn":i.includes("pnpm")?"pnpm":"npm"}function Gu(){let i=Lg();return i==="yarn"?"yarn":i==="pnpm"?"pnpm exec":"npx"}var Gl=x(()=>{});function E(i,e){if(!i)throw new Error(e||"Assertion error")}function Ku(i,e){if(ce()&&!i)throw new Error(e)}function it(){return co==="console"?"console":co==="0"||co==="false"?"":co?"inspector":""}function ce(){return Og}var co,Og,Li=x(()=>{Gl();co=dn("PWDEBUG")||"";Og=!!process.env.PWTEST_UNDER_TEST});import Kl from"crypto";function Y(){let i="0123456789abcdef",e="";for(let t=0;t<16;t++){let n=Math.floor(Math.random()*256);e+=i[n>>4]+i[n&15]}return e}function Wt(i){let e=Kl.createHash("sha1");return e.update(i),e.digest("hex")}function Ju(i){let e=[];do{let t=i&127;i>>>=7,e.length>0&&(t|=128),e.push(t)}while(i>0);return Buffer.from(e.reverse())}function Xu(){let{privateKey:i,publicKey:e}=Kl.generateKeyPairSync("rsa",{modulusLength:2048}),t=e.export({type:"pkcs1",format:"der"}),n=365*24*60*60*1e3,r=new Date(new Date().getTime()-n),s=new Date(new Date().getTime()+n),o=ne.encodeSequence([ne.encodeExplicitContextDependent(0,ne.encodeInteger(1)),ne.encodeInteger(1),ne.encodeSequence([ne.encodeObjectIdentifier("1.2.840.113549.1.1.11"),ne.encodeNull()]),ne.encodeSequence([ne.encodeSet([ne.encodeSequence([ne.encodeObjectIdentifier("2.5.4.3"),ne.encodePrintableString("localhost")])]),ne.encodeSet([ne.encodeSequence([ne.encodeObjectIdentifier("2.5.4.10"),ne.encodePrintableString("Playwright Client Certificate Support")])])]),ne.encodeSequence([ne.encodeDate(r),ne.encodeDate(s)]),ne.encodeSequence([ne.encodeSet([ne.encodeSequence([ne.encodeObjectIdentifier("2.5.4.3"),ne.encodePrintableString("localhost")])]),ne.encodeSet([ne.encodeSequence([ne.encodeObjectIdentifier("2.5.4.10"),ne.encodePrintableString("Playwright Client Certificate Support")])])]),ne.encodeSequence([ne.encodeSequence([ne.encodeObjectIdentifier("1.2.840.113549.1.1.1"),ne.encodeNull()]),ne.encodeBitString(t)])]),l=Kl.sign("sha256",o,i);return{cert:["-----BEGIN CERTIFICATE-----",ne.encodeSequence([o,ne.encodeSequence([ne.encodeObjectIdentifier("1.2.840.113549.1.1.11"),ne.encodeNull()]),ne.encodeBitString(l)]).toString("base64").match(/.{1,64}/g).join(`
`),"-----END CERTIFICATE-----"].join(`
`),key:i.export({type:"pkcs1",format:"pem"})}}var ne,Jl=x(()=>{Li();ne=class{static encodeSequence(e){return this._encode(48,Buffer.concat(e))}static encodeInteger(e){return E(e>=-128&&e<=127),this._encode(2,Buffer.from([e]))}static encodeObjectIdentifier(e){let t=e.split(".").map(r=>Number(r)),n=[Ju(40*t[0]+t[1])];for(let r=2;r<t.length;r++)n.push(Ju(t[r]));return this._encode(6,Buffer.concat(n))}static encodeNull(){return Buffer.from([5,0])}static encodeSet(e){return E(e.length===1,"Only one item in the set is supported. We'd need to sort the data to support more."),this._encode(49,Buffer.concat(e))}static encodeExplicitContextDependent(e,t){return this._encode(160+e,t)}static encodePrintableString(e){return this._encode(19,Buffer.from(e))}static encodeBitString(e){let n=Buffer.concat([Buffer.from([0]),e]);return this._encode(3,n)}static encodeDate(e){let t=e.getUTCFullYear(),n=t>=2050,s=[n?t.toString():t.toString().slice(-2),(e.getUTCMonth()+1).toString().padStart(2,"0"),e.getUTCDate().toString().padStart(2,"0"),e.getUTCHours().toString().padStart(2,"0"),e.getUTCMinutes().toString().padStart(2,"0"),e.getUTCSeconds().toString().padStart(2,"0")].join("")+"Z",o=n?24:23;return this._encode(o,Buffer.from(s))}static _encode(e,t){let n=this._encodeLength(t.length);return Buffer.concat([Buffer.from([e]),n,t])}static _encodeLength(e){if(e<128)return Buffer.from([e]);{let t=[];for(;e>0;)t.unshift(e&255),e>>=8;return Buffer.from([128|t.length,...t])}}}});var Xl,N,uo,Rr,Te=x(()=>{Xl=class{_debuggers=new Map;constructor(){if(process.env.DEBUG_FILE){let e=new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|"),"g"),t=fs.createWriteStream(process.env.DEBUG_FILE);debug.log=n=>{t.write(n.replace(e,"")),t.write(`
`)}}}log(e,t){console.log(`[${e}] ${t}`)}isEnabled(e){return!1}},N=new Xl,uo=150,Rr=class{_logs=[];log(e){this._logs.push(e),this._logs.length===uo*2&&this._logs.splice(0,uo)}recentLogs(){return this._logs.length>uo?this._logs.slice(-uo):this._logs}}});var Ql,L,It=x(()=>{Ql=class{static addEventListener(e,t,n){return e.on(t,n),{emitter:e,eventName:t,handler:n}}static removeEventListeners(e){for(let t of e)t.emitter.removeListener(t.eventName,t.handler);e.splice(0,e.length)}},L=Ql});function ut(i,e="'"){let t=JSON.stringify(i),n=t.substring(1,t.length-1).replace(/\\"/g,'"');if(e==="'")return e+n.replace(/[']/g,"\\'")+e;if(e==='"')return e+n.replace(/["]/g,'\\"')+e;if(e==="`")return e+n.replace(/[`]/g,"`")+e;throw new Error("Invalid escape char")}function ae(i){return typeof i=="string"||i instanceof String}function Oi(i){return i.charAt(0).toUpperCase()+i.substring(1)}function Ar(i){return i.replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/([A-Z])([A-Z][a-z])/g,"$1_$2").toLowerCase()}function Mg(i){let e="";for(let t=0;t<i.length;t++)e+=Ng(i,t);return e}function Yl(i){return`"${Mg(i).replace(/\\ /g," ")}"`}function Ng(i,e){let t=i.charCodeAt(e);return t===0?"\uFFFD":t>=1&&t<=31||t>=48&&t<=57&&(e===0||e===1&&i.charCodeAt(0)===45)?"\\"+t.toString(16)+" ":e===0&&t===45&&i.length===1?"\\"+i.charAt(e):t>=128||t===45||t===95||t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122?i.charAt(e):"\\"+i.charAt(e)}function Mi(i){return i.replace(/(^|[^\\])(\\\\)*\\(['"`])/g,"$1$2$3")}function Qu(i){return i.unicode||i.unicodeSets?String(i):String(i).replace(/(^|[^\\])(\\\\)*(["'`])/g,"$1$2\\$3").replace(/>>/g,"\\>\\>")}function un(i,e){return typeof i!="string"?Qu(i):`${JSON.stringify(i)}${e?"s":"i"}`}function An(i,e){return typeof i!="string"?Qu(i):`"${i.replace(/\\/g,"\\\\").replace(/["]/g,'\\"')}"${e?"s":"i"}`}function Hg(i,e,t=""){if(i.length<=e)return i;let n=[...i];return n.length>e?n.slice(0,e-t.length).join("")+t:n.join("")}function Zl(i,e){return Hg(i,e,"\u2026")}function Yu(i){return i.replace(/[&<]/ug,e=>Dg[e])}var Dg,Fn=x(()=>{Dg={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}});function je(i){return i instanceof RegExp||Object.prototype.toString.call(i)==="[object RegExp]"}function Zu(i){return typeof i=="object"&&i!==null}function ho(i){return i instanceof Error||i&&Object.getPrototypeOf(i)?.name==="Error"}var ec=x(()=>{Fn()});function eh(i,e={}){return i.map(t=>({string:ae(t)?t:void 0,regexSource:je(t)?t.source:void 0,regexFlags:je(t)?t.flags:void 0,matchSubstring:e.matchSubstring,ignoreCase:e.ignoreCase,normalizeWhiteSpace:e.normalizeWhiteSpace}))}var th=x(()=>{ec()});function nh(i){return null}var rh=x(()=>{});function ve(i,e){let t=(i.stack?.split(`
`)||[]).filter(r=>r.startsWith("    at "));i.message=e;let n=`${i.name}: ${i.message}`;return t.length&&(i.stack=`${n}
${t.join(`
`)}`),i}function tc(){let i=Error.stackTraceLimit;Error.stackTraceLimit=50;let t=new Error().stack||"";return Error.stackTraceLimit=i,t.split(`
`)}function sh(){let i=tc(),e=ce(),t=i.map(s=>{let o=nh(s);if(!o||!o.file)return null;let l=o.file.startsWith(ih);return{frame:o,frameText:s,isPlaywrightLibrary:l}}).filter(Boolean),n="";for(let s=0;s<t.length-1;s++){let o=t[s];if(o.isPlaywrightLibrary&&!t[s+1].isPlaywrightLibrary){n=n||r(o.frame.function);break}}function r(s){if(!s)return"";let o=s.match(/(API|JS|CDP|[A-Z])(.*)/);return o?o[1].toLowerCase()+o[2]:s}return t=t.filter(s=>process.env.PWDEBUGIMPL?!0:!Bg.some(o=>s.frame.file.startsWith(o))),{frames:t.map(s=>s.frame),apiName:n}}function oh(i){let e=[];for(let t of i)t.function?e.push(`    at ${t.function} (${t.file}:${t.line}:${t.column})`):e.push(`    at ${t.file}:${t.line}:${t.column}`);return e}function ah(i){let e=i.indexOf(":");return{name:e!==-1?i.slice(0,e):"",message:e!==-1&&e+2<=i.length?i.substring(e+2):i}}function lh(i){return!i||!i.some(e=>!!e)?"":`
Call log:
  ${"- "+(i||[]).join(`
  - `)}
`}var ih,Bg,Lt=x(()=>{rh();O();ih="/tmp",Bg=[ih]});function ch(i,e){let t=new Error;return t.name=i.name,t.message=i.message,t.stack=[i.name+":"+i.message,...e].join(`
`),t}var U,Re,qe=x(()=>{Lt();U=class extends Promise{_resolve;_reject;_isDone;constructor(){let e,t;super((n,r)=>{e=n,t=r}),this._isDone=!1,this._resolve=e,this._reject=t}isDone(){return this._isDone}resolve(e){this._isDone=!0,this._resolve(e)}reject(e){this._isDone=!0,this._reject(e)}static get[Symbol.species](){return Promise}get[Symbol.toStringTag](){return"ManualPromise"}},Re=class{_terminateError;_closeError;_terminatePromises=new Map;_isClosed=!1;reject(e){this._isClosed=!0,this._terminateError=e;for(let t of this._terminatePromises.keys())t.resolve(e)}close(e){this._isClosed=!0,this._closeError=e;for(let[t,n]of this._terminatePromises)t.resolve(ch(e,n))}isClosed(){return this._isClosed}static async raceMultiple(e,t){return Promise.race(e.map(n=>n.race(t)))}async race(e){return this._race(Array.isArray(e)?e:[e],!1)}async safeRace(e,t){return this._race([e],!0,t)}async _race(e,t,n){let r=new U,s=tc();this._terminateError&&r.resolve(this._terminateError),this._closeError&&r.resolve(ch(this._closeError,s)),this._terminatePromises.set(r,s);try{return await Promise.race([r.then(o=>t?n:Promise.reject(o)),...e])}finally{this._terminatePromises.delete(r)}}}});import $g from"path";async function We(i){await fs.promises.mkdir($g.dirname(i),{recursive:!0}).catch(()=>{})}async function In(i){return await Promise.all(i.map(e=>fs.promises.rm(e,{recursive:!0,force:!0,maxRetries:10}).catch(t=>t)))}function fo(i){if(!i)return!1;try{return fs.accessSync(i),!0}catch{return!1}}var mo,zt,po,_t=x(()=>{qe();mo=50*1024*1024,zt=i=>new Promise(e=>fs.stat(i,t=>e(!t)));po=class{_buffers=new Map;_error;_operations=[];_operationsDone;constructor(){this._operationsDone=new U,this._operationsDone.resolve()}mkdir(e){this._appendOperation({op:"mkdir",dir:e})}writeFile(e,t,n){this._buffers.delete(e),this._appendOperation({op:"writeFile",file:e,content:t,skipIfExists:n})}appendFile(e,t,n){this._buffers.has(e)||this._buffers.set(e,[]),this._buffers.get(e).push(t),n&&this._flushFile(e)}_flushFile(e){let t=this._buffers.get(e);if(t===void 0)return;let n=t.join("");this._buffers.delete(e),this._appendOperation({op:"appendFile",file:e,content:n})}copyFile(e,t){this._flushFile(e),this._buffers.delete(t),this._appendOperation({op:"copyFile",from:e,to:t})}async syncAndGetError(){for(let e of this._buffers.keys())this._flushFile(e);return await this._operationsDone,this._error}zip(e,t){for(let n of this._buffers.keys())this._flushFile(n);this._appendOperation({op:"zip",entries:e,zipFileName:t})}_appendOperation(e){let t=this._operations[this._operations.length-1];if(t?.op==="appendFile"&&e.op==="appendFile"&&t.file===e.file){t.content+=e.content;return}this._operations.push(e),this._operationsDone.isDone()&&this._performOperations()}async _performOperations(){for(this._operationsDone=new U;this._operations.length;){let e=this._operations.shift();if(!this._error)try{await this._performOperation(e)}catch(t){this._error=t}}this._operationsDone.resolve()}async _performOperation(e){switch(e.op){case"mkdir":{await fs.promises.mkdir(e.dir,{recursive:!0});return}case"writeFile":{e.skipIfExists?await fs.promises.writeFile(e.file,e.content,{flag:"wx"}).catch(()=>{}):await fs.promises.writeFile(e.file,e.content);return}case"copyFile":{await fs.promises.copyFile(e.from,e.to);return}case"appendFile":{await fs.promises.appendFile(e.file,e.content);return}case"zip":{let t=new yazl.ZipFile,n=new U;t.on("error",r=>n.reject(r));for(let r of e.entries)t.addFile(r.value,r.name);t.end(),t.outputStream.pipe(fs.createWriteStream(e.zipFileName)).on("close",()=>n.resolve()).on("error",r=>n.reject(r)),await n;return}}}}});function Ce(i,e,t){t||(t=e);let n=[];for(let r in i){let s=i[r];if(s!==void 0)if(e){let o=r.toLowerCase()==="set-cookie"?t:e;for(let l of s.split(o))n.push({name:r,value:l.trim()})}else n.push({name:r,value:s})}return n}function go(i,e){let t={};for(let{name:n,value:r}of i)t[e?n.toLowerCase():n]=r;return t}var dh=x(()=>{});function jg(){return{hostPlatform:"<unknown>",isOfficiallySupportedPlatform:!0}}var hn,nc,wo=x(()=>{({hostPlatform:hn,isOfficiallySupportedPlatform:nc}=jg())});var rc=x(()=>{Li();kr();qe();Jl()});function st(i){return Ae(i,48,57)}function uh(i){return st(i)||Ae(i,65,70)||Ae(i,97,102)}function qg(i){return Ae(i,65,90)}function Wg(i){return Ae(i,97,122)}function zg(i){return qg(i)||Wg(i)}function Ug(i){return i>=128}function bo(i){return zg(i)||Ug(i)||i===95}function hh(i){return bo(i)||st(i)||i===45}function Vg(i){return Ae(i,0,8)||i===11||Ae(i,14,31)||i===127}function Fr(i){return i===10}function pn(i){return Fr(i)||i===9||i===32}function Kg(i){let e=[];for(let t=0;t<i.length;t++){let n=i.charCodeAt(t);if(n===13&&i.charCodeAt(t+1)===10&&(n=10,t++),(n===13||n===12)&&(n=10),n===0&&(n=65533),Ae(n,55296,56319)&&Ae(i.charCodeAt(t+1),56320,57343)){let r=n-55296,s=i.charCodeAt(t+1)-56320;n=Math.pow(2,16)+r*Math.pow(2,10)+s,t++}e.push(n)}return e}function Fe(i){if(i<=65535)return String.fromCharCode(i);i-=Math.pow(2,16);let e=Math.floor(i/Math.pow(2,10))+55296,t=i%Math.pow(2,10)+56320;return String.fromCharCode(e)+String.fromCharCode(t)}function ph(i){let e=Kg(i),t=-1,n=[],r,s=0,o=0,l=0,c=function(){s+=1,l=o,o=0},h={line:s,column:o},m=function(M){return M>=e.length?-1:e[M]},f=function(M){if(M===void 0&&(M=1),M>3)throw"Spec Error: no more than three codepoints of lookahead.";return m(t+M)},g=function(M){return M===void 0&&(M=1),t+=M,r=m(t),Fr(r)?c():o+=M,!0},b=function(){return t-=1,Fr(r)?(s-=1,o=l):o-=1,h.line=s,h.column=o,!0},v=function(M){return M===void 0&&(M=r),M===-1},S=function(){},_=function(){},k=function(){if(D(),g(),pn(r)){for(;pn(f());)g();return new Ir}else{if(r===34)return I();if(r===35)if(hh(f())||W(f(1),f(2))){let M=new Qi("");return J(f(1),f(2),f(3))&&(M.type="id"),M.value=te(),M}else return new Ie(r);else return r===36?f()===61?(g(),new ac):new Ie(r):r===39?I():r===40?new Vi:r===41?new Gi:r===42?f()===61?(g(),new lc):new Ie(r):r===43?$e()?(b(),H()):new Ie(r):r===44?new qi:r===45?$e()?(b(),H()):f(1)===45&&f(2)===62?(g(2),new Bi):oe()?(b(),A()):new Ie(r):r===46?$e()?(b(),H()):new Ie(r):r===58?new $i:r===59?new ji:r===60?f(1)===33&&f(2)===45&&f(3)===45?(g(3),new Di):new Ie(r):r===64?J(f(1),f(2),f(3))?new Xi(te()):new Ie(r):r===91?new Ui:r===92?C()?(b(),A()):(_(),new Ie(r)):r===93?new Lr:r===94?f()===61?(g(),new oc):new Ie(r):r===123?new Wi:r===124?f()===61?(g(),new sc):f()===124?(g(),new Ki):new Ie(r):r===125?new zi:r===126?f()===61?(g(),new ic):new Ie(r):st(r)?(b(),H()):bo(r)?(b(),A()):v()?new rr:new Ie(r)}},D=function(){for(;f(1)===47&&f(2)===42;)for(g(2);;)if(g(),r===42&&f()===47){g();break}else if(v()){_();return}},H=function(){let M=Se();if(J(f(1),f(2),f(3))){let Q=new cc;return Q.value=M.value,Q.repr=M.repr,Q.type=M.type,Q.unit=te(),Q}else if(f()===37){g();let Q=new ts;return Q.value=M.value,Q.repr=M.repr,Q}else{let Q=new es;return Q.value=M.value,Q.repr=M.repr,Q.type=M.type,Q}},A=function(){let M=te();if(M.toLowerCase()==="url"&&f()===40){for(g();pn(f(1))&&pn(f(2));)g();return f()===34||f()===39?new nr(M):pn(f())&&(f(2)===34||f(2)===39)?new nr(M):F()}else return f()===40?(g(),new nr(M)):new Ji(M)},I=function(M){M===void 0&&(M=r);let Q="";for(;g();){if(r===M||v())return new Yi(Q);if(Fr(r))return _(),b(),new Hi;r===92?v(f())?S():Fr(f())?g():Q+=Fe(q()):Q+=Fe(r)}throw new Error("Internal error")},F=function(){let M=new Zi("");for(;pn(f());)g();if(v(f()))return M;for(;g();){if(r===41||v())return M;if(pn(r)){for(;pn(f());)g();return f()===41||v(f())?(g(),M):(Pe(),new tr)}else{if(r===34||r===39||r===40||Vg(r))return _(),Pe(),new tr;if(r===92)if(C())M.value+=Fe(q());else return _(),Pe(),new tr;else M.value+=Fe(r)}}throw new Error("Internal error")},q=function(){if(g(),uh(r)){let M=[r];for(let ee=0;ee<5&&uh(f());ee++)g(),M.push(r);pn(f())&&g();let Q=parseInt(M.map(function(ee){return String.fromCharCode(ee)}).join(""),16);return Q>Gg&&(Q=65533),Q}else return v()?65533:r},W=function(M,Q){return!(M!==92||Fr(Q))},C=function(){return W(r,f())},J=function(M,Q,ee){return M===45?bo(Q)||Q===45||W(Q,ee):bo(M)?!0:M===92?W(M,Q):!1},oe=function(){return J(r,f(1),f(2))},Ze=function(M,Q,ee){return M===43||M===45?!!(st(Q)||Q===46&&st(ee)):M===46?!!st(Q):!!st(M)},$e=function(){return Ze(r,f(1),f(2))},te=function(){let M="";for(;g();)if(hh(r))M+=Fe(r);else if(C())M+=Fe(q());else return b(),M;throw new Error("Internal parse error")},Se=function(){let M="",Q="integer";for((f()===43||f()===45)&&(g(),M+=Fe(r));st(f());)g(),M+=Fe(r);if(f(1)===46&&st(f(2)))for(g(),M+=Fe(r),g(),M+=Fe(r),Q="number";st(f());)g(),M+=Fe(r);let ee=f(1),an=f(2),et=f(3);if((ee===69||ee===101)&&st(an))for(g(),M+=Fe(r),g(),M+=Fe(r),Q="number";st(f());)g(),M+=Fe(r);else if((ee===69||ee===101)&&(an===43||an===45)&&st(et))for(g(),M+=Fe(r),g(),M+=Fe(r),g(),M+=Fe(r),Q="number";st(f());)g(),M+=Fe(r);let Tn=ie(M);return{type:Q,value:Tn,repr:M}},ie=function(M){return+M},Pe=function(){for(;g();){if(r===41||v())return;C()&&q(),S()}},jt=0;for(;!v(f());)if(n.push(k()),jt++,jt>e.length*2)throw new Error("I'm infinite-looping!");return n}function ns(i){i=""+i;let e="",t=i.charCodeAt(0);for(let n=0;n<i.length;n++){let r=i.charCodeAt(n);if(r===0)throw new Ni("Invalid character: the input contains U+0000.");Ae(r,1,31)||r===127||n===0&&Ae(r,48,57)||n===1&&Ae(r,48,57)&&t===45?e+="\\"+r.toString(16)+" ":r>=128||r===45||r===95||Ae(r,48,57)||Ae(r,65,90)||Ae(r,97,122)?e+=i[n]:e+="\\"+i[n]}return e}function Jg(i){i=""+i;let e="";for(let t=0;t<i.length;t++){let n=i.charCodeAt(t);if(n===0)throw new Ni("Invalid character: the input contains U+0000.");n>=128||n===45||n===95||Ae(n,48,57)||Ae(n,65,90)||Ae(n,97,122)?e+=i[t]:e+="\\"+n.toString(16)+" "}return e}function mh(i){i=""+i;let e="";for(let t=0;t<i.length;t++){let n=i.charCodeAt(t);if(n===0)throw new Ni("Invalid character: the input contains U+0000.");Ae(n,1,31)||n===127?e+="\\"+n.toString(16)+" ":n===34||n===92?e+="\\"+i[t]:e+=i[t]}return e}var Ae,Gg,Ni,be,Hi,tr,Ir,Di,Bi,$i,ji,qi,Ln,Wi,zi,Ui,Lr,Vi,Gi,ic,sc,oc,ac,lc,Ki,rr,Ie,On,Ji,nr,Xi,Qi,Yi,Zi,es,ts,cc,fh=x(()=>{Ae=function(i,e,t){return i>=e&&i<=t};Gg=1114111,Ni=class extends Error{constructor(e){super(e),this.name="InvalidCharacterError"}};be=class{tokenType="";value;toJSON(){return{token:this.tokenType}}toString(){return this.tokenType}toSource(){return""+this}},Hi=class extends be{tokenType="BADSTRING"},tr=class extends be{tokenType="BADURL"},Ir=class extends be{tokenType="WHITESPACE";toString(){return"WS"}toSource(){return" "}},Di=class extends be{tokenType="CDO";toSource(){return"<!--"}},Bi=class extends be{tokenType="CDC";toSource(){return"-->"}},$i=class extends be{tokenType=":"},ji=class extends be{tokenType=";"},qi=class extends be{tokenType=","},Ln=class extends be{value="";mirror=""},Wi=class extends Ln{tokenType="{";constructor(){super(),this.value="{",this.mirror="}"}},zi=class extends Ln{tokenType="}";constructor(){super(),this.value="}",this.mirror="{"}},Ui=class extends Ln{tokenType="[";constructor(){super(),this.value="[",this.mirror="]"}},Lr=class extends Ln{tokenType="]";constructor(){super(),this.value="]",this.mirror="["}},Vi=class extends Ln{tokenType="(";constructor(){super(),this.value="(",this.mirror=")"}},Gi=class extends Ln{tokenType=")";constructor(){super(),this.value=")",this.mirror="("}},ic=class extends be{tokenType="~="},sc=class extends be{tokenType="|="},oc=class extends be{tokenType="^="},ac=class extends be{tokenType="$="},lc=class extends be{tokenType="*="},Ki=class extends be{tokenType="||"},rr=class extends be{tokenType="EOF";toSource(){return""}},Ie=class extends be{tokenType="DELIM";value="";constructor(e){super(),this.value=Fe(e)}toString(){return"DELIM("+this.value+")"}toJSON(){let e=this.constructor.prototype.constructor.prototype.toJSON.call(this);return e.value=this.value,e}toSource(){return this.value==="\\"?`\\
`:this.value}},On=class extends be{value="";ASCIIMatch(e){return this.value.toLowerCase()===e.toLowerCase()}toJSON(){let e=this.constructor.prototype.constructor.prototype.toJSON.call(this);return e.value=this.value,e}},Ji=class extends On{constructor(e){super(),this.value=e}tokenType="IDENT";toString(){return"IDENT("+this.value+")"}toSource(){return ns(this.value)}},nr=class extends On{tokenType="FUNCTION";mirror;constructor(e){super(),this.value=e,this.mirror=")"}toString(){return"FUNCTION("+this.value+")"}toSource(){return ns(this.value)+"("}},Xi=class extends On{tokenType="AT-KEYWORD";constructor(e){super(),this.value=e}toString(){return"AT("+this.value+")"}toSource(){return"@"+ns(this.value)}},Qi=class extends On{tokenType="HASH";type;constructor(e){super(),this.value=e,this.type="unrestricted"}toString(){return"HASH("+this.value+")"}toJSON(){let e=this.constructor.prototype.constructor.prototype.toJSON.call(this);return e.value=this.value,e.type=this.type,e}toSource(){return this.type==="id"?"#"+ns(this.value):"#"+Jg(this.value)}},Yi=class extends On{tokenType="STRING";constructor(e){super(),this.value=e}toString(){return'"'+mh(this.value)+'"'}},Zi=class extends On{tokenType="URL";constructor(e){super(),this.value=e}toString(){return"URL("+this.value+")"}toSource(){return'url("'+mh(this.value)+'")'}},es=class extends be{tokenType="NUMBER";type;repr;constructor(){super(),this.type="integer",this.repr=""}toString(){return this.type==="integer"?"INT("+this.value+")":"NUMBER("+this.value+")"}toJSON(){let e=super.toJSON();return e.value=this.value,e.type=this.type,e.repr=this.repr,e}toSource(){return this.repr}},ts=class extends be{tokenType="PERCENTAGE";repr;constructor(){super(),this.repr=""}toString(){return"PERCENTAGE("+this.value+")"}toJSON(){let e=this.constructor.prototype.constructor.prototype.toJSON.call(this);return e.value=this.value,e.repr=this.repr,e}toSource(){return this.repr+"%"}},cc=class extends be{tokenType="DIMENSION";type;repr;unit;constructor(){super(),this.type="integer",this.repr="",this.unit=""}toString(){return"DIM("+this.value+","+this.unit+")"}toJSON(){let e=this.constructor.prototype.constructor.prototype.toJSON.call(this);return e.value=this.value,e.type=this.type,e.repr=this.repr,e.unit=this.unit,e}toSource(){let e=this.repr,t=ns(this.unit);return t[0].toLowerCase()==="e"&&(t[1]==="-"||Ae(t.charCodeAt(1),48,57))&&(t="\\65 "+t.slice(1,t.length)),e+t}}});function Mn(i){return i instanceof me}function gh(i,e){let t;try{t=ph(i),t[t.length-1]instanceof rr||t.push(new rr)}catch(C){let J=C.message+` while parsing selector "${i}"`,oe=(C.stack||"").indexOf(C.message);throw oe!==-1&&(C.stack=C.stack.substring(0,oe)+J+C.stack.substring(oe+C.message.length)),C.message=J,C}let n=t.find(C=>C instanceof Xi||C instanceof Hi||C instanceof tr||C instanceof Ki||C instanceof Di||C instanceof Bi||C instanceof ji||C instanceof Wi||C instanceof zi||C instanceof Zi||C instanceof ts);if(n)throw new me(`Unsupported token "${n.toSource()}" while parsing selector "${i}"`);let r=0,s=new Set;function o(){return new me(`Unexpected token "${t[r].toSource()}" while parsing selector "${i}"`)}function l(){for(;t[r]instanceof Ir;)r++}function c(C=r){return t[C]instanceof Ji}function h(C=r){return t[C]instanceof Yi}function m(C=r){return t[C]instanceof es}function f(C=r){return t[C]instanceof qi}function g(C=r){return t[C]instanceof Vi}function b(C=r){return t[C]instanceof Gi}function v(C=r){return t[C]instanceof nr}function S(C=r){return t[C]instanceof Ie&&t[C].value==="*"}function _(C=r){return t[C]instanceof rr}function k(C=r){return t[C]instanceof Ie&&[">","+","~"].includes(t[C].value)}function D(C=r){return f(C)||b(C)||_(C)||k(C)||t[C]instanceof Ir}function H(){let C=[A()];for(;l(),!!f();)r++,C.push(A());return C}function A(){return l(),m()||h()?t[r++].value:I()}function I(){let C={simples:[]};for(l(),k()?C.simples.push({selector:{functions:[{name:"scope",args:[]}]},combinator:""}):C.simples.push({selector:F(),combinator:""});;){if(l(),k())C.simples[C.simples.length-1].combinator=t[r++].value,l();else if(D())break;C.simples.push({combinator:"",selector:F()})}return C}function F(){let C="",J=[];for(;!D();)if(c()||S())C+=t[r++].toSource();else if(t[r]instanceof Qi)C+=t[r++].toSource();else if(t[r]instanceof Ie&&t[r].value===".")if(r++,c())C+="."+t[r++].toSource();else throw o();else if(t[r]instanceof $i)if(r++,c())if(!e.has(t[r].value.toLowerCase()))C+=":"+t[r++].toSource();else{let oe=t[r++].value.toLowerCase();J.push({name:oe,args:[]}),s.add(oe)}else if(v()){let oe=t[r++].value.toLowerCase();if(e.has(oe)?(J.push({name:oe,args:H()}),s.add(oe)):C+=`:${oe}(${q()})`,l(),!b())throw o();r++}else throw o();else if(t[r]instanceof Ui){for(C+="[",r++;!(t[r]instanceof Lr)&&!_();)C+=t[r++].toSource();if(!(t[r]instanceof Lr))throw o();C+="]",r++}else throw o();if(!C&&!J.length)throw o();return{css:C||void 0,functions:J}}function q(){let C="",J=1;for(;!_()&&((g()||v())&&J++,b()&&J--,!!J);)C+=t[r++].toSource();return C}let W=H();if(!_())throw o();if(W.some(C=>typeof C!="object"||!("simples"in C)))throw new me(`Error while parsing selector "${i}"`);return{selector:W,names:Array.from(s)}}var me,dc=x(()=>{fh();me=class extends Error{}});function Nn(i){let e=ew(i),t=[];for(let n of e.parts){if(n.name==="css"||n.name==="css:light"){n.name==="css:light"&&(n.body=":light("+n.body+")");let r=gh(n.body,Yg);t.push({name:"css",body:r.selector,source:n.body});continue}if(uc.has(n.name)){let r,s;try{let h=JSON.parse("["+n.body+"]");if(!Array.isArray(h)||h.length<1||h.length>2||typeof h[0]!="string")throw new me(`Malformed selector: ${n.name}=`+n.body);if(r=h[0],h.length===2){if(typeof h[1]!="number"||!Qg.has(n.name))throw new me(`Malformed selector: ${n.name}=`+n.body);s=h[1]}}catch{throw new me(`Malformed selector: ${n.name}=`+n.body)}let o={name:n.name,source:n.body,body:{parsed:Nn(r),distance:s}},l=[...o.body.parsed.parts].reverse().find(h=>h.name==="internal:control"&&h.body==="enter-frame"),c=l?o.body.parsed.parts.indexOf(l):-1;c!==-1&&Zg(o.body.parsed.parts.slice(0,c+1),t.slice(0,c+1))&&o.body.parsed.parts.splice(0,c+1),t.push(o);continue}t.push({...n,source:n.body})}if(uc.has(t[0].name))throw new me(`"${t[0].name}" selector cannot be first`);return{capture:e.capture,parts:t}}function wh(i){let e=Nn(i),t=[],n={parts:[]},r=0;for(let s=0;s<e.parts.length;++s){let o=e.parts[s];if(o.name==="internal:control"&&o.body==="enter-frame"){if(!n.parts.length)throw new me("Selector cannot start with entering frame, select the iframe first");t.push(n),n={parts:[]},r=s+1;continue}e.capture===s&&(n.capture=s-r),n.parts.push(o)}if(!n.parts.length)throw new me(`Selector cannot end with entering frame, while parsing selector ${i}`);if(t.push(n),typeof e.capture=="number"&&typeof t[t.length-1].capture!="number")throw new me("Can not capture the selector before diving into the frame. Only use * after the last frame has been selected");return t}function Zg(i,e){return mn({parts:i})===mn({parts:e})}function mn(i,e){return typeof i=="string"?i:i.parts.map((t,n)=>{let r=!0;!e&&n!==i.capture&&(t.name==="css"||t.name==="xpath"&&t.source.startsWith("//")||t.source.startsWith(".."))&&(r=!1);let s=r?t.name+"=":"";return`${n===i.capture?"*":""}${s}${t.source}`}).join(" >> ")}function yo(i,e){let t=(n,r)=>{for(let s of n.parts)e(s,r),uc.has(s.name)&&t(s.body.parsed,!0)};t(i,!1)}function ew(i){let e=0,t,n=0,r={parts:[]},s=()=>{let l=i.substring(n,e).trim(),c=l.indexOf("="),h,m;c!==-1&&l.substring(0,c).trim().match(/^[a-zA-Z_0-9-+:*]+$/)?(h=l.substring(0,c).trim(),m=l.substring(c+1)):l.length>1&&l[0]==='"'&&l[l.length-1]==='"'||l.length>1&&l[0]==="'"&&l[l.length-1]==="'"?(h="text",m=l):/^\(*\/\//.test(l)||l.startsWith("..")?(h="xpath",m=l):(h="css",m=l);let f=!1;if(h[0]==="*"&&(f=!0,h=h.substring(1)),r.parts.push({name:h,body:m}),f){if(r.capture!==void 0)throw new me("Only one of the selectors can capture using * modifier");r.capture=r.parts.length-1}};if(!i.includes(">>"))return e=i.length,s(),r;let o=()=>{let c=i.substring(n,e).match(/^\s*text\s*=(.*)$/);return!!c&&!!c[1]};for(;e<i.length;){let l=i[e];l==="\\"&&e+1<i.length?e+=2:l===t?(t=void 0,e++):!t&&(l==='"'||l==="'"||l==="`")&&!o()?(t=l,e++):!t&&l===">"&&i[e+1]===">"?(s(),e+=2,n=e):e++}return s(),r}function _o(i,e){let t=0,n=i.length===0,r=()=>i[t]||"",s=()=>{let _=r();return++t,n=t>=i.length,_},o=_=>{throw n?new me(`Unexpected end of selector while parsing selector \`${i}\``):new me(`Error while parsing selector \`${i}\` - unexpected symbol "${r()}" at position ${t}`+(_?" during "+_:""))};function l(){for(;!n&&/\s/.test(r());)s()}function c(_){return _>="\x80"||_>="0"&&_<="9"||_>="A"&&_<="Z"||_>="a"&&_<="z"||_>="0"&&_<="9"||_==="_"||_==="-"}function h(){let _="";for(l();!n&&c(r());)_+=s();return _}function m(_){let k=s();for(k!==_&&o("parsing quoted string");!n&&r()!==_;)r()==="\\"&&s(),k+=s();return r()!==_&&o("parsing quoted string"),k+=s(),k}function f(){s()!=="/"&&o("parsing regular expression");let _="",k=!1;for(;!n;){if(r()==="\\")_+=s(),n&&o("parsing regular expression");else if(k&&r()==="]")k=!1;else if(!k&&r()==="[")k=!0;else if(!k&&r()==="/")break;_+=s()}s()!=="/"&&o("parsing regular expression");let D="";for(;!n&&r().match(/[dgimsuy]/);)D+=s();try{return new RegExp(_,D)}catch(H){throw new me(`Error while parsing selector \`${i}\`: ${H.message}`)}}function g(){let _="";return l(),r()==="'"||r()==='"'?_=m(r()).slice(1,-1):_=h(),_||o("parsing property path"),_}function b(){l();let _="";return n||(_+=s()),!n&&_!=="="&&(_+=s()),["=","*=","^=","$=","|=","~="].includes(_)||o("parsing operator"),_}function v(){s();let _=[];for(_.push(g()),l();r()===".";)s(),_.push(g()),l();if(r()==="]")return s(),{name:_.join("."),jsonPath:_,op:"<truthy>",value:null,caseSensitive:!1};let k=b(),D,H=!0;if(l(),r()==="/"){if(k!=="=")throw new me(`Error while parsing selector \`${i}\` - cannot use ${k} in attribute with regular expression`);D=f()}else if(r()==="'"||r()==='"')D=m(r()).slice(1,-1),l(),r()==="i"||r()==="I"?(H=!1,s()):(r()==="s"||r()==="S")&&(H=!0,s());else{for(D="";!n&&(c(r())||r()==="+"||r()===".");)D+=s();D==="true"?D=!0:D==="false"?D=!1:e||(D=+D,Number.isNaN(D)&&o("parsing attribute value"))}if(l(),r()!=="]"&&o("parsing attribute value"),s(),k!=="="&&typeof D!="string")throw new me(`Error while parsing selector \`${i}\` - cannot use ${k} in attribute with non-string matching value - ${D}`);return{name:_.join("."),jsonPath:_,op:k,value:D,caseSensitive:H}}let S={name:"",attributes:[]};for(S.name=h(),l();r()==="[";)S.attributes.push(v()),l();if(n||o(void 0),!S.name&&!S.attributes.length)throw new me(`Error while parsing selector \`${i}\` - selector cannot be empty`);return S}var uc,Qg,Yg,ir=x(()=>{dc();dc();uc=new Set(["internal:has","internal:has-not","internal:and","internal:or","internal:chain","left-of","right-of","above","below","near"]),Qg=new Set(["left-of","right-of","above","below","near"]),Yg=new Set(["not","is","where","has","scope","light","visible","text","text-matches","text-is","has-text","above","below","right-of","left-of","near","nth-match"])});function ke(i,e,t=!1){return wc(i,e,t)[0]}function wc(i,e,t=!1,n=20,r){try{return Or(new nw[i](r),Nn(e),t,n)}catch{return[e]}}function Or(i,e,t=!1,n=20){let r=[...e.parts];for(let l=0;l<r.length-1;l++)if(r[l].name==="nth"&&r[l+1].name==="internal:control"&&r[l+1].body==="enter-frame"){let[c]=r.splice(l,1);r.splice(l+1,0,c)}let s=[],o=t?"frame-locator":"page";for(let l=0;l<r.length;l++){let c=r[l],h=o;if(o="locator",c.name==="nth"){c.body==="0"?s.push([i.generateLocator(h,"first",""),i.generateLocator(h,"nth","0")]):c.body==="-1"?s.push([i.generateLocator(h,"last",""),i.generateLocator(h,"nth","-1")]):s.push([i.generateLocator(h,"nth",c.body)]);continue}if(c.name==="internal:text"){let{exact:S,text:_}=rs(c.body);s.push([i.generateLocator(h,"text",_,{exact:S})]);continue}if(c.name==="internal:has-text"){let{exact:S,text:_}=rs(c.body);if(!S){s.push([i.generateLocator(h,"has-text",_,{exact:S})]);continue}}if(c.name==="internal:has-not-text"){let{exact:S,text:_}=rs(c.body);if(!S){s.push([i.generateLocator(h,"has-not-text",_,{exact:S})]);continue}}if(c.name==="internal:has"){let S=Or(i,c.body.parsed,!1,n);s.push(S.map(_=>i.generateLocator(h,"has",_)));continue}if(c.name==="internal:has-not"){let S=Or(i,c.body.parsed,!1,n);s.push(S.map(_=>i.generateLocator(h,"hasNot",_)));continue}if(c.name==="internal:and"){let S=Or(i,c.body.parsed,!1,n);s.push(S.map(_=>i.generateLocator(h,"and",_)));continue}if(c.name==="internal:or"){let S=Or(i,c.body.parsed,!1,n);s.push(S.map(_=>i.generateLocator(h,"or",_)));continue}if(c.name==="internal:chain"){let S=Or(i,c.body.parsed,!1,n);s.push(S.map(_=>i.generateLocator(h,"chain",_)));continue}if(c.name==="internal:label"){let{exact:S,text:_}=rs(c.body);s.push([i.generateLocator(h,"label",_,{exact:S})]);continue}if(c.name==="internal:role"){let S=_o(c.body,!0),_={attrs:[]};for(let k of S.attributes)k.name==="name"?(_.exact=k.caseSensitive,_.name=k.value):(k.name==="level"&&typeof k.value=="string"&&(k.value=+k.value),_.attrs.push({name:k.name==="include-hidden"?"includeHidden":k.name,value:k.value}));s.push([i.generateLocator(h,"role",S.name,_)]);continue}if(c.name==="internal:testid"){let S=_o(c.body,!0),{value:_}=S.attributes[0];s.push([i.generateLocator(h,"test-id",_)]);continue}if(c.name==="internal:attr"){let S=_o(c.body,!0),{name:_,value:k,caseSensitive:D}=S.attributes[0],H=k,A=!!D;if(_==="placeholder"){s.push([i.generateLocator(h,"placeholder",H,{exact:A})]);continue}if(_==="alt"){s.push([i.generateLocator(h,"alt",H,{exact:A})]);continue}if(_==="title"){s.push([i.generateLocator(h,"title",H,{exact:A})]);continue}}let m="default",f=r[l+1];f&&f.name==="internal:control"&&f.body==="enter-frame"&&(m="frame",o="frame-locator",l++);let g=mn({parts:[c]}),b=i.generateLocator(h,m,g);if(m==="default"&&f&&["internal:has-text","internal:has-not-text"].includes(f.name)){let{exact:S,text:_}=rs(f.body);if(!S){let k=i.generateLocator("locator",f.name==="internal:has-text"?"has-text":"has-not-text",_,{exact:S}),D={};f.name==="internal:has-text"?D.hasText=_:D.hasNotText=_;let H=i.generateLocator(h,"default",g,D);s.push([i.chainLocators([b,k]),H]),l++;continue}}let v;if(["xpath","css"].includes(c.name)){let S=mn({parts:[c]},!0);v=i.generateLocator(h,m,S)}s.push([b,v].filter(Boolean))}return tw(i,s,n)}function tw(i,e,t){let n=e.map(()=>""),r=[],s=o=>{if(o===e.length)return r.push(i.chainLocators(n)),n.length<t;for(let l of e[o])if(n[o]=l,!s(o+1))return!1;return!0};return s(0),r}function rs(i){let e=!1,t=i.match(/^\/(.*)\/([igm]*)$/);return t?{text:new RegExp(t[1],t[2])}:(i.endsWith('"')?(i=JSON.parse(i),e=!0):i.endsWith('"s')?(i=JSON.parse(i.substring(0,i.length-1)),e=!0):i.endsWith('"i')&&(i=JSON.parse(i.substring(0,i.length-1)),e=!1),{exact:e,text:i})}function Ve(i){return i instanceof RegExp}var hc,pc,mc,fc,gc,nw,bc=x(()=>{Fn();ir();hc=class{constructor(e){this.preferredQuote=e}generateLocator(e,t,n,r={}){switch(t){case"default":return r.hasText!==void 0?`locator(${this.quote(n)}, { hasText: ${this.toHasText(r.hasText)} })`:r.hasNotText!==void 0?`locator(${this.quote(n)}, { hasNotText: ${this.toHasText(r.hasNotText)} })`:`locator(${this.quote(n)})`;case"frame":return`frameLocator(${this.quote(n)})`;case"nth":return`nth(${n})`;case"first":return"first()";case"last":return"last()";case"role":let s=[];Ve(r.name)?s.push(`name: ${this.regexToSourceString(r.name)}`):typeof r.name=="string"&&(s.push(`name: ${this.quote(r.name)}`),r.exact&&s.push("exact: true"));for(let{name:l,value:c}of r.attrs)s.push(`${l}: ${typeof c=="string"?this.quote(c):c}`);let o=s.length?`, { ${s.join(", ")} }`:"";return`getByRole(${this.quote(n)}${o})`;case"has-text":return`filter({ hasText: ${this.toHasText(n)} })`;case"has-not-text":return`filter({ hasNotText: ${this.toHasText(n)} })`;case"has":return`filter({ has: ${n} })`;case"hasNot":return`filter({ hasNot: ${n} })`;case"and":return`and(${n})`;case"or":return`or(${n})`;case"chain":return`locator(${n})`;case"test-id":return`getByTestId(${this.toTestIdValue(n)})`;case"text":return this.toCallWithExact("getByText",n,!!r.exact);case"alt":return this.toCallWithExact("getByAltText",n,!!r.exact);case"placeholder":return this.toCallWithExact("getByPlaceholder",n,!!r.exact);case"label":return this.toCallWithExact("getByLabel",n,!!r.exact);case"title":return this.toCallWithExact("getByTitle",n,!!r.exact);default:throw new Error("Unknown selector kind "+t)}}chainLocators(e){return e.join(".")}regexToSourceString(e){return Mi(String(e))}toCallWithExact(e,t,n){return Ve(t)?`${e}(${this.regexToSourceString(t)})`:n?`${e}(${this.quote(t)}, { exact: true })`:`${e}(${this.quote(t)})`}toHasText(e){return Ve(e)?this.regexToSourceString(e):this.quote(e)}toTestIdValue(e){return Ve(e)?this.regexToSourceString(e):this.quote(e)}quote(e){return ut(e,this.preferredQuote??"'")}},pc=class{generateLocator(e,t,n,r={}){switch(t){case"default":return r.hasText!==void 0?`locator(${this.quote(n)}, has_text=${this.toHasText(r.hasText)})`:r.hasNotText!==void 0?`locator(${this.quote(n)}, has_not_text=${this.toHasText(r.hasNotText)})`:`locator(${this.quote(n)})`;case"frame":return`frame_locator(${this.quote(n)})`;case"nth":return`nth(${n})`;case"first":return"first";case"last":return"last";case"role":let s=[];Ve(r.name)?s.push(`name=${this.regexToString(r.name)}`):typeof r.name=="string"&&(s.push(`name=${this.quote(r.name)}`),r.exact&&s.push("exact=True"));for(let{name:l,value:c}of r.attrs){let h=typeof c=="string"?this.quote(c):c;typeof c=="boolean"&&(h=c?"True":"False"),s.push(`${Ar(l)}=${h}`)}let o=s.length?`, ${s.join(", ")}`:"";return`get_by_role(${this.quote(n)}${o})`;case"has-text":return`filter(has_text=${this.toHasText(n)})`;case"has-not-text":return`filter(has_not_text=${this.toHasText(n)})`;case"has":return`filter(has=${n})`;case"hasNot":return`filter(has_not=${n})`;case"and":return`and_(${n})`;case"or":return`or_(${n})`;case"chain":return`locator(${n})`;case"test-id":return`get_by_test_id(${this.toTestIdValue(n)})`;case"text":return this.toCallWithExact("get_by_text",n,!!r.exact);case"alt":return this.toCallWithExact("get_by_alt_text",n,!!r.exact);case"placeholder":return this.toCallWithExact("get_by_placeholder",n,!!r.exact);case"label":return this.toCallWithExact("get_by_label",n,!!r.exact);case"title":return this.toCallWithExact("get_by_title",n,!!r.exact);default:throw new Error("Unknown selector kind "+t)}}chainLocators(e){return e.join(".")}regexToString(e){let t=e.flags.includes("i")?", re.IGNORECASE":"";return`re.compile(r"${Mi(e.source).replace(/\\\//,"/").replace(/"/g,'\\"')}"${t})`}toCallWithExact(e,t,n){return Ve(t)?`${e}(${this.regexToString(t)})`:n?`${e}(${this.quote(t)}, exact=True)`:`${e}(${this.quote(t)})`}toHasText(e){return Ve(e)?this.regexToString(e):`${this.quote(e)}`}toTestIdValue(e){return Ve(e)?this.regexToString(e):this.quote(e)}quote(e){return ut(e,'"')}},mc=class{generateLocator(e,t,n,r={}){let s;switch(e){case"page":s="Page";break;case"frame-locator":s="FrameLocator";break;case"locator":s="Locator";break}switch(t){case"default":return r.hasText!==void 0?`locator(${this.quote(n)}, new ${s}.LocatorOptions().setHasText(${this.toHasText(r.hasText)}))`:r.hasNotText!==void 0?`locator(${this.quote(n)}, new ${s}.LocatorOptions().setHasNotText(${this.toHasText(r.hasNotText)}))`:`locator(${this.quote(n)})`;case"frame":return`frameLocator(${this.quote(n)})`;case"nth":return`nth(${n})`;case"first":return"first()";case"last":return"last()";case"role":let o=[];Ve(r.name)?o.push(`.setName(${this.regexToString(r.name)})`):typeof r.name=="string"&&(o.push(`.setName(${this.quote(r.name)})`),r.exact&&o.push(".setExact(true)"));for(let{name:c,value:h}of r.attrs)o.push(`.set${Oi(c)}(${typeof h=="string"?this.quote(h):h})`);let l=o.length?`, new ${s}.GetByRoleOptions()${o.join("")}`:"";return`getByRole(AriaRole.${Ar(n).toUpperCase()}${l})`;case"has-text":return`filter(new ${s}.FilterOptions().setHasText(${this.toHasText(n)}))`;case"has-not-text":return`filter(new ${s}.FilterOptions().setHasNotText(${this.toHasText(n)}))`;case"has":return`filter(new ${s}.FilterOptions().setHas(${n}))`;case"hasNot":return`filter(new ${s}.FilterOptions().setHasNot(${n}))`;case"and":return`and(${n})`;case"or":return`or(${n})`;case"chain":return`locator(${n})`;case"test-id":return`getByTestId(${this.toTestIdValue(n)})`;case"text":return this.toCallWithExact(s,"getByText",n,!!r.exact);case"alt":return this.toCallWithExact(s,"getByAltText",n,!!r.exact);case"placeholder":return this.toCallWithExact(s,"getByPlaceholder",n,!!r.exact);case"label":return this.toCallWithExact(s,"getByLabel",n,!!r.exact);case"title":return this.toCallWithExact(s,"getByTitle",n,!!r.exact);default:throw new Error("Unknown selector kind "+t)}}chainLocators(e){return e.join(".")}regexToString(e){let t=e.flags.includes("i")?", Pattern.CASE_INSENSITIVE":"";return`Pattern.compile(${this.quote(Mi(e.source))}${t})`}toCallWithExact(e,t,n,r){return Ve(n)?`${t}(${this.regexToString(n)})`:r?`${t}(${this.quote(n)}, new ${e}.${Oi(t)}Options().setExact(true))`:`${t}(${this.quote(n)})`}toHasText(e){return Ve(e)?this.regexToString(e):this.quote(e)}toTestIdValue(e){return Ve(e)?this.regexToString(e):this.quote(e)}quote(e){return ut(e,'"')}},fc=class{generateLocator(e,t,n,r={}){switch(t){case"default":return r.hasText!==void 0?`Locator(${this.quote(n)}, new() { ${this.toHasText(r.hasText)} })`:r.hasNotText!==void 0?`Locator(${this.quote(n)}, new() { ${this.toHasNotText(r.hasNotText)} })`:`Locator(${this.quote(n)})`;case"frame":return`FrameLocator(${this.quote(n)})`;case"nth":return`Nth(${n})`;case"first":return"First";case"last":return"Last";case"role":let s=[];Ve(r.name)?s.push(`NameRegex = ${this.regexToString(r.name)}`):typeof r.name=="string"&&(s.push(`Name = ${this.quote(r.name)}`),r.exact&&s.push("Exact = true"));for(let{name:l,value:c}of r.attrs)s.push(`${Oi(l)} = ${typeof c=="string"?this.quote(c):c}`);let o=s.length?`, new() { ${s.join(", ")} }`:"";return`GetByRole(AriaRole.${Oi(n)}${o})`;case"has-text":return`Filter(new() { ${this.toHasText(n)} })`;case"has-not-text":return`Filter(new() { ${this.toHasNotText(n)} })`;case"has":return`Filter(new() { Has = ${n} })`;case"hasNot":return`Filter(new() { HasNot = ${n} })`;case"and":return`And(${n})`;case"or":return`Or(${n})`;case"chain":return`Locator(${n})`;case"test-id":return`GetByTestId(${this.toTestIdValue(n)})`;case"text":return this.toCallWithExact("GetByText",n,!!r.exact);case"alt":return this.toCallWithExact("GetByAltText",n,!!r.exact);case"placeholder":return this.toCallWithExact("GetByPlaceholder",n,!!r.exact);case"label":return this.toCallWithExact("GetByLabel",n,!!r.exact);case"title":return this.toCallWithExact("GetByTitle",n,!!r.exact);default:throw new Error("Unknown selector kind "+t)}}chainLocators(e){return e.join(".")}regexToString(e){let t=e.flags.includes("i")?", RegexOptions.IgnoreCase":"";return`new Regex(${this.quote(Mi(e.source))}${t})`}toCallWithExact(e,t,n){return Ve(t)?`${e}(${this.regexToString(t)})`:n?`${e}(${this.quote(t)}, new() { Exact = true })`:`${e}(${this.quote(t)})`}toHasText(e){return Ve(e)?`HasTextRegex = ${this.regexToString(e)}`:`HasText = ${this.quote(e)}`}toTestIdValue(e){return Ve(e)?this.regexToString(e):this.quote(e)}toHasNotText(e){return Ve(e)?`HasNotTextRegex = ${this.regexToString(e)}`:`HasNotText = ${this.quote(e)}`}quote(e){return ut(e,'"')}},gc=class{generateLocator(e,t,n,r={}){return JSON.stringify({kind:t,body:n,options:r})}chainLocators(e){let t=e.map(n=>JSON.parse(n));for(let n=0;n<t.length-1;++n)t[n].next=t[n+1];return JSON.stringify(t[0])}},nw={javascript:hc,python:pc,java:mc,csharp:fc,jsonl:gc}});function bh(i){return!!i.match(/^(text\/.*?|application\/(json|(x-)?javascript|xml.*?|ecmascript|graphql|x-www-form-urlencoded)|image\/svg(\+xml)?|application\/.*?(\+json|\+xml))(;\s*charset=.*)?$/)}var yh=x(()=>{});function rw(i){let e=["^"],t=!1;for(let n=0;n<i.length;++n){let r=i[n];if(r==="\\"&&n+1<i.length){let s=i[++n];e.push(_h.has(s)?"\\"+s:s);continue}if(r==="*"){let s=i[n-1],o=1;for(;i[n+1]==="*";)o++,n++;let l=i[n+1];o>1&&(s==="/"||s===void 0)&&(l==="/"||l===void 0)?(e.push("((?:[^/]*(?:/|$))*)"),n++):e.push("([^/]*)");continue}switch(r){case"?":e.push(".");break;case"[":e.push("[");break;case"]":e.push("]");break;case"{":t=!0,e.push("(");break;case"}":t=!1,e.push(")");break;case",":if(t){e.push("|");break}e.push("\\"+r);break;default:e.push(_h.has(r)?"\\"+r:r)}}return e.push("$"),new RegExp(e.join(""))}function yc(i){return i instanceof RegExp||Object.prototype.toString.call(i)==="[object RegExp]"}function vo(i,e){return yc(i)&&yc(e)?i.source===e.source&&i.flags===e.flags:i===e}function tt(i,e,t){if(t===void 0||t==="")return!0;if(ae(t)&&!t.startsWith("*")&&(t=_c(i,t)),ae(t)&&(t=rw(t)),yc(t))return t.test(e);if(typeof t=="string"&&t===e)return!0;let n=iw(e);if(!n)return!1;if(typeof t=="string")return n.pathname===t;if(typeof t!="function")throw new Error("url parameter should be string, RegExp or function");return t(n)}function iw(i){try{return new URL(i)}catch{return null}}function _c(i,e){try{return new URL(e,i).toString()}catch{return e}}var _h,vh=x(()=>{Fn();_h=new Set(["$","^","+",".","*","(",")","|","\\","?","{","}","[","]"])});var Mr,vc=x(()=>{Mr=class{_map;constructor(){this._map=new Map}set(e,t){let n=this._map.get(e);n||(n=[],this._map.set(e,n)),n.push(t)}get(e){return this._map.get(e)||[]}has(e){return this._map.has(e)}delete(e,t){let n=this._map.get(e);n&&n.includes(t)&&this._map.set(e,n.filter(r=>t!==r))}deleteAll(e){this._map.delete(e)}hasValue(e,t){let n=this._map.get(e);return n?n.includes(t):!1}get size(){return this._map.size}[Symbol.iterator](){return this._map[Symbol.iterator]()}keys(){return this._map.keys()}values(){let e=[];for(let t of this.keys())e.push(...this.get(t));return e}clear(){this._map.clear()}}});async function Po(){await Promise.all(Array.from(sr).map(i=>i().catch(e=>{})))}function Co(i){setTimeout(()=>process.exit(i),3e4),Po().then(()=>{process.exit(i)})}function sw(){for(let i of Nr)i()}function Ph(){let i=()=>{ce()?setTimeout(()=>process.exit(130),1e3):process.exit(130)};if(xh){process.off("SIGINT",Ph);for(let e of Nr)e();i()}else xh=!0,Po().then(()=>i())}function ow(){Po()}function aw(){Po()}function xo(i){So.has(i)||(So.add(i),process.on(i,Ch[i]))}function Sh(){if(!Nr.size){for(let i of So)process.off(i,Ch[i]);So.clear()}}async function ko(i){let e=i.stdio==="pipe"?["ignore","pipe","pipe","pipe","pipe"]:["pipe","pipe","pipe"];i.log(`<launching> ${i.command} ${i.args?i.args.join(" "):""}`);let t={detached:process.platform!=="win32",env:i.env,cwd:i.cwd,shell:i.shell,stdio:e},n=childProcess.spawn(i.command,i.args||[],t),r=async()=>{i.log(`[pid=${n.pid||"N/A"}] starting temporary directories cleanup`);let S=await In(i.tempDirectories);for(let _=0;_<i.tempDirectories.length;++_)S[_]&&i.log(`[pid=${n.pid||"N/A"}] exception while removing ${i.tempDirectories[_]}: ${S[_]}`);i.log(`[pid=${n.pid||"N/A"}] finished temporary directories cleanup`)};if(n.on("error",()=>{}),!n.pid){let S,_=new Promise((k,D)=>S=k);return n.once("error",k=>{S(new Error("Failed to launch: "+k))}),r().then(()=>_).then(k=>Promise.reject(k))}i.log(`<launched> pid=${n.pid}`),readline.createInterface({input:n.stdout}).on("line",S=>{i.log(`[pid=${n.pid}][out] `+S)}),readline.createInterface({input:n.stderr}).on("line",S=>{i.log(`[pid=${n.pid}][err] `+S)});let l=!1,c=()=>{},h=new Promise(S=>c=S);n.once("exit",(S,_)=>{i.log(`[pid=${n.pid}] <process did exit: exitCode=${S}, signal=${_}>`),l=!0,sr.delete(f),Nr.delete(b),Sh(),i.onExit(S,_),r().then(c)}),xo("exit"),i.handleSIGINT&&xo("SIGINT"),i.handleSIGTERM&&xo("SIGTERM"),i.handleSIGHUP&&xo("SIGHUP"),sr.add(f),Nr.add(b);let m=!1;async function f(){if(m){i.log(`[pid=${n.pid}] <forcefully close>`),g(),await h;return}m=!0,i.log(`[pid=${n.pid}] <gracefully close start>`),await i.attemptToGracefullyClose().catch(()=>g()),await h,i.log(`[pid=${n.pid}] <gracefully close end>`)}function g(){if(sr.delete(f),Nr.delete(b),Sh(),i.log(`[pid=${n.pid}] <kill>`),n.pid&&!n.killed&&!l){i.log(`[pid=${n.pid}] <will force kill>`);try{if(process.platform==="win32"){let S=childProcess.spawnSync(`taskkill /pid ${n.pid} /T /F`,{shell:!0}),[_,k]=[S.stdout.toString(),S.stderr.toString()];_&&i.log(`[pid=${n.pid}] taskkill stdout: ${_}`),k&&i.log(`[pid=${n.pid}] taskkill stderr: ${k}`)}else process.kill(-n.pid,"SIGKILL")}catch(S){i.log(`[pid=${n.pid}] exception while trying to kill process: ${S}`)}}else i.log(`[pid=${n.pid}] <skipped force kill spawnedProcess.killed=${n.killed} processClosed=${l}>`)}function b(){g(),i.log(`[pid=${n.pid||"N/A"}] starting temporary directories cleanup`);for(let S of i.tempDirectories)try{fs.rmSync(S,{force:!0,recursive:!0,maxRetries:5})}catch(_){i.log(`[pid=${n.pid||"N/A"}] exception while removing ${S}: ${_}`)}i.log(`[pid=${n.pid||"N/A"}] finished temporary directories cleanup`)}function v(){return g(),h}return{launchedProcess:n,gracefullyClose:f,kill:v}}function kh(i){let e={};for(let{name:t,value:n}of i)e[t]=n;return e}var sr,Nr,xh,So,Ch,Hr=x(()=>{O();_t();sr=new Set,Nr=new Set;xh=!1;So=new Set,Ch={exit:sw,SIGINT:Ph,SIGTERM:ow,SIGHUP:aw}});import*as Eh from"path";async function Th(){if(Eo){debugger;throw new Error("Not implemented")}}async function Rh(i){Eo&&await new Promise(e=>To.post("Profiler.stop",(t,{profile:n})=>{t||(fs.mkdirSync(Eo,{recursive:!0}),fs.writeFileSync(Eh.join(Eo,i+".json"),JSON.stringify(n))),e()}))}var Eo,To,Ah=x(()=>{Eo=process.env.PWTEST_PROFILE_DIR||"",To=null});var Dr,xc=x(()=>{qe();Dr=class{_max;_acquired=0;_queue=[];constructor(e){this._max=e}setMax(e){this._max=e}acquire(){let e=new U;return this._queue.push(e),this._flush(),e}release(){--this._acquired,this._flush()}_flush(){for(;this._acquired<this._max&&this._queue.length;)++this._acquired,this._queue.shift().resolve()}}});function is(i,e,t={}){let n=spawn(i,e,Object.assign({windowsHide:!0},t));return new Promise(r=>{let s="",o="";n.stdout&&n.stdout.on("data",l=>s+=l.toString()),n.stderr&&n.stderr.on("data",l=>o+=l.toString()),n.on("close",l=>r({stdout:s,stderr:o,code:l})),n.on("error",l=>r({stdout:s,stderr:o,code:0,error:l}))})}var Ro=x(()=>{});function Fh(i){let e=performance.now();if(i!==void 0){let t=e-(i[0]*1e3+i[1]/1e6),n=Math.floor(t/1e3),r=Math.floor(t%1e3*1e6);return[n,r]}else{let t=Math.floor(e/1e3),n=Math.floor(e%1e3*1e6);return[t,n]}}function X(){let[i,e]=Fh(lw);return i*1e3+(e/1e3|0)/1e3}function or(i,...e){setTimeout(i,0,...e)}var lw,Ao=x(()=>{lw=Fh()});function Br(){if(process.versions.electron)return n=>setTimeout(n,0);if(parseInt(process.versions.node,10)>=11)return or;let i=!1,e=[],t=()=>{let n=e.shift();if(!n){i=!1;return}or(t),n()};return n=>{e.push(n),i||(i=!0,or(t))}}var Ih=x(()=>{Ao()});async function Fo(i,e){let t;return Promise.race([i().then(n=>({result:n,timedOut:!1})),new Promise(n=>{let s=(e||2147483647)-X();t=setTimeout(()=>n({timedOut:!0}),s)})]).finally(()=>{clearTimeout(t)})}var Io=x(()=>{O()});function Sc(i){let e=new Map,t=[];for(let n of i){if(!n.stack||!n.stack.length)continue;let r=[];for(let s of n.stack){let o=e.get(s.file);typeof o!="number"&&(o=e.size,e.set(s.file,o));let l=[o,s.line||0,s.column||0,s.function||""];r.push(l)}t.push([n.id,r])}return{files:[...e.keys()],stacks:t}}var Lh=x(()=>{});var cw,Oh,dw,Lo,Pc=x(()=>{O();Te();cw=0,Oh=Symbol("kConnection"),dw={zlibDeflateOptions:{level:3},zlibInflateOptions:{chunkSize:10*1024},threshold:10*1024},Lo=class{_wsServer;server;_delegate;constructor(e){this._delegate=e}async listen(e=0,t,n){N.log("server",`Server started at ${new Date}`);let r=Dl((o,l)=>{if(o.method==="GET"&&o.url==="/json"){l.setHeader("Content-Type","application/json"),l.end(JSON.stringify({wsEndpointPath:n}));return}l.end("Running")});r.on("error",o=>N.log("server",String(o))),this.server=r;let s=await new Promise((o,l)=>{r.listen(e,t,()=>{let c=r.address();if(!c){l(new Error("Could not bind server socket"));return}let h=typeof c=="string"?`${c}${n}`:`ws://${t||"localhost"}:${c.port}${n}`;o(h)}).on("error",l)});return N.log("server","Listening at "+s),this._wsServer=new wsServer({noServer:!0,perMessageDeflate:dw}),this._delegate.onHeaders&&this._wsServer.on("headers",o=>this._delegate.onHeaders(o)),r.on("upgrade",(o,l,c)=>{if(new URL("http://localhost"+o.url).pathname!==n){l.write(`HTTP/${o.httpVersion} 400 Bad Request\r
\r
`),l.destroy();return}let m=this._delegate.onUpgrade?.(o,l);if(m){l.write(m.error),l.destroy();return}this._wsServer?.handleUpgrade(o,l,c,f=>this._wsServer?.emit("connection",f,o))}),this._wsServer.on("connection",(o,l)=>{N.log("server","Connected client ws.extension="+o.extensions);let c=new URL("http://localhost"+(l.url||"")),h=String(++cw);N.log("server",`[${h}] serving connection: ${l.url}`);let m=this._delegate.onConnection(l,c,o,h);o[Oh]=m}),s}async close(){let e=this._wsServer;if(!e)return;N.log("server","closing websocket server");let t=new Promise(n=>e.close(n));await Promise.all(Array.from(e.clients).map(async n=>{let r=n[Oh];r&&await r.close();try{n.terminate()}catch{}})),await t,N.log("server","closing http server"),this.server&&await new Promise(n=>this.server.close(n)),this._wsServer=void 0,this.server=void 0,N.log("server","closed server"),await this._delegate.onClose?.()}}});var ss,Cc=x(()=>{ss=class{_fileName;_zipFile;_entries=new Map;_openedPromise;constructor(e){this._fileName=e,this._openedPromise=this._open()}async _open(){await new Promise((e,t)=>{yauzl.open(this._fileName,{autoClose:!1},(n,r)=>{if(n){t(n);return}this._zipFile=r,this._zipFile.on("entry",s=>{this._entries.set(s.fileName,s)}),this._zipFile.on("end",e)})})}async entries(){return await this._openedPromise,[...this._entries.keys()]}async read(e){await this._openedPromise;let t=this._entries.get(e);if(!t)throw new Error(`${e} not found in file ${this._fileName}`);return new Promise((n,r)=>{this._zipFile.openReadStream(t,(s,o)=>{if(s||!o){r(s||"Entry not found");return}let l=[];o.on("data",c=>l.push(c)),o.on("end",()=>n(Buffer.concat(l)))})})}close(){this._zipFile?.close()}}});var kc,Ec,Tc,$r,Rc=x(()=>{kc=class{store=void 0;run(e,t){this.store=e;try{return t()}finally{this.store=void 0}}getStore(){return this.store}},Ec=class{_asyncLocalStorage=new kc;run(e,t,n){let r=this._asyncLocalStorage.getStore(),s=new Tc(r,e,t);return this._asyncLocalStorage.run(s,n)}zoneData(e){for(let t=this._asyncLocalStorage.getStore();t;t=t.previous)if(t.type===e)return t.data}exitZones(e){return this._asyncLocalStorage.run(void 0,e)}printZones(){let e=[];for(let t=this._asyncLocalStorage.getStore();t;t=t.previous){let n=t.type;t.type==="apiZone"&&(n+=`(${t.data.apiName})`),e.push(n)}console.log("zones: ",e.join(" -> "))}},Tc=class{type;data;previous;constructor(e,t,n){this.type=t,this.data=n,this.previous=e}},$r=new Ec});var O=x(()=>{oo();Vl();Jl();Li();Te();Gl();It();th();_t();dh();wo();rc();qe();bc();yh();Fn();vh();vc();kr();Hr();Ah();ec();xc();Ro();Lt();Ih();Ao();Io();Lh();Rn();Pc();Cc();Rc()});var de,Mh=x(()=>{de={"ubuntu20.04-x64":{tools:["xvfb","fonts-noto-color-emoji","ttf-unifont","libfontconfig","libfreetype6","xfonts-cyrillic","xfonts-scalable","fonts-liberation","fonts-ipafont-gothic","fonts-wqy-zenhei","fonts-tlwg-loma-otf","ttf-ubuntu-font-family"],chromium:["fonts-liberation","libasound2","libatk-bridge2.0-0","libatk1.0-0","libatspi2.0-0","libcairo2","libcups2","libdbus-1-3","libdrm2","libegl1","libgbm1","libglib2.0-0","libgtk-3-0","libnspr4","libnss3","libpango-1.0-0","libx11-6","libx11-xcb1","libxcb1","libxcomposite1","libxdamage1","libxext6","libxfixes3","libxrandr2","libxshmfence1"],firefox:["ffmpeg","libatk1.0-0","libcairo-gobject2","libcairo2","libdbus-1-3","libdbus-glib-1-2","libfontconfig1","libfreetype6","libgdk-pixbuf2.0-0","libglib2.0-0","libgtk-3-0","libpango-1.0-0","libpangocairo-1.0-0","libpangoft2-1.0-0","libx11-6","libx11-xcb1","libxcb-shm0","libxcb1","libxcomposite1","libxcursor1","libxdamage1","libxext6","libxfixes3","libxi6","libxrender1","libxt6","libxtst6"],webkit:["libenchant-2-2","libflite1","libx264-155","libatk-bridge2.0-0","libatk1.0-0","libcairo2","libegl1","libenchant1c2a","libepoxy0","libevdev2","libfontconfig1","libfreetype6","libgdk-pixbuf2.0-0","libgl1","libgles2","libglib2.0-0","libgtk-3-0","libgudev-1.0-0","libharfbuzz-icu0","libharfbuzz0b","libhyphen0","libicu66","libjpeg-turbo8","libnghttp2-14","libnotify4","libopengl0","libopenjp2-7","libopus0","libpango-1.0-0","libpng16-16","libsecret-1-0","libvpx6","libwayland-client0","libwayland-egl1","libwayland-server0","libwebp6","libwebpdemux2","libwoff1","libx11-6","libxcomposite1","libxdamage1","libxkbcommon0","libxml2","libxslt1.1","libatomic1","libevent-2.1-7"],lib2package:{"libflite.so.1":"libflite1","libflite_usenglish.so.1":"libflite1","libflite_cmu_grapheme_lang.so.1":"libflite1","libflite_cmu_grapheme_lex.so.1":"libflite1","libflite_cmu_indic_lang.so.1":"libflite1","libflite_cmu_indic_lex.so.1":"libflite1","libflite_cmulex.so.1":"libflite1","libflite_cmu_time_awb.so.1":"libflite1","libflite_cmu_us_awb.so.1":"libflite1","libflite_cmu_us_kal16.so.1":"libflite1","libflite_cmu_us_kal.so.1":"libflite1","libflite_cmu_us_rms.so.1":"libflite1","libflite_cmu_us_slt.so.1":"libflite1","libx264.so":"libx264-155","libasound.so.2":"libasound2","libatk-1.0.so.0":"libatk1.0-0","libatk-bridge-2.0.so.0":"libatk-bridge2.0-0","libatspi.so.0":"libatspi2.0-0","libcairo-gobject.so.2":"libcairo-gobject2","libcairo.so.2":"libcairo2","libcups.so.2":"libcups2","libdbus-1.so.3":"libdbus-1-3","libdbus-glib-1.so.2":"libdbus-glib-1-2","libdrm.so.2":"libdrm2","libEGL.so.1":"libegl1","libenchant.so.1":"libenchant1c2a","libevdev.so.2":"libevdev2","libepoxy.so.0":"libepoxy0","libfontconfig.so.1":"libfontconfig1","libfreetype.so.6":"libfreetype6","libgbm.so.1":"libgbm1","libgdk_pixbuf-2.0.so.0":"libgdk-pixbuf2.0-0","libgdk-3.so.0":"libgtk-3-0","libgdk-x11-2.0.so.0":"libgtk2.0-0","libgio-2.0.so.0":"libglib2.0-0","libGL.so.1":"libgl1","libGLESv2.so.2":"libgles2","libglib-2.0.so.0":"libglib2.0-0","libgmodule-2.0.so.0":"libglib2.0-0","libgobject-2.0.so.0":"libglib2.0-0","libgthread-2.0.so.0":"libglib2.0-0","libgtk-3.so.0":"libgtk-3-0","libgtk-x11-2.0.so.0":"libgtk2.0-0","libgudev-1.0.so.0":"libgudev-1.0-0","libharfbuzz-icu.so.0":"libharfbuzz-icu0","libharfbuzz.so.0":"libharfbuzz0b","libhyphen.so.0":"libhyphen0","libicui18n.so.66":"libicu66","libicuuc.so.66":"libicu66","libjpeg.so.8":"libjpeg-turbo8","libnotify.so.4":"libnotify4","libnspr4.so":"libnspr4","libnss3.so":"libnss3","libnssutil3.so":"libnss3","libOpenGL.so.0":"libopengl0","libopenjp2.so.7":"libopenjp2-7","libopus.so.0":"libopus0","libpango-1.0.so.0":"libpango-1.0-0","libpangocairo-1.0.so.0":"libpangocairo-1.0-0","libpangoft2-1.0.so.0":"libpangoft2-1.0-0","libpng16.so.16":"libpng16-16","libsecret-1.so.0":"libsecret-1-0","libsmime3.so":"libnss3","libvpx.so.6":"libvpx6","libwayland-client.so.0":"libwayland-client0","libwayland-egl.so.1":"libwayland-egl1","libwayland-server.so.0":"libwayland-server0","libwebp.so.6":"libwebp6","libwebpdemux.so.2":"libwebpdemux2","libwoff2dec.so.1.0.2":"libwoff1","libX11-xcb.so.1":"libx11-xcb1","libX11.so.6":"libx11-6","libxcb-dri3.so.0":"libxcb-dri3-0","libxcb-shm.so.0":"libxcb-shm0","libxcb.so.1":"libxcb1","libXcomposite.so.1":"libxcomposite1","libXcursor.so.1":"libxcursor1","libXdamage.so.1":"libxdamage1","libXext.so.6":"libxext6","libXfixes.so.3":"libxfixes3","libXi.so.6":"libxi6","libxkbcommon.so.0":"libxkbcommon0","libxml2.so.2":"libxml2","libXrandr.so.2":"libxrandr2","libXrender.so.1":"libxrender1","libxslt.so.1":"libxslt1.1","libXt.so.6":"libxt6","libXtst.so.6":"libxtst6","libxshmfence.so.1":"libxshmfence1","libatomic.so.1":"libatomic1","libenchant-2.so.2":"libenchant-2-2","libevent-2.1.so.7":"libevent-2.1-7"}},"ubuntu22.04-x64":{tools:["xvfb","fonts-noto-color-emoji","fonts-unifont","libfontconfig1","libfreetype6","xfonts-cyrillic","xfonts-scalable","fonts-liberation","fonts-ipafont-gothic","fonts-wqy-zenhei","fonts-tlwg-loma-otf","fonts-freefont-ttf"],chromium:["libasound2","libatk-bridge2.0-0","libatk1.0-0","libatspi2.0-0","libcairo2","libcups2","libdbus-1-3","libdrm2","libgbm1","libglib2.0-0","libnspr4","libnss3","libpango-1.0-0","libwayland-client0","libx11-6","libxcb1","libxcomposite1","libxdamage1","libxext6","libxfixes3","libxkbcommon0","libxrandr2"],firefox:["ffmpeg","libasound2","libatk1.0-0","libcairo-gobject2","libcairo2","libdbus-1-3","libdbus-glib-1-2","libfontconfig1","libfreetype6","libgdk-pixbuf-2.0-0","libglib2.0-0","libgtk-3-0","libpango-1.0-0","libpangocairo-1.0-0","libx11-6","libx11-xcb1","libxcb-shm0","libxcb1","libxcomposite1","libxcursor1","libxdamage1","libxext6","libxfixes3","libxi6","libxrandr2","libxrender1","libxtst6"],webkit:["libsoup-3.0-0","libenchant-2-2","gstreamer1.0-libav","gstreamer1.0-plugins-bad","gstreamer1.0-plugins-base","gstreamer1.0-plugins-good","libicu70","libatk-bridge2.0-0","libatk1.0-0","libcairo2","libdbus-1-3","libdrm2","libegl1","libepoxy0","libevdev2","libffi7","libfontconfig1","libfreetype6","libgbm1","libgdk-pixbuf-2.0-0","libgles2","libglib2.0-0","libglx0","libgstreamer-gl1.0-0","libgstreamer-plugins-base1.0-0","libgstreamer1.0-0","libgtk-3-0","libgudev-1.0-0","libharfbuzz-icu0","libharfbuzz0b","libhyphen0","libjpeg-turbo8","liblcms2-2","libmanette-0.2-0","libnotify4","libopengl0","libopenjp2-7","libopus0","libpango-1.0-0","libpng16-16","libproxy1v5","libsecret-1-0","libwayland-client0","libwayland-egl1","libwayland-server0","libwebpdemux2","libwoff1","libx11-6","libxcomposite1","libxdamage1","libxkbcommon0","libxml2","libxslt1.1","libx264-163","libatomic1","libevent-2.1-7"],lib2package:{"libsoup-3.0.so.0":"libsoup-3.0-0","libasound.so.2":"libasound2","libatk-1.0.so.0":"libatk1.0-0","libatk-bridge-2.0.so.0":"libatk-bridge2.0-0","libatspi.so.0":"libatspi2.0-0","libcairo-gobject.so.2":"libcairo-gobject2","libcairo.so.2":"libcairo2","libcups.so.2":"libcups2","libdbus-1.so.3":"libdbus-1-3","libdbus-glib-1.so.2":"libdbus-glib-1-2","libdrm.so.2":"libdrm2","libEGL.so.1":"libegl1","libepoxy.so.0":"libepoxy0","libevdev.so.2":"libevdev2","libffi.so.7":"libffi7","libfontconfig.so.1":"libfontconfig1","libfreetype.so.6":"libfreetype6","libgbm.so.1":"libgbm1","libgdk_pixbuf-2.0.so.0":"libgdk-pixbuf-2.0-0","libgdk-3.so.0":"libgtk-3-0","libgio-2.0.so.0":"libglib2.0-0","libGLESv2.so.2":"libgles2","libglib-2.0.so.0":"libglib2.0-0","libGLX.so.0":"libglx0","libgmodule-2.0.so.0":"libglib2.0-0","libgobject-2.0.so.0":"libglib2.0-0","libgstallocators-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstapp-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstaudio-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstbase-1.0.so.0":"libgstreamer1.0-0","libgstfft-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstgl-1.0.so.0":"libgstreamer-gl1.0-0","libgstpbutils-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstreamer-1.0.so.0":"libgstreamer1.0-0","libgsttag-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstvideo-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgtk-3.so.0":"libgtk-3-0","libgudev-1.0.so.0":"libgudev-1.0-0","libharfbuzz-icu.so.0":"libharfbuzz-icu0","libharfbuzz.so.0":"libharfbuzz0b","libhyphen.so.0":"libhyphen0","libjpeg.so.8":"libjpeg-turbo8","liblcms2.so.2":"liblcms2-2","libmanette-0.2.so.0":"libmanette-0.2-0","libnotify.so.4":"libnotify4","libnspr4.so":"libnspr4","libnss3.so":"libnss3","libnssutil3.so":"libnss3","libOpenGL.so.0":"libopengl0","libopenjp2.so.7":"libopenjp2-7","libopus.so.0":"libopus0","libpango-1.0.so.0":"libpango-1.0-0","libpangocairo-1.0.so.0":"libpangocairo-1.0-0","libpng16.so.16":"libpng16-16","libproxy.so.1":"libproxy1v5","libsecret-1.so.0":"libsecret-1-0","libsmime3.so":"libnss3","libwayland-client.so.0":"libwayland-client0","libwayland-egl.so.1":"libwayland-egl1","libwayland-server.so.0":"libwayland-server0","libwebpdemux.so.2":"libwebpdemux2","libwoff2dec.so.1.0.2":"libwoff1","libX11-xcb.so.1":"libx11-xcb1","libX11.so.6":"libx11-6","libxcb-shm.so.0":"libxcb-shm0","libxcb.so.1":"libxcb1","libXcomposite.so.1":"libxcomposite1","libXcursor.so.1":"libxcursor1","libXdamage.so.1":"libxdamage1","libXext.so.6":"libxext6","libXfixes.so.3":"libxfixes3","libXi.so.6":"libxi6","libxkbcommon.so.0":"libxkbcommon0","libxml2.so.2":"libxml2","libXrandr.so.2":"libxrandr2","libXrender.so.1":"libxrender1","libxslt.so.1":"libxslt1.1","libXtst.so.6":"libxtst6","libicui18n.so.60":"libicu70","libicuuc.so.66":"libicu70","libicui18n.so.66":"libicu70","libwebp.so.6":"libwebp6","libenchant-2.so.2":"libenchant-2-2","libx264.so":"libx264-163","libvpx.so.7":"libvpx7","libatomic.so.1":"libatomic1","libevent-2.1.so.7":"libevent-2.1-7"}},"ubuntu24.04-x64":{tools:["xvfb","fonts-noto-color-emoji","fonts-unifont","libfontconfig1","libfreetype6","xfonts-cyrillic","xfonts-scalable","fonts-liberation","fonts-ipafont-gothic","fonts-wqy-zenhei","fonts-tlwg-loma-otf","fonts-freefont-ttf"],chromium:["libasound2t64","libatk-bridge2.0-0t64","libatk1.0-0t64","libatspi2.0-0t64","libcairo2","libcups2t64","libdbus-1-3","libdrm2","libgbm1","libglib2.0-0t64","libnspr4","libnss3","libpango-1.0-0","libx11-6","libxcb1","libxcomposite1","libxdamage1","libxext6","libxfixes3","libxkbcommon0","libxrandr2"],firefox:["libasound2t64","libatk1.0-0t64","libcairo-gobject2","libcairo2","libdbus-1-3","libfontconfig1","libfreetype6","libgdk-pixbuf-2.0-0","libglib2.0-0t64","libgtk-3-0t64","libpango-1.0-0","libpangocairo-1.0-0","libx11-6","libx11-xcb1","libxcb-shm0","libxcb1","libxcomposite1","libxcursor1","libxdamage1","libxext6","libxfixes3","libxi6","libxrandr2","libxrender1"],webkit:["gstreamer1.0-libav","gstreamer1.0-plugins-bad","gstreamer1.0-plugins-base","gstreamer1.0-plugins-good","libicu74","libatomic1","libatk-bridge2.0-0t64","libatk1.0-0t64","libcairo-gobject2","libcairo2","libdbus-1-3","libdrm2","libenchant-2-2","libepoxy0","libevent-2.1-7t64","libflite1","libfontconfig1","libfreetype6","libgbm1","libgdk-pixbuf-2.0-0","libgles2","libglib2.0-0t64","libgstreamer-gl1.0-0","libgstreamer-plugins-bad1.0-0","libgstreamer-plugins-base1.0-0","libgstreamer1.0-0","libgtk-3-0t64","libharfbuzz-icu0","libharfbuzz0b","libhyphen0","libicu74","libjpeg-turbo8","liblcms2-2","libmanette-0.2-0","libopus0","libpango-1.0-0","libpangocairo-1.0-0","libpng16-16t64","libsecret-1-0","libvpx9","libwayland-client0","libwayland-egl1","libwayland-server0","libwebp7","libwebpdemux2","libwoff1","libx11-6","libxkbcommon0","libxml2","libxslt1.1","libx264-164"],lib2package:{"libasound.so.2":"libasound2t64","libatk-1.0.so.0":"libatk1.0-0t64","libatk-bridge-2.0.so.0":"libatk-bridge2.0-0t64","libatomic.so.1":"libatomic1","libatspi.so.0":"libatspi2.0-0t64","libcairo-gobject.so.2":"libcairo-gobject2","libcairo.so.2":"libcairo2","libcups.so.2":"libcups2t64","libdbus-1.so.3":"libdbus-1-3","libdrm.so.2":"libdrm2","libenchant-2.so.2":"libenchant-2-2","libepoxy.so.0":"libepoxy0","libevent-2.1.so.7":"libevent-2.1-7t64","libflite_cmu_grapheme_lang.so.1":"libflite1","libflite_cmu_grapheme_lex.so.1":"libflite1","libflite_cmu_indic_lang.so.1":"libflite1","libflite_cmu_indic_lex.so.1":"libflite1","libflite_cmu_time_awb.so.1":"libflite1","libflite_cmu_us_awb.so.1":"libflite1","libflite_cmu_us_kal.so.1":"libflite1","libflite_cmu_us_kal16.so.1":"libflite1","libflite_cmu_us_rms.so.1":"libflite1","libflite_cmu_us_slt.so.1":"libflite1","libflite_cmulex.so.1":"libflite1","libflite_usenglish.so.1":"libflite1","libflite.so.1":"libflite1","libfontconfig.so.1":"libfontconfig1","libfreetype.so.6":"libfreetype6","libgbm.so.1":"libgbm1","libgdk_pixbuf-2.0.so.0":"libgdk-pixbuf-2.0-0","libgdk-3.so.0":"libgtk-3-0t64","libgio-2.0.so.0":"libglib2.0-0t64","libGLESv2.so.2":"libgles2","libglib-2.0.so.0":"libglib2.0-0t64","libgmodule-2.0.so.0":"libglib2.0-0t64","libgobject-2.0.so.0":"libglib2.0-0t64","libgstallocators-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstapp-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstaudio-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstbase-1.0.so.0":"libgstreamer1.0-0","libgstcodecparsers-1.0.so.0":"libgstreamer-plugins-bad1.0-0","libgstfft-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstgl-1.0.so.0":"libgstreamer-gl1.0-0","libgstpbutils-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstreamer-1.0.so.0":"libgstreamer1.0-0","libgsttag-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstvideo-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgtk-3.so.0":"libgtk-3-0t64","libharfbuzz-icu.so.0":"libharfbuzz-icu0","libharfbuzz.so.0":"libharfbuzz0b","libhyphen.so.0":"libhyphen0","libicudata.so.74":"libicu74","libicui18n.so.74":"libicu74","libicuuc.so.74":"libicu74","libjpeg.so.8":"libjpeg-turbo8","liblcms2.so.2":"liblcms2-2","libmanette-0.2.so.0":"libmanette-0.2-0","libnspr4.so":"libnspr4","libnss3.so":"libnss3","libnssutil3.so":"libnss3","libopus.so.0":"libopus0","libpango-1.0.so.0":"libpango-1.0-0","libpangocairo-1.0.so.0":"libpangocairo-1.0-0","libpng16.so.16":"libpng16-16t64","libsecret-1.so.0":"libsecret-1-0","libsmime3.so":"libnss3","libsoup-3.0.so.0":"libsoup-3.0-0","libvpx.so.9":"libvpx9","libwayland-client.so.0":"libwayland-client0","libwayland-egl.so.1":"libwayland-egl1","libwayland-server.so.0":"libwayland-server0","libwebp.so.7":"libwebp7","libwebpdemux.so.2":"libwebpdemux2","libwoff2dec.so.1.0.2":"libwoff1","libX11-xcb.so.1":"libx11-xcb1","libX11.so.6":"libx11-6","libxcb-shm.so.0":"libxcb-shm0","libxcb.so.1":"libxcb1","libXcomposite.so.1":"libxcomposite1","libXcursor.so.1":"libxcursor1","libXdamage.so.1":"libxdamage1","libXext.so.6":"libxext6","libXfixes.so.3":"libxfixes3","libXi.so.6":"libxi6","libxkbcommon.so.0":"libxkbcommon0","libxml2.so.2":"libxml2","libXrandr.so.2":"libxrandr2","libXrender.so.1":"libxrender1","libxslt.so.1":"libxslt1.1","libx264.so":"libx264-164"}},"debian11-x64":{tools:["xvfb","fonts-noto-color-emoji","fonts-unifont","libfontconfig1","libfreetype6","xfonts-cyrillic","xfonts-scalable","fonts-liberation","fonts-ipafont-gothic","fonts-wqy-zenhei","fonts-tlwg-loma-otf","fonts-freefont-ttf"],chromium:["libasound2","libatk-bridge2.0-0","libatk1.0-0","libatspi2.0-0","libcairo2","libcups2","libdbus-1-3","libdrm2","libgbm1","libglib2.0-0","libnspr4","libnss3","libpango-1.0-0","libwayland-client0","libx11-6","libxcb1","libxcomposite1","libxdamage1","libxext6","libxfixes3","libxkbcommon0","libxrandr2"],firefox:["libasound2","libatk1.0-0","libcairo-gobject2","libcairo2","libdbus-1-3","libdbus-glib-1-2","libfontconfig1","libfreetype6","libgdk-pixbuf-2.0-0","libglib2.0-0","libgtk-3-0","libharfbuzz0b","libpango-1.0-0","libpangocairo-1.0-0","libx11-6","libx11-xcb1","libxcb-shm0","libxcb1","libxcomposite1","libxcursor1","libxdamage1","libxext6","libxfixes3","libxi6","libxrandr2","libxrender1","libxtst6"],webkit:["gstreamer1.0-libav","gstreamer1.0-plugins-bad","gstreamer1.0-plugins-base","gstreamer1.0-plugins-good","libatk-bridge2.0-0","libatk1.0-0","libcairo2","libdbus-1-3","libdrm2","libegl1","libenchant-2-2","libepoxy0","libevdev2","libfontconfig1","libfreetype6","libgbm1","libgdk-pixbuf-2.0-0","libgles2","libglib2.0-0","libglx0","libgstreamer-gl1.0-0","libgstreamer-plugins-base1.0-0","libgstreamer1.0-0","libgtk-3-0","libgudev-1.0-0","libharfbuzz-icu0","libharfbuzz0b","libhyphen0","libicu67","libjpeg62-turbo","liblcms2-2","libmanette-0.2-0","libnghttp2-14","libnotify4","libopengl0","libopenjp2-7","libopus0","libpango-1.0-0","libpng16-16","libproxy1v5","libsecret-1-0","libwayland-client0","libwayland-egl1","libwayland-server0","libwebp6","libwebpdemux2","libwoff1","libx11-6","libxcomposite1","libxdamage1","libxkbcommon0","libxml2","libxslt1.1","libatomic1","libevent-2.1-7"],lib2package:{"libasound.so.2":"libasound2","libatk-1.0.so.0":"libatk1.0-0","libatk-bridge-2.0.so.0":"libatk-bridge2.0-0","libatspi.so.0":"libatspi2.0-0","libcairo-gobject.so.2":"libcairo-gobject2","libcairo.so.2":"libcairo2","libcups.so.2":"libcups2","libdbus-1.so.3":"libdbus-1-3","libdbus-glib-1.so.2":"libdbus-glib-1-2","libdrm.so.2":"libdrm2","libEGL.so.1":"libegl1","libenchant-2.so.2":"libenchant-2-2","libepoxy.so.0":"libepoxy0","libevdev.so.2":"libevdev2","libfontconfig.so.1":"libfontconfig1","libfreetype.so.6":"libfreetype6","libgbm.so.1":"libgbm1","libgdk_pixbuf-2.0.so.0":"libgdk-pixbuf-2.0-0","libgdk-3.so.0":"libgtk-3-0","libgio-2.0.so.0":"libglib2.0-0","libGLESv2.so.2":"libgles2","libglib-2.0.so.0":"libglib2.0-0","libGLX.so.0":"libglx0","libgmodule-2.0.so.0":"libglib2.0-0","libgobject-2.0.so.0":"libglib2.0-0","libgstallocators-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstapp-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstaudio-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstbase-1.0.so.0":"libgstreamer1.0-0","libgstfft-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstgl-1.0.so.0":"libgstreamer-gl1.0-0","libgstpbutils-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstreamer-1.0.so.0":"libgstreamer1.0-0","libgsttag-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgstvideo-1.0.so.0":"libgstreamer-plugins-base1.0-0","libgtk-3.so.0":"libgtk-3-0","libgudev-1.0.so.0":"libgudev-1.0-0","libharfbuzz-icu.so.0":"libharfbuzz-icu0","libharfbuzz.so.0":"libharfbuzz0b","libhyphen.so.0":"libhyphen0","libicui18n.so.67":"libicu67","libicuuc.so.67":"libicu67","libjpeg.so.62":"libjpeg62-turbo","liblcms2.so.2":"liblcms2-2","libmanette-0.2.so.0":"libmanette-0.2-0","libnotify.so.4":"libnotify4","libnspr4.so":"libnspr4","libnss3.so":"libnss3","libnssutil3.so":"libnss3","libOpenGL.so.0":"libopengl0","libopenjp2.so.7":"libopenjp2-7","libopus.so.0":"libopus0","libpango-1.0.so.0":"libpango-1.0-0","libpangocairo-1.0.so.0":"libpangocairo-1.0-0","libpng16.so.16":"libpng16-16","libproxy.so.1":"libproxy1v5","libsecret-1.so.0":"libsecret-1-0","libsmime3.so":"libnss3","libwayland-client.so.0":"libwayland-client0","libwayland-egl.so.1":"libwayland-egl1","libwayland-server.so.0":"libwayland-server0","libwebp.so.6":"libwebp6","libwebpdemux.so.2":"libwebpdemux2","libwoff2dec.so.1.0.2":"libwoff1","libX11-xcb.so.1":"libx11-xcb1","libX11.so.6":"libx11-6","libxcb-shm.so.0":"libxcb-shm0","libxcb.so.1":"libxcb1","libXcomposite.so.1":"libxcomposite1","libXcursor.so.1":"libxcursor1","libXdamage.so.1":"libxdamage1","libXext.so.6":"libxext6","libXfixes.so.3":"libxfixes3","libXi.so.6":"libxi6","libxkbcommon.so.0":"libxkbcommon0","libxml2.so.2":"libxml2","libXrandr.so.2":"libxrandr2","libXrender.so.1":"libxrender1","libxslt.so.1":"libxslt1.1","libXtst.so.6":"libxtst6","libatomic.so.1":"libatomic1","libevent-2.1.so.7":"libevent-2.1-7"}},"debian12-x64":{tools:["xvfb","fonts-noto-color-emoji","fonts-unifont","libfontconfig1","libfreetype6","xfonts-scalable","fonts-liberation","fonts-ipafont-gothic","fonts-wqy-zenhei","fonts-tlwg-loma-otf","fonts-freefont-ttf"],chromium:["libasound2","libatk-bridge2.0-0","libatk1.0-0","libatspi2.0-0","libcairo2","libcups2","libdbus-1-3","libdrm2","libgbm1","libglib2.0-0","libnspr4","libnss3","libpango-1.0-0","libx11-6","libxcb1","libxcomposite1","libxdamage1","libxext6","libxfixes3","libxkbcommon0","libxrandr2"],firefox:["libasound2","libatk1.0-0","libcairo-gobject2","libcairo2","libdbus-1-3","libdbus-glib-1-2","libfontconfig1","libfreetype6","libgdk-pixbuf-2.0-0","libglib2.0-0","libgtk-3-0","libharfbuzz0b","libpango-1.0-0","libpangocairo-1.0-0","libx11-6","libx11-xcb1","libxcb-shm0","libxcb1","libxcomposite1","libxcursor1","libxdamage1","libxext6","libxfixes3","libxi6","libxrandr2","libxrender1","libxtst6"],webkit:["libsoup-3.0-0","gstreamer1.0-libav","gstreamer1.0-plugins-bad","gstreamer1.0-plugins-base","gstreamer1.0-plugins-good","libatk-bridge2.0-0","libatk1.0-0","libcairo2","libdbus-1-3","libdrm2","libegl1","libenchant-2-2","libepoxy0","libevdev2","libfontconfig1","libfreetype6","libgbm1","libgdk-pixbuf-2.0-0","libgles2","libglib2.0-0","libglx0","libgstreamer-gl1.0-0","libgstreamer-plugins-base1.0-0","libgstreamer1.0-0","libgtk-3-0","libgudev-1.0-0","libharfbuzz-icu0","libharfbuzz0b","libhyphen0","libicu72","libjpeg62-turbo","liblcms2-2","libmanette-0.2-0","libnotify4","libopengl0","libopenjp2-7","libopus0","libpango-1.0-0","libpng16-16","libproxy1v5","libsecret-1-0","libwayland-client0","libwayland-egl1","libwayland-server0","libwebp7","libwebpdemux2","libwoff1","libx11-6","libxcomposite1","libxdamage1","libxkbcommon0","libxml2","libxslt1.1","libatomic1","libevent-2.1-7"],lib2package:{"libsoup-3.0.so.0":"libsoup-3.0-0","libasound.so.2":"libasound2","libatk-1.0.so.0":"libatk1.0-0","libatk-bridge-2.0.so.0":"libatk-bridge2.0-0","libatspi.so.0":"libatspi2.0-0","libcairo.so.2":"libcairo2","libcups.so.2":"libcups2","libdbus-1.so.3":"libdbus-1-3","libdrm.so.2":"libdrm2","libgbm.so.1":"libgbm1","libgio-2.0.so.0":"libglib2.0-0","libglib-2.0.so.0":"libglib2.0-0","libgobject-2.0.so.0":"libglib2.0-0","libnspr4.so":"libnspr4","libnss3.so":"libnss3","libnssutil3.so":"libnss3","libpango-1.0.so.0":"libpango-1.0-0","libsmime3.so":"libnss3","libX11.so.6":"libx11-6","libxcb.so.1":"libxcb1","libXcomposite.so.1":"libxcomposite1","libXdamage.so.1":"libxdamage1","libXext.so.6":"libxext6","libXfixes.so.3":"libxfixes3","libxkbcommon.so.0":"libxkbcommon0","libXrandr.so.2":"libxrandr2"}}};de["ubuntu20.04-arm64"]={tools:[...de["ubuntu20.04-x64"].tools],chromium:[...de["ubuntu20.04-x64"].chromium],firefox:[...de["ubuntu20.04-x64"].firefox],webkit:[...de["ubuntu20.04-x64"].webkit],lib2package:{...de["ubuntu20.04-x64"].lib2package}};de["ubuntu22.04-arm64"]={tools:[...de["ubuntu22.04-x64"].tools],chromium:[...de["ubuntu22.04-x64"].chromium],firefox:[...de["ubuntu22.04-x64"].firefox],webkit:[...de["ubuntu22.04-x64"].webkit],lib2package:{...de["ubuntu22.04-x64"].lib2package}};de["ubuntu24.04-arm64"]={tools:[...de["ubuntu24.04-x64"].tools],chromium:[...de["ubuntu24.04-x64"].chromium],firefox:[...de["ubuntu24.04-x64"].firefox],webkit:[...de["ubuntu24.04-x64"].webkit],lib2package:{...de["ubuntu24.04-x64"].lib2package}};de["debian11-arm64"]={tools:[...de["debian11-x64"].tools],chromium:[...de["debian11-x64"].chromium],firefox:[...de["debian11-x64"].firefox],webkit:[...de["debian11-x64"].webkit],lib2package:{...de["debian11-x64"].lib2package}};de["debian12-arm64"]={tools:[...de["debian12-x64"].tools],chromium:[...de["debian12-x64"].chromium],firefox:[...de["debian12-x64"].firefox],webkit:[...de["debian12-x64"].webkit],lib2package:{...de["debian12-x64"].lib2package}}});function Hh(i){return{driverVersion:Nh,dockerImageName:i.replace("%version%",Nh)}}function Dh(){try{let i=JSON.parse(fs.readFileSync(uw,"utf8"));return{...i,dockerImageNameTemplate:i.dockerImageName.replace(i.driverVersion,"%version%")}}catch{return null}}async function Bh(i){return process.getuid?.()===0?{command:"sh",args:["-c",`${i.join("&& ")}`],elevatedPermissions:!1}:(await is("which",["sudo"])).code===0?{command:"sudo",args:["--","sh","-c",`${i.join("&& ")}`],elevatedPermissions:!0}:{command:"su",args:["root","-c",`${i.join("&& ")}`],elevatedPermissions:!0}}var Nh,uw,Ac=x(()=>{Ro();wo();fn();Mh();Rn();Nh=process.env.PW_CLI_DISPLAY_VERSION||$l().version,uw="/ms-playwright/.docker-info"});import hw from"os";import $h from"path";async function jh(i,e,t,n,r,s){if(await zt(ls(e)))return N.log("install",`${i} is already downloaded.`),!1;let o=$h.join(hw.tmpdir(),r);try{for(let c=1;c<=3;++c){N.log("install",`downloading ${i} - attempt #${c}`);let h=n[(c-1)%n.length];as(`Downloading ${i}`+colors.dim(` from ${h}`));let{error:m}=await pw(i,e,h,o,t,s);if(!m){N.log("install",`SUCCESS installing ${i}`);break}await zt(o)&&await fs.promises.unlink(o),await zt(e)&&await fs.promises.rmdir(e,{recursive:!0});let f=m?.message||"";if(N.log("install",`attempt #${c} - ERROR: ${f}`),c>=3)throw m}}catch(l){throw N.log("install",`FAILED installation ${i} with error: ${l}`),process.exitCode=1,l}finally{await zt(o)&&await fs.promises.unlink(o)}return as(`${i} downloaded to ${e}`),!0}function pw(i,e,t,n,r,s){let o=childProcess.fork($h.join(__dirname,"oopDownloadBrowserMain.js")),l=new U,c=mw();o.on("message",m=>{m?.method==="log"&&N.log("install",m.params.message),m?.method==="progress"&&c(m.params.done,m.params.total)}),o.on("exit",m=>{if(m!==0){l.resolve({error:new Error(`Download failure, code=${m}`)});return}fs.existsSync(ls(e))?l.resolve({error:null}):l.resolve({error:new Error(`Download failure, ${ls(e)} does not exist`)})}),o.on("error",m=>{l.resolve({error:m})}),N.log("install","running download:"),N.log("install",`-- from url: ${t}`),N.log("install",`-- to location: ${n}`);let h={title:i,browserDirectory:e,url:t,zipPath:n,executablePath:r,connectionTimeout:s,userAgent:qt()};return o.send({method:"download",params:h}),l}function as(i){let e=process.env.npm_config_loglevel;["silent","error","warn"].indexOf(e||"")>-1||console.log(i)}function mw(){return process.stdout.isTTY?fw():gw()}function fw(){let i,e=0;return(t,n)=>{i||(i=new ProgressBar(`${qh(n)} [:bar] :percent :etas`,{complete:"=",incomplete:" ",width:20,total:n}));let r=t-e;e=t,i.tick(r)}}function gw(){let t=-1;return(n,r)=>{let s=n/r,o=Math.floor(10*s);if(o>t){t=o;let l=String(s*100|0).padStart(3);console.log(`|${"\u25A0".repeat(o*8)}${" ".repeat((10-o)*8)}| ${l}% of ${qh(r)}`)}}}function qh(i){let e=i/1024/1024;return`${Math.round(e*10)/10} MiB`}var Wh=x(()=>{_t();Te();qe();fn();Rn()});var zh=so((ex,ww)=>{ww.exports={comment:"Do not edit this file, use utils/roll_browser.js",browsers:[{name:"chromium",revision:"1134",installByDefault:!0,browserVersion:"129.0.6668.29"},{name:"chromium-tip-of-tree",revision:"1256",installByDefault:!1,browserVersion:"130.0.6695.0"},{name:"firefox",revision:"1463",installByDefault:!0,browserVersion:"130.0"},{name:"firefox-beta",revision:"1462",installByDefault:!1,browserVersion:"130.0b2"},{name:"webkit",revision:"2071",installByDefault:!0,revisionOverrides:{"mac10.14":"1446","mac10.15":"1616",mac11:"1816","mac11-arm64":"1816",mac12:"2009","mac12-arm64":"2009"},browserVersion:"18.0"},{name:"ffmpeg",revision:"1010",installByDefault:!0},{name:"android",revision:"1001",installByDefault:!1}]}});import fe from"path";function Uh(i){let e=fe.basename(i);for(let t of Gh)if(e.startsWith(t+"-"))return!0;return!1}function Vh(i){return i.browsers.map(e=>{let t=e.name,n=(e.revisionOverrides||{})[hn],r=n||e.revision,s=n?`${t}_${hn}_special`:`${t}`;return{name:t,revision:r,browserVersion:n?void 0:e.browserVersion,installByDefault:!!e.installByDefault,dir:fe.join(vt,s.replace(/-/g,"_")+"-"+r)}})}function ls(i){return fe.join(i,"INSTALLATION_COMPLETE")}function jr(i,e){switch(i){case"python":return`playwright ${e}`;case"java":return`mvn exec:java -e -D exec.mainClass=com.microsoft.playwright.CLI -D exec.args="${e}"`;case"csharp":return`pwsh bin/Debug/netX/playwright.ps1 ${e}`;default:return`${Gu()} playwright ${e}`}}function Kh(i){let e=null;for(let t of["chromium","chrome","msedge"])try{Ut.findExecutable(t).executablePathOrDie(i),e=t==="chromium"?void 0:t;break}catch{}if(e===null){let n=["No chromium-based browser found on the system.","Please run the following command to download one:","",`    ${jr(i,"install chromium")}`,"","<3 Playwright Team"].join(`
`);throw new Error(`
`+cn(n,1))}return e}function Oc(i){if(typeof i!="object"||!i)return i;if(Array.isArray(i))return i.map(Oc);let e={};for(let[t,n]of Object.entries(i))e[t.toLowerCase()]=Oc(n);return e}var Fc,Ic,Oo,Lc,yw,vt,Gh,Mo,Ut,fn=x(()=>{kr();Rn();O();_t();wo();Ro();Ac();Wh();Ac();Te();Fc="/tmp",Ic="/tmp/bin",Oo=["https://playwright.azureedge.net","https://playwright-akamai.azureedge.net","https://playwright-verizon.azureedge.net"];if(process.env.PW_TEST_CDN_THAT_SHOULD_WORK)for(let i=0;i<Oo.length;i++){let e=Oo[i];e!==process.env.PW_TEST_CDN_THAT_SHOULD_WORK&&(Oo[i]=e+".does-not-resolve.playwright.dev")}Lc={chromium:{linux:["chrome-linux","chrome"],mac:["chrome-mac","Chromium.app","Contents","MacOS","Chromium"],win:["chrome-win","chrome.exe"]},firefox:{linux:["firefox","firefox"],mac:["firefox","Nightly.app","Contents","MacOS","firefox"],win:["firefox","firefox.exe"]},webkit:{linux:["pw_run.sh"],mac:["pw_run.sh"],win:["Playwright.exe"]},ffmpeg:{linux:["ffmpeg-linux"],mac:["ffmpeg-mac"],win:["ffmpeg-win64.exe"]}},yw={chromium:{"<unknown>":void 0,"ubuntu18.04-x64":void 0,"ubuntu20.04-x64":"builds/chromium/%s/chromium-linux.zip","ubuntu22.04-x64":"builds/chromium/%s/chromium-linux.zip","ubuntu24.04-x64":"builds/chromium/%s/chromium-linux.zip","ubuntu18.04-arm64":void 0,"ubuntu20.04-arm64":"builds/chromium/%s/chromium-linux-arm64.zip","ubuntu22.04-arm64":"builds/chromium/%s/chromium-linux-arm64.zip","ubuntu24.04-arm64":"builds/chromium/%s/chromium-linux-arm64.zip","debian11-x64":"builds/chromium/%s/chromium-linux.zip","debian11-arm64":"builds/chromium/%s/chromium-linux-arm64.zip","debian12-x64":"builds/chromium/%s/chromium-linux.zip","debian12-arm64":"builds/chromium/%s/chromium-linux-arm64.zip","mac10.13":"builds/chromium/%s/chromium-mac.zip","mac10.14":"builds/chromium/%s/chromium-mac.zip","mac10.15":"builds/chromium/%s/chromium-mac.zip",mac11:"builds/chromium/%s/chromium-mac.zip","mac11-arm64":"builds/chromium/%s/chromium-mac-arm64.zip",mac12:"builds/chromium/%s/chromium-mac.zip","mac12-arm64":"builds/chromium/%s/chromium-mac-arm64.zip",mac13:"builds/chromium/%s/chromium-mac.zip","mac13-arm64":"builds/chromium/%s/chromium-mac-arm64.zip",mac14:"builds/chromium/%s/chromium-mac.zip","mac14-arm64":"builds/chromium/%s/chromium-mac-arm64.zip",win64:"builds/chromium/%s/chromium-win64.zip"},"chromium-tip-of-tree":{"<unknown>":void 0,"ubuntu18.04-x64":void 0,"ubuntu20.04-x64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-linux.zip","ubuntu22.04-x64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-linux.zip","ubuntu24.04-x64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-linux.zip","ubuntu18.04-arm64":void 0,"ubuntu20.04-arm64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-linux-arm64.zip","ubuntu22.04-arm64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-linux-arm64.zip","ubuntu24.04-arm64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-linux-arm64.zip","debian11-x64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-linux.zip","debian11-arm64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-linux-arm64.zip","debian12-x64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-linux.zip","debian12-arm64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-linux-arm64.zip","mac10.13":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-mac.zip","mac10.14":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-mac.zip","mac10.15":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-mac.zip",mac11:"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-mac.zip","mac11-arm64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-mac-arm64.zip",mac12:"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-mac.zip","mac12-arm64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-mac-arm64.zip",mac13:"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-mac.zip","mac13-arm64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-mac-arm64.zip",mac14:"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-mac.zip","mac14-arm64":"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-mac-arm64.zip",win64:"builds/chromium-tip-of-tree/%s/chromium-tip-of-tree-win64.zip"},firefox:{"<unknown>":void 0,"ubuntu18.04-x64":void 0,"ubuntu20.04-x64":"builds/firefox/%s/firefox-ubuntu-20.04.zip","ubuntu22.04-x64":"builds/firefox/%s/firefox-ubuntu-22.04.zip","ubuntu24.04-x64":"builds/firefox/%s/firefox-ubuntu-24.04.zip","ubuntu18.04-arm64":void 0,"ubuntu20.04-arm64":"builds/firefox/%s/firefox-ubuntu-20.04-arm64.zip","ubuntu22.04-arm64":"builds/firefox/%s/firefox-ubuntu-22.04-arm64.zip","ubuntu24.04-arm64":"builds/firefox/%s/firefox-ubuntu-24.04-arm64.zip","debian11-x64":"builds/firefox/%s/firefox-debian-11.zip","debian11-arm64":"builds/firefox/%s/firefox-debian-11-arm64.zip","debian12-x64":"builds/firefox/%s/firefox-debian-12.zip","debian12-arm64":"builds/firefox/%s/firefox-debian-12-arm64.zip","mac10.13":"builds/firefox/%s/firefox-mac.zip","mac10.14":"builds/firefox/%s/firefox-mac.zip","mac10.15":"builds/firefox/%s/firefox-mac.zip",mac11:"builds/firefox/%s/firefox-mac.zip","mac11-arm64":"builds/firefox/%s/firefox-mac-arm64.zip",mac12:"builds/firefox/%s/firefox-mac.zip","mac12-arm64":"builds/firefox/%s/firefox-mac-arm64.zip",mac13:"builds/firefox/%s/firefox-mac.zip","mac13-arm64":"builds/firefox/%s/firefox-mac-arm64.zip",mac14:"builds/firefox/%s/firefox-mac.zip","mac14-arm64":"builds/firefox/%s/firefox-mac-arm64.zip",win64:"builds/firefox/%s/firefox-win64.zip"},"firefox-beta":{"<unknown>":void 0,"ubuntu18.04-x64":void 0,"ubuntu20.04-x64":"builds/firefox-beta/%s/firefox-beta-ubuntu-20.04.zip","ubuntu22.04-x64":"builds/firefox-beta/%s/firefox-beta-ubuntu-22.04.zip","ubuntu24.04-x64":"builds/firefox-beta/%s/firefox-beta-ubuntu-24.04.zip","ubuntu18.04-arm64":void 0,"ubuntu20.04-arm64":void 0,"ubuntu22.04-arm64":"builds/firefox-beta/%s/firefox-beta-ubuntu-22.04-arm64.zip","ubuntu24.04-arm64":"builds/firefox-beta/%s/firefox-beta-ubuntu-24.04-arm64.zip","debian11-x64":"builds/firefox-beta/%s/firefox-beta-debian-11.zip","debian11-arm64":"builds/firefox-beta/%s/firefox-beta-debian-11-arm64.zip","debian12-x64":"builds/firefox-beta/%s/firefox-beta-debian-12.zip","debian12-arm64":"builds/firefox-beta/%s/firefox-beta-debian-12-arm64.zip","mac10.13":"builds/firefox-beta/%s/firefox-beta-mac.zip","mac10.14":"builds/firefox-beta/%s/firefox-beta-mac.zip","mac10.15":"builds/firefox-beta/%s/firefox-beta-mac.zip",mac11:"builds/firefox-beta/%s/firefox-beta-mac.zip","mac11-arm64":"builds/firefox-beta/%s/firefox-beta-mac-arm64.zip",mac12:"builds/firefox-beta/%s/firefox-beta-mac.zip","mac12-arm64":"builds/firefox-beta/%s/firefox-beta-mac-arm64.zip",mac13:"builds/firefox-beta/%s/firefox-beta-mac.zip","mac13-arm64":"builds/firefox-beta/%s/firefox-beta-mac-arm64.zip",mac14:"builds/firefox-beta/%s/firefox-beta-mac.zip","mac14-arm64":"builds/firefox-beta/%s/firefox-beta-mac-arm64.zip",win64:"builds/firefox-beta/%s/firefox-beta-win64.zip"},webkit:{"<unknown>":void 0,"ubuntu18.04-x64":void 0,"ubuntu20.04-x64":"builds/webkit/%s/webkit-ubuntu-20.04.zip","ubuntu22.04-x64":"builds/webkit/%s/webkit-ubuntu-22.04.zip","ubuntu24.04-x64":"builds/webkit/%s/webkit-ubuntu-24.04.zip","ubuntu18.04-arm64":void 0,"ubuntu20.04-arm64":"builds/webkit/%s/webkit-ubuntu-20.04-arm64.zip","ubuntu22.04-arm64":"builds/webkit/%s/webkit-ubuntu-22.04-arm64.zip","ubuntu24.04-arm64":"builds/webkit/%s/webkit-ubuntu-24.04-arm64.zip","debian11-x64":"builds/webkit/%s/webkit-debian-11.zip","debian11-arm64":"builds/webkit/%s/webkit-debian-11-arm64.zip","debian12-x64":"builds/webkit/%s/webkit-debian-12.zip","debian12-arm64":"builds/webkit/%s/webkit-debian-12-arm64.zip","mac10.13":void 0,"mac10.14":"builds/deprecated-webkit-mac-10.14/%s/deprecated-webkit-mac-10.14.zip","mac10.15":"builds/deprecated-webkit-mac-10.15/%s/deprecated-webkit-mac-10.15.zip",mac11:"builds/webkit/%s/webkit-mac-11.zip","mac11-arm64":"builds/webkit/%s/webkit-mac-11-arm64.zip",mac12:"builds/webkit/%s/webkit-mac-12.zip","mac12-arm64":"builds/webkit/%s/webkit-mac-12-arm64.zip",mac13:"builds/webkit/%s/webkit-mac-13.zip","mac13-arm64":"builds/webkit/%s/webkit-mac-13-arm64.zip",mac14:"builds/webkit/%s/webkit-mac-14.zip","mac14-arm64":"builds/webkit/%s/webkit-mac-14-arm64.zip",win64:"builds/webkit/%s/webkit-win64.zip"},ffmpeg:{"<unknown>":void 0,"ubuntu18.04-x64":void 0,"ubuntu20.04-x64":"builds/ffmpeg/%s/ffmpeg-linux.zip","ubuntu22.04-x64":"builds/ffmpeg/%s/ffmpeg-linux.zip","ubuntu24.04-x64":"builds/ffmpeg/%s/ffmpeg-linux.zip","ubuntu18.04-arm64":void 0,"ubuntu20.04-arm64":"builds/ffmpeg/%s/ffmpeg-linux-arm64.zip","ubuntu22.04-arm64":"builds/ffmpeg/%s/ffmpeg-linux-arm64.zip","ubuntu24.04-arm64":"builds/ffmpeg/%s/ffmpeg-linux-arm64.zip","debian11-x64":"builds/ffmpeg/%s/ffmpeg-linux.zip","debian11-arm64":"builds/ffmpeg/%s/ffmpeg-linux-arm64.zip","debian12-x64":"builds/ffmpeg/%s/ffmpeg-linux.zip","debian12-arm64":"builds/ffmpeg/%s/ffmpeg-linux-arm64.zip","mac10.13":"builds/ffmpeg/%s/ffmpeg-mac.zip","mac10.14":"builds/ffmpeg/%s/ffmpeg-mac.zip","mac10.15":"builds/ffmpeg/%s/ffmpeg-mac.zip",mac11:"builds/ffmpeg/%s/ffmpeg-mac.zip","mac11-arm64":"builds/ffmpeg/%s/ffmpeg-mac-arm64.zip",mac12:"builds/ffmpeg/%s/ffmpeg-mac.zip","mac12-arm64":"builds/ffmpeg/%s/ffmpeg-mac-arm64.zip",mac13:"builds/ffmpeg/%s/ffmpeg-mac.zip","mac13-arm64":"builds/ffmpeg/%s/ffmpeg-mac-arm64.zip",mac14:"builds/ffmpeg/%s/ffmpeg-mac.zip","mac14-arm64":"builds/ffmpeg/%s/ffmpeg-mac-arm64.zip",win64:"builds/ffmpeg/%s/ffmpeg-win64.zip"},android:{"<unknown>":"builds/android/%s/android.zip","ubuntu18.04-x64":void 0,"ubuntu20.04-x64":"builds/android/%s/android.zip","ubuntu22.04-x64":"builds/android/%s/android.zip","ubuntu24.04-x64":"builds/android/%s/android.zip","ubuntu18.04-arm64":void 0,"ubuntu20.04-arm64":"builds/android/%s/android.zip","ubuntu22.04-arm64":"builds/android/%s/android.zip","ubuntu24.04-arm64":"builds/android/%s/android.zip","debian11-x64":"builds/android/%s/android.zip","debian11-arm64":"builds/android/%s/android.zip","debian12-x64":"builds/android/%s/android.zip","debian12-arm64":"builds/android/%s/android.zip","mac10.13":"builds/android/%s/android.zip","mac10.14":"builds/android/%s/android.zip","mac10.15":"builds/android/%s/android.zip",mac11:"builds/android/%s/android.zip","mac11-arm64":"builds/android/%s/android.zip",mac12:"builds/android/%s/android.zip","mac12-arm64":"builds/android/%s/android.zip",mac13:"builds/android/%s/android.zip","mac13-arm64":"builds/android/%s/android.zip",mac14:"builds/android/%s/android.zip","mac14-arm64":"builds/android/%s/android.zip",win64:"builds/android/%s/android.zip"},bidi:{}},vt=(()=>{let i,e=dn("PLAYWRIGHT_BROWSERS_PATH");if(e==="0")i=fe.join(__dirname,"..","..","..",".local-browsers");else if(e)i=e;else{let t;t="/tmp",i=fe.join(t,"ms-playwright")}return fe.isAbsolute(i)||(i=fe.resolve(dn("INIT_CWD")||process.cwd(),i)),i})();Gh=["chromium","firefox","webkit","ffmpeg","firefox-beta","chromium-tip-of-tree"],Mo=class{_executables;constructor(e){let t=Vh(e),n=(l,c)=>{let h;return process.platform==="linux"?h=Lc[c].linux:process.platform==="darwin"?h=Lc[c].mac:process.platform==="win32"&&(h=Lc[c].win),h?fe.join(l,...h):void 0},r=(l,c,h,m)=>{if(!c)throw new Error(`${l} is not supported on ${hn}`);let f=jr(m,`install${h?"":" "+l}`);if(!fo(c)){let g=Dh(),b=g?Hh(g.dockerImageNameTemplate):null,S=g&&b&&g.dockerImageName!==b.dockerImageName?[`Looks like ${m==="javascript"?"Playwright Test or ":""}Playwright was just updated to ${b.driverVersion}.`,"Please update docker image as well.",`-  current: ${g.dockerImageName}`,`- required: ${b.dockerImageName}`,"","<3 Playwright Team"].join(`
`):[`Looks like ${m==="javascript"?"Playwright Test or ":""}Playwright was just installed or updated.`,`Please run the following command to download new browser${h?"s":""}:`,"",`    ${f}`,"","<3 Playwright Team"].join(`
`);throw new Error(`Executable doesn't exist at ${c}
${cn(S,1)}`)}return c};this._executables=[];let s=t.find(l=>l.name==="chromium"),o=n(s.dir,"chromium");this._executables.push({type:"browser",name:"chromium",browserName:"chromium",directory:s.dir,executablePath:()=>o,executablePathOrDie:l=>r("chromium",o,s.installByDefault,l),installType:s.installByDefault?"download-by-default":"download-on-demand",_validateHostRequirements:l=>this._validateHostRequirements(l,"chromium",s.dir,["chrome-linux"],[],["chrome-win"]),downloadURLs:this._downloadURLs(s),browserVersion:s.browserVersion,_install:()=>this._downloadExecutable(s,o),_dependencyGroup:"chromium",_isHermeticInstallation:!0})}_createChromiumChannel(e,t,n){let r=(s,o)=>{let l=t[process.platform];if(!l){if(o)throw new Error(`Chromium distribution '${e}' is not supported on ${process.platform}`);return}let c=process.platform==="win32"?[process.env.LOCALAPPDATA,process.env.PROGRAMFILES,process.env["PROGRAMFILES(X86)"]].filter(Boolean):[""];for(let f of c){let g=fe.join(f,l);if(fo(g))return g}if(!o)return;let h=c.length?` at ${fe.join(c[0],l)}`:"",m=n?`
Run "${jr(s,"install "+e)}"`:"";throw new Error(`Chromium distribution '${e}' is not found${h}${m}`)};return{type:"channel",name:e,browserName:"chromium",directory:void 0,executablePath:s=>r(s,!1),executablePathOrDie:s=>r(s,!0),installType:n?"install-script":"none",_validateHostRequirements:()=>Promise.resolve(),_isHermeticInstallation:!1,_install:n}}_createBidiFirefoxChannel(e,t,n){let r=(s,o)=>{let l=t[process.platform];if(!l){if(o)throw new Error(`Firefox distribution '${e}' is not supported on ${process.platform}`);return}let c=fe.resolve("firefox"),h="stable";e.includes("beta")?h="beta":e.includes("nightly")&&(h="nightly");let f=fs.readdirSync(c).filter(g=>g.includes(h));if(f.length===1)return fe.join(c,f[0],l);if(f.length>1){if(o)throw new Error(`Multiple Firefox installations found for channel '${e}': ${f.join(", ")}`);return}if(o)throw new Error(`Cannot find Firefox installation for channel '${e}' under ${c}`)};return{type:"channel",name:e,browserName:"bidi",directory:void 0,executablePath:s=>r(s,!1),executablePathOrDie:s=>r(s,!0),installType:"none",_validateHostRequirements:()=>Promise.resolve(),_isHermeticInstallation:!0,_install:n}}_createBidiChannel(e,t,n){let r=(s,o)=>{let l=t[process.platform];if(!l){if(o)throw new Error(`Firefox distribution '${e}' is not supported on ${process.platform}`);return}let c=process.platform==="win32"?[process.env.LOCALAPPDATA,process.env.PROGRAMFILES,process.env["PROGRAMFILES(X86)"]].filter(Boolean):[""];for(let f of c){let g=fe.join(f,l);if(fo(g))return g}if(!o)return;let h=c.length?` at ${fe.join(c[0],l)}`:"",m=n?`
Run "${jr(s,"install "+e)}"`:"";throw new Error(`Firefox distribution '${e}' is not found${h}${m}`)};return{type:"channel",name:e,browserName:"bidi",directory:void 0,executablePath:s=>r(s,!1),executablePathOrDie:s=>r(s,!0),installType:n?"install-script":"none",_validateHostRequirements:()=>Promise.resolve(),_isHermeticInstallation:!1,_install:n}}executables(){return this._executables}findExecutable(e){return this._executables.find(t=>t.name===e)}defaultExecutables(){return this._executables.filter(e=>e.installType==="download-by-default")}_addRequirementsAndDedupe(e){let t=new Set;for(let n of e)t.add(n),n.browserName==="chromium"&&t.add(this.findExecutable("ffmpeg"));return Array.from(t)}async _validateHostRequirements(e,t,n,r,s,o){}async installDeps(e,t){let n=this._addRequirementsAndDedupe(e),r=new Set;for(let s of n)s._dependencyGroup&&r.add(s._dependencyGroup);r.add("tools")}async install(e,t){let n=this._addRequirementsAndDedupe(e);await fs.promises.mkdir(vt,{recursive:!0});let r=fe.join(vt,"__dirlock"),s=fe.join(vt,".links"),o;try{o=await lockfile.lock(vt,{retries:{retries:20,factor:1.27579},onCompromised:l=>{throw new Error(`${l.message} Path: ${r}`)},lockfilePath:r}),await fs.promises.mkdir(s,{recursive:!0}),await fs.promises.writeFile(fe.join(s,Wt(Fc)),Fc),await this._validateInstallationCache(s);for(let l of n){if(!l._install)throw new Error(`ERROR: Playwright does not support installing ${l.name}`);let{embedderName:c}=jl();if(!lo("CI")&&!l._isHermeticInstallation&&!t&&l.executablePath(c)){let h=jr(c,"install --force "+l.name);throw new Error(`
`+cn([`ATTENTION: "${l.name}" is already installed on the system!`,"",`"${l.name}" installation is not hermetic; installing newer version`,"requires *removal* of a current installation first.","",`To *uninstall* current version and re-install latest "${l.name}":`,"",`- Close all running instances of "${l.name}", if any`,'- Use "--force" to install browser:',"",`    ${h}`,"","<3 Playwright Team"].join(`
`),1))}await l._install()}}catch(l){if(l.code==="ELOCKED"){let c=process.platform==="win32"?"rm -R":"rm -rf";throw new Error(`
`+cn(["An active lockfile is found at:","",`  ${r}`,"","Either:","- wait a few minutes if other Playwright is installing browsers in parallel","- remove lock manually with:","",`    ${c} ${r}`,"","<3 Playwright Team"].join(`
`),1))}else throw l}finally{o&&await o()}}async uninstall(e){let t=fe.join(vt,".links");if(e){let n=await fs.promises.readdir(t).catch(()=>[]);for(let r of n)await fs.promises.unlink(fe.join(t,r))}else await fs.promises.unlink(fe.join(t,Wt(Fc))).catch(()=>{});return await this._validateInstallationCache(t),{numberOfBrowsersLeft:(await fs.promises.readdir(vt).catch(()=>[])).filter(n=>Uh(n)).length}}async validateHostRequirementsForExecutablesIfNeeded(e,t){if(lo("PLAYWRIGHT_SKIP_VALIDATE_HOST_REQUIREMENTS")){process.stderr.write("Skipping host requirements validation logic because `PLAYWRIGHT_SKIP_VALIDATE_HOST_REQUIREMENTS` env variable is set.\n");return}for(let n of e)await this._validateHostRequirementsForExecutableIfNeeded(n,t)}async _validateHostRequirementsForExecutableIfNeeded(e,t){if(!e.directory)return;let r=fe.join(e.directory,"DEPENDENCIES_VALIDATED");if(!await fs.promises.stat(r).then(s=>Date.now()-s.mtime.getTime()<2592e6).catch(()=>!1)){N.log("install",`validating host requirements for "${e.name}"`);try{await e._validateHostRequirements(t),N.log("install",`validation passed for ${e.name}`)}catch(s){throw N.log("install",`validation failed for ${e.name}`),s}await fs.promises.writeFile(r,"").catch(()=>{})}}_downloadURLs(e){let t=yw[e.name],n=t[hn]||t["<unknown>"];if(!n)return[];let r=util.format(n,e.revision),s=Oo.map(c=>`${c}/${r}`),o;e.name.startsWith("chromium")?o="PLAYWRIGHT_CHROMIUM_DOWNLOAD_HOST":e.name.startsWith("firefox")?o="PLAYWRIGHT_FIREFOX_DOWNLOAD_HOST":e.name.startsWith("webkit")&&(o="PLAYWRIGHT_WEBKIT_DOWNLOAD_HOST");let l=o&&dn(o)||dn("PLAYWRIGHT_DOWNLOAD_HOST");return l&&(s=[`${l}/${r}`]),s}async _downloadExecutable(e,t){let n=this._downloadURLs(e);if(!n.length)throw new Error(`ERROR: Playwright does not support ${e.name} on ${hn}`);nc||as(`BEWARE: your OS is not officially supported by Playwright; downloading fallback build for ${hn}.`);let r=e.name.split("-").map(h=>h==="ffmpeg"?"FFMPEG":h.charAt(0).toUpperCase()+h.slice(1)).join(" "),s=e.browserVersion?`${r} ${e.browserVersion} (playwright build v${e.revision})`:`${r} playwright build v${e.revision}`,o=`playwright-download-${e.name}-${hn}-${e.revision}.zip`,c=+(dn("PLAYWRIGHT_DOWNLOAD_CONNECTION_TIMEOUT")||"0")||3e4;await jh(s,e.dir,t,n,o,c).catch(h=>{throw new Error(`Failed to download ${s}, caused by
${h.stack}`)})}async _installMSEdgeChannel(e,t){let n=[];if(process.platform!=="linux"){let r=Oc(JSON.parse(await ln({url:"https://edgeupdates.microsoft.com/api/products"}))),s={msedge:"Stable","msedge-beta":"Beta","msedge-dev":"Dev"}[e],o=r.find(m=>m.product===s),l={darwin:{platform:"MacOS",arch:"universal",artifact:"pkg"},win32:{platform:"Windows",arch:"x64",artifact:"msi"}}[process.platform],c=l?o.releases.find(m=>m.platform===l.platform&&m.architecture===l.arch&&m.artifacts.length>0):null,h=c?c.artifacts.find(m=>m.artifactname===l.artifact):null;if(h)n.push(h.location);else throw new Error(`Cannot install ${e} on ${process.platform}`)}await this._installChromiumChannel(e,t,n)}async _installChromiumChannel(e,t,n=[]){let r=t[process.platform];if(!r)throw new Error(`Cannot install ${e} on ${process.platform}`);let s=Ic;if(r.endsWith(".ps1")){let l=["-ExecutionPolicy","Bypass","-File",fe.join(Ic,r),...n],{code:c}=await is("powershell.exe",l,{cwd:s,stdio:"inherit"});if(c!==0)throw new Error(`Failed to install ${e}`)}else{let{command:l,args:c,elevatedPermissions:h}=await Bh([`bash "${fe.join(Ic,r)}" ${n.join("")}`]);h&&console.log("Switching to root user to install dependencies...");let{code:m}=await is(l,c,{cwd:s,stdio:"inherit"});if(m!==0)throw new Error(`Failed to install ${e}`)}}async _validateInstallationCache(e){let t=new Set;for(let n of await fs.promises.readdir(e)){let r=fe.join(e,n),s="";try{s=(await fs.promises.readFile(r)).toString();let l=Vh({comment:"",browsers:[]});for(let c of Gh){let h=l.find(b=>b.name===c);if(!h)continue;let m=h.dir,f=parseInt(h.revision,10);(!(c==="chromium"&&(f>=786218||f<3e5)||c==="firefox"&&f>=1128||c==="webkit"&&f>=1307||c!=="firefox"&&c!=="chromium"&&c!=="webkit")||await zt(ls(m)))&&t.add(m)}}catch{await fs.promises.unlink(r).catch(l=>{})}}if(!lo("PLAYWRIGHT_SKIP_BROWSER_GC")){let n=(await fs.promises.readdir(vt)).map(s=>fe.join(vt,s));n=n.filter(s=>Uh(s));let r=new Set(n);for(let s of t)r.delete(s);for(let s of r)as("Removing unused browser at "+s);await In([...r])}}};Ut=new Mo(zh())});function ht(i,e,t){let n=No(i,e,t);if(!n)throw new he(`Unknown scheme for ${t}: ${i}.${e}`);return n}function No(i,e,t){let n=i+(t==="Initializer"?"":e[0].toUpperCase()+e.substring(1))+t;return u[n]}function Mc(){return a(u.Metadata)}var he,u,w,y,p,Z,xt,a,R,d,$,T,P,Nc=x(()=>{O();he=class extends Error{},u={};w=(i,e,t)=>{if(i instanceof Number)return i.valueOf();if(typeof i=="number")return i;throw new he(`${e}: expected number, got ${typeof i}`)},y=(i,e,t)=>{if(i instanceof Boolean)return i.valueOf();if(typeof i=="boolean")return i;throw new he(`${e}: expected boolean, got ${typeof i}`)},p=(i,e,t)=>{if(i instanceof String)return i.valueOf();if(typeof i=="string")return i;throw new he(`${e}: expected string, got ${typeof i}`)},Z=(i,e,t)=>{if(t.binary==="fromBase64"){if(i instanceof String)return Buffer.from(i.valueOf(),"base64");if(typeof i=="string")return Buffer.from(i,"base64");throw new he(`${e}: expected base64-encoded buffer, got ${typeof i}`)}if(t.binary==="toBase64"){if(!(i instanceof Buffer))throw new he(`${e}: expected Buffer, got ${typeof i}`);return i.toString("base64")}if(t.binary==="buffer"){if(!(i instanceof Buffer))throw new he(`${e}: expected Buffer, got ${typeof i}`);return i}throw new he(`Unsupported binary behavior "${t.binary}"`)},xt=(i,e,t)=>i,a=i=>(e,t,n)=>Object.is(e,void 0)?e:i(e,t,n),R=i=>(e,t,n)=>{if(!Array.isArray(e))throw new he(`${t}: expected array, got ${typeof e}`);return e.map((r,s)=>i(r,t+"["+s+"]",n))},d=i=>(e,t,n)=>{if(Object.is(e,null))throw new he(`${t}: expected object, got null`);if(typeof e!="object")throw new he(`${t}: expected object, got ${typeof e}`);let r={};for(let[s,o]of Object.entries(i)){let l=o(e[s],t?t+"."+s:s,n);Object.is(l,void 0)||(r[s]=l)}if(ce())for(let[s,o]of Object.entries(e))s.startsWith("__testHook")&&(r[s]=o);return r},$=i=>(e,t,n)=>{if(!i.includes(e))throw new he(`${t}: expected one of (${i.join("|")})`);return e},T=i=>(e,t,n)=>n.tChannelImpl(i,e,t,n),P=i=>(e,t,n)=>{let r=u[i];if(!r)throw new he(t+': unknown type "'+i+'"');return r(e,t,n)}});var cs=x(()=>{Nc();Nc();u.StackFrame=d({file:p,line:w,column:w,function:a(p)});u.Metadata=d({location:a(d({file:p,line:a(w),column:a(w)})),apiName:a(p),internal:a(y),stepId:a(p)});u.ClientSideCallMetadata=d({id:w,stack:a(R(P("StackFrame")))});u.Point=d({x:w,y:w});u.Rect=d({x:w,y:w,width:w,height:w});u.SerializedValue=d({n:a(w),b:a(y),s:a(p),v:a($(["null","undefined","NaN","Infinity","-Infinity","-0"])),d:a(p),u:a(p),bi:a(p),e:a(d({m:p,n:p,s:p})),r:a(d({p,f:p})),a:a(R(P("SerializedValue"))),o:a(R(d({k:p,v:P("SerializedValue")}))),h:a(w),id:a(w),ref:a(w)});u.SerializedArgument=d({value:P("SerializedValue"),handles:R(T("*"))});u.ExpectedTextValue=d({string:a(p),regexSource:a(p),regexFlags:a(p),matchSubstring:a(y),ignoreCase:a(y),normalizeWhiteSpace:a(y)});u.AXNode=d({role:p,name:p,valueString:a(p),valueNumber:a(w),description:a(p),keyshortcuts:a(p),roledescription:a(p),valuetext:a(p),disabled:a(y),expanded:a(y),focused:a(y),modal:a(y),multiline:a(y),multiselectable:a(y),readonly:a(y),required:a(y),selected:a(y),checked:a($(["checked","unchecked","mixed"])),pressed:a($(["pressed","released","mixed"])),level:a(w),valuemin:a(w),valuemax:a(w),autocomplete:a(p),haspopup:a(p),invalid:a(p),orientation:a(p),children:a(R(P("AXNode")))});u.SetNetworkCookie=d({name:p,value:p,url:a(p),domain:a(p),path:a(p),expires:a(w),httpOnly:a(y),secure:a(y),sameSite:a($(["Strict","Lax","None"]))});u.NetworkCookie=d({name:p,value:p,domain:p,path:p,expires:w,httpOnly:y,secure:y,sameSite:$(["Strict","Lax","None"])});u.NameValue=d({name:p,value:p});u.OriginStorage=d({origin:p,localStorage:R(P("NameValue"))});u.SerializedError=d({error:a(d({message:p,name:p,stack:a(p)})),value:a(P("SerializedValue"))});u.RecordHarOptions=d({path:p,content:a($(["embed","attach","omit"])),mode:a($(["full","minimal"])),urlGlob:a(p),urlRegexSource:a(p),urlRegexFlags:a(p)});u.FormField=d({name:p,value:a(p),file:a(d({name:p,mimeType:a(p),buffer:Z}))});u.APIRequestContextInitializer=d({tracing:T(["Tracing"])});u.APIRequestContextFetchParams=d({url:p,encodedParams:a(p),params:a(R(P("NameValue"))),method:a(p),headers:a(R(P("NameValue"))),postData:a(Z),jsonData:a(p),formData:a(R(P("NameValue"))),multipartData:a(R(P("FormField"))),timeout:a(w),failOnStatusCode:a(y),ignoreHTTPSErrors:a(y),maxRedirects:a(w),maxRetries:a(w)});u.APIRequestContextFetchResult=d({response:P("APIResponse")});u.APIRequestContextFetchResponseBodyParams=d({fetchUid:p});u.APIRequestContextFetchResponseBodyResult=d({binary:a(Z)});u.APIRequestContextFetchLogParams=d({fetchUid:p});u.APIRequestContextFetchLogResult=d({log:R(p)});u.APIRequestContextStorageStateParams=a(d({}));u.APIRequestContextStorageStateResult=d({cookies:R(P("NetworkCookie")),origins:R(P("OriginStorage"))});u.APIRequestContextDisposeAPIResponseParams=d({fetchUid:p});u.APIRequestContextDisposeAPIResponseResult=a(d({}));u.APIRequestContextDisposeParams=d({reason:a(p)});u.APIRequestContextDisposeResult=a(d({}));u.APIResponse=d({fetchUid:p,url:p,status:w,statusText:p,headers:R(P("NameValue"))});u.LifecycleEvent=$(["load","domcontentloaded","networkidle","commit"]);u.LocalUtilsInitializer=d({deviceDescriptors:R(d({name:p,descriptor:d({userAgent:p,viewport:d({width:w,height:w}),screen:a(d({width:w,height:w})),deviceScaleFactor:w,isMobile:y,hasTouch:y,defaultBrowserType:$(["chromium","firefox","webkit"])})}))});u.LocalUtilsZipParams=d({zipFile:p,entries:R(P("NameValue")),stacksId:a(p),mode:$(["write","append"]),includeSources:y});u.LocalUtilsZipResult=a(d({}));u.LocalUtilsHarOpenParams=d({file:p});u.LocalUtilsHarOpenResult=d({harId:a(p),error:a(p)});u.LocalUtilsHarLookupParams=d({harId:p,url:p,method:p,headers:R(P("NameValue")),postData:a(Z),isNavigationRequest:y});u.LocalUtilsHarLookupResult=d({action:$(["error","redirect","fulfill","noentry"]),message:a(p),redirectURL:a(p),status:a(w),headers:a(R(P("NameValue"))),body:a(Z)});u.LocalUtilsHarCloseParams=d({harId:p});u.LocalUtilsHarCloseResult=a(d({}));u.LocalUtilsHarUnzipParams=d({zipFile:p,harFile:p});u.LocalUtilsHarUnzipResult=a(d({}));u.LocalUtilsConnectParams=d({wsEndpoint:p,headers:a(xt),exposeNetwork:a(p),slowMo:a(w),timeout:a(w),socksProxyRedirectPortForTest:a(w)});u.LocalUtilsConnectResult=d({pipe:T(["JsonPipe"]),headers:R(P("NameValue"))});u.LocalUtilsTracingStartedParams=d({tracesDir:a(p),traceName:p});u.LocalUtilsTracingStartedResult=d({stacksId:p});u.LocalUtilsAddStackToTracingNoReplyParams=d({callData:P("ClientSideCallMetadata")});u.LocalUtilsAddStackToTracingNoReplyResult=a(d({}));u.LocalUtilsTraceDiscardedParams=d({stacksId:p});u.LocalUtilsTraceDiscardedResult=a(d({}));u.RootInitializer=a(d({}));u.RootInitializeParams=d({sdkLanguage:$(["javascript","python","java","csharp"])});u.RootInitializeResult=d({playwright:T(["Playwright"])});u.PlaywrightInitializer=d({chromium:T(["BrowserType"]),utils:a(T(["LocalUtils"])),selectors:T(["Selectors"]),preLaunchedBrowser:a(T(["Browser"])),socksSupport:a(T(["SocksSupport"]))});u.PlaywrightNewRequestParams=d({baseURL:a(p),userAgent:a(p),ignoreHTTPSErrors:a(y),extraHTTPHeaders:a(R(P("NameValue"))),clientCertificates:a(R(d({origin:p,cert:a(Z),key:a(Z),passphrase:a(p),pfx:a(Z)}))),httpCredentials:a(d({username:p,password:p,origin:a(p),send:a($(["always","unauthorized"]))})),proxy:a(d({server:p,bypass:a(p),username:a(p),password:a(p)})),timeout:a(w),storageState:a(d({cookies:a(R(P("NetworkCookie"))),origins:a(R(P("OriginStorage")))})),tracesDir:a(p)});u.PlaywrightNewRequestResult=d({request:T(["APIRequestContext"])});u.RecorderSource=d({isRecorded:y,id:p,label:p,text:p,language:p,highlight:R(d({line:w,type:p})),revealLine:a(w),group:a(p)});u.DebugControllerInitializer=a(d({}));u.DebugControllerInspectRequestedEvent=d({selector:p,locator:p});u.DebugControllerSetModeRequestedEvent=d({mode:p});u.DebugControllerStateChangedEvent=d({pageCount:w});u.DebugControllerSourceChangedEvent=d({text:p,header:a(p),footer:a(p),actions:a(R(p))});u.DebugControllerPausedEvent=d({paused:y});u.DebugControllerInitializeParams=d({codegenId:p,sdkLanguage:$(["javascript","python","java","csharp"])});u.DebugControllerInitializeResult=a(d({}));u.DebugControllerSetReportStateChangedParams=d({enabled:y});u.DebugControllerSetReportStateChangedResult=a(d({}));u.DebugControllerResetForReuseParams=a(d({}));u.DebugControllerResetForReuseResult=a(d({}));u.DebugControllerNavigateParams=d({url:p});u.DebugControllerNavigateResult=a(d({}));u.DebugControllerSetRecorderModeParams=d({mode:$(["inspecting","recording","none"]),testIdAttributeName:a(p)});u.DebugControllerSetRecorderModeResult=a(d({}));u.DebugControllerHighlightParams=d({selector:p});u.DebugControllerHighlightResult=a(d({}));u.DebugControllerHideHighlightParams=a(d({}));u.DebugControllerHideHighlightResult=a(d({}));u.DebugControllerResumeParams=a(d({}));u.DebugControllerResumeResult=a(d({}));u.DebugControllerKillParams=a(d({}));u.DebugControllerKillResult=a(d({}));u.DebugControllerCloseAllBrowsersParams=a(d({}));u.DebugControllerCloseAllBrowsersResult=a(d({}));u.SocksSupportInitializer=a(d({}));u.SocksSupportSocksRequestedEvent=d({uid:p,host:p,port:w});u.SocksSupportSocksDataEvent=d({uid:p,data:Z});u.SocksSupportSocksClosedEvent=d({uid:p});u.SocksSupportSocksConnectedParams=d({uid:p,host:p,port:w});u.SocksSupportSocksConnectedResult=a(d({}));u.SocksSupportSocksFailedParams=d({uid:p,errorCode:p});u.SocksSupportSocksFailedResult=a(d({}));u.SocksSupportSocksDataParams=d({uid:p,data:Z});u.SocksSupportSocksDataResult=a(d({}));u.SocksSupportSocksErrorParams=d({uid:p,error:p});u.SocksSupportSocksErrorResult=a(d({}));u.SocksSupportSocksEndParams=d({uid:p});u.SocksSupportSocksEndResult=a(d({}));u.SelectorsInitializer=a(d({}));u.SelectorsRegisterParams=d({name:p,source:p,contentScript:a(y)});u.SelectorsRegisterResult=a(d({}));u.SelectorsSetTestIdAttributeNameParams=d({testIdAttributeName:p});u.SelectorsSetTestIdAttributeNameResult=a(d({}));u.BrowserTypeInitializer=d({executablePath:p,name:p});u.BrowserTypeLaunchParams=d({channel:a(p),executablePath:a(p),args:a(R(p)),ignoreAllDefaultArgs:a(y),ignoreDefaultArgs:a(R(p)),handleSIGINT:a(y),handleSIGTERM:a(y),handleSIGHUP:a(y),timeout:a(w),env:a(R(P("NameValue"))),headless:a(y),devtools:a(y),proxy:a(d({server:p,bypass:a(p),username:a(p),password:a(p)})),downloadsPath:a(p),tracesDir:a(p),chromiumSandbox:a(y),firefoxUserPrefs:a(xt),slowMo:a(w)});u.BrowserTypeLaunchResult=d({browser:T(["Browser"])});u.BrowserTypeLaunchPersistentContextParams=d({channel:a(p),executablePath:a(p),args:a(R(p)),ignoreAllDefaultArgs:a(y),ignoreDefaultArgs:a(R(p)),handleSIGINT:a(y),handleSIGTERM:a(y),handleSIGHUP:a(y),timeout:a(w),env:a(R(P("NameValue"))),headless:a(y),devtools:a(y),proxy:a(d({server:p,bypass:a(p),username:a(p),password:a(p)})),downloadsPath:a(p),tracesDir:a(p),chromiumSandbox:a(y),firefoxUserPrefs:a(xt),noDefaultViewport:a(y),viewport:a(d({width:w,height:w})),screen:a(d({width:w,height:w})),ignoreHTTPSErrors:a(y),clientCertificates:a(R(d({origin:p,cert:a(Z),key:a(Z),passphrase:a(p),pfx:a(Z)}))),javaScriptEnabled:a(y),bypassCSP:a(y),userAgent:a(p),locale:a(p),timezoneId:a(p),geolocation:a(d({longitude:w,latitude:w,accuracy:a(w)})),permissions:a(R(p)),extraHTTPHeaders:a(R(P("NameValue"))),offline:a(y),httpCredentials:a(d({username:p,password:p,origin:a(p),send:a($(["always","unauthorized"]))})),deviceScaleFactor:a(w),isMobile:a(y),hasTouch:a(y),colorScheme:a($(["dark","light","no-preference","no-override"])),reducedMotion:a($(["reduce","no-preference","no-override"])),forcedColors:a($(["active","none","no-override"])),acceptDownloads:a($(["accept","deny","internal-browser-default"])),baseURL:a(p),recordVideo:a(d({dir:p,size:a(d({width:w,height:w}))})),recordHar:a(P("RecordHarOptions")),strictSelectors:a(y),serviceWorkers:a($(["allow","block"])),userDataDir:p,slowMo:a(w)});u.BrowserTypeLaunchPersistentContextResult=d({context:T(["BrowserContext"])});u.BrowserTypeConnectOverCDPParams=d({endpointURL:p,headers:a(R(P("NameValue"))),slowMo:a(w),timeout:a(w)});u.BrowserTypeConnectOverCDPResult=d({browser:T(["Browser"]),defaultContext:a(T(["BrowserContext"]))});u.BrowserInitializer=d({version:p,name:p});u.BrowserCloseEvent=a(d({}));u.BrowserCloseParams=d({reason:a(p)});u.BrowserCloseResult=a(d({}));u.BrowserKillForTestsParams=a(d({}));u.BrowserKillForTestsResult=a(d({}));u.BrowserDefaultUserAgentForTestParams=a(d({}));u.BrowserDefaultUserAgentForTestResult=d({userAgent:p});u.BrowserNewContextParams=d({noDefaultViewport:a(y),viewport:a(d({width:w,height:w})),screen:a(d({width:w,height:w})),ignoreHTTPSErrors:a(y),clientCertificates:a(R(d({origin:p,cert:a(Z),key:a(Z),passphrase:a(p),pfx:a(Z)}))),javaScriptEnabled:a(y),bypassCSP:a(y),userAgent:a(p),locale:a(p),timezoneId:a(p),geolocation:a(d({longitude:w,latitude:w,accuracy:a(w)})),permissions:a(R(p)),extraHTTPHeaders:a(R(P("NameValue"))),offline:a(y),httpCredentials:a(d({username:p,password:p,origin:a(p),send:a($(["always","unauthorized"]))})),deviceScaleFactor:a(w),isMobile:a(y),hasTouch:a(y),colorScheme:a($(["dark","light","no-preference","no-override"])),reducedMotion:a($(["reduce","no-preference","no-override"])),forcedColors:a($(["active","none","no-override"])),acceptDownloads:a($(["accept","deny","internal-browser-default"])),baseURL:a(p),recordVideo:a(d({dir:p,size:a(d({width:w,height:w}))})),recordHar:a(P("RecordHarOptions")),strictSelectors:a(y),serviceWorkers:a($(["allow","block"])),proxy:a(d({server:p,bypass:a(p),username:a(p),password:a(p)})),storageState:a(d({cookies:a(R(P("SetNetworkCookie"))),origins:a(R(P("OriginStorage")))}))});u.BrowserNewContextResult=d({context:T(["BrowserContext"])});u.BrowserNewContextForReuseParams=d({noDefaultViewport:a(y),viewport:a(d({width:w,height:w})),screen:a(d({width:w,height:w})),ignoreHTTPSErrors:a(y),clientCertificates:a(R(d({origin:p,cert:a(Z),key:a(Z),passphrase:a(p),pfx:a(Z)}))),javaScriptEnabled:a(y),bypassCSP:a(y),userAgent:a(p),locale:a(p),timezoneId:a(p),geolocation:a(d({longitude:w,latitude:w,accuracy:a(w)})),permissions:a(R(p)),extraHTTPHeaders:a(R(P("NameValue"))),offline:a(y),httpCredentials:a(d({username:p,password:p,origin:a(p),send:a($(["always","unauthorized"]))})),deviceScaleFactor:a(w),isMobile:a(y),hasTouch:a(y),colorScheme:a($(["dark","light","no-preference","no-override"])),reducedMotion:a($(["reduce","no-preference","no-override"])),forcedColors:a($(["active","none","no-override"])),acceptDownloads:a($(["accept","deny","internal-browser-default"])),baseURL:a(p),recordVideo:a(d({dir:p,size:a(d({width:w,height:w}))})),recordHar:a(P("RecordHarOptions")),strictSelectors:a(y),serviceWorkers:a($(["allow","block"])),proxy:a(d({server:p,bypass:a(p),username:a(p),password:a(p)})),storageState:a(d({cookies:a(R(P("SetNetworkCookie"))),origins:a(R(P("OriginStorage")))}))});u.BrowserNewContextForReuseResult=d({context:T(["BrowserContext"])});u.BrowserStopPendingOperationsParams=d({reason:p});u.BrowserStopPendingOperationsResult=a(d({}));u.BrowserNewBrowserCDPSessionParams=a(d({}));u.BrowserNewBrowserCDPSessionResult=d({session:T(["CDPSession"])});u.BrowserStartTracingParams=d({page:a(T(["Page"])),screenshots:a(y),categories:a(R(p))});u.BrowserStartTracingResult=a(d({}));u.BrowserStopTracingParams=a(d({}));u.BrowserStopTracingResult=d({artifact:T(["Artifact"])});u.EventTargetInitializer=a(d({}));u.EventTargetWaitForEventInfoParams=d({info:d({waitId:p,phase:$(["before","after","log"]),event:a(p),message:a(p),error:a(p)})});u.BrowserContextWaitForEventInfoParams=P("EventTargetWaitForEventInfoParams");u.PageWaitForEventInfoParams=P("EventTargetWaitForEventInfoParams");u.WebSocketWaitForEventInfoParams=P("EventTargetWaitForEventInfoParams");u.ElectronApplicationWaitForEventInfoParams=P("EventTargetWaitForEventInfoParams");u.AndroidDeviceWaitForEventInfoParams=P("EventTargetWaitForEventInfoParams");u.EventTargetWaitForEventInfoResult=a(d({}));u.BrowserContextWaitForEventInfoResult=P("EventTargetWaitForEventInfoResult");u.PageWaitForEventInfoResult=P("EventTargetWaitForEventInfoResult");u.WebSocketWaitForEventInfoResult=P("EventTargetWaitForEventInfoResult");u.ElectronApplicationWaitForEventInfoResult=P("EventTargetWaitForEventInfoResult");u.AndroidDeviceWaitForEventInfoResult=P("EventTargetWaitForEventInfoResult");u.BrowserContextInitializer=d({isChromium:y,requestContext:T(["APIRequestContext"]),tracing:T(["Tracing"])});u.BrowserContextBindingCallEvent=d({binding:T(["BindingCall"])});u.BrowserContextConsoleEvent=d({type:p,text:p,args:R(T(["ElementHandle","JSHandle"])),location:d({url:p,lineNumber:w,columnNumber:w}),page:T(["Page"])});u.BrowserContextCloseEvent=a(d({}));u.BrowserContextDialogEvent=d({dialog:T(["Dialog"])});u.BrowserContextPageEvent=d({page:T(["Page"])});u.BrowserContextPageErrorEvent=d({error:P("SerializedError"),page:T(["Page"])});u.BrowserContextRouteEvent=d({route:T(["Route"])});u.BrowserContextVideoEvent=d({artifact:T(["Artifact"])});u.BrowserContextBackgroundPageEvent=d({page:T(["Page"])});u.BrowserContextServiceWorkerEvent=d({worker:T(["Worker"])});u.BrowserContextRequestEvent=d({request:T(["Request"]),page:a(T(["Page"]))});u.BrowserContextRequestFailedEvent=d({request:T(["Request"]),failureText:a(p),responseEndTiming:w,page:a(T(["Page"]))});u.BrowserContextRequestFinishedEvent=d({request:T(["Request"]),response:a(T(["Response"])),responseEndTiming:w,page:a(T(["Page"]))});u.BrowserContextResponseEvent=d({response:T(["Response"]),page:a(T(["Page"]))});u.BrowserContextAddCookiesParams=d({cookies:R(P("SetNetworkCookie"))});u.BrowserContextAddCookiesResult=a(d({}));u.BrowserContextAddInitScriptParams=d({source:p});u.BrowserContextAddInitScriptResult=a(d({}));u.BrowserContextClearCookiesParams=d({name:a(p),nameRegexSource:a(p),nameRegexFlags:a(p),domain:a(p),domainRegexSource:a(p),domainRegexFlags:a(p),path:a(p),pathRegexSource:a(p),pathRegexFlags:a(p)});u.BrowserContextClearCookiesResult=a(d({}));u.BrowserContextClearPermissionsParams=a(d({}));u.BrowserContextClearPermissionsResult=a(d({}));u.BrowserContextCloseParams=d({reason:a(p)});u.BrowserContextCloseResult=a(d({}));u.BrowserContextCookiesParams=d({urls:R(p)});u.BrowserContextCookiesResult=d({cookies:R(P("NetworkCookie"))});u.BrowserContextExposeBindingParams=d({name:p,needsHandle:a(y)});u.BrowserContextExposeBindingResult=a(d({}));u.BrowserContextGrantPermissionsParams=d({permissions:R(p),origin:a(p)});u.BrowserContextGrantPermissionsResult=a(d({}));u.BrowserContextNewPageParams=a(d({}));u.BrowserContextNewPageResult=d({page:T(["Page"])});u.BrowserContextSetDefaultNavigationTimeoutNoReplyParams=d({timeout:a(w)});u.BrowserContextSetDefaultNavigationTimeoutNoReplyResult=a(d({}));u.BrowserContextSetDefaultTimeoutNoReplyParams=d({timeout:a(w)});u.BrowserContextSetDefaultTimeoutNoReplyResult=a(d({}));u.BrowserContextSetExtraHTTPHeadersParams=d({headers:R(P("NameValue"))});u.BrowserContextSetExtraHTTPHeadersResult=a(d({}));u.BrowserContextSetGeolocationParams=d({geolocation:a(d({longitude:w,latitude:w,accuracy:a(w)}))});u.BrowserContextSetGeolocationResult=a(d({}));u.BrowserContextSetHTTPCredentialsParams=d({httpCredentials:a(d({username:p,password:p,origin:a(p)}))});u.BrowserContextSetHTTPCredentialsResult=a(d({}));u.BrowserContextSetNetworkInterceptionPatternsParams=d({patterns:R(d({glob:a(p),regexSource:a(p),regexFlags:a(p)}))});u.BrowserContextSetNetworkInterceptionPatternsResult=a(d({}));u.BrowserContextSetOfflineParams=d({offline:y});u.BrowserContextSetOfflineResult=a(d({}));u.BrowserContextStorageStateParams=a(d({}));u.BrowserContextStorageStateResult=d({cookies:R(P("NetworkCookie")),origins:R(P("OriginStorage"))});u.BrowserContextPauseParams=a(d({}));u.BrowserContextPauseResult=a(d({}));u.BrowserContextRecorderSupplementEnableParams=d({language:a(p),mode:a($(["inspecting","recording"])),pauseOnNextStatement:a(y),testIdAttributeName:a(p),launchOptions:a(xt),contextOptions:a(xt),device:a(p),saveStorage:a(p),outputFile:a(p),omitCallTracking:a(y)});u.BrowserContextRecorderSupplementEnableResult=a(d({}));u.BrowserContextNewCDPSessionParams=d({page:a(T(["Page"])),frame:a(T(["Frame"]))});u.BrowserContextNewCDPSessionResult=d({session:T(["CDPSession"])});u.BrowserContextHarStartParams=d({page:a(T(["Page"])),options:P("RecordHarOptions")});u.BrowserContextHarStartResult=d({harId:p});u.BrowserContextHarExportParams=d({harId:a(p)});u.BrowserContextHarExportResult=d({artifact:T(["Artifact"])});u.BrowserContextCreateTempFilesParams=d({rootDirName:a(p),items:R(d({name:p,lastModifiedMs:a(w)}))});u.BrowserContextCreateTempFilesResult=d({rootDir:a(T(["WritableStream"])),writableStreams:R(T(["WritableStream"]))});u.BrowserContextUpdateSubscriptionParams=d({event:$(["console","dialog","request","response","requestFinished","requestFailed"]),enabled:y});u.BrowserContextUpdateSubscriptionResult=a(d({}));u.BrowserContextClockFastForwardParams=d({ticksNumber:a(w),ticksString:a(p)});u.BrowserContextClockFastForwardResult=a(d({}));u.BrowserContextClockInstallParams=d({timeNumber:a(w),timeString:a(p)});u.BrowserContextClockInstallResult=a(d({}));u.BrowserContextClockPauseAtParams=d({timeNumber:a(w),timeString:a(p)});u.BrowserContextClockPauseAtResult=a(d({}));u.BrowserContextClockResumeParams=a(d({}));u.BrowserContextClockResumeResult=a(d({}));u.BrowserContextClockRunForParams=d({ticksNumber:a(w),ticksString:a(p)});u.BrowserContextClockRunForResult=a(d({}));u.BrowserContextClockSetFixedTimeParams=d({timeNumber:a(w),timeString:a(p)});u.BrowserContextClockSetFixedTimeResult=a(d({}));u.BrowserContextClockSetSystemTimeParams=d({timeNumber:a(w),timeString:a(p)});u.BrowserContextClockSetSystemTimeResult=a(d({}));u.PageInitializer=d({mainFrame:T(["Frame"]),viewportSize:a(d({width:w,height:w})),isClosed:y,opener:a(T(["Page"]))});u.PageBindingCallEvent=d({binding:T(["BindingCall"])});u.PageCloseEvent=a(d({}));u.PageCrashEvent=a(d({}));u.PageDownloadEvent=d({url:p,suggestedFilename:p,artifact:T(["Artifact"])});u.PageFileChooserEvent=d({element:T(["ElementHandle"]),isMultiple:y});u.PageFrameAttachedEvent=d({frame:T(["Frame"])});u.PageFrameDetachedEvent=d({frame:T(["Frame"])});u.PageLocatorHandlerTriggeredEvent=d({uid:w});u.PageRouteEvent=d({route:T(["Route"])});u.PageVideoEvent=d({artifact:T(["Artifact"])});u.PageWebSocketEvent=d({webSocket:T(["WebSocket"])});u.PageWorkerEvent=d({worker:T(["Worker"])});u.PageSetDefaultNavigationTimeoutNoReplyParams=d({timeout:a(w)});u.PageSetDefaultNavigationTimeoutNoReplyResult=a(d({}));u.PageSetDefaultTimeoutNoReplyParams=d({timeout:a(w)});u.PageSetDefaultTimeoutNoReplyResult=a(d({}));u.PageAddInitScriptParams=d({source:p});u.PageAddInitScriptResult=a(d({}));u.PageCloseParams=d({runBeforeUnload:a(y),reason:a(p)});u.PageCloseResult=a(d({}));u.PageEmulateMediaParams=d({media:a($(["screen","print","no-override"])),colorScheme:a($(["dark","light","no-preference","no-override"])),reducedMotion:a($(["reduce","no-preference","no-override"])),forcedColors:a($(["active","none","no-override"]))});u.PageEmulateMediaResult=a(d({}));u.PageExposeBindingParams=d({name:p,needsHandle:a(y)});u.PageExposeBindingResult=a(d({}));u.PageGoBackParams=d({timeout:a(w),waitUntil:a(P("LifecycleEvent"))});u.PageGoBackResult=d({response:a(T(["Response"]))});u.PageGoForwardParams=d({timeout:a(w),waitUntil:a(P("LifecycleEvent"))});u.PageGoForwardResult=d({response:a(T(["Response"]))});u.PageRegisterLocatorHandlerParams=d({selector:p,noWaitAfter:a(y)});u.PageRegisterLocatorHandlerResult=d({uid:w});u.PageResolveLocatorHandlerNoReplyParams=d({uid:w,remove:a(y)});u.PageResolveLocatorHandlerNoReplyResult=a(d({}));u.PageUnregisterLocatorHandlerParams=d({uid:w});u.PageUnregisterLocatorHandlerResult=a(d({}));u.PageReloadParams=d({timeout:a(w),waitUntil:a(P("LifecycleEvent"))});u.PageReloadResult=d({response:a(T(["Response"]))});u.PageExpectScreenshotParams=d({expected:a(Z),timeout:a(w),isNot:y,locator:a(d({frame:T(["Frame"]),selector:p})),comparator:a(p),maxDiffPixels:a(w),maxDiffPixelRatio:a(w),threshold:a(w),fullPage:a(y),clip:a(P("Rect")),omitBackground:a(y),caret:a($(["hide","initial"])),animations:a($(["disabled","allow"])),scale:a($(["css","device"])),mask:a(R(d({frame:T(["Frame"]),selector:p}))),maskColor:a(p),style:a(p)});u.PageExpectScreenshotResult=d({diff:a(Z),errorMessage:a(p),actual:a(Z),previous:a(Z),log:a(R(p))});u.PageScreenshotParams=d({timeout:a(w),type:a($(["png","jpeg"])),quality:a(w),fullPage:a(y),clip:a(P("Rect")),omitBackground:a(y),caret:a($(["hide","initial"])),animations:a($(["disabled","allow"])),scale:a($(["css","device"])),mask:a(R(d({frame:T(["Frame"]),selector:p}))),maskColor:a(p),style:a(p)});u.PageScreenshotResult=d({binary:Z});u.PageSetExtraHTTPHeadersParams=d({headers:R(P("NameValue"))});u.PageSetExtraHTTPHeadersResult=a(d({}));u.PageSetNetworkInterceptionPatternsParams=d({patterns:R(d({glob:a(p),regexSource:a(p),regexFlags:a(p)}))});u.PageSetNetworkInterceptionPatternsResult=a(d({}));u.PageSetViewportSizeParams=d({viewportSize:d({width:w,height:w})});u.PageSetViewportSizeResult=a(d({}));u.PageKeyboardDownParams=d({key:p});u.PageKeyboardDownResult=a(d({}));u.PageKeyboardUpParams=d({key:p});u.PageKeyboardUpResult=a(d({}));u.PageKeyboardInsertTextParams=d({text:p});u.PageKeyboardInsertTextResult=a(d({}));u.PageKeyboardTypeParams=d({text:p,delay:a(w)});u.PageKeyboardTypeResult=a(d({}));u.PageKeyboardPressParams=d({key:p,delay:a(w)});u.PageKeyboardPressResult=a(d({}));u.PageMouseMoveParams=d({x:w,y:w,steps:a(w)});u.PageMouseMoveResult=a(d({}));u.PageMouseDownParams=d({button:a($(["left","right","middle"])),clickCount:a(w)});u.PageMouseDownResult=a(d({}));u.PageMouseUpParams=d({button:a($(["left","right","middle"])),clickCount:a(w)});u.PageMouseUpResult=a(d({}));u.PageMouseClickParams=d({x:w,y:w,delay:a(w),button:a($(["left","right","middle"])),clickCount:a(w)});u.PageMouseClickResult=a(d({}));u.PageMouseWheelParams=d({deltaX:w,deltaY:w});u.PageMouseWheelResult=a(d({}));u.PageTouchscreenTapParams=d({x:w,y:w});u.PageTouchscreenTapResult=a(d({}));u.PageAccessibilitySnapshotParams=d({interestingOnly:a(y),root:a(T(["ElementHandle"]))});u.PageAccessibilitySnapshotResult=d({rootAXNode:a(P("AXNode"))});u.PagePdfParams=d({scale:a(w),displayHeaderFooter:a(y),headerTemplate:a(p),footerTemplate:a(p),printBackground:a(y),landscape:a(y),pageRanges:a(p),format:a(p),width:a(p),height:a(p),preferCSSPageSize:a(y),margin:a(d({top:a(p),bottom:a(p),left:a(p),right:a(p)})),tagged:a(y),outline:a(y)});u.PagePdfResult=d({pdf:Z});u.PageStartJSCoverageParams=d({resetOnNavigation:a(y),reportAnonymousScripts:a(y)});u.PageStartJSCoverageResult=a(d({}));u.PageStopJSCoverageParams=a(d({}));u.PageStopJSCoverageResult=d({entries:R(d({url:p,scriptId:p,source:a(p),functions:R(d({functionName:p,isBlockCoverage:y,ranges:R(d({startOffset:w,endOffset:w,count:w}))}))}))});u.PageStartCSSCoverageParams=d({resetOnNavigation:a(y)});u.PageStartCSSCoverageResult=a(d({}));u.PageStopCSSCoverageParams=a(d({}));u.PageStopCSSCoverageResult=d({entries:R(d({url:p,text:a(p),ranges:R(d({start:w,end:w}))}))});u.PageBringToFrontParams=a(d({}));u.PageBringToFrontResult=a(d({}));u.PageUpdateSubscriptionParams=d({event:$(["console","dialog","fileChooser","request","response","requestFinished","requestFailed"]),enabled:y});u.PageUpdateSubscriptionResult=a(d({}));u.FrameInitializer=d({url:p,name:p,parentFrame:a(T(["Frame"])),loadStates:R(P("LifecycleEvent"))});u.FrameLoadstateEvent=d({add:a(P("LifecycleEvent")),remove:a(P("LifecycleEvent"))});u.FrameNavigatedEvent=d({url:p,name:p,newDocument:a(d({request:a(T(["Request"]))})),error:a(p)});u.FrameEvalOnSelectorParams=d({selector:p,strict:a(y),expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.FrameEvalOnSelectorResult=d({value:P("SerializedValue")});u.FrameEvalOnSelectorAllParams=d({selector:p,expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.FrameEvalOnSelectorAllResult=d({value:P("SerializedValue")});u.FrameAddScriptTagParams=d({url:a(p),content:a(p),type:a(p)});u.FrameAddScriptTagResult=d({element:T(["ElementHandle"])});u.FrameAddStyleTagParams=d({url:a(p),content:a(p)});u.FrameAddStyleTagResult=d({element:T(["ElementHandle"])});u.FrameBlurParams=d({selector:p,strict:a(y),timeout:a(w)});u.FrameBlurResult=a(d({}));u.FrameCheckParams=d({selector:p,strict:a(y),force:a(y),position:a(P("Point")),timeout:a(w),trial:a(y)});u.FrameCheckResult=a(d({}));u.FrameClickParams=d({selector:p,strict:a(y),force:a(y),noWaitAfter:a(y),modifiers:a(R($(["Alt","Control","ControlOrMeta","Meta","Shift"]))),position:a(P("Point")),delay:a(w),button:a($(["left","right","middle"])),clickCount:a(w),timeout:a(w),trial:a(y)});u.FrameClickResult=a(d({}));u.FrameContentParams=a(d({}));u.FrameContentResult=d({value:p});u.FrameDragAndDropParams=d({source:p,target:p,force:a(y),timeout:a(w),trial:a(y),sourcePosition:a(P("Point")),targetPosition:a(P("Point")),strict:a(y)});u.FrameDragAndDropResult=a(d({}));u.FrameDblclickParams=d({selector:p,strict:a(y),force:a(y),modifiers:a(R($(["Alt","Control","ControlOrMeta","Meta","Shift"]))),position:a(P("Point")),delay:a(w),button:a($(["left","right","middle"])),timeout:a(w),trial:a(y)});u.FrameDblclickResult=a(d({}));u.FrameDispatchEventParams=d({selector:p,strict:a(y),type:p,eventInit:P("SerializedArgument"),timeout:a(w)});u.FrameDispatchEventResult=a(d({}));u.FrameEvaluateExpressionParams=d({expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.FrameEvaluateExpressionResult=d({value:P("SerializedValue")});u.FrameEvaluateExpressionHandleParams=d({expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.FrameEvaluateExpressionHandleResult=d({handle:T(["ElementHandle","JSHandle"])});u.FrameFillParams=d({selector:p,strict:a(y),value:p,force:a(y),timeout:a(w)});u.FrameFillResult=a(d({}));u.FrameFocusParams=d({selector:p,strict:a(y),timeout:a(w)});u.FrameFocusResult=a(d({}));u.FrameFrameElementParams=a(d({}));u.FrameFrameElementResult=d({element:T(["ElementHandle"])});u.FrameHighlightParams=d({selector:p});u.FrameHighlightResult=a(d({}));u.FrameGetAttributeParams=d({selector:p,strict:a(y),name:p,timeout:a(w)});u.FrameGetAttributeResult=d({value:a(p)});u.FrameGotoParams=d({url:p,timeout:a(w),waitUntil:a(P("LifecycleEvent")),referer:a(p)});u.FrameGotoResult=d({response:a(T(["Response"]))});u.FrameHoverParams=d({selector:p,strict:a(y),force:a(y),modifiers:a(R($(["Alt","Control","ControlOrMeta","Meta","Shift"]))),position:a(P("Point")),timeout:a(w),trial:a(y)});u.FrameHoverResult=a(d({}));u.FrameInnerHTMLParams=d({selector:p,strict:a(y),timeout:a(w)});u.FrameInnerHTMLResult=d({value:p});u.FrameInnerTextParams=d({selector:p,strict:a(y),timeout:a(w)});u.FrameInnerTextResult=d({value:p});u.FrameInputValueParams=d({selector:p,strict:a(y),timeout:a(w)});u.FrameInputValueResult=d({value:p});u.FrameIsCheckedParams=d({selector:p,strict:a(y),timeout:a(w)});u.FrameIsCheckedResult=d({value:y});u.FrameIsDisabledParams=d({selector:p,strict:a(y),timeout:a(w)});u.FrameIsDisabledResult=d({value:y});u.FrameIsEnabledParams=d({selector:p,strict:a(y),timeout:a(w)});u.FrameIsEnabledResult=d({value:y});u.FrameIsHiddenParams=d({selector:p,strict:a(y)});u.FrameIsHiddenResult=d({value:y});u.FrameIsVisibleParams=d({selector:p,strict:a(y)});u.FrameIsVisibleResult=d({value:y});u.FrameIsEditableParams=d({selector:p,strict:a(y),timeout:a(w)});u.FrameIsEditableResult=d({value:y});u.FramePressParams=d({selector:p,strict:a(y),key:p,delay:a(w),noWaitAfter:a(y),timeout:a(w)});u.FramePressResult=a(d({}));u.FrameQuerySelectorParams=d({selector:p,strict:a(y)});u.FrameQuerySelectorResult=d({element:a(T(["ElementHandle"]))});u.FrameQuerySelectorAllParams=d({selector:p});u.FrameQuerySelectorAllResult=d({elements:R(T(["ElementHandle"]))});u.FrameQueryCountParams=d({selector:p});u.FrameQueryCountResult=d({value:w});u.FrameSelectOptionParams=d({selector:p,strict:a(y),elements:a(R(T(["ElementHandle"]))),options:a(R(d({valueOrLabel:a(p),value:a(p),label:a(p),index:a(w)}))),force:a(y),timeout:a(w)});u.FrameSelectOptionResult=d({values:R(p)});u.FrameSetContentParams=d({html:p,timeout:a(w),waitUntil:a(P("LifecycleEvent"))});u.FrameSetContentResult=a(d({}));u.FrameSetInputFilesParams=d({selector:p,strict:a(y),payloads:a(R(d({name:p,mimeType:a(p),buffer:Z}))),localDirectory:a(p),directoryStream:a(T(["WritableStream"])),localPaths:a(R(p)),streams:a(R(T(["WritableStream"]))),timeout:a(w)});u.FrameSetInputFilesResult=a(d({}));u.FrameTapParams=d({selector:p,strict:a(y),force:a(y),modifiers:a(R($(["Alt","Control","ControlOrMeta","Meta","Shift"]))),position:a(P("Point")),timeout:a(w),trial:a(y)});u.FrameTapResult=a(d({}));u.FrameTextContentParams=d({selector:p,strict:a(y),timeout:a(w)});u.FrameTextContentResult=d({value:a(p)});u.FrameTitleParams=a(d({}));u.FrameTitleResult=d({value:p});u.FrameTypeParams=d({selector:p,strict:a(y),text:p,delay:a(w),timeout:a(w)});u.FrameTypeResult=a(d({}));u.FrameUncheckParams=d({selector:p,strict:a(y),force:a(y),position:a(P("Point")),timeout:a(w),trial:a(y)});u.FrameUncheckResult=a(d({}));u.FrameWaitForTimeoutParams=d({timeout:w});u.FrameWaitForTimeoutResult=a(d({}));u.FrameWaitForFunctionParams=d({expression:p,isFunction:a(y),arg:P("SerializedArgument"),timeout:a(w),pollingInterval:a(w)});u.FrameWaitForFunctionResult=d({handle:T(["ElementHandle","JSHandle"])});u.FrameWaitForSelectorParams=d({selector:p,strict:a(y),timeout:a(w),state:a($(["attached","detached","visible","hidden"])),omitReturnValue:a(y)});u.FrameWaitForSelectorResult=d({element:a(T(["ElementHandle"]))});u.FrameExpectParams=d({selector:p,expression:p,expressionArg:a(xt),expectedText:a(R(P("ExpectedTextValue"))),expectedNumber:a(w),expectedValue:a(P("SerializedArgument")),useInnerText:a(y),isNot:y,timeout:a(w)});u.FrameExpectResult=d({matches:y,received:a(P("SerializedValue")),timedOut:a(y),log:a(R(p))});u.WorkerInitializer=d({url:p});u.WorkerCloseEvent=a(d({}));u.WorkerEvaluateExpressionParams=d({expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.WorkerEvaluateExpressionResult=d({value:P("SerializedValue")});u.WorkerEvaluateExpressionHandleParams=d({expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.WorkerEvaluateExpressionHandleResult=d({handle:T(["ElementHandle","JSHandle"])});u.JSHandleInitializer=d({preview:p});u.JSHandlePreviewUpdatedEvent=d({preview:p});u.ElementHandlePreviewUpdatedEvent=P("JSHandlePreviewUpdatedEvent");u.JSHandleDisposeParams=a(d({}));u.ElementHandleDisposeParams=P("JSHandleDisposeParams");u.JSHandleDisposeResult=a(d({}));u.ElementHandleDisposeResult=P("JSHandleDisposeResult");u.JSHandleEvaluateExpressionParams=d({expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.ElementHandleEvaluateExpressionParams=P("JSHandleEvaluateExpressionParams");u.JSHandleEvaluateExpressionResult=d({value:P("SerializedValue")});u.ElementHandleEvaluateExpressionResult=P("JSHandleEvaluateExpressionResult");u.JSHandleEvaluateExpressionHandleParams=d({expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.ElementHandleEvaluateExpressionHandleParams=P("JSHandleEvaluateExpressionHandleParams");u.JSHandleEvaluateExpressionHandleResult=d({handle:T(["ElementHandle","JSHandle"])});u.ElementHandleEvaluateExpressionHandleResult=P("JSHandleEvaluateExpressionHandleResult");u.JSHandleGetPropertyListParams=a(d({}));u.ElementHandleGetPropertyListParams=P("JSHandleGetPropertyListParams");u.JSHandleGetPropertyListResult=d({properties:R(d({name:p,value:T(["ElementHandle","JSHandle"])}))});u.ElementHandleGetPropertyListResult=P("JSHandleGetPropertyListResult");u.JSHandleGetPropertyParams=d({name:p});u.ElementHandleGetPropertyParams=P("JSHandleGetPropertyParams");u.JSHandleGetPropertyResult=d({handle:T(["ElementHandle","JSHandle"])});u.ElementHandleGetPropertyResult=P("JSHandleGetPropertyResult");u.JSHandleJsonValueParams=a(d({}));u.ElementHandleJsonValueParams=P("JSHandleJsonValueParams");u.JSHandleJsonValueResult=d({value:P("SerializedValue")});u.ElementHandleJsonValueResult=P("JSHandleJsonValueResult");u.JSHandleObjectCountParams=a(d({}));u.ElementHandleObjectCountParams=P("JSHandleObjectCountParams");u.JSHandleObjectCountResult=d({count:w});u.ElementHandleObjectCountResult=P("JSHandleObjectCountResult");u.ElementHandleInitializer=d({preview:p});u.ElementHandleEvalOnSelectorParams=d({selector:p,strict:a(y),expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.ElementHandleEvalOnSelectorResult=d({value:P("SerializedValue")});u.ElementHandleEvalOnSelectorAllParams=d({selector:p,expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.ElementHandleEvalOnSelectorAllResult=d({value:P("SerializedValue")});u.ElementHandleBoundingBoxParams=a(d({}));u.ElementHandleBoundingBoxResult=d({value:a(P("Rect"))});u.ElementHandleCheckParams=d({force:a(y),position:a(P("Point")),timeout:a(w),trial:a(y)});u.ElementHandleCheckResult=a(d({}));u.ElementHandleClickParams=d({force:a(y),noWaitAfter:a(y),modifiers:a(R($(["Alt","Control","ControlOrMeta","Meta","Shift"]))),position:a(P("Point")),delay:a(w),button:a($(["left","right","middle"])),clickCount:a(w),timeout:a(w),trial:a(y)});u.ElementHandleClickResult=a(d({}));u.ElementHandleContentFrameParams=a(d({}));u.ElementHandleContentFrameResult=d({frame:a(T(["Frame"]))});u.ElementHandleDblclickParams=d({force:a(y),modifiers:a(R($(["Alt","Control","ControlOrMeta","Meta","Shift"]))),position:a(P("Point")),delay:a(w),button:a($(["left","right","middle"])),timeout:a(w),trial:a(y)});u.ElementHandleDblclickResult=a(d({}));u.ElementHandleDispatchEventParams=d({type:p,eventInit:P("SerializedArgument")});u.ElementHandleDispatchEventResult=a(d({}));u.ElementHandleFillParams=d({value:p,force:a(y),timeout:a(w)});u.ElementHandleFillResult=a(d({}));u.ElementHandleFocusParams=a(d({}));u.ElementHandleFocusResult=a(d({}));u.ElementHandleGetAttributeParams=d({name:p});u.ElementHandleGetAttributeResult=d({value:a(p)});u.ElementHandleHoverParams=d({force:a(y),modifiers:a(R($(["Alt","Control","ControlOrMeta","Meta","Shift"]))),position:a(P("Point")),timeout:a(w),trial:a(y)});u.ElementHandleHoverResult=a(d({}));u.ElementHandleInnerHTMLParams=a(d({}));u.ElementHandleInnerHTMLResult=d({value:p});u.ElementHandleInnerTextParams=a(d({}));u.ElementHandleInnerTextResult=d({value:p});u.ElementHandleInputValueParams=a(d({}));u.ElementHandleInputValueResult=d({value:p});u.ElementHandleIsCheckedParams=a(d({}));u.ElementHandleIsCheckedResult=d({value:y});u.ElementHandleIsDisabledParams=a(d({}));u.ElementHandleIsDisabledResult=d({value:y});u.ElementHandleIsEditableParams=a(d({}));u.ElementHandleIsEditableResult=d({value:y});u.ElementHandleIsEnabledParams=a(d({}));u.ElementHandleIsEnabledResult=d({value:y});u.ElementHandleIsHiddenParams=a(d({}));u.ElementHandleIsHiddenResult=d({value:y});u.ElementHandleIsVisibleParams=a(d({}));u.ElementHandleIsVisibleResult=d({value:y});u.ElementHandleOwnerFrameParams=a(d({}));u.ElementHandleOwnerFrameResult=d({frame:a(T(["Frame"]))});u.ElementHandlePressParams=d({key:p,delay:a(w),timeout:a(w),noWaitAfter:a(y)});u.ElementHandlePressResult=a(d({}));u.ElementHandleQuerySelectorParams=d({selector:p,strict:a(y)});u.ElementHandleQuerySelectorResult=d({element:a(T(["ElementHandle"]))});u.ElementHandleQuerySelectorAllParams=d({selector:p});u.ElementHandleQuerySelectorAllResult=d({elements:R(T(["ElementHandle"]))});u.ElementHandleScreenshotParams=d({timeout:a(w),type:a($(["png","jpeg"])),quality:a(w),omitBackground:a(y),caret:a($(["hide","initial"])),animations:a($(["disabled","allow"])),scale:a($(["css","device"])),mask:a(R(d({frame:T(["Frame"]),selector:p}))),maskColor:a(p),style:a(p)});u.ElementHandleScreenshotResult=d({binary:Z});u.ElementHandleScrollIntoViewIfNeededParams=d({timeout:a(w)});u.ElementHandleScrollIntoViewIfNeededResult=a(d({}));u.ElementHandleSelectOptionParams=d({elements:a(R(T(["ElementHandle"]))),options:a(R(d({valueOrLabel:a(p),value:a(p),label:a(p),index:a(w)}))),force:a(y),timeout:a(w)});u.ElementHandleSelectOptionResult=d({values:R(p)});u.ElementHandleSelectTextParams=d({force:a(y),timeout:a(w)});u.ElementHandleSelectTextResult=a(d({}));u.ElementHandleSetInputFilesParams=d({payloads:a(R(d({name:p,mimeType:a(p),buffer:Z}))),localDirectory:a(p),directoryStream:a(T(["WritableStream"])),localPaths:a(R(p)),streams:a(R(T(["WritableStream"]))),timeout:a(w)});u.ElementHandleSetInputFilesResult=a(d({}));u.ElementHandleTapParams=d({force:a(y),modifiers:a(R($(["Alt","Control","ControlOrMeta","Meta","Shift"]))),position:a(P("Point")),timeout:a(w),trial:a(y)});u.ElementHandleTapResult=a(d({}));u.ElementHandleTextContentParams=a(d({}));u.ElementHandleTextContentResult=d({value:a(p)});u.ElementHandleTypeParams=d({text:p,delay:a(w),timeout:a(w)});u.ElementHandleTypeResult=a(d({}));u.ElementHandleUncheckParams=d({force:a(y),position:a(P("Point")),timeout:a(w),trial:a(y)});u.ElementHandleUncheckResult=a(d({}));u.ElementHandleWaitForElementStateParams=d({state:$(["visible","hidden","stable","enabled","disabled","editable"]),timeout:a(w)});u.ElementHandleWaitForElementStateResult=a(d({}));u.ElementHandleWaitForSelectorParams=d({selector:p,strict:a(y),timeout:a(w),state:a($(["attached","detached","visible","hidden"]))});u.ElementHandleWaitForSelectorResult=d({element:a(T(["ElementHandle"]))});u.RequestInitializer=d({frame:a(T(["Frame"])),serviceWorker:a(T(["Worker"])),url:p,resourceType:p,method:p,postData:a(Z),headers:R(P("NameValue")),isNavigationRequest:y,redirectedFrom:a(T(["Request"]))});u.RequestResponseParams=a(d({}));u.RequestResponseResult=d({response:a(T(["Response"]))});u.RequestRawRequestHeadersParams=a(d({}));u.RequestRawRequestHeadersResult=d({headers:R(P("NameValue"))});u.RouteInitializer=d({request:T(["Request"])});u.RouteRedirectNavigationRequestParams=d({url:p});u.RouteRedirectNavigationRequestResult=a(d({}));u.RouteAbortParams=d({errorCode:a(p),requestUrl:p});u.RouteAbortResult=a(d({}));u.RouteContinueParams=d({url:a(p),method:a(p),headers:a(R(P("NameValue"))),postData:a(Z),requestUrl:p,isFallback:y});u.RouteContinueResult=a(d({}));u.RouteFulfillParams=d({status:a(w),headers:a(R(P("NameValue"))),body:a(p),isBase64:a(y),fetchResponseUid:a(p),requestUrl:p});u.RouteFulfillResult=a(d({}));u.ResourceTiming=d({startTime:w,domainLookupStart:w,domainLookupEnd:w,connectStart:w,secureConnectionStart:w,connectEnd:w,requestStart:w,responseStart:w});u.ResponseInitializer=d({request:T(["Request"]),url:p,status:w,statusText:p,headers:R(P("NameValue")),timing:P("ResourceTiming"),fromServiceWorker:y});u.ResponseBodyParams=a(d({}));u.ResponseBodyResult=d({binary:Z});u.ResponseSecurityDetailsParams=a(d({}));u.ResponseSecurityDetailsResult=d({value:a(P("SecurityDetails"))});u.ResponseServerAddrParams=a(d({}));u.ResponseServerAddrResult=d({value:a(P("RemoteAddr"))});u.ResponseRawResponseHeadersParams=a(d({}));u.ResponseRawResponseHeadersResult=d({headers:R(P("NameValue"))});u.ResponseSizesParams=a(d({}));u.ResponseSizesResult=d({sizes:P("RequestSizes")});u.SecurityDetails=d({issuer:a(p),protocol:a(p),subjectName:a(p),validFrom:a(w),validTo:a(w)});u.RequestSizes=d({requestBodySize:w,requestHeadersSize:w,responseBodySize:w,responseHeadersSize:w});u.RemoteAddr=d({ipAddress:p,port:w});u.WebSocketInitializer=d({url:p});u.WebSocketOpenEvent=a(d({}));u.WebSocketFrameSentEvent=d({opcode:w,data:p});u.WebSocketFrameReceivedEvent=d({opcode:w,data:p});u.WebSocketSocketErrorEvent=d({error:p});u.WebSocketCloseEvent=a(d({}));u.BindingCallInitializer=d({frame:T(["Frame"]),name:p,args:a(R(P("SerializedValue"))),handle:a(T(["ElementHandle","JSHandle"]))});u.BindingCallRejectParams=d({error:P("SerializedError")});u.BindingCallRejectResult=a(d({}));u.BindingCallResolveParams=d({result:P("SerializedArgument")});u.BindingCallResolveResult=a(d({}));u.DialogInitializer=d({page:a(T(["Page"])),type:p,message:p,defaultValue:p});u.DialogAcceptParams=d({promptText:a(p)});u.DialogAcceptResult=a(d({}));u.DialogDismissParams=a(d({}));u.DialogDismissResult=a(d({}));u.TracingInitializer=a(d({}));u.TracingTracingStartParams=d({name:a(p),snapshots:a(y),screenshots:a(y),live:a(y)});u.TracingTracingStartResult=a(d({}));u.TracingTracingStartChunkParams=d({name:a(p),title:a(p)});u.TracingTracingStartChunkResult=d({traceName:p});u.TracingTracingStopChunkParams=d({mode:$(["archive","discard","entries"])});u.TracingTracingStopChunkResult=d({artifact:a(T(["Artifact"])),entries:a(R(P("NameValue")))});u.TracingTracingStopParams=a(d({}));u.TracingTracingStopResult=a(d({}));u.ArtifactInitializer=d({absolutePath:p});u.ArtifactPathAfterFinishedParams=a(d({}));u.ArtifactPathAfterFinishedResult=d({value:p});u.ArtifactSaveAsParams=d({path:p});u.ArtifactSaveAsResult=a(d({}));u.ArtifactSaveAsStreamParams=a(d({}));u.ArtifactSaveAsStreamResult=d({stream:T(["Stream"])});u.ArtifactFailureParams=a(d({}));u.ArtifactFailureResult=d({error:a(p)});u.ArtifactStreamParams=a(d({}));u.ArtifactStreamResult=d({stream:T(["Stream"])});u.ArtifactCancelParams=a(d({}));u.ArtifactCancelResult=a(d({}));u.ArtifactDeleteParams=a(d({}));u.ArtifactDeleteResult=a(d({}));u.StreamInitializer=a(d({}));u.StreamReadParams=d({size:a(w)});u.StreamReadResult=d({binary:Z});u.StreamCloseParams=a(d({}));u.StreamCloseResult=a(d({}));u.WritableStreamInitializer=a(d({}));u.WritableStreamWriteParams=d({binary:Z});u.WritableStreamWriteResult=a(d({}));u.WritableStreamCloseParams=a(d({}));u.WritableStreamCloseResult=a(d({}));u.CDPSessionInitializer=a(d({}));u.CDPSessionEventEvent=d({method:p,params:a(xt)});u.CDPSessionSendParams=d({method:p,params:a(xt)});u.CDPSessionSendResult=d({result:xt});u.CDPSessionDetachParams=a(d({}));u.CDPSessionDetachResult=a(d({}));u.ElectronInitializer=a(d({}));u.ElectronLaunchParams=d({executablePath:a(p),args:a(R(p)),cwd:a(p),env:a(R(P("NameValue"))),timeout:a(w),acceptDownloads:a($(["accept","deny","internal-browser-default"])),bypassCSP:a(y),colorScheme:a($(["dark","light","no-preference","no-override"])),extraHTTPHeaders:a(R(P("NameValue"))),geolocation:a(d({longitude:w,latitude:w,accuracy:a(w)})),httpCredentials:a(d({username:p,password:p,origin:a(p)})),ignoreHTTPSErrors:a(y),locale:a(p),offline:a(y),recordHar:a(P("RecordHarOptions")),recordVideo:a(d({dir:p,size:a(d({width:w,height:w}))})),strictSelectors:a(y),timezoneId:a(p),tracesDir:a(p)});u.ElectronLaunchResult=d({electronApplication:T(["ElectronApplication"])});u.ElectronApplicationInitializer=d({context:T(["BrowserContext"])});u.ElectronApplicationCloseEvent=a(d({}));u.ElectronApplicationConsoleEvent=d({type:p,text:p,args:R(T(["ElementHandle","JSHandle"])),location:d({url:p,lineNumber:w,columnNumber:w})});u.ElectronApplicationBrowserWindowParams=d({page:T(["Page"])});u.ElectronApplicationBrowserWindowResult=d({handle:T(["ElementHandle","JSHandle"])});u.ElectronApplicationEvaluateExpressionParams=d({expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.ElectronApplicationEvaluateExpressionResult=d({value:P("SerializedValue")});u.ElectronApplicationEvaluateExpressionHandleParams=d({expression:p,isFunction:a(y),arg:P("SerializedArgument")});u.ElectronApplicationEvaluateExpressionHandleResult=d({handle:T(["ElementHandle","JSHandle"])});u.ElectronApplicationUpdateSubscriptionParams=d({event:$(["console"]),enabled:y});u.ElectronApplicationUpdateSubscriptionResult=a(d({}));u.AndroidInitializer=a(d({}));u.AndroidDevicesParams=d({host:a(p),port:a(w),omitDriverInstall:a(y)});u.AndroidDevicesResult=d({devices:R(T(["AndroidDevice"]))});u.AndroidSetDefaultTimeoutNoReplyParams=d({timeout:w});u.AndroidSetDefaultTimeoutNoReplyResult=a(d({}));u.AndroidSocketInitializer=a(d({}));u.AndroidSocketDataEvent=d({data:Z});u.AndroidSocketCloseEvent=a(d({}));u.AndroidSocketWriteParams=d({data:Z});u.AndroidSocketWriteResult=a(d({}));u.AndroidSocketCloseParams=a(d({}));u.AndroidSocketCloseResult=a(d({}));u.AndroidDeviceInitializer=d({model:p,serial:p});u.AndroidDeviceCloseEvent=a(d({}));u.AndroidDeviceWebViewAddedEvent=d({webView:P("AndroidWebView")});u.AndroidDeviceWebViewRemovedEvent=d({socketName:p});u.AndroidDeviceWaitParams=d({selector:P("AndroidSelector"),state:a($(["gone"])),timeout:a(w)});u.AndroidDeviceWaitResult=a(d({}));u.AndroidDeviceFillParams=d({selector:P("AndroidSelector"),text:p,timeout:a(w)});u.AndroidDeviceFillResult=a(d({}));u.AndroidDeviceTapParams=d({selector:P("AndroidSelector"),duration:a(w),timeout:a(w)});u.AndroidDeviceTapResult=a(d({}));u.AndroidDeviceDragParams=d({selector:P("AndroidSelector"),dest:P("Point"),speed:a(w),timeout:a(w)});u.AndroidDeviceDragResult=a(d({}));u.AndroidDeviceFlingParams=d({selector:P("AndroidSelector"),direction:$(["up","down","left","right"]),speed:a(w),timeout:a(w)});u.AndroidDeviceFlingResult=a(d({}));u.AndroidDeviceLongTapParams=d({selector:P("AndroidSelector"),timeout:a(w)});u.AndroidDeviceLongTapResult=a(d({}));u.AndroidDevicePinchCloseParams=d({selector:P("AndroidSelector"),percent:w,speed:a(w),timeout:a(w)});u.AndroidDevicePinchCloseResult=a(d({}));u.AndroidDevicePinchOpenParams=d({selector:P("AndroidSelector"),percent:w,speed:a(w),timeout:a(w)});u.AndroidDevicePinchOpenResult=a(d({}));u.AndroidDeviceScrollParams=d({selector:P("AndroidSelector"),direction:$(["up","down","left","right"]),percent:w,speed:a(w),timeout:a(w)});u.AndroidDeviceScrollResult=a(d({}));u.AndroidDeviceSwipeParams=d({selector:P("AndroidSelector"),direction:$(["up","down","left","right"]),percent:w,speed:a(w),timeout:a(w)});u.AndroidDeviceSwipeResult=a(d({}));u.AndroidDeviceInfoParams=d({selector:P("AndroidSelector")});u.AndroidDeviceInfoResult=d({info:P("AndroidElementInfo")});u.AndroidDeviceScreenshotParams=a(d({}));u.AndroidDeviceScreenshotResult=d({binary:Z});u.AndroidDeviceInputTypeParams=d({text:p});u.AndroidDeviceInputTypeResult=a(d({}));u.AndroidDeviceInputPressParams=d({key:p});u.AndroidDeviceInputPressResult=a(d({}));u.AndroidDeviceInputTapParams=d({point:P("Point")});u.AndroidDeviceInputTapResult=a(d({}));u.AndroidDeviceInputSwipeParams=d({segments:R(P("Point")),steps:w});u.AndroidDeviceInputSwipeResult=a(d({}));u.AndroidDeviceInputDragParams=d({from:P("Point"),to:P("Point"),steps:w});u.AndroidDeviceInputDragResult=a(d({}));u.AndroidDeviceLaunchBrowserParams=d({noDefaultViewport:a(y),viewport:a(d({width:w,height:w})),screen:a(d({width:w,height:w})),ignoreHTTPSErrors:a(y),clientCertificates:a(R(d({origin:p,cert:a(Z),key:a(Z),passphrase:a(p),pfx:a(Z)}))),javaScriptEnabled:a(y),bypassCSP:a(y),userAgent:a(p),locale:a(p),timezoneId:a(p),geolocation:a(d({longitude:w,latitude:w,accuracy:a(w)})),permissions:a(R(p)),extraHTTPHeaders:a(R(P("NameValue"))),offline:a(y),httpCredentials:a(d({username:p,password:p,origin:a(p),send:a($(["always","unauthorized"]))})),deviceScaleFactor:a(w),isMobile:a(y),hasTouch:a(y),colorScheme:a($(["dark","light","no-preference","no-override"])),reducedMotion:a($(["reduce","no-preference","no-override"])),forcedColors:a($(["active","none","no-override"])),acceptDownloads:a($(["accept","deny","internal-browser-default"])),baseURL:a(p),recordVideo:a(d({dir:p,size:a(d({width:w,height:w}))})),recordHar:a(P("RecordHarOptions")),strictSelectors:a(y),serviceWorkers:a($(["allow","block"])),pkg:a(p),args:a(R(p)),proxy:a(d({server:p,bypass:a(p),username:a(p),password:a(p)}))});u.AndroidDeviceLaunchBrowserResult=d({context:T(["BrowserContext"])});u.AndroidDeviceOpenParams=d({command:p});u.AndroidDeviceOpenResult=d({socket:T(["AndroidSocket"])});u.AndroidDeviceShellParams=d({command:p});u.AndroidDeviceShellResult=d({result:Z});u.AndroidDeviceInstallApkParams=d({file:Z,args:a(R(p))});u.AndroidDeviceInstallApkResult=a(d({}));u.AndroidDevicePushParams=d({file:Z,path:p,mode:a(w)});u.AndroidDevicePushResult=a(d({}));u.AndroidDeviceSetDefaultTimeoutNoReplyParams=d({timeout:w});u.AndroidDeviceSetDefaultTimeoutNoReplyResult=a(d({}));u.AndroidDeviceConnectToWebViewParams=d({socketName:p});u.AndroidDeviceConnectToWebViewResult=d({context:T(["BrowserContext"])});u.AndroidDeviceCloseParams=a(d({}));u.AndroidDeviceCloseResult=a(d({}));u.AndroidWebView=d({pid:w,pkg:p,socketName:p});u.AndroidSelector=d({checkable:a(y),checked:a(y),clazz:a(p),clickable:a(y),depth:a(w),desc:a(p),enabled:a(y),focusable:a(y),focused:a(y),hasChild:a(d({selector:P("AndroidSelector")})),hasDescendant:a(d({selector:P("AndroidSelector"),maxDepth:a(w)})),longClickable:a(y),pkg:a(p),res:a(p),scrollable:a(y),selected:a(y),text:a(p)});u.AndroidElementInfo=d({children:a(R(P("AndroidElementInfo"))),clazz:p,desc:p,res:p,pkg:p,text:p,bounds:P("Rect"),checkable:y,checked:y,clickable:y,enabled:y,focusable:y,focused:y,longClickable:y,scrollable:y,selected:y});u.JsonPipeInitializer=a(d({}));u.JsonPipeMessageEvent=d({message:xt});u.JsonPipeClosedEvent=d({reason:a(p)});u.JsonPipeSendParams=d({message:xt});u.JsonPipeSendResult=a(d({}));u.JsonPipeCloseParams=a(d({}));u.JsonPipeCloseResult=a(d({}))});function Hn(i,e){return Hc(i,e,new Map)}function Hc(i,e,t){if(i.ref!==void 0)return t.get(i.ref);if(i.n!==void 0)return i.n;if(i.s!==void 0)return i.s;if(i.b!==void 0)return i.b;if(i.v!==void 0){if(i.v==="undefined")return;if(i.v==="null")return null;if(i.v==="NaN")return NaN;if(i.v==="Infinity")return 1/0;if(i.v==="-Infinity")return-1/0;if(i.v==="-0")return-0}if(i.d!==void 0)return new Date(i.d);if(i.u!==void 0)return new URL(i.u);if(i.bi!==void 0)return BigInt(i.bi);if(i.e!==void 0){let n=new Error(i.e.m);return n.name=i.e.n,n.stack=i.e.s,n}if(i.r!==void 0)return new RegExp(i.r.p,i.r.f);if(i.a!==void 0){let n=[];t.set(i.id,n);for(let r of i.a)n.push(Hc(r,e,t));return n}if(i.o!==void 0){let n={};t.set(i.id,n);for(let{k:r,v:s}of i.o)n[r]=Hc(s,e,t);return n}if(i.h!==void 0){if(e===void 0)throw new Error("Unexpected handle");return e[i.h]}throw new Error("Unexpected value")}function Dn(i,e){return Dc(i,e,{lastId:0,visited:new Map})}function Dc(i,e,t){let n=e(i);if("fallThrough"in n)i=n.fallThrough;else return n;if(typeof i=="symbol")return{v:"undefined"};if(Object.is(i,void 0))return{v:"undefined"};if(Object.is(i,null))return{v:"null"};if(Object.is(i,NaN))return{v:"NaN"};if(Object.is(i,1/0))return{v:"Infinity"};if(Object.is(i,-1/0))return{v:"-Infinity"};if(Object.is(i,-0))return{v:"-0"};if(typeof i=="boolean")return{b:i};if(typeof i=="number")return{n:i};if(typeof i=="string")return{s:i};if(typeof i=="bigint")return{bi:i.toString()};if(Jh(i))return{e:{n:i.name,m:i.message,s:i.stack||""}};if(vw(i))return{d:i.toJSON()};if(xw(i))return{u:i.toJSON()};if(_w(i))return{r:{p:i.source,f:i.flags}};let r=t.visited.get(i);if(r)return{ref:r};if(Array.isArray(i)){let s=[],o=++t.lastId;t.visited.set(i,o);for(let l=0;l<i.length;++l)s.push(Dc(i[l],e,t));return{a:s,id:o}}if(typeof i=="object"){let s=[],o=++t.lastId;t.visited.set(i,o);for(let l of Object.keys(i))s.push({k:l,v:Dc(i[l],e,t)});return{o:s,id:o}}throw new Error("Unexpected value")}function _w(i){return i instanceof RegExp||Object.prototype.toString.call(i)==="[object RegExp]"}function vw(i){return i instanceof Date||Object.prototype.toString.call(i)==="[object Date]"}function xw(i){return i instanceof URL||Object.prototype.toString.call(i)==="[object URL]"}function Jh(i){let e=i?Object.getPrototypeOf(i):null;return i instanceof Error||e?.name==="Error"||e&&Jh(e)}var ds=x(()=>{});function Bc(i){return i instanceof pt||i.name==="TargetClosedError"}function Bn(i){return ho(i)?{error:{message:i.message,stack:i.stack,name:i.name}}:{value:Dn(i,e=>({fallThrough:e}))}}function Xh(i){if(!i.error){if(i.value===void 0)throw new Error("Serialized error must have either an error or a value");return Hn(i.value,void 0)}let e=new Error(i.error.message);return e.stack=i.error.stack||"",e.name=i.error.name,e}var Ho,qr,pt,Vt=x(()=>{O();ds();Ho=class extends Error{constructor(e){super(e),this.name=this.constructor.name}},qr=class extends Ho{},pt=class extends Ho{constructor(e,t){super((e||"Target page, context or browser has been closed")+(t||""))}}});import{EventEmitter as Sw}from"events";function Do(){let i=new Map;return new Proxy({},{get:(e,t)=>typeof t!="string"?e[t]:t==="addListener"?(n,r)=>i.set(n,r):t==="removeListener"?n=>i.delete(n):t.startsWith("on")?async(n,...r)=>{for(let[s,o]of i)(!o||n.attribution.context===o)&&await s[t]?.(n,...r)}:e[t]})}function ge(){return{id:"",startTime:0,endTime:0,type:"Internal",method:"",params:{},log:[],isServerSide:!0}}var se,ye=x(()=>{O();se=class extends Sw{guid;attribution;instrumentation;constructor(e,t,n){super(),this.guid=n||`${t||""}@${Y()}`,this.setMaxListeners(0),this.attribution={...e.attribution},this.instrumentation=e.instrumentation}}});function Wr(i){return i instanceof ar}function mt(i){return i instanceof ar&&(i.type==="closed"||i.type==="crashed")}var ar,gn=x(()=>{Lt();ar=class extends Error{type;method;logs;constructor(e,t,n){super(),this.type=e,this.method=t,this.logs=n}setMessage(e){ve(this,`Protocol error (${this.method}): ${e}`)}browserLogMessage(){return this.logs?`
Browser logs:
`+this.logs:""}}});import{EventEmitter as Pw}from"events";function pe(i){return i[$c]}function Ew(i){return kw??{JSHandle:1e5,ElementHandle:1e5}[i]??1e4}function Qh(i){return i.attribution.page?._closeReason||i.attribution.context?._closeReason||i.attribution.browser?._closeReason}var $c,Cw,kw,K,lr,wn,_e=x(()=>{cs();O();Vt();ye();It();gn();$c=Symbol("dispatcher"),Cw=Mc();K=class extends Pw{_connection;_parent;_dispatchers=new Map;_disposed=!1;_eventListeners=[];_guid;_type;_gcBucket;_object;_openScope=new Re;constructor(e,t,n,r,s){super(),this._connection=e instanceof wn?e:e._connection,this._parent=e instanceof wn?void 0:e;let o=t.guid;this._guid=o,this._type=n,this._object=t,this._gcBucket=s??n,t[$c]=this,this._connection.registerDispatcher(this),this._parent&&(E(!this._parent._dispatchers.has(o)),this._parent._dispatchers.set(o,this)),this._parent&&this._connection.sendCreate(this._parent,n,o,r),this._connection.maybeDisposeStaleDispatchers(this._gcBucket)}parentScope(){return this._parent}addObjectListener(e,t){this._eventListeners.push(L.addEventListener(this._object,e,t))}adopt(e){if(e._parent===this)return;e._parent._dispatchers.delete(e._guid),this._dispatchers.set(e._guid,e),e._parent=this,this._connection.sendAdopt(this,e)}async _handleCommand(e,t,n){let r=this[t](n,e);try{return await this._openScope.race(r)}catch(s){if(e.potentiallyClosesScope&&Bc(s))return await r;throw s}}_dispatchEvent(e,t){if(this._disposed){if(ce())throw new Error(`${this._guid} is sending "${String(e)}" event after being disposed`);return}this._connection.sendEvent(this,e,t)}_dispose(e){this._disposeRecursively(new pt),this._connection.sendDispose(this,e)}_onDispose(){}_disposeRecursively(e){E(!this._disposed,`${this._guid} is disposed more than once`),this._onDispose(),this._disposed=!0,L.removeEventListeners(this._eventListeners),this._parent?._dispatchers.delete(this._guid),this._connection._dispatchersByBucket.get(this._gcBucket)?.delete(this._guid),this._connection._dispatchers.delete(this._guid);for(let n of[...this._dispatchers.values()])n._disposeRecursively(e);this._dispatchers.clear(),delete this._object[$c],this._openScope.close(e)}_debugScopeState(){return{_guid:this._guid,objects:Array.from(this._dispatchers.values()).map(e=>e._debugScopeState())}}async waitForEventInfo(){}},lr=class extends K{constructor(t,n){super(t,{guid:""},"Root",{});this.createPlaywright=n}_initialized=!1;async initialize(t){return E(this.createPlaywright),E(!this._initialized),this._initialized=!0,{playwright:await this.createPlaywright(this,t)}}},wn=class{_dispatchers=new Map;_dispatchersByBucket=new Map;onmessage=e=>{};_waitOperations=new Map;_isLocal;constructor(e){this._isLocal=!!e}sendEvent(e,t,n){n=ht(e._type,t,"Event")(n,"",{tChannelImpl:this._tChannelImplToWire.bind(this),binary:this._isLocal?"buffer":"toBase64"}),this.onmessage({guid:e._guid,method:t,params:n})}sendCreate(e,t,n,r){r=ht(t,"","Initializer")(r,"",{tChannelImpl:this._tChannelImplToWire.bind(this),binary:this._isLocal?"buffer":"toBase64"}),this.onmessage({guid:e._guid,method:"__create__",params:{type:t,initializer:r,guid:n}})}sendAdopt(e,t){this.onmessage({guid:e._guid,method:"__adopt__",params:{guid:t._guid}})}sendDispose(e,t){this.onmessage({guid:e._guid,method:"__dispose__",params:{reason:t}})}_tChannelImplFromWire(e,t,n,r){if(t&&typeof t=="object"&&typeof t.guid=="string"){let s=t.guid,o=this._dispatchers.get(s);if(!o)throw new he(`${n}: no object with guid ${s}`);if(e!=="*"&&!e.includes(o._type))throw new he(`${n}: object with guid ${s} has type ${o._type}, expected ${e.toString()}`);return o}throw new he(`${n}: expected guid for ${e.toString()}`)}_tChannelImplToWire(e,t,n,r){if(t instanceof K){if(e!=="*"&&!e.includes(t._type))throw new he(`${n}: dispatcher with guid ${t._guid} has type ${t._type}, expected ${e.toString()}`);return{guid:t._guid}}throw new he(`${n}: expected dispatcher ${e.toString()}`)}registerDispatcher(e){E(!this._dispatchers.has(e._guid)),this._dispatchers.set(e._guid,e);let t=this._dispatchersByBucket.get(e._gcBucket);t||(t=new Set,this._dispatchersByBucket.set(e._gcBucket,t)),t.add(e._guid)}maybeDisposeStaleDispatchers(e){let t=Ew(e),n=this._dispatchersByBucket.get(e);if(!n||n.size<=t)return;let r=[...n],s=t/10|0;this._dispatchersByBucket.set(e,new Set(r.slice(s)));for(let o=0;o<s;++o){let l=this._dispatchers.get(r[o]);l&&l._dispose("gc")}}async dispatch(e){let{id:t,guid:n,method:r,params:s,metadata:o}=e,l=this._dispatchers.get(n);if(!l){this.onmessage({id:t,error:Bn(new pt)});return}let c,h;try{if(c=ht(l._type,r,"Params")(s,"",{tChannelImpl:this._tChannelImplFromWire.bind(this),binary:this._isLocal?"buffer":"fromBase64"}),h=Cw(o,"",{tChannelImpl:this._tChannelImplFromWire.bind(this),binary:this._isLocal?"buffer":"fromBase64"}),typeof l[r]!="function")throw new Error(`Mismatching dispatcher: "${l._type}" does not implement "${r}"`)}catch(b){this.onmessage({id:t,error:Bn(b)});return}let m=l._object instanceof se?l._object:void 0,f={id:`call@${t}`,location:h.location,apiName:h.apiName,internal:h.internal,stepId:h.stepId,objectId:m?.guid,pageId:m?.attribution?.page?.guid,frameId:m?.attribution?.frame?.guid,startTime:X(),endTime:0,type:l._type,method:r,params:s||{},log:[]};if(m&&s?.info?.waitId){let b=s.info;switch(b.phase){case"before":{this._waitOperations.set(b.waitId,f),await m.instrumentation.onBeforeCall(m,f),this.onmessage({id:t});return}case"log":{let v=this._waitOperations.get(b.waitId);v.log.push(b.message),m.instrumentation.onCallLog(m,v,"api",b.message),this.onmessage({id:t});return}case"after":{let v=this._waitOperations.get(b.waitId);v.endTime=X(),v.error=b.error?{error:{name:"Error",message:b.error}}:void 0,this._waitOperations.delete(b.waitId),await m.instrumentation.onAfterCall(m,v),this.onmessage({id:t});return}}}await m?.instrumentation.onBeforeCall(m,f);let g={id:t};try{let b=await l._handleCommand(f,r,c),v=ht(l._type,r,"Result");g.result=v(b,"",{tChannelImpl:this._tChannelImplToWire.bind(this),binary:this._isLocal?"buffer":"toBase64"}),f.result=b}catch(b){if(Bc(b)&&m){let v=Qh(m);v&&ve(b,v)}else if(Wr(b))if(b.type==="closed"){let v=m?Qh(m):void 0;b=new pt(v,b.browserLogMessage())}else b.type==="crashed"&&ve(b,"Target crashed "+b.browserLogMessage());g.error=Bn(b),f.error=g.error}finally{f.endTime=X(),await m?.instrumentation.onAfterCall(m,f)}g.error&&(g.log=f.log),this.onmessage(g)}}});var us,Tw,Le,bn=x(()=>{O();us=3e4,Tw=3*60*1e3,Le=class{_parent;_defaultTimeout;_defaultNavigationTimeout;constructor(e){this._parent=e}setDefaultTimeout(e){this._defaultTimeout=e}setDefaultNavigationTimeout(e){this._defaultNavigationTimeout=e}defaultNavigationTimeout(){return this._defaultNavigationTimeout}defaultTimeout(){return this._defaultTimeout}navigationTimeout(e){return typeof e.timeout=="number"?e.timeout:this._defaultNavigationTimeout!==void 0?this._defaultNavigationTimeout:it()?0:this._defaultTimeout!==void 0?this._defaultTimeout:this._parent?this._parent.navigationTimeout(e):us}timeout(e){return typeof e.timeout=="number"?e.timeout:it()?0:this._defaultTimeout!==void 0?this._defaultTimeout:this._parent?this._parent.timeout(e):us}static timeout(e){return typeof e.timeout=="number"?e.timeout:it()?0:us}static launchTimeout(e){return typeof e.timeout=="number"?e.timeout:it()?0:Tw}}});var jc,qc,le,Ot=x(()=>{Te();It();jc=process.env.MAX_LOG_LENGTH?+process.env.MAX_LOG_LENGTH:1/0,qc=class{static completeUserURL(e){return(e.startsWith("localhost")||e.startsWith("127.0.0.1"))&&(e="http://"+e),e}static enclosingIntRect(e){let t=Math.floor(e.x+.001),n=Math.floor(e.y+.001),r=Math.ceil(e.x+e.width-.001),s=Math.ceil(e.y+e.height-.001);return{x:t,y:n,width:r-t,height:s-n}}static enclosingIntSize(e){return{width:Math.floor(e.width+.001),height:Math.floor(e.height+.001)}}static getViewportSizeFromWindowFeatures(e){let t=e.find(o=>o.startsWith("width=")),n=e.find(o=>o.startsWith("height=")),r=t?parseInt(t.substring(6),10):NaN,s=n?parseInt(n.substring(7),10):NaN;return!Number.isNaN(r)&&!Number.isNaN(s)?{width:r,height:s}:null}static waitForEvent(e,t,n,r){let s=[],o=new Promise((c,h)=>{s.push(L.addEventListener(t,n,m=>{try{if(r&&!r(m))return;L.removeEventListeners(s),c(m)}catch(f){L.removeEventListeners(s),h(f)}}))}),l=()=>L.removeEventListeners(s);return e&&e.cleanupWhenAborted(l),{promise:o,dispose:l}}static secondsToRoundishMillis(e){return(e*1e6|0)/1e3}static millisToRoundishMillis(e){return(e*1e3|0)/1e3}static debugProtocolLogger(e){return(t,n)=>{if(e&&e(t,n),N.isEnabled("protocol")){let r=JSON.stringify(n);r.length>jc&&(r=r.substring(0,jc/2)+" <<<<<( LOG TRUNCATED )>>>>> "+r.substring(r.length-jc/2)),N.log("protocol",(t==="send"?"SEND \u25BA ":"\u25C0 RECV ")+r)}}}static formatBrowserLogs(e,t){return!t&&!e.length?"":`
`+(t?t+`
`:"")+e.join(`
`)}},le=qc});function Yh(i,e){let t=e.map(n=>new URL(n));return i.filter(n=>{if(!t.length)return!0;for(let r of t){let s=n.domain;if(s.startsWith(".")||(s="."+s),!!("."+r.hostname).endsWith(s)&&r.pathname.startsWith(n.path)&&!(r.protocol!=="https:"&&r.hostname!=="localhost"&&n.secure))return!0}return!1})}function Zh(i){return i.map(e=>{E(e.url||e.domain&&e.path,"Cookie should have a url or a domain/path pair"),E(!(e.url&&e.domain),"Cookie should have either url or domain"),E(!(e.url&&e.path),"Cookie should have either url or path"),E(!(e.expires&&e.expires<0&&e.expires!==-1),"Cookie should have a valid expires, only -1 or a positive number for the unix timestamp in seconds is allowed"),E(!(e.expires&&e.expires>0&&e.expires>jo),"Cookie should have a valid expires, only -1 or a positive number for the unix timestamp in seconds is allowed");let t={...e};if(t.url){E(t.url!=="about:blank",`Blank page can not have cookie "${e.name}"`),E(!t.url.startsWith("data:"),`Data URL page can not have cookie "${e.name}"`);let n=new URL(t.url);t.domain=n.hostname,t.path=n.pathname.substring(0,n.pathname.lastIndexOf("/")+1),t.secure=n.protocol==="https:"}return t})}function qo(i){try{return new URL(i)}catch{return null}}function Rw(i){return i.includes("#")?i.substring(0,i.indexOf("#")):i}function Wc(i){return Aw[String(i)]||"Unknown"}function ep(i,e){return[{name:i,value:e}]}function Wo(i){let e=new Map,t=new Map;for(let r of i)if(r)for(let{name:s,value:o}of r){let l=s.toLowerCase();t.set(l,s),e.set(l,o)}let n=[];for(let[r,s]of e)n.push({name:t.get(r),value:s});return n}var jo,Bo,zr,$o,yn,Aw,Gt=x(()=>{O();qe();ye();hs();Oe();jo=253402300799;Bo=class extends se{_response=null;_redirectedFrom;_redirectedTo=null;_documentId;_isFavicon;_failureText=null;_url;_resourceType;_method;_postData;_headers;_headersMap=new Map;_frame=null;_serviceWorker=null;_context;_rawRequestHeadersPromise=new U;_waitForResponsePromise=new U;_responseEndTiming=-1;_overrides;_bodySize;constructor(e,t,n,r,s,o,l,c,h,m){super(t||e,"request"),E(!o.startsWith("data:"),"Data urls should not fire requests"),this._context=e,this._frame=t,this._serviceWorker=n,this._redirectedFrom=r,r&&(r._redirectedTo=this),this._documentId=s,this._url=Rw(o),this._resourceType=l,this._method=c,this._postData=h,this._headers=m,this._updateHeadersMap(),this._isFavicon=o.endsWith("/favicon.ico")||!!r?._isFavicon}_setFailureText(e){this._failureText=e,this._waitForResponsePromise.resolve(null)}_setOverrides(e){this._overrides=e,this._updateHeadersMap()}_updateHeadersMap(){for(let{name:e,value:t}of this.headers())this._headersMap.set(e.toLowerCase(),t)}_hasOverrides(){return!!this._overrides}url(){return this._overrides?.url||this._url}resourceType(){return this._resourceType}method(){return this._overrides?.method||this._method}postDataBuffer(){return this._overrides?.postData||this._postData}headers(){return this._overrides?.headers||this._headers}headerValue(e){return this._headersMap.get(e)}setRawRequestHeaders(e){this._rawRequestHeadersPromise.isDone()||this._rawRequestHeadersPromise.resolve(e||this._headers)}async rawRequestHeaders(){return this._overrides?.headers||this._rawRequestHeadersPromise}response(){return this._waitForResponsePromise}_existingResponse(){return this._response}_setResponse(e){this._response=e,this._waitForResponsePromise.resolve(e)}_finalRequest(){return this._redirectedTo?this._redirectedTo._finalRequest():this}frame(){return this._frame}serviceWorker(){return this._serviceWorker}isNavigationRequest(){return!!this._documentId}redirectedFrom(){return this._redirectedFrom}failure(){return this._failureText===null?null:{errorText:this._failureText}}_setBodySize(e){this._bodySize=e}bodySize(){return this._bodySize||this.postDataBuffer()?.length||0}async requestHeadersSize(){let e=4;e+=this.method().length,e+=new URL(this.url()).pathname.length,e+=8;let t=await this.rawRequestHeaders();for(let n of t)e+=n.name.length+n.value.length+4;return e}},zr=class extends se{_request;_delegate;_handled=!1;constructor(e,t){super(e._frame||e._context,"route"),this._request=e,this._delegate=t,this._request._context.addRouteInFlight(this)}request(){return this._request}async abort(e="failed"){this._startHandling(),this._request._context.emit(j.Events.RequestAborted,this._request),await this._delegate.abort(e),this._endHandling()}async redirectNavigationRequest(e){this._startHandling(),E(this._request.isNavigationRequest()),this._request.frame().redirectNavigation(e,this._request._documentId,this._request.headerValue("referer"))}async fulfill(e){this._startHandling();let t=e.body,n=e.isBase64||!1;if(t===void 0)if(e.fetchResponseUid){let s=this._request._context.fetchRequest.fetchResponses.get(e.fetchResponseUid)||Mt.findResponseBody(e.fetchResponseUid);E(s,"Fetch response has been disposed"),t=s.toString("base64"),n=!0}else t="",n=!1;let r=[...e.headers||[]];this._maybeAddCorsHeaders(r),this._request._context.emit(j.Events.RequestFulfilled,this._request),await this._delegate.fulfill({status:e.status||200,headers:r,body:t,isBase64:n}),this._endHandling()}_maybeAddCorsHeaders(e){let t=this._request.headerValue("origin");if(!t)return;let n=new URL(this._request.url());!n.protocol.startsWith("http")||n.origin===t.trim()||e.find(({name:s})=>s==="access-control-allow-origin")||(e.push({name:"access-control-allow-origin",value:t}),e.push({name:"access-control-allow-credentials",value:"true"}),e.push({name:"vary",value:"Origin"}))}async continue(e){if(this._startHandling(),e.url){let t=new URL(e.url);if(new URL(this._request.url()).protocol!==t.protocol)throw new Error("New URL must have same protocol as overridden URL")}this._request._setOverrides(e),e.isFallback||this._request._context.emit(j.Events.RequestContinued,this._request),await this._delegate.continue(e),this._endHandling()}_startHandling(){E(!this._handled,"Route is already handled!"),this._handled=!0}_endHandling(){this._request._context.removeRouteInFlight(this)}},$o=class extends se{_request;_contentPromise=null;_finishedPromise=new U;_status;_statusText;_url;_headers;_headersMap=new Map;_getResponseBodyCallback;_timing;_serverAddrPromise=new U;_securityDetailsPromise=new U;_rawResponseHeadersPromise=new U;_httpVersion;_fromServiceWorker;_encodedBodySizePromise=new U;_transferSizePromise=new U;_responseHeadersSizePromise=new U;constructor(e,t,n,r,s,o,l,c){super(e.frame()||e._context,"response"),this._request=e,this._timing=s,this._status=t,this._statusText=n,this._url=e.url(),this._headers=r;for(let{name:h,value:m}of this._headers)this._headersMap.set(h.toLowerCase(),m);this._getResponseBodyCallback=o,this._request._setResponse(this),this._httpVersion=c,this._fromServiceWorker=l}_serverAddrFinished(e){this._serverAddrPromise.resolve(e)}_securityDetailsFinished(e){this._securityDetailsPromise.resolve(e)}_requestFinished(e){this._request._responseEndTiming=Math.max(e,this._timing.responseStart),this._timing.requestStart===-1&&(this._timing.requestStart=this._request._responseEndTiming),this._finishedPromise.resolve()}_setHttpVersion(e){this._httpVersion=e}url(){return this._url}status(){return this._status}statusText(){return this._statusText}headers(){return this._headers}headerValue(e){return this._headersMap.get(e)}async rawResponseHeaders(){return this._rawResponseHeadersPromise}setRawResponseHeaders(e){this._rawResponseHeadersPromise.isDone()||this._rawResponseHeadersPromise.resolve(e||this._headers)}setTransferSize(e){this._transferSizePromise.resolve(e)}setEncodedBodySize(e){this._encodedBodySizePromise.resolve(e)}setResponseHeadersSize(e){this._responseHeadersSizePromise.resolve(e)}timing(){return this._timing}async serverAddr(){return await this._serverAddrPromise||null}async securityDetails(){return await this._securityDetailsPromise||null}body(){return this._contentPromise||(this._contentPromise=this._finishedPromise.then(async()=>{if(this._status>=300&&this._status<=399)throw new Error("Response body is unavailable for redirect responses");return this._getResponseBodyCallback()})),this._contentPromise}request(){return this._request}frame(){return this._request.frame()}httpVersion(){return!this._httpVersion||this._httpVersion==="http/1.1"?"HTTP/1.1":this._httpVersion==="h2"?"HTTP/2.0":this._httpVersion}fromServiceWorker(){return this._fromServiceWorker}async responseHeadersSize(){let e=await this._responseHeadersSizePromise;if(e!==null)return e;let t=4;t+=8,t+=3,t+=this.statusText().length;let n=await this._rawResponseHeadersPromise;for(let r of n)t+=r.name.length+r.value.length+4;return t+=2,t}async sizes(){let e=await this._request.requestHeadersSize(),t=await this.responseHeadersSize(),n=await this._encodedBodySizePromise;if(n===null){let o=(await this._rawResponseHeadersPromise).find(l=>l.name.toLowerCase()==="content-length")?.value;n=o?+o:0}let r=await this._transferSizePromise;return r===null&&(r=t+n),{requestBodySize:this._request.bodySize(),requestHeadersSize:e,responseBodySize:n,responseHeadersSize:t,transferSize:r}}},yn=class i extends se{_url;_notified=!1;static Events={Close:"close",SocketError:"socketerror",FrameReceived:"framereceived",FrameSent:"framesent"};constructor(e,t){super(e,"ws"),this._url=t}markAsNotified(){return this._notified?!1:(this._notified=!0,!0)}url(){return this._url}frameSent(e,t){this.emit(i.Events.FrameSent,{opcode:e,data:t})}frameReceived(e,t){this.emit(i.Events.FrameReceived,{opcode:e,data:t})}error(e){this.emit(i.Events.SocketError,e)}closed(){this.emit(i.Events.Close)}},Aw={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"}});var tp,np=x(()=>{tp=`
var __commonJS = obj => {
  let required = false;
  let result;
  return function __require() {
    if (!required) {
      required = true;
      let fn;
      for (const name in obj) { fn = obj[name]; break; }
      const module = { exports: {} };
      fn(module.exports, module);
      result = module.exports;
    }
    return result;
  }
};
var __export = (target, all) => {for (var name in all) target[name] = all[name];};
var __toESM = mod => ({ ...mod, 'default': mod });
var __toCommonJS = mod => ({ ...mod, __esModule: true });


// packages/playwright-core/src/server/injected/injectedScript.ts
var injectedScript_exports = {};
__export(injectedScript_exports, {
  InjectedScript: () => InjectedScript
});
module.exports = __toCommonJS(injectedScript_exports);

// packages/playwright-core/src/server/injected/xpathSelectorEngine.ts
var XPathEngine = {
  queryAll(root, selector) {
    if (selector.startsWith("/") && root.nodeType !== Node.DOCUMENT_NODE)
      selector = "." + selector;
    const result = [];
    const document = root.ownerDocument || root;
    if (!document)
      return result;
    const it = document.evaluate(selector, root, null, XPathResult.ORDERED_NODE_ITERATOR_TYPE);
    for (let node = it.iterateNext(); node; node = it.iterateNext()) {
      if (node.nodeType === Node.ELEMENT_NODE)
        result.push(node);
    }
    return result;
  }
};

// packages/playwright-core/src/server/injected/domUtils.ts
var browserNameForWorkarounds = "";
function setBrowserName(name) {
  browserNameForWorkarounds = name;
}
function isInsideScope(scope, element) {
  while (element) {
    if (scope.contains(element))
      return true;
    element = enclosingShadowHost(element);
  }
  return false;
}
function parentElementOrShadowHost(element) {
  if (element.parentElement)
    return element.parentElement;
  if (!element.parentNode)
    return;
  if (element.parentNode.nodeType === 11 && element.parentNode.host)
    return element.parentNode.host;
}
function enclosingShadowRootOrDocument(element) {
  let node = element;
  while (node.parentNode)
    node = node.parentNode;
  if (node.nodeType === 11 || node.nodeType === 9)
    return node;
}
function enclosingShadowHost(element) {
  while (element.parentElement)
    element = element.parentElement;
  return parentElementOrShadowHost(element);
}
function closestCrossShadow(element, css, scope) {
  while (element) {
    const closest = element.closest(css);
    if (scope && closest !== scope && (closest == null ? void 0 : closest.contains(scope)))
      return;
    if (closest)
      return closest;
    element = enclosingShadowHost(element);
  }
}
function getElementComputedStyle(element, pseudo) {
  return element.ownerDocument && element.ownerDocument.defaultView ? element.ownerDocument.defaultView.getComputedStyle(element, pseudo) : void 0;
}
function isElementStyleVisibilityVisible(element, style) {
  style = style != null ? style : getElementComputedStyle(element);
  if (!style)
    return true;
  if (Element.prototype.checkVisibility && browserNameForWorkarounds !== "webkit") {
    if (!element.checkVisibility())
      return false;
  } else {
    const detailsOrSummary = element.closest("details,summary");
    if (detailsOrSummary !== element && (detailsOrSummary == null ? void 0 : detailsOrSummary.nodeName) === "DETAILS" && !detailsOrSummary.open)
      return false;
  }
  if (style.visibility !== "visible")
    return false;
  return true;
}
function isElementVisible(element) {
  const style = getElementComputedStyle(element);
  if (!style)
    return true;
  if (style.display === "contents") {
    for (let child = element.firstChild; child; child = child.nextSibling) {
      if (child.nodeType === 1 && isElementVisible(child))
        return true;
      if (child.nodeType === 3 && isVisibleTextNode(child))
        return true;
    }
    return false;
  }
  if (!isElementStyleVisibilityVisible(element, style))
    return false;
  const rect = element.getBoundingClientRect();
  return rect.width > 0 && rect.height > 0;
}
function isVisibleTextNode(node) {
  const range = node.ownerDocument.createRange();
  range.selectNode(node);
  const rect = range.getBoundingClientRect();
  return rect.width > 0 && rect.height > 0;
}
function elementSafeTagName(element) {
  if (element instanceof HTMLFormElement)
    return "FORM";
  return element.tagName.toUpperCase();
}

// packages/playwright-core/src/utils/isomorphic/stringUtils.ts
function escapeWithQuotes(text, char = "'") {
  const stringified = JSON.stringify(text);
  const escapedText = stringified.substring(1, stringified.length - 1).replace(/\\\\"/g, '"');
  if (char === "'")
    return char + escapedText.replace(/[']/g, "\\\\'") + char;
  if (char === '"')
    return char + escapedText.replace(/["]/g, '\\\\"') + char;
  if (char === "\`")
    return char + escapedText.replace(/[\`]/g, "\`") + char;
  throw new Error("Invalid escape char");
}
function toTitleCase(name) {
  return name.charAt(0).toUpperCase() + name.substring(1);
}
function toSnakeCase(name) {
  return name.replace(/([a-z0-9])([A-Z])/g, "$1_$2").replace(/([A-Z])([A-Z][a-z])/g, "$1_$2").toLowerCase();
}
function cssEscape(s) {
  let result = "";
  for (let i = 0; i < s.length; i++)
    result += cssEscapeOne(s, i);
  return result;
}
function quoteCSSAttributeValue(text) {
  return \`"\${cssEscape(text).replace(/\\\\ /g, " ")}"\`;
}
function cssEscapeOne(s, i) {
  const c = s.charCodeAt(i);
  if (c === 0)
    return "\\uFFFD";
  if (c >= 1 && c <= 31 || c >= 48 && c <= 57 && (i === 0 || i === 1 && s.charCodeAt(0) === 45))
    return "\\\\" + c.toString(16) + " ";
  if (i === 0 && c === 45 && s.length === 1)
    return "\\\\" + s.charAt(i);
  if (c >= 128 || c === 45 || c === 95 || c >= 48 && c <= 57 || c >= 65 && c <= 90 || c >= 97 && c <= 122)
    return s.charAt(i);
  return "\\\\" + s.charAt(i);
}
var normalizedWhitespaceCache;
function cacheNormalizedWhitespaces() {
  normalizedWhitespaceCache = /* @__PURE__ */ new Map();
}
function normalizeWhiteSpace(text) {
  let result = normalizedWhitespaceCache == null ? void 0 : normalizedWhitespaceCache.get(text);
  if (result === void 0) {
    result = text.replace(/\\u200b/g, "").trim().replace(/\\s+/g, " ");
    normalizedWhitespaceCache == null ? void 0 : normalizedWhitespaceCache.set(text, result);
  }
  return result;
}
function normalizeEscapedRegexQuotes(source) {
  return source.replace(/(^|[^\\\\])(\\\\\\\\)*\\\\(['"\`])/g, "$1$2$3");
}
function escapeRegexForSelector(re) {
  if (re.unicode || re.unicodeSets)
    return String(re);
  return String(re).replace(/(^|[^\\\\])(\\\\\\\\)*(["'\`])/g, "$1$2\\\\$3").replace(/>>/g, "\\\\>\\\\>");
}
function escapeForTextSelector(text, exact) {
  if (typeof text !== "string")
    return escapeRegexForSelector(text);
  return \`\${JSON.stringify(text)}\${exact ? "s" : "i"}\`;
}
function escapeForAttributeSelector(value, exact) {
  if (typeof value !== "string")
    return escapeRegexForSelector(value);
  return \`"\${value.replace(/\\\\/g, "\\\\\\\\").replace(/["]/g, '\\\\"')}"\${exact ? "s" : "i"}\`;
}
function trimString(input, cap, suffix = "") {
  if (input.length <= cap)
    return input;
  const chars = [...input];
  if (chars.length > cap)
    return chars.slice(0, cap - suffix.length).join("") + suffix;
  return chars.join("");
}
function trimStringWithEllipsis(input, cap) {
  return trimString(input, cap, "\\u2026");
}
function escapeRegExp(s) {
  return s.replace(/[.*+?^\${}()|[\\]\\\\]/g, "\\\\$&");
}
var escaped = { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" };
function escapeHTMLAttribute(s) {
  return s.replace(/[&<>"']/ug, (char) => escaped[char]);
}
function escapeHTML(s) {
  return s.replace(/[&<]/ug, (char) => escaped[char]);
}

// packages/playwright-core/src/server/injected/roleUtils.ts
function hasExplicitAccessibleName(e) {
  return e.hasAttribute("aria-label") || e.hasAttribute("aria-labelledby");
}
var kAncestorPreventingLandmark = "article:not([role]), aside:not([role]), main:not([role]), nav:not([role]), section:not([role]), [role=article], [role=complementary], [role=main], [role=navigation], [role=region]";
var kGlobalAriaAttributes = /* @__PURE__ */ new Map([
  ["aria-atomic", void 0],
  ["aria-busy", void 0],
  ["aria-controls", void 0],
  ["aria-current", void 0],
  ["aria-describedby", void 0],
  ["aria-details", void 0],
  // Global use deprecated in ARIA 1.2
  // ['aria-disabled', undefined],
  ["aria-dropeffect", void 0],
  // Global use deprecated in ARIA 1.2
  // ['aria-errormessage', undefined],
  ["aria-flowto", void 0],
  ["aria-grabbed", void 0],
  // Global use deprecated in ARIA 1.2
  // ['aria-haspopup', undefined],
  ["aria-hidden", void 0],
  // Global use deprecated in ARIA 1.2
  // ['aria-invalid', undefined],
  ["aria-keyshortcuts", void 0],
  ["aria-label", /* @__PURE__ */ new Set(["caption", "code", "deletion", "emphasis", "generic", "insertion", "paragraph", "presentation", "strong", "subscript", "superscript"])],
  ["aria-labelledby", /* @__PURE__ */ new Set(["caption", "code", "deletion", "emphasis", "generic", "insertion", "paragraph", "presentation", "strong", "subscript", "superscript"])],
  ["aria-live", void 0],
  ["aria-owns", void 0],
  ["aria-relevant", void 0],
  ["aria-roledescription", /* @__PURE__ */ new Set(["generic"])]
]);
function hasGlobalAriaAttribute(element, forRole) {
  return [...kGlobalAriaAttributes].some(([attr, prohibited]) => {
    return !(prohibited == null ? void 0 : prohibited.has(forRole || "")) && element.hasAttribute(attr);
  });
}
function hasTabIndex(element) {
  return !Number.isNaN(Number(String(element.getAttribute("tabindex"))));
}
function isFocusable(element) {
  return !isNativelyDisabled(element) && (isNativelyFocusable(element) || hasTabIndex(element));
}
function isNativelyFocusable(element) {
  const tagName = elementSafeTagName(element);
  if (["BUTTON", "DETAILS", "SELECT", "TEXTAREA"].includes(tagName))
    return true;
  if (tagName === "A" || tagName === "AREA")
    return element.hasAttribute("href");
  if (tagName === "INPUT")
    return !element.hidden;
  return false;
}
var kImplicitRoleByTagName = {
  "A": (e) => {
    return e.hasAttribute("href") ? "link" : null;
  },
  "AREA": (e) => {
    return e.hasAttribute("href") ? "link" : null;
  },
  "ARTICLE": () => "article",
  "ASIDE": () => "complementary",
  "BLOCKQUOTE": () => "blockquote",
  "BUTTON": () => "button",
  "CAPTION": () => "caption",
  "CODE": () => "code",
  "DATALIST": () => "listbox",
  "DD": () => "definition",
  "DEL": () => "deletion",
  "DETAILS": () => "group",
  "DFN": () => "term",
  "DIALOG": () => "dialog",
  "DT": () => "term",
  "EM": () => "emphasis",
  "FIELDSET": () => "group",
  "FIGURE": () => "figure",
  "FOOTER": (e) => closestCrossShadow(e, kAncestorPreventingLandmark) ? null : "contentinfo",
  "FORM": (e) => hasExplicitAccessibleName(e) ? "form" : null,
  "H1": () => "heading",
  "H2": () => "heading",
  "H3": () => "heading",
  "H4": () => "heading",
  "H5": () => "heading",
  "H6": () => "heading",
  "HEADER": (e) => closestCrossShadow(e, kAncestorPreventingLandmark) ? null : "banner",
  "HR": () => "separator",
  "HTML": () => "document",
  "IMG": (e) => e.getAttribute("alt") === "" && !e.getAttribute("title") && !hasGlobalAriaAttribute(e) && !hasTabIndex(e) ? "presentation" : "img",
  "INPUT": (e) => {
    const type = e.type.toLowerCase();
    if (type === "search")
      return e.hasAttribute("list") ? "combobox" : "searchbox";
    if (["email", "tel", "text", "url", ""].includes(type)) {
      const list = getIdRefs(e, e.getAttribute("list"))[0];
      return list && elementSafeTagName(list) === "DATALIST" ? "combobox" : "textbox";
    }
    if (type === "hidden")
      return "";
    return {
      "button": "button",
      "checkbox": "checkbox",
      "image": "button",
      "number": "spinbutton",
      "radio": "radio",
      "range": "slider",
      "reset": "button",
      "submit": "button"
    }[type] || "textbox";
  },
  "INS": () => "insertion",
  "LI": () => "listitem",
  "MAIN": () => "main",
  "MARK": () => "mark",
  "MATH": () => "math",
  "MENU": () => "list",
  "METER": () => "meter",
  "NAV": () => "navigation",
  "OL": () => "list",
  "OPTGROUP": () => "group",
  "OPTION": () => "option",
  "OUTPUT": () => "status",
  "P": () => "paragraph",
  "PROGRESS": () => "progressbar",
  "SECTION": (e) => hasExplicitAccessibleName(e) ? "region" : null,
  "SELECT": (e) => e.hasAttribute("multiple") || e.size > 1 ? "listbox" : "combobox",
  "STRONG": () => "strong",
  "SUB": () => "subscript",
  "SUP": () => "superscript",
  // For <svg> we default to Chrome behavior:
  // - Chrome reports 'img'.
  // - Firefox reports 'diagram' that is not in official ARIA spec yet.
  // - Safari reports 'no role', but still computes accessible name.
  "SVG": () => "img",
  "TABLE": () => "table",
  "TBODY": () => "rowgroup",
  "TD": (e) => {
    const table = closestCrossShadow(e, "table");
    const role = table ? getExplicitAriaRole(table) : "";
    return role === "grid" || role === "treegrid" ? "gridcell" : "cell";
  },
  "TEXTAREA": () => "textbox",
  "TFOOT": () => "rowgroup",
  "TH": (e) => {
    if (e.getAttribute("scope") === "col")
      return "columnheader";
    if (e.getAttribute("scope") === "row")
      return "rowheader";
    const table = closestCrossShadow(e, "table");
    const role = table ? getExplicitAriaRole(table) : "";
    return role === "grid" || role === "treegrid" ? "gridcell" : "cell";
  },
  "THEAD": () => "rowgroup",
  "TIME": () => "time",
  "TR": () => "row",
  "UL": () => "list"
};
var kPresentationInheritanceParents = {
  "DD": ["DL", "DIV"],
  "DIV": ["DL"],
  "DT": ["DL", "DIV"],
  "LI": ["OL", "UL"],
  "TBODY": ["TABLE"],
  "TD": ["TR"],
  "TFOOT": ["TABLE"],
  "TH": ["TR"],
  "THEAD": ["TABLE"],
  "TR": ["THEAD", "TBODY", "TFOOT", "TABLE"]
};
function getImplicitAriaRole(element) {
  var _a;
  const implicitRole = ((_a = kImplicitRoleByTagName[elementSafeTagName(element)]) == null ? void 0 : _a.call(kImplicitRoleByTagName, element)) || "";
  if (!implicitRole)
    return null;
  let ancestor = element;
  while (ancestor) {
    const parent = parentElementOrShadowHost(ancestor);
    const parents = kPresentationInheritanceParents[elementSafeTagName(ancestor)];
    if (!parents || !parent || !parents.includes(elementSafeTagName(parent)))
      break;
    const parentExplicitRole = getExplicitAriaRole(parent);
    if ((parentExplicitRole === "none" || parentExplicitRole === "presentation") && !hasPresentationConflictResolution(parent, parentExplicitRole))
      return parentExplicitRole;
    ancestor = parent;
  }
  return implicitRole;
}
var allRoles = [
  "alert",
  "alertdialog",
  "application",
  "article",
  "banner",
  "blockquote",
  "button",
  "caption",
  "cell",
  "checkbox",
  "code",
  "columnheader",
  "combobox",
  "command",
  "complementary",
  "composite",
  "contentinfo",
  "definition",
  "deletion",
  "dialog",
  "directory",
  "document",
  "emphasis",
  "feed",
  "figure",
  "form",
  "generic",
  "grid",
  "gridcell",
  "group",
  "heading",
  "img",
  "input",
  "insertion",
  "landmark",
  "link",
  "list",
  "listbox",
  "listitem",
  "log",
  "main",
  "marquee",
  "math",
  "meter",
  "menu",
  "menubar",
  "menuitem",
  "menuitemcheckbox",
  "menuitemradio",
  "navigation",
  "none",
  "note",
  "option",
  "paragraph",
  "presentation",
  "progressbar",
  "radio",
  "radiogroup",
  "range",
  "region",
  "roletype",
  "row",
  "rowgroup",
  "rowheader",
  "scrollbar",
  "search",
  "searchbox",
  "section",
  "sectionhead",
  "select",
  "separator",
  "slider",
  "spinbutton",
  "status",
  "strong",
  "structure",
  "subscript",
  "superscript",
  "switch",
  "tab",
  "table",
  "tablist",
  "tabpanel",
  "term",
  "textbox",
  "time",
  "timer",
  "toolbar",
  "tooltip",
  "tree",
  "treegrid",
  "treeitem",
  "widget",
  "window"
];
var abstractRoles = ["command", "composite", "input", "landmark", "range", "roletype", "section", "sectionhead", "select", "structure", "widget", "window"];
var validRoles = allRoles.filter((role) => !abstractRoles.includes(role));
function getExplicitAriaRole(element) {
  const roles = (element.getAttribute("role") || "").split(" ").map((role) => role.trim());
  return roles.find((role) => validRoles.includes(role)) || null;
}
function hasPresentationConflictResolution(element, role) {
  return hasGlobalAriaAttribute(element, role) || isFocusable(element);
}
function getAriaRole(element) {
  const explicitRole = getExplicitAriaRole(element);
  if (!explicitRole)
    return getImplicitAriaRole(element);
  if (explicitRole === "none" || explicitRole === "presentation") {
    const implicitRole = getImplicitAriaRole(element);
    if (hasPresentationConflictResolution(element, implicitRole))
      return implicitRole;
  }
  return explicitRole;
}
function getAriaBoolean(attr) {
  return attr === null ? void 0 : attr.toLowerCase() === "true";
}
function isElementIgnoredForAria(element) {
  return ["STYLE", "SCRIPT", "NOSCRIPT", "TEMPLATE"].includes(elementSafeTagName(element));
}
function isElementHiddenForAria(element) {
  if (isElementIgnoredForAria(element))
    return true;
  const style = getElementComputedStyle(element);
  const isSlot = element.nodeName === "SLOT";
  if ((style == null ? void 0 : style.display) === "contents" && !isSlot) {
    for (let child = element.firstChild; child; child = child.nextSibling) {
      if (child.nodeType === 1 && !isElementHiddenForAria(child))
        return false;
      if (child.nodeType === 3 && isVisibleTextNode(child))
        return false;
    }
    return true;
  }
  const isOptionInsideSelect = element.nodeName === "OPTION" && !!element.closest("select");
  if (!isOptionInsideSelect && !isSlot && !isElementStyleVisibilityVisible(element, style))
    return true;
  return belongsToDisplayNoneOrAriaHiddenOrNonSlotted(element);
}
function belongsToDisplayNoneOrAriaHiddenOrNonSlotted(element) {
  let hidden = cacheIsHidden == null ? void 0 : cacheIsHidden.get(element);
  if (hidden === void 0) {
    hidden = false;
    if (element.parentElement && element.parentElement.shadowRoot && !element.assignedSlot)
      hidden = true;
    if (!hidden) {
      const style = getElementComputedStyle(element);
      hidden = !style || style.display === "none" || getAriaBoolean(element.getAttribute("aria-hidden")) === true;
    }
    if (!hidden) {
      const parent = parentElementOrShadowHost(element);
      if (parent)
        hidden = belongsToDisplayNoneOrAriaHiddenOrNonSlotted(parent);
    }
    cacheIsHidden == null ? void 0 : cacheIsHidden.set(element, hidden);
  }
  return hidden;
}
function getIdRefs(element, ref) {
  if (!ref)
    return [];
  const root = enclosingShadowRootOrDocument(element);
  if (!root)
    return [];
  try {
    const ids = ref.split(" ").filter((id) => !!id);
    const set = /* @__PURE__ */ new Set();
    for (const id of ids) {
      const firstElement = root.querySelector("#" + CSS.escape(id));
      if (firstElement)
        set.add(firstElement);
    }
    return [...set];
  } catch (e) {
    return [];
  }
}
function trimFlatString(s) {
  return s.trim();
}
function asFlatString(s) {
  return s.split("\\xA0").map((chunk) => chunk.replace(/\\r\\n/g, "\\n").replace(/\\s\\s*/g, " ")).join("\\xA0").trim();
}
function queryInAriaOwned(element, selector) {
  const result = [...element.querySelectorAll(selector)];
  for (const owned of getIdRefs(element, element.getAttribute("aria-owns"))) {
    if (owned.matches(selector))
      result.push(owned);
    result.push(...owned.querySelectorAll(selector));
  }
  return result;
}
function getPseudoContent(element, pseudo) {
  const cache = pseudo === "::before" ? cachePseudoContentBefore : cachePseudoContentAfter;
  if (cache == null ? void 0 : cache.has(element))
    return (cache == null ? void 0 : cache.get(element)) || "";
  const pseudoStyle = getElementComputedStyle(element, pseudo);
  const content = getPseudoContentImpl(pseudoStyle);
  if (cache)
    cache.set(element, content);
  return content;
}
function getPseudoContentImpl(pseudoStyle) {
  if (!pseudoStyle || pseudoStyle.display === "none" || pseudoStyle.visibility === "hidden")
    return "";
  const content = pseudoStyle.content;
  if (content[0] === "'" && content[content.length - 1] === "'" || content[0] === '"' && content[content.length - 1] === '"') {
    const unquoted = content.substring(1, content.length - 1);
    const display = pseudoStyle.display || "inline";
    if (display !== "inline")
      return " " + unquoted + " ";
    return unquoted;
  }
  return "";
}
function getAriaLabelledByElements(element) {
  const ref = element.getAttribute("aria-labelledby");
  if (ref === null)
    return null;
  return getIdRefs(element, ref);
}
function allowsNameFromContent(role, targetDescendant) {
  const alwaysAllowsNameFromContent = ["button", "cell", "checkbox", "columnheader", "gridcell", "heading", "link", "menuitem", "menuitemcheckbox", "menuitemradio", "option", "radio", "row", "rowheader", "switch", "tab", "tooltip", "treeitem"].includes(role);
  const descendantAllowsNameFromContent = targetDescendant && ["", "caption", "code", "contentinfo", "definition", "deletion", "emphasis", "insertion", "list", "listitem", "mark", "none", "paragraph", "presentation", "region", "row", "rowgroup", "section", "strong", "subscript", "superscript", "table", "term", "time"].includes(role);
  return alwaysAllowsNameFromContent || descendantAllowsNameFromContent;
}
function getElementAccessibleName(element, includeHidden) {
  const cache = includeHidden ? cacheAccessibleNameHidden : cacheAccessibleName;
  let accessibleName = cache == null ? void 0 : cache.get(element);
  if (accessibleName === void 0) {
    accessibleName = "";
    const elementProhibitsNaming = ["caption", "code", "definition", "deletion", "emphasis", "generic", "insertion", "mark", "paragraph", "presentation", "strong", "subscript", "suggestion", "superscript", "term", "time"].includes(getAriaRole(element) || "");
    if (!elementProhibitsNaming) {
      accessibleName = asFlatString(getTextAlternativeInternal(element, {
        includeHidden,
        visitedElements: /* @__PURE__ */ new Set(),
        embeddedInDescribedBy: void 0,
        embeddedInLabelledBy: void 0,
        embeddedInLabel: void 0,
        embeddedInNativeTextAlternative: void 0,
        embeddedInTargetElement: "self"
      }));
    }
    cache == null ? void 0 : cache.set(element, accessibleName);
  }
  return accessibleName;
}
function getElementAccessibleDescription(element, includeHidden) {
  const cache = includeHidden ? cacheAccessibleDescriptionHidden : cacheAccessibleDescription;
  let accessibleDescription = cache == null ? void 0 : cache.get(element);
  if (accessibleDescription === void 0) {
    accessibleDescription = "";
    if (element.hasAttribute("aria-describedby")) {
      const describedBy = getIdRefs(element, element.getAttribute("aria-describedby"));
      accessibleDescription = asFlatString(describedBy.map((ref) => getTextAlternativeInternal(ref, {
        includeHidden,
        visitedElements: /* @__PURE__ */ new Set(),
        embeddedInLabelledBy: void 0,
        embeddedInLabel: void 0,
        embeddedInNativeTextAlternative: void 0,
        embeddedInTargetElement: "none",
        embeddedInDescribedBy: { element: ref, hidden: isElementHiddenForAria(ref) }
      })).join(" "));
    } else if (element.hasAttribute("aria-description")) {
      accessibleDescription = asFlatString(element.getAttribute("aria-description") || "");
    } else {
      accessibleDescription = asFlatString(element.getAttribute("title") || "");
    }
    cache == null ? void 0 : cache.set(element, accessibleDescription);
  }
  return accessibleDescription;
}
function getTextAlternativeInternal(element, options) {
  var _a, _b, _c, _d;
  if (options.visitedElements.has(element))
    return "";
  const childOptions = {
    ...options,
    embeddedInTargetElement: options.embeddedInTargetElement === "self" ? "descendant" : options.embeddedInTargetElement
  };
  if (!options.includeHidden) {
    const isEmbeddedInHiddenReferenceTraversal = !!((_a = options.embeddedInLabelledBy) == null ? void 0 : _a.hidden) || !!((_b = options.embeddedInDescribedBy) == null ? void 0 : _b.hidden) || !!((_c = options.embeddedInNativeTextAlternative) == null ? void 0 : _c.hidden) || !!((_d = options.embeddedInLabel) == null ? void 0 : _d.hidden);
    if (isElementIgnoredForAria(element) || !isEmbeddedInHiddenReferenceTraversal && isElementHiddenForAria(element)) {
      options.visitedElements.add(element);
      return "";
    }
  }
  const labelledBy = getAriaLabelledByElements(element);
  if (!options.embeddedInLabelledBy) {
    const accessibleName = (labelledBy || []).map((ref) => getTextAlternativeInternal(ref, {
      ...options,
      embeddedInLabelledBy: { element: ref, hidden: isElementHiddenForAria(ref) },
      embeddedInDescribedBy: void 0,
      embeddedInTargetElement: "none",
      embeddedInLabel: void 0,
      embeddedInNativeTextAlternative: void 0
    })).join(" ");
    if (accessibleName)
      return accessibleName;
  }
  const role = getAriaRole(element) || "";
  const tagName = elementSafeTagName(element);
  if (!!options.embeddedInLabel || !!options.embeddedInLabelledBy || options.embeddedInTargetElement === "descendant") {
    const isOwnLabel = [...element.labels || []].includes(element);
    const isOwnLabelledBy = (labelledBy || []).includes(element);
    if (!isOwnLabel && !isOwnLabelledBy) {
      if (role === "textbox") {
        options.visitedElements.add(element);
        if (tagName === "INPUT" || tagName === "TEXTAREA")
          return element.value;
        return element.textContent || "";
      }
      if (["combobox", "listbox"].includes(role)) {
        options.visitedElements.add(element);
        let selectedOptions;
        if (tagName === "SELECT") {
          selectedOptions = [...element.selectedOptions];
          if (!selectedOptions.length && element.options.length)
            selectedOptions.push(element.options[0]);
        } else {
          const listbox = role === "combobox" ? queryInAriaOwned(element, "*").find((e) => getAriaRole(e) === "listbox") : element;
          selectedOptions = listbox ? queryInAriaOwned(listbox, '[aria-selected="true"]').filter((e) => getAriaRole(e) === "option") : [];
        }
        if (!selectedOptions.length && tagName === "INPUT") {
          return element.value;
        }
        return selectedOptions.map((option) => getTextAlternativeInternal(option, childOptions)).join(" ");
      }
      if (["progressbar", "scrollbar", "slider", "spinbutton", "meter"].includes(role)) {
        options.visitedElements.add(element);
        if (element.hasAttribute("aria-valuetext"))
          return element.getAttribute("aria-valuetext") || "";
        if (element.hasAttribute("aria-valuenow"))
          return element.getAttribute("aria-valuenow") || "";
        return element.getAttribute("value") || "";
      }
      if (["menu"].includes(role)) {
        options.visitedElements.add(element);
        return "";
      }
    }
  }
  const ariaLabel = element.getAttribute("aria-label") || "";
  if (trimFlatString(ariaLabel)) {
    options.visitedElements.add(element);
    return ariaLabel;
  }
  if (!["presentation", "none"].includes(role)) {
    if (tagName === "INPUT" && ["button", "submit", "reset"].includes(element.type)) {
      options.visitedElements.add(element);
      const value = element.value || "";
      if (trimFlatString(value))
        return value;
      if (element.type === "submit")
        return "Submit";
      if (element.type === "reset")
        return "Reset";
      const title = element.getAttribute("title") || "";
      return title;
    }
    if (tagName === "INPUT" && element.type === "image") {
      options.visitedElements.add(element);
      const labels = element.labels || [];
      if (labels.length && !options.embeddedInLabelledBy)
        return getAccessibleNameFromAssociatedLabels(labels, options);
      const alt = element.getAttribute("alt") || "";
      if (trimFlatString(alt))
        return alt;
      const title = element.getAttribute("title") || "";
      if (trimFlatString(title))
        return title;
      return "Submit";
    }
    if (!labelledBy && tagName === "BUTTON") {
      options.visitedElements.add(element);
      const labels = element.labels || [];
      if (labels.length)
        return getAccessibleNameFromAssociatedLabels(labels, options);
    }
    if (!labelledBy && tagName === "OUTPUT") {
      options.visitedElements.add(element);
      const labels = element.labels || [];
      if (labels.length)
        return getAccessibleNameFromAssociatedLabels(labels, options);
      return element.getAttribute("title") || "";
    }
    if (!labelledBy && (tagName === "TEXTAREA" || tagName === "SELECT" || tagName === "INPUT")) {
      options.visitedElements.add(element);
      const labels = element.labels || [];
      if (labels.length)
        return getAccessibleNameFromAssociatedLabels(labels, options);
      const usePlaceholder = tagName === "INPUT" && ["text", "password", "search", "tel", "email", "url"].includes(element.type) || tagName === "TEXTAREA";
      const placeholder = element.getAttribute("placeholder") || "";
      const title = element.getAttribute("title") || "";
      if (!usePlaceholder || title)
        return title;
      return placeholder;
    }
    if (!labelledBy && tagName === "FIELDSET") {
      options.visitedElements.add(element);
      for (let child = element.firstElementChild; child; child = child.nextElementSibling) {
        if (elementSafeTagName(child) === "LEGEND") {
          return getTextAlternativeInternal(child, {
            ...childOptions,
            embeddedInNativeTextAlternative: { element: child, hidden: isElementHiddenForAria(child) }
          });
        }
      }
      const title = element.getAttribute("title") || "";
      return title;
    }
    if (!labelledBy && tagName === "FIGURE") {
      options.visitedElements.add(element);
      for (let child = element.firstElementChild; child; child = child.nextElementSibling) {
        if (elementSafeTagName(child) === "FIGCAPTION") {
          return getTextAlternativeInternal(child, {
            ...childOptions,
            embeddedInNativeTextAlternative: { element: child, hidden: isElementHiddenForAria(child) }
          });
        }
      }
      const title = element.getAttribute("title") || "";
      return title;
    }
    if (tagName === "IMG") {
      options.visitedElements.add(element);
      const alt = element.getAttribute("alt") || "";
      if (trimFlatString(alt))
        return alt;
      const title = element.getAttribute("title") || "";
      return title;
    }
    if (tagName === "TABLE") {
      options.visitedElements.add(element);
      for (let child = element.firstElementChild; child; child = child.nextElementSibling) {
        if (elementSafeTagName(child) === "CAPTION") {
          return getTextAlternativeInternal(child, {
            ...childOptions,
            embeddedInNativeTextAlternative: { element: child, hidden: isElementHiddenForAria(child) }
          });
        }
      }
      const summary = element.getAttribute("summary") || "";
      if (summary)
        return summary;
    }
    if (tagName === "AREA") {
      options.visitedElements.add(element);
      const alt = element.getAttribute("alt") || "";
      if (trimFlatString(alt))
        return alt;
      const title = element.getAttribute("title") || "";
      return title;
    }
    if (tagName === "SVG" || element.ownerSVGElement) {
      options.visitedElements.add(element);
      for (let child = element.firstElementChild; child; child = child.nextElementSibling) {
        if (elementSafeTagName(child) === "TITLE" && child.ownerSVGElement) {
          return getTextAlternativeInternal(child, {
            ...childOptions,
            embeddedInLabelledBy: { element: child, hidden: isElementHiddenForAria(child) }
          });
        }
      }
    }
    if (element.ownerSVGElement && tagName === "A") {
      const title = element.getAttribute("xlink:title") || "";
      if (trimFlatString(title)) {
        options.visitedElements.add(element);
        return title;
      }
    }
  }
  const shouldNameFromContentForSummary = tagName === "SUMMARY" && !["presentation", "none"].includes(role);
  if (allowsNameFromContent(role, options.embeddedInTargetElement === "descendant") || shouldNameFromContentForSummary || !!options.embeddedInLabelledBy || !!options.embeddedInDescribedBy || !!options.embeddedInLabel || !!options.embeddedInNativeTextAlternative) {
    options.visitedElements.add(element);
    const tokens = [];
    const visit = (node, skipSlotted) => {
      var _a2;
      if (skipSlotted && node.assignedSlot)
        return;
      if (node.nodeType === 1) {
        const display = ((_a2 = getElementComputedStyle(node)) == null ? void 0 : _a2.display) || "inline";
        let token = getTextAlternativeInternal(node, childOptions);
        if (display !== "inline" || node.nodeName === "BR")
          token = " " + token + " ";
        tokens.push(token);
      } else if (node.nodeType === 3) {
        tokens.push(node.textContent || "");
      }
    };
    tokens.push(getPseudoContent(element, "::before"));
    const assignedNodes = element.nodeName === "SLOT" ? element.assignedNodes() : [];
    if (assignedNodes.length) {
      for (const child of assignedNodes)
        visit(child, false);
    } else {
      for (let child = element.firstChild; child; child = child.nextSibling)
        visit(child, true);
      if (element.shadowRoot) {
        for (let child = element.shadowRoot.firstChild; child; child = child.nextSibling)
          visit(child, true);
      }
      for (const owned of getIdRefs(element, element.getAttribute("aria-owns")))
        visit(owned, true);
    }
    tokens.push(getPseudoContent(element, "::after"));
    const accessibleName = tokens.join("");
    const maybeTrimmedAccessibleName = options.embeddedInTargetElement === "self" ? trimFlatString(accessibleName) : accessibleName;
    if (maybeTrimmedAccessibleName)
      return accessibleName;
  }
  if (!["presentation", "none"].includes(role) || tagName === "IFRAME") {
    options.visitedElements.add(element);
    const title = element.getAttribute("title") || "";
    if (trimFlatString(title))
      return title;
  }
  options.visitedElements.add(element);
  return "";
}
var kAriaSelectedRoles = ["gridcell", "option", "row", "tab", "rowheader", "columnheader", "treeitem"];
function getAriaSelected(element) {
  if (elementSafeTagName(element) === "OPTION")
    return element.selected;
  if (kAriaSelectedRoles.includes(getAriaRole(element) || ""))
    return getAriaBoolean(element.getAttribute("aria-selected")) === true;
  return false;
}
var kAriaCheckedRoles = ["checkbox", "menuitemcheckbox", "option", "radio", "switch", "menuitemradio", "treeitem"];
function getAriaChecked(element) {
  const result = getChecked(element, true);
  return result === "error" ? false : result;
}
function getChecked(element, allowMixed) {
  const tagName = elementSafeTagName(element);
  if (allowMixed && tagName === "INPUT" && element.indeterminate)
    return "mixed";
  if (tagName === "INPUT" && ["checkbox", "radio"].includes(element.type))
    return element.checked;
  if (kAriaCheckedRoles.includes(getAriaRole(element) || "")) {
    const checked = element.getAttribute("aria-checked");
    if (checked === "true")
      return true;
    if (allowMixed && checked === "mixed")
      return "mixed";
    return false;
  }
  return "error";
}
var kAriaPressedRoles = ["button"];
function getAriaPressed(element) {
  if (kAriaPressedRoles.includes(getAriaRole(element) || "")) {
    const pressed = element.getAttribute("aria-pressed");
    if (pressed === "true")
      return true;
    if (pressed === "mixed")
      return "mixed";
  }
  return false;
}
var kAriaExpandedRoles = ["application", "button", "checkbox", "combobox", "gridcell", "link", "listbox", "menuitem", "row", "rowheader", "tab", "treeitem", "columnheader", "menuitemcheckbox", "menuitemradio", "rowheader", "switch"];
function getAriaExpanded(element) {
  if (elementSafeTagName(element) === "DETAILS")
    return element.open;
  if (kAriaExpandedRoles.includes(getAriaRole(element) || "")) {
    const expanded = element.getAttribute("aria-expanded");
    if (expanded === null)
      return "none";
    if (expanded === "true")
      return true;
    return false;
  }
  return "none";
}
var kAriaLevelRoles = ["heading", "listitem", "row", "treeitem"];
function getAriaLevel(element) {
  const native = { "H1": 1, "H2": 2, "H3": 3, "H4": 4, "H5": 5, "H6": 6 }[elementSafeTagName(element)];
  if (native)
    return native;
  if (kAriaLevelRoles.includes(getAriaRole(element) || "")) {
    const attr = element.getAttribute("aria-level");
    const value = attr === null ? Number.NaN : Number(attr);
    if (Number.isInteger(value) && value >= 1)
      return value;
  }
  return 0;
}
var kAriaDisabledRoles = ["application", "button", "composite", "gridcell", "group", "input", "link", "menuitem", "scrollbar", "separator", "tab", "checkbox", "columnheader", "combobox", "grid", "listbox", "menu", "menubar", "menuitemcheckbox", "menuitemradio", "option", "radio", "radiogroup", "row", "rowheader", "searchbox", "select", "slider", "spinbutton", "switch", "tablist", "textbox", "toolbar", "tree", "treegrid", "treeitem"];
function getAriaDisabled(element) {
  return isNativelyDisabled(element) || hasExplicitAriaDisabled(element);
}
function isNativelyDisabled(element) {
  const isNativeFormControl = ["BUTTON", "INPUT", "SELECT", "TEXTAREA", "OPTION", "OPTGROUP"].includes(element.tagName);
  return isNativeFormControl && (element.hasAttribute("disabled") || belongsToDisabledFieldSet(element));
}
function belongsToDisabledFieldSet(element) {
  if (!element)
    return false;
  if (elementSafeTagName(element) === "FIELDSET" && element.hasAttribute("disabled"))
    return true;
  return belongsToDisabledFieldSet(element.parentElement);
}
function hasExplicitAriaDisabled(element) {
  if (!element)
    return false;
  if (kAriaDisabledRoles.includes(getAriaRole(element) || "")) {
    const attribute = (element.getAttribute("aria-disabled") || "").toLowerCase();
    if (attribute === "true")
      return true;
    if (attribute === "false")
      return false;
  }
  return hasExplicitAriaDisabled(parentElementOrShadowHost(element));
}
function getAccessibleNameFromAssociatedLabels(labels, options) {
  return [...labels].map((label) => getTextAlternativeInternal(label, {
    ...options,
    embeddedInLabel: { element: label, hidden: isElementHiddenForAria(label) },
    embeddedInNativeTextAlternative: void 0,
    embeddedInLabelledBy: void 0,
    embeddedInDescribedBy: void 0,
    embeddedInTargetElement: "none"
  })).filter((accessibleName) => !!accessibleName).join(" ");
}
var cacheAccessibleName;
var cacheAccessibleNameHidden;
var cacheAccessibleDescription;
var cacheAccessibleDescriptionHidden;
var cacheIsHidden;
var cachePseudoContentBefore;
var cachePseudoContentAfter;
var cachesCounter = 0;
function beginAriaCaches() {
  ++cachesCounter;
  cacheAccessibleName != null ? cacheAccessibleName : cacheAccessibleName = /* @__PURE__ */ new Map();
  cacheAccessibleNameHidden != null ? cacheAccessibleNameHidden : cacheAccessibleNameHidden = /* @__PURE__ */ new Map();
  cacheAccessibleDescription != null ? cacheAccessibleDescription : cacheAccessibleDescription = /* @__PURE__ */ new Map();
  cacheAccessibleDescriptionHidden != null ? cacheAccessibleDescriptionHidden : cacheAccessibleDescriptionHidden = /* @__PURE__ */ new Map();
  cacheIsHidden != null ? cacheIsHidden : cacheIsHidden = /* @__PURE__ */ new Map();
  cachePseudoContentBefore != null ? cachePseudoContentBefore : cachePseudoContentBefore = /* @__PURE__ */ new Map();
  cachePseudoContentAfter != null ? cachePseudoContentAfter : cachePseudoContentAfter = /* @__PURE__ */ new Map();
}
function endAriaCaches() {
  if (!--cachesCounter) {
    cacheAccessibleName = void 0;
    cacheAccessibleNameHidden = void 0;
    cacheAccessibleDescription = void 0;
    cacheAccessibleDescriptionHidden = void 0;
    cacheIsHidden = void 0;
    cachePseudoContentBefore = void 0;
    cachePseudoContentAfter = void 0;
  }
}

// packages/playwright-core/src/server/injected/selectorUtils.ts
function matchesComponentAttribute(obj, attr) {
  for (const token of attr.jsonPath) {
    if (obj !== void 0 && obj !== null)
      obj = obj[token];
  }
  return matchesAttributePart(obj, attr);
}
function matchesAttributePart(value, attr) {
  const objValue = typeof value === "string" && !attr.caseSensitive ? value.toUpperCase() : value;
  const attrValue = typeof attr.value === "string" && !attr.caseSensitive ? attr.value.toUpperCase() : attr.value;
  if (attr.op === "<truthy>")
    return !!objValue;
  if (attr.op === "=") {
    if (attrValue instanceof RegExp)
      return typeof objValue === "string" && !!objValue.match(attrValue);
    return objValue === attrValue;
  }
  if (typeof objValue !== "string" || typeof attrValue !== "string")
    return false;
  if (attr.op === "*=")
    return objValue.includes(attrValue);
  if (attr.op === "^=")
    return objValue.startsWith(attrValue);
  if (attr.op === "$=")
    return objValue.endsWith(attrValue);
  if (attr.op === "|=")
    return objValue === attrValue || objValue.startsWith(attrValue + "-");
  if (attr.op === "~=")
    return objValue.split(" ").includes(attrValue);
  return false;
}
function shouldSkipForTextMatching(element) {
  const document = element.ownerDocument;
  return element.nodeName === "SCRIPT" || element.nodeName === "NOSCRIPT" || element.nodeName === "STYLE" || document.head && document.head.contains(element);
}
function elementText(cache, root) {
  let value = cache.get(root);
  if (value === void 0) {
    value = { full: "", normalized: "", immediate: [] };
    if (!shouldSkipForTextMatching(root)) {
      let currentImmediate = "";
      if (root instanceof HTMLInputElement && (root.type === "submit" || root.type === "button")) {
        value = { full: root.value, normalized: normalizeWhiteSpace(root.value), immediate: [root.value] };
      } else {
        for (let child = root.firstChild; child; child = child.nextSibling) {
          if (child.nodeType === Node.TEXT_NODE) {
            value.full += child.nodeValue || "";
            currentImmediate += child.nodeValue || "";
          } else {
            if (currentImmediate)
              value.immediate.push(currentImmediate);
            currentImmediate = "";
            if (child.nodeType === Node.ELEMENT_NODE)
              value.full += elementText(cache, child).full;
          }
        }
        if (currentImmediate)
          value.immediate.push(currentImmediate);
        if (root.shadowRoot)
          value.full += elementText(cache, root.shadowRoot).full;
        if (value.full)
          value.normalized = normalizeWhiteSpace(value.full);
      }
    }
    cache.set(root, value);
  }
  return value;
}
function elementMatchesText(cache, element, matcher) {
  if (shouldSkipForTextMatching(element))
    return "none";
  if (!matcher(elementText(cache, element)))
    return "none";
  for (let child = element.firstChild; child; child = child.nextSibling) {
    if (child.nodeType === Node.ELEMENT_NODE && matcher(elementText(cache, child)))
      return "selfAndChildren";
  }
  if (element.shadowRoot && matcher(elementText(cache, element.shadowRoot)))
    return "selfAndChildren";
  return "self";
}
function getElementLabels(textCache, element) {
  const labels = getAriaLabelledByElements(element);
  if (labels)
    return labels.map((label) => elementText(textCache, label));
  const ariaLabel = element.getAttribute("aria-label");
  if (ariaLabel !== null && !!ariaLabel.trim())
    return [{ full: ariaLabel, normalized: normalizeWhiteSpace(ariaLabel), immediate: [ariaLabel] }];
  const isNonHiddenInput = element.nodeName === "INPUT" && element.type !== "hidden";
  if (["BUTTON", "METER", "OUTPUT", "PROGRESS", "SELECT", "TEXTAREA"].includes(element.nodeName) || isNonHiddenInput) {
    const labels2 = element.labels;
    if (labels2)
      return [...labels2].map((label) => elementText(textCache, label));
  }
  return [];
}

// packages/playwright-core/src/utils/isomorphic/cssTokenizer.ts
var between = function(num, first, last) {
  return num >= first && num <= last;
};
function digit(code) {
  return between(code, 48, 57);
}
function hexdigit(code) {
  return digit(code) || between(code, 65, 70) || between(code, 97, 102);
}
function uppercaseletter(code) {
  return between(code, 65, 90);
}
function lowercaseletter(code) {
  return between(code, 97, 122);
}
function letter(code) {
  return uppercaseletter(code) || lowercaseletter(code);
}
function nonascii(code) {
  return code >= 128;
}
function namestartchar(code) {
  return letter(code) || nonascii(code) || code === 95;
}
function namechar(code) {
  return namestartchar(code) || digit(code) || code === 45;
}
function nonprintable(code) {
  return between(code, 0, 8) || code === 11 || between(code, 14, 31) || code === 127;
}
function newline(code) {
  return code === 10;
}
function whitespace(code) {
  return newline(code) || code === 9 || code === 32;
}
var maximumallowedcodepoint = 1114111;
var InvalidCharacterError = class extends Error {
  constructor(message) {
    super(message);
    this.name = "InvalidCharacterError";
  }
};
function preprocess(str) {
  const codepoints = [];
  for (let i = 0; i < str.length; i++) {
    let code = str.charCodeAt(i);
    if (code === 13 && str.charCodeAt(i + 1) === 10) {
      code = 10;
      i++;
    }
    if (code === 13 || code === 12)
      code = 10;
    if (code === 0)
      code = 65533;
    if (between(code, 55296, 56319) && between(str.charCodeAt(i + 1), 56320, 57343)) {
      const lead = code - 55296;
      const trail = str.charCodeAt(i + 1) - 56320;
      code = Math.pow(2, 16) + lead * Math.pow(2, 10) + trail;
      i++;
    }
    codepoints.push(code);
  }
  return codepoints;
}
function stringFromCode(code) {
  if (code <= 65535)
    return String.fromCharCode(code);
  code -= Math.pow(2, 16);
  const lead = Math.floor(code / Math.pow(2, 10)) + 55296;
  const trail = code % Math.pow(2, 10) + 56320;
  return String.fromCharCode(lead) + String.fromCharCode(trail);
}
function tokenize(str1) {
  const str = preprocess(str1);
  let i = -1;
  const tokens = [];
  let code;
  let line = 0;
  let column = 0;
  let lastLineLength = 0;
  const incrLineno = function() {
    line += 1;
    lastLineLength = column;
    column = 0;
  };
  const locStart = { line, column };
  const codepoint = function(i2) {
    if (i2 >= str.length)
      return -1;
    return str[i2];
  };
  const next = function(num) {
    if (num === void 0)
      num = 1;
    if (num > 3)
      throw "Spec Error: no more than three codepoints of lookahead.";
    return codepoint(i + num);
  };
  const consume = function(num) {
    if (num === void 0)
      num = 1;
    i += num;
    code = codepoint(i);
    if (newline(code))
      incrLineno();
    else
      column += num;
    return true;
  };
  const reconsume = function() {
    i -= 1;
    if (newline(code)) {
      line -= 1;
      column = lastLineLength;
    } else {
      column -= 1;
    }
    locStart.line = line;
    locStart.column = column;
    return true;
  };
  const eof = function(codepoint2) {
    if (codepoint2 === void 0)
      codepoint2 = code;
    return codepoint2 === -1;
  };
  const donothing = function() {
  };
  const parseerror = function() {
  };
  const consumeAToken = function() {
    consumeComments();
    consume();
    if (whitespace(code)) {
      while (whitespace(next()))
        consume();
      return new WhitespaceToken();
    } else if (code === 34) {
      return consumeAStringToken();
    } else if (code === 35) {
      if (namechar(next()) || areAValidEscape(next(1), next(2))) {
        const token = new HashToken("");
        if (wouldStartAnIdentifier(next(1), next(2), next(3)))
          token.type = "id";
        token.value = consumeAName();
        return token;
      } else {
        return new DelimToken(code);
      }
    } else if (code === 36) {
      if (next() === 61) {
        consume();
        return new SuffixMatchToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 39) {
      return consumeAStringToken();
    } else if (code === 40) {
      return new OpenParenToken();
    } else if (code === 41) {
      return new CloseParenToken();
    } else if (code === 42) {
      if (next() === 61) {
        consume();
        return new SubstringMatchToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 43) {
      if (startsWithANumber()) {
        reconsume();
        return consumeANumericToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 44) {
      return new CommaToken();
    } else if (code === 45) {
      if (startsWithANumber()) {
        reconsume();
        return consumeANumericToken();
      } else if (next(1) === 45 && next(2) === 62) {
        consume(2);
        return new CDCToken();
      } else if (startsWithAnIdentifier()) {
        reconsume();
        return consumeAnIdentlikeToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 46) {
      if (startsWithANumber()) {
        reconsume();
        return consumeANumericToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 58) {
      return new ColonToken();
    } else if (code === 59) {
      return new SemicolonToken();
    } else if (code === 60) {
      if (next(1) === 33 && next(2) === 45 && next(3) === 45) {
        consume(3);
        return new CDOToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 64) {
      if (wouldStartAnIdentifier(next(1), next(2), next(3)))
        return new AtKeywordToken(consumeAName());
      else
        return new DelimToken(code);
    } else if (code === 91) {
      return new OpenSquareToken();
    } else if (code === 92) {
      if (startsWithAValidEscape()) {
        reconsume();
        return consumeAnIdentlikeToken();
      } else {
        parseerror();
        return new DelimToken(code);
      }
    } else if (code === 93) {
      return new CloseSquareToken();
    } else if (code === 94) {
      if (next() === 61) {
        consume();
        return new PrefixMatchToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 123) {
      return new OpenCurlyToken();
    } else if (code === 124) {
      if (next() === 61) {
        consume();
        return new DashMatchToken();
      } else if (next() === 124) {
        consume();
        return new ColumnToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 125) {
      return new CloseCurlyToken();
    } else if (code === 126) {
      if (next() === 61) {
        consume();
        return new IncludeMatchToken();
      } else {
        return new DelimToken(code);
      }
    } else if (digit(code)) {
      reconsume();
      return consumeANumericToken();
    } else if (namestartchar(code)) {
      reconsume();
      return consumeAnIdentlikeToken();
    } else if (eof()) {
      return new EOFToken();
    } else {
      return new DelimToken(code);
    }
  };
  const consumeComments = function() {
    while (next(1) === 47 && next(2) === 42) {
      consume(2);
      while (true) {
        consume();
        if (code === 42 && next() === 47) {
          consume();
          break;
        } else if (eof()) {
          parseerror();
          return;
        }
      }
    }
  };
  const consumeANumericToken = function() {
    const num = consumeANumber();
    if (wouldStartAnIdentifier(next(1), next(2), next(3))) {
      const token = new DimensionToken();
      token.value = num.value;
      token.repr = num.repr;
      token.type = num.type;
      token.unit = consumeAName();
      return token;
    } else if (next() === 37) {
      consume();
      const token = new PercentageToken();
      token.value = num.value;
      token.repr = num.repr;
      return token;
    } else {
      const token = new NumberToken();
      token.value = num.value;
      token.repr = num.repr;
      token.type = num.type;
      return token;
    }
  };
  const consumeAnIdentlikeToken = function() {
    const str2 = consumeAName();
    if (str2.toLowerCase() === "url" && next() === 40) {
      consume();
      while (whitespace(next(1)) && whitespace(next(2)))
        consume();
      if (next() === 34 || next() === 39)
        return new FunctionToken(str2);
      else if (whitespace(next()) && (next(2) === 34 || next(2) === 39))
        return new FunctionToken(str2);
      else
        return consumeAURLToken();
    } else if (next() === 40) {
      consume();
      return new FunctionToken(str2);
    } else {
      return new IdentToken(str2);
    }
  };
  const consumeAStringToken = function(endingCodePoint) {
    if (endingCodePoint === void 0)
      endingCodePoint = code;
    let string = "";
    while (consume()) {
      if (code === endingCodePoint || eof()) {
        return new StringToken(string);
      } else if (newline(code)) {
        parseerror();
        reconsume();
        return new BadStringToken();
      } else if (code === 92) {
        if (eof(next()))
          donothing();
        else if (newline(next()))
          consume();
        else
          string += stringFromCode(consumeEscape());
      } else {
        string += stringFromCode(code);
      }
    }
    throw new Error("Internal error");
  };
  const consumeAURLToken = function() {
    const token = new URLToken("");
    while (whitespace(next()))
      consume();
    if (eof(next()))
      return token;
    while (consume()) {
      if (code === 41 || eof()) {
        return token;
      } else if (whitespace(code)) {
        while (whitespace(next()))
          consume();
        if (next() === 41 || eof(next())) {
          consume();
          return token;
        } else {
          consumeTheRemnantsOfABadURL();
          return new BadURLToken();
        }
      } else if (code === 34 || code === 39 || code === 40 || nonprintable(code)) {
        parseerror();
        consumeTheRemnantsOfABadURL();
        return new BadURLToken();
      } else if (code === 92) {
        if (startsWithAValidEscape()) {
          token.value += stringFromCode(consumeEscape());
        } else {
          parseerror();
          consumeTheRemnantsOfABadURL();
          return new BadURLToken();
        }
      } else {
        token.value += stringFromCode(code);
      }
    }
    throw new Error("Internal error");
  };
  const consumeEscape = function() {
    consume();
    if (hexdigit(code)) {
      const digits = [code];
      for (let total = 0; total < 5; total++) {
        if (hexdigit(next())) {
          consume();
          digits.push(code);
        } else {
          break;
        }
      }
      if (whitespace(next()))
        consume();
      let value = parseInt(digits.map(function(x) {
        return String.fromCharCode(x);
      }).join(""), 16);
      if (value > maximumallowedcodepoint)
        value = 65533;
      return value;
    } else if (eof()) {
      return 65533;
    } else {
      return code;
    }
  };
  const areAValidEscape = function(c1, c2) {
    if (c1 !== 92)
      return false;
    if (newline(c2))
      return false;
    return true;
  };
  const startsWithAValidEscape = function() {
    return areAValidEscape(code, next());
  };
  const wouldStartAnIdentifier = function(c1, c2, c3) {
    if (c1 === 45)
      return namestartchar(c2) || c2 === 45 || areAValidEscape(c2, c3);
    else if (namestartchar(c1))
      return true;
    else if (c1 === 92)
      return areAValidEscape(c1, c2);
    else
      return false;
  };
  const startsWithAnIdentifier = function() {
    return wouldStartAnIdentifier(code, next(1), next(2));
  };
  const wouldStartANumber = function(c1, c2, c3) {
    if (c1 === 43 || c1 === 45) {
      if (digit(c2))
        return true;
      if (c2 === 46 && digit(c3))
        return true;
      return false;
    } else if (c1 === 46) {
      if (digit(c2))
        return true;
      return false;
    } else if (digit(c1)) {
      return true;
    } else {
      return false;
    }
  };
  const startsWithANumber = function() {
    return wouldStartANumber(code, next(1), next(2));
  };
  const consumeAName = function() {
    let result = "";
    while (consume()) {
      if (namechar(code)) {
        result += stringFromCode(code);
      } else if (startsWithAValidEscape()) {
        result += stringFromCode(consumeEscape());
      } else {
        reconsume();
        return result;
      }
    }
    throw new Error("Internal parse error");
  };
  const consumeANumber = function() {
    let repr = "";
    let type = "integer";
    if (next() === 43 || next() === 45) {
      consume();
      repr += stringFromCode(code);
    }
    while (digit(next())) {
      consume();
      repr += stringFromCode(code);
    }
    if (next(1) === 46 && digit(next(2))) {
      consume();
      repr += stringFromCode(code);
      consume();
      repr += stringFromCode(code);
      type = "number";
      while (digit(next())) {
        consume();
        repr += stringFromCode(code);
      }
    }
    const c1 = next(1), c2 = next(2), c3 = next(3);
    if ((c1 === 69 || c1 === 101) && digit(c2)) {
      consume();
      repr += stringFromCode(code);
      consume();
      repr += stringFromCode(code);
      type = "number";
      while (digit(next())) {
        consume();
        repr += stringFromCode(code);
      }
    } else if ((c1 === 69 || c1 === 101) && (c2 === 43 || c2 === 45) && digit(c3)) {
      consume();
      repr += stringFromCode(code);
      consume();
      repr += stringFromCode(code);
      consume();
      repr += stringFromCode(code);
      type = "number";
      while (digit(next())) {
        consume();
        repr += stringFromCode(code);
      }
    }
    const value = convertAStringToANumber(repr);
    return { type, value, repr };
  };
  const convertAStringToANumber = function(string) {
    return +string;
  };
  const consumeTheRemnantsOfABadURL = function() {
    while (consume()) {
      if (code === 41 || eof()) {
        return;
      } else if (startsWithAValidEscape()) {
        consumeEscape();
        donothing();
      } else {
        donothing();
      }
    }
  };
  let iterationCount = 0;
  while (!eof(next())) {
    tokens.push(consumeAToken());
    iterationCount++;
    if (iterationCount > str.length * 2)
      throw new Error("I'm infinite-looping!");
  }
  return tokens;
}
var CSSParserToken = class {
  constructor() {
    this.tokenType = "";
  }
  toJSON() {
    return { token: this.tokenType };
  }
  toString() {
    return this.tokenType;
  }
  toSource() {
    return "" + this;
  }
};
var BadStringToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "BADSTRING";
  }
};
var BadURLToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "BADURL";
  }
};
var WhitespaceToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "WHITESPACE";
  }
  toString() {
    return "WS";
  }
  toSource() {
    return " ";
  }
};
var CDOToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "CDO";
  }
  toSource() {
    return "<!--";
  }
};
var CDCToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "CDC";
  }
  toSource() {
    return "-->";
  }
};
var ColonToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = ":";
  }
};
var SemicolonToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = ";";
  }
};
var CommaToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = ",";
  }
};
var GroupingToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.value = "";
    this.mirror = "";
  }
};
var OpenCurlyToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = "{";
    this.value = "{";
    this.mirror = "}";
  }
};
var CloseCurlyToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = "}";
    this.value = "}";
    this.mirror = "{";
  }
};
var OpenSquareToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = "[";
    this.value = "[";
    this.mirror = "]";
  }
};
var CloseSquareToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = "]";
    this.value = "]";
    this.mirror = "[";
  }
};
var OpenParenToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = "(";
    this.value = "(";
    this.mirror = ")";
  }
};
var CloseParenToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = ")";
    this.value = ")";
    this.mirror = "(";
  }
};
var IncludeMatchToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "~=";
  }
};
var DashMatchToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "|=";
  }
};
var PrefixMatchToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "^=";
  }
};
var SuffixMatchToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "$=";
  }
};
var SubstringMatchToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "*=";
  }
};
var ColumnToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "||";
  }
};
var EOFToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "EOF";
  }
  toSource() {
    return "";
  }
};
var DelimToken = class extends CSSParserToken {
  constructor(code) {
    super();
    this.tokenType = "DELIM";
    this.value = "";
    this.value = stringFromCode(code);
  }
  toString() {
    return "DELIM(" + this.value + ")";
  }
  toJSON() {
    const json = this.constructor.prototype.constructor.prototype.toJSON.call(this);
    json.value = this.value;
    return json;
  }
  toSource() {
    if (this.value === "\\\\")
      return "\\\\\\n";
    else
      return this.value;
  }
};
var StringValuedToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.value = "";
  }
  ASCIIMatch(str) {
    return this.value.toLowerCase() === str.toLowerCase();
  }
  toJSON() {
    const json = this.constructor.prototype.constructor.prototype.toJSON.call(this);
    json.value = this.value;
    return json;
  }
};
var IdentToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "IDENT";
    this.value = val;
  }
  toString() {
    return "IDENT(" + this.value + ")";
  }
  toSource() {
    return escapeIdent(this.value);
  }
};
var FunctionToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "FUNCTION";
    this.value = val;
    this.mirror = ")";
  }
  toString() {
    return "FUNCTION(" + this.value + ")";
  }
  toSource() {
    return escapeIdent(this.value) + "(";
  }
};
var AtKeywordToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "AT-KEYWORD";
    this.value = val;
  }
  toString() {
    return "AT(" + this.value + ")";
  }
  toSource() {
    return "@" + escapeIdent(this.value);
  }
};
var HashToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "HASH";
    this.value = val;
    this.type = "unrestricted";
  }
  toString() {
    return "HASH(" + this.value + ")";
  }
  toJSON() {
    const json = this.constructor.prototype.constructor.prototype.toJSON.call(this);
    json.value = this.value;
    json.type = this.type;
    return json;
  }
  toSource() {
    if (this.type === "id")
      return "#" + escapeIdent(this.value);
    else
      return "#" + escapeHash(this.value);
  }
};
var StringToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "STRING";
    this.value = val;
  }
  toString() {
    return '"' + escapeString(this.value) + '"';
  }
};
var URLToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "URL";
    this.value = val;
  }
  toString() {
    return "URL(" + this.value + ")";
  }
  toSource() {
    return 'url("' + escapeString(this.value) + '")';
  }
};
var NumberToken = class extends CSSParserToken {
  constructor() {
    super();
    this.tokenType = "NUMBER";
    this.type = "integer";
    this.repr = "";
  }
  toString() {
    if (this.type === "integer")
      return "INT(" + this.value + ")";
    return "NUMBER(" + this.value + ")";
  }
  toJSON() {
    const json = super.toJSON();
    json.value = this.value;
    json.type = this.type;
    json.repr = this.repr;
    return json;
  }
  toSource() {
    return this.repr;
  }
};
var PercentageToken = class extends CSSParserToken {
  constructor() {
    super();
    this.tokenType = "PERCENTAGE";
    this.repr = "";
  }
  toString() {
    return "PERCENTAGE(" + this.value + ")";
  }
  toJSON() {
    const json = this.constructor.prototype.constructor.prototype.toJSON.call(this);
    json.value = this.value;
    json.repr = this.repr;
    return json;
  }
  toSource() {
    return this.repr + "%";
  }
};
var DimensionToken = class extends CSSParserToken {
  constructor() {
    super();
    this.tokenType = "DIMENSION";
    this.type = "integer";
    this.repr = "";
    this.unit = "";
  }
  toString() {
    return "DIM(" + this.value + "," + this.unit + ")";
  }
  toJSON() {
    const json = this.constructor.prototype.constructor.prototype.toJSON.call(this);
    json.value = this.value;
    json.type = this.type;
    json.repr = this.repr;
    json.unit = this.unit;
    return json;
  }
  toSource() {
    const source = this.repr;
    let unit = escapeIdent(this.unit);
    if (unit[0].toLowerCase() === "e" && (unit[1] === "-" || between(unit.charCodeAt(1), 48, 57))) {
      unit = "\\\\65 " + unit.slice(1, unit.length);
    }
    return source + unit;
  }
};
function escapeIdent(string) {
  string = "" + string;
  let result = "";
  const firstcode = string.charCodeAt(0);
  for (let i = 0; i < string.length; i++) {
    const code = string.charCodeAt(i);
    if (code === 0)
      throw new InvalidCharacterError("Invalid character: the input contains U+0000.");
    if (between(code, 1, 31) || code === 127 || i === 0 && between(code, 48, 57) || i === 1 && between(code, 48, 57) && firstcode === 45)
      result += "\\\\" + code.toString(16) + " ";
    else if (code >= 128 || code === 45 || code === 95 || between(code, 48, 57) || between(code, 65, 90) || between(code, 97, 122))
      result += string[i];
    else
      result += "\\\\" + string[i];
  }
  return result;
}
function escapeHash(string) {
  string = "" + string;
  let result = "";
  for (let i = 0; i < string.length; i++) {
    const code = string.charCodeAt(i);
    if (code === 0)
      throw new InvalidCharacterError("Invalid character: the input contains U+0000.");
    if (code >= 128 || code === 45 || code === 95 || between(code, 48, 57) || between(code, 65, 90) || between(code, 97, 122))
      result += string[i];
    else
      result += "\\\\" + code.toString(16) + " ";
  }
  return result;
}
function escapeString(string) {
  string = "" + string;
  let result = "";
  for (let i = 0; i < string.length; i++) {
    const code = string.charCodeAt(i);
    if (code === 0)
      throw new InvalidCharacterError("Invalid character: the input contains U+0000.");
    if (between(code, 1, 31) || code === 127)
      result += "\\\\" + code.toString(16) + " ";
    else if (code === 34 || code === 92)
      result += "\\\\" + string[i];
    else
      result += string[i];
  }
  return result;
}

// packages/playwright-core/src/utils/isomorphic/cssParser.ts
var InvalidSelectorError = class extends Error {
};
function parseCSS(selector, customNames) {
  let tokens;
  try {
    tokens = tokenize(selector);
    if (!(tokens[tokens.length - 1] instanceof EOFToken))
      tokens.push(new EOFToken());
  } catch (e) {
    const newMessage = e.message + \` while parsing selector "\${selector}"\`;
    const index = (e.stack || "").indexOf(e.message);
    if (index !== -1)
      e.stack = e.stack.substring(0, index) + newMessage + e.stack.substring(index + e.message.length);
    e.message = newMessage;
    throw e;
  }
  const unsupportedToken = tokens.find((token) => {
    return token instanceof AtKeywordToken || token instanceof BadStringToken || token instanceof BadURLToken || token instanceof ColumnToken || token instanceof CDOToken || token instanceof CDCToken || token instanceof SemicolonToken || // TODO: Consider using these for something, e.g. to escape complex strings.
    // For example :xpath{ (//div/bar[@attr="foo"])[2]/baz }
    // Or this way :xpath( {complex-xpath-goes-here("hello")} )
    token instanceof OpenCurlyToken || token instanceof CloseCurlyToken || // TODO: Consider treating these as strings?
    token instanceof URLToken || token instanceof PercentageToken;
  });
  if (unsupportedToken)
    throw new InvalidSelectorError(\`Unsupported token "\${unsupportedToken.toSource()}" while parsing selector "\${selector}"\`);
  let pos = 0;
  const names = /* @__PURE__ */ new Set();
  function unexpected() {
    return new InvalidSelectorError(\`Unexpected token "\${tokens[pos].toSource()}" while parsing selector "\${selector}"\`);
  }
  function skipWhitespace() {
    while (tokens[pos] instanceof WhitespaceToken)
      pos++;
  }
  function isIdent(p = pos) {
    return tokens[p] instanceof IdentToken;
  }
  function isString(p = pos) {
    return tokens[p] instanceof StringToken;
  }
  function isNumber(p = pos) {
    return tokens[p] instanceof NumberToken;
  }
  function isComma(p = pos) {
    return tokens[p] instanceof CommaToken;
  }
  function isOpenParen(p = pos) {
    return tokens[p] instanceof OpenParenToken;
  }
  function isCloseParen(p = pos) {
    return tokens[p] instanceof CloseParenToken;
  }
  function isFunction(p = pos) {
    return tokens[p] instanceof FunctionToken;
  }
  function isStar(p = pos) {
    return tokens[p] instanceof DelimToken && tokens[p].value === "*";
  }
  function isEOF(p = pos) {
    return tokens[p] instanceof EOFToken;
  }
  function isClauseCombinator(p = pos) {
    return tokens[p] instanceof DelimToken && [">", "+", "~"].includes(tokens[p].value);
  }
  function isSelectorClauseEnd(p = pos) {
    return isComma(p) || isCloseParen(p) || isEOF(p) || isClauseCombinator(p) || tokens[p] instanceof WhitespaceToken;
  }
  function consumeFunctionArguments() {
    const result2 = [consumeArgument()];
    while (true) {
      skipWhitespace();
      if (!isComma())
        break;
      pos++;
      result2.push(consumeArgument());
    }
    return result2;
  }
  function consumeArgument() {
    skipWhitespace();
    if (isNumber())
      return tokens[pos++].value;
    if (isString())
      return tokens[pos++].value;
    return consumeComplexSelector();
  }
  function consumeComplexSelector() {
    const result2 = { simples: [] };
    skipWhitespace();
    if (isClauseCombinator()) {
      result2.simples.push({ selector: { functions: [{ name: "scope", args: [] }] }, combinator: "" });
    } else {
      result2.simples.push({ selector: consumeSimpleSelector(), combinator: "" });
    }
    while (true) {
      skipWhitespace();
      if (isClauseCombinator()) {
        result2.simples[result2.simples.length - 1].combinator = tokens[pos++].value;
        skipWhitespace();
      } else if (isSelectorClauseEnd()) {
        break;
      }
      result2.simples.push({ combinator: "", selector: consumeSimpleSelector() });
    }
    return result2;
  }
  function consumeSimpleSelector() {
    let rawCSSString = "";
    const functions = [];
    while (!isSelectorClauseEnd()) {
      if (isIdent() || isStar()) {
        rawCSSString += tokens[pos++].toSource();
      } else if (tokens[pos] instanceof HashToken) {
        rawCSSString += tokens[pos++].toSource();
      } else if (tokens[pos] instanceof DelimToken && tokens[pos].value === ".") {
        pos++;
        if (isIdent())
          rawCSSString += "." + tokens[pos++].toSource();
        else
          throw unexpected();
      } else if (tokens[pos] instanceof ColonToken) {
        pos++;
        if (isIdent()) {
          if (!customNames.has(tokens[pos].value.toLowerCase())) {
            rawCSSString += ":" + tokens[pos++].toSource();
          } else {
            const name = tokens[pos++].value.toLowerCase();
            functions.push({ name, args: [] });
            names.add(name);
          }
        } else if (isFunction()) {
          const name = tokens[pos++].value.toLowerCase();
          if (!customNames.has(name)) {
            rawCSSString += \`:\${name}(\${consumeBuiltinFunctionArguments()})\`;
          } else {
            functions.push({ name, args: consumeFunctionArguments() });
            names.add(name);
          }
          skipWhitespace();
          if (!isCloseParen())
            throw unexpected();
          pos++;
        } else {
          throw unexpected();
        }
      } else if (tokens[pos] instanceof OpenSquareToken) {
        rawCSSString += "[";
        pos++;
        while (!(tokens[pos] instanceof CloseSquareToken) && !isEOF())
          rawCSSString += tokens[pos++].toSource();
        if (!(tokens[pos] instanceof CloseSquareToken))
          throw unexpected();
        rawCSSString += "]";
        pos++;
      } else {
        throw unexpected();
      }
    }
    if (!rawCSSString && !functions.length)
      throw unexpected();
    return { css: rawCSSString || void 0, functions };
  }
  function consumeBuiltinFunctionArguments() {
    let s = "";
    let balance = 1;
    while (!isEOF()) {
      if (isOpenParen() || isFunction())
        balance++;
      if (isCloseParen())
        balance--;
      if (!balance)
        break;
      s += tokens[pos++].toSource();
    }
    return s;
  }
  const result = consumeFunctionArguments();
  if (!isEOF())
    throw unexpected();
  if (result.some((arg) => typeof arg !== "object" || !("simples" in arg)))
    throw new InvalidSelectorError(\`Error while parsing selector "\${selector}"\`);
  return { selector: result, names: Array.from(names) };
}

// packages/playwright-core/src/utils/isomorphic/selectorParser.ts
var kNestedSelectorNames = /* @__PURE__ */ new Set(["internal:has", "internal:has-not", "internal:and", "internal:or", "internal:chain", "left-of", "right-of", "above", "below", "near"]);
var kNestedSelectorNamesWithDistance = /* @__PURE__ */ new Set(["left-of", "right-of", "above", "below", "near"]);
var customCSSNames = /* @__PURE__ */ new Set(["not", "is", "where", "has", "scope", "light", "visible", "text", "text-matches", "text-is", "has-text", "above", "below", "right-of", "left-of", "near", "nth-match"]);
function parseSelector(selector) {
  const parsedStrings = parseSelectorString(selector);
  const parts = [];
  for (const part of parsedStrings.parts) {
    if (part.name === "css" || part.name === "css:light") {
      if (part.name === "css:light")
        part.body = ":light(" + part.body + ")";
      const parsedCSS = parseCSS(part.body, customCSSNames);
      parts.push({
        name: "css",
        body: parsedCSS.selector,
        source: part.body
      });
      continue;
    }
    if (kNestedSelectorNames.has(part.name)) {
      let innerSelector;
      let distance;
      try {
        const unescaped = JSON.parse("[" + part.body + "]");
        if (!Array.isArray(unescaped) || unescaped.length < 1 || unescaped.length > 2 || typeof unescaped[0] !== "string")
          throw new InvalidSelectorError(\`Malformed selector: \${part.name}=\` + part.body);
        innerSelector = unescaped[0];
        if (unescaped.length === 2) {
          if (typeof unescaped[1] !== "number" || !kNestedSelectorNamesWithDistance.has(part.name))
            throw new InvalidSelectorError(\`Malformed selector: \${part.name}=\` + part.body);
          distance = unescaped[1];
        }
      } catch (e) {
        throw new InvalidSelectorError(\`Malformed selector: \${part.name}=\` + part.body);
      }
      const nested = { name: part.name, source: part.body, body: { parsed: parseSelector(innerSelector), distance } };
      const lastFrame = [...nested.body.parsed.parts].reverse().find((part2) => part2.name === "internal:control" && part2.body === "enter-frame");
      const lastFrameIndex = lastFrame ? nested.body.parsed.parts.indexOf(lastFrame) : -1;
      if (lastFrameIndex !== -1 && selectorPartsEqual(nested.body.parsed.parts.slice(0, lastFrameIndex + 1), parts.slice(0, lastFrameIndex + 1)))
        nested.body.parsed.parts.splice(0, lastFrameIndex + 1);
      parts.push(nested);
      continue;
    }
    parts.push({ ...part, source: part.body });
  }
  if (kNestedSelectorNames.has(parts[0].name))
    throw new InvalidSelectorError(\`"\${parts[0].name}" selector cannot be first\`);
  return {
    capture: parsedStrings.capture,
    parts
  };
}
function selectorPartsEqual(list1, list2) {
  return stringifySelector({ parts: list1 }) === stringifySelector({ parts: list2 });
}
function stringifySelector(selector, forceEngineName) {
  if (typeof selector === "string")
    return selector;
  return selector.parts.map((p, i) => {
    let includeEngine = true;
    if (!forceEngineName && i !== selector.capture) {
      if (p.name === "css")
        includeEngine = false;
      else if (p.name === "xpath" && p.source.startsWith("//") || p.source.startsWith(".."))
        includeEngine = false;
    }
    const prefix = includeEngine ? p.name + "=" : "";
    return \`\${i === selector.capture ? "*" : ""}\${prefix}\${p.source}\`;
  }).join(" >> ");
}
function visitAllSelectorParts(selector, visitor) {
  const visit = (selector2, nested) => {
    for (const part of selector2.parts) {
      visitor(part, nested);
      if (kNestedSelectorNames.has(part.name))
        visit(part.body.parsed, true);
    }
  };
  visit(selector, false);
}
function parseSelectorString(selector) {
  let index = 0;
  let quote;
  let start = 0;
  const result = { parts: [] };
  const append = () => {
    const part = selector.substring(start, index).trim();
    const eqIndex = part.indexOf("=");
    let name;
    let body;
    if (eqIndex !== -1 && part.substring(0, eqIndex).trim().match(/^[a-zA-Z_0-9-+:*]+$/)) {
      name = part.substring(0, eqIndex).trim();
      body = part.substring(eqIndex + 1);
    } else if (part.length > 1 && part[0] === '"' && part[part.length - 1] === '"') {
      name = "text";
      body = part;
    } else if (part.length > 1 && part[0] === "'" && part[part.length - 1] === "'") {
      name = "text";
      body = part;
    } else if (/^\\(*\\/\\//.test(part) || part.startsWith("..")) {
      name = "xpath";
      body = part;
    } else {
      name = "css";
      body = part;
    }
    let capture = false;
    if (name[0] === "*") {
      capture = true;
      name = name.substring(1);
    }
    result.parts.push({ name, body });
    if (capture) {
      if (result.capture !== void 0)
        throw new InvalidSelectorError(\`Only one of the selectors can capture using * modifier\`);
      result.capture = result.parts.length - 1;
    }
  };
  if (!selector.includes(">>")) {
    index = selector.length;
    append();
    return result;
  }
  const shouldIgnoreTextSelectorQuote = () => {
    const prefix = selector.substring(start, index);
    const match = prefix.match(/^\\s*text\\s*=(.*)$/);
    return !!match && !!match[1];
  };
  while (index < selector.length) {
    const c = selector[index];
    if (c === "\\\\" && index + 1 < selector.length) {
      index += 2;
    } else if (c === quote) {
      quote = void 0;
      index++;
    } else if (!quote && (c === '"' || c === "'" || c === "\`") && !shouldIgnoreTextSelectorQuote()) {
      quote = c;
      index++;
    } else if (!quote && c === ">" && selector[index + 1] === ">") {
      append();
      index += 2;
      start = index;
    } else {
      index++;
    }
  }
  append();
  return result;
}
function parseAttributeSelector(selector, allowUnquotedStrings) {
  let wp = 0;
  let EOL = selector.length === 0;
  const next = () => selector[wp] || "";
  const eat1 = () => {
    const result2 = next();
    ++wp;
    EOL = wp >= selector.length;
    return result2;
  };
  const syntaxError = (stage) => {
    if (EOL)
      throw new InvalidSelectorError(\`Unexpected end of selector while parsing selector \\\`\${selector}\\\`\`);
    throw new InvalidSelectorError(\`Error while parsing selector \\\`\${selector}\\\` - unexpected symbol "\${next()}" at position \${wp}\` + (stage ? " during " + stage : ""));
  };
  function skipSpaces() {
    while (!EOL && /\\s/.test(next()))
      eat1();
  }
  function isCSSNameChar(char) {
    return char >= "\\x80" || char >= "0" && char <= "9" || char >= "A" && char <= "Z" || char >= "a" && char <= "z" || char >= "0" && char <= "9" || char === "_" || char === "-";
  }
  function readIdentifier() {
    let result2 = "";
    skipSpaces();
    while (!EOL && isCSSNameChar(next()))
      result2 += eat1();
    return result2;
  }
  function readQuotedString(quote) {
    let result2 = eat1();
    if (result2 !== quote)
      syntaxError("parsing quoted string");
    while (!EOL && next() !== quote) {
      if (next() === "\\\\")
        eat1();
      result2 += eat1();
    }
    if (next() !== quote)
      syntaxError("parsing quoted string");
    result2 += eat1();
    return result2;
  }
  function readRegularExpression() {
    if (eat1() !== "/")
      syntaxError("parsing regular expression");
    let source = "";
    let inClass = false;
    while (!EOL) {
      if (next() === "\\\\") {
        source += eat1();
        if (EOL)
          syntaxError("parsing regular expression");
      } else if (inClass && next() === "]") {
        inClass = false;
      } else if (!inClass && next() === "[") {
        inClass = true;
      } else if (!inClass && next() === "/") {
        break;
      }
      source += eat1();
    }
    if (eat1() !== "/")
      syntaxError("parsing regular expression");
    let flags = "";
    while (!EOL && next().match(/[dgimsuy]/))
      flags += eat1();
    try {
      return new RegExp(source, flags);
    } catch (e) {
      throw new InvalidSelectorError(\`Error while parsing selector \\\`\${selector}\\\`: \${e.message}\`);
    }
  }
  function readAttributeToken() {
    let token = "";
    skipSpaces();
    if (next() === \`'\` || next() === \`"\`)
      token = readQuotedString(next()).slice(1, -1);
    else
      token = readIdentifier();
    if (!token)
      syntaxError("parsing property path");
    return token;
  }
  function readOperator() {
    skipSpaces();
    let op = "";
    if (!EOL)
      op += eat1();
    if (!EOL && op !== "=")
      op += eat1();
    if (!["=", "*=", "^=", "$=", "|=", "~="].includes(op))
      syntaxError("parsing operator");
    return op;
  }
  function readAttribute() {
    eat1();
    const jsonPath = [];
    jsonPath.push(readAttributeToken());
    skipSpaces();
    while (next() === ".") {
      eat1();
      jsonPath.push(readAttributeToken());
      skipSpaces();
    }
    if (next() === "]") {
      eat1();
      return { name: jsonPath.join("."), jsonPath, op: "<truthy>", value: null, caseSensitive: false };
    }
    const operator = readOperator();
    let value = void 0;
    let caseSensitive = true;
    skipSpaces();
    if (next() === "/") {
      if (operator !== "=")
        throw new InvalidSelectorError(\`Error while parsing selector \\\`\${selector}\\\` - cannot use \${operator} in attribute with regular expression\`);
      value = readRegularExpression();
    } else if (next() === \`'\` || next() === \`"\`) {
      value = readQuotedString(next()).slice(1, -1);
      skipSpaces();
      if (next() === "i" || next() === "I") {
        caseSensitive = false;
        eat1();
      } else if (next() === "s" || next() === "S") {
        caseSensitive = true;
        eat1();
      }
    } else {
      value = "";
      while (!EOL && (isCSSNameChar(next()) || next() === "+" || next() === "."))
        value += eat1();
      if (value === "true") {
        value = true;
      } else if (value === "false") {
        value = false;
      } else {
        if (!allowUnquotedStrings) {
          value = +value;
          if (Number.isNaN(value))
            syntaxError("parsing attribute value");
        }
      }
    }
    skipSpaces();
    if (next() !== "]")
      syntaxError("parsing attribute value");
    eat1();
    if (operator !== "=" && typeof value !== "string")
      throw new InvalidSelectorError(\`Error while parsing selector \\\`\${selector}\\\` - cannot use \${operator} in attribute with non-string matching value - \${value}\`);
    return { name: jsonPath.join("."), jsonPath, op: operator, value, caseSensitive };
  }
  const result = {
    name: "",
    attributes: []
  };
  result.name = readIdentifier();
  skipSpaces();
  while (next() === "[") {
    result.attributes.push(readAttribute());
    skipSpaces();
  }
  if (!EOL)
    syntaxError(void 0);
  if (!result.name && !result.attributes.length)
    throw new InvalidSelectorError(\`Error while parsing selector \\\`\${selector}\\\` - selector cannot be empty\`);
  return result;
}

// packages/playwright-core/src/server/injected/reactSelectorEngine.ts
function getFunctionComponentName(component) {
  return component.displayName || component.name || "Anonymous";
}
function getComponentName(reactElement) {
  if (reactElement.type) {
    switch (typeof reactElement.type) {
      case "function":
        return getFunctionComponentName(reactElement.type);
      case "string":
        return reactElement.type;
      case "object":
        return reactElement.type.displayName || (reactElement.type.render ? getFunctionComponentName(reactElement.type.render) : "");
    }
  }
  if (reactElement._currentElement) {
    const elementType = reactElement._currentElement.type;
    if (typeof elementType === "string")
      return elementType;
    if (typeof elementType === "function")
      return elementType.displayName || elementType.name || "Anonymous";
  }
  return "";
}
function getComponentKey(reactElement) {
  var _a, _b;
  return (_b = reactElement.key) != null ? _b : (_a = reactElement._currentElement) == null ? void 0 : _a.key;
}
function getChildren(reactElement) {
  if (reactElement.child) {
    const children = [];
    for (let child = reactElement.child; child; child = child.sibling)
      children.push(child);
    return children;
  }
  if (!reactElement._currentElement)
    return [];
  const isKnownElement = (reactElement2) => {
    var _a;
    const elementType = (_a = reactElement2._currentElement) == null ? void 0 : _a.type;
    return typeof elementType === "function" || typeof elementType === "string";
  };
  if (reactElement._renderedComponent) {
    const child = reactElement._renderedComponent;
    return isKnownElement(child) ? [child] : [];
  }
  if (reactElement._renderedChildren)
    return [...Object.values(reactElement._renderedChildren)].filter(isKnownElement);
  return [];
}
function getProps(reactElement) {
  var _a;
  const props = (
    // React 16+
    reactElement.memoizedProps || // React 15
    ((_a = reactElement._currentElement) == null ? void 0 : _a.props)
  );
  if (!props || typeof props === "string")
    return props;
  const result = { ...props };
  delete result.children;
  return result;
}
function buildComponentsTree(reactElement) {
  var _a;
  const treeNode = {
    key: getComponentKey(reactElement),
    name: getComponentName(reactElement),
    children: getChildren(reactElement).map(buildComponentsTree),
    rootElements: [],
    props: getProps(reactElement)
  };
  const rootElement = (
    // React 16+
    // @see https://github.com/baruchvlz/resq/blob/5c15a5e04d3f7174087248f5a158c3d6dcc1ec72/src/utils.js#L29
    reactElement.stateNode || // React 15
    reactElement._hostNode || ((_a = reactElement._renderedComponent) == null ? void 0 : _a._hostNode)
  );
  if (rootElement instanceof Element) {
    treeNode.rootElements.push(rootElement);
  } else {
    for (const child of treeNode.children)
      treeNode.rootElements.push(...child.rootElements);
  }
  return treeNode;
}
function filterComponentsTree(treeNode, searchFn, result = []) {
  if (searchFn(treeNode))
    result.push(treeNode);
  for (const child of treeNode.children)
    filterComponentsTree(child, searchFn, result);
  return result;
}
function findReactRoots(root, roots = []) {
  const document = root.ownerDocument || root;
  const walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT);
  do {
    const node = walker.currentNode;
    const reactNode = node;
    const rootKey = Object.keys(reactNode).find((key) => key.startsWith("__reactContainer") && reactNode[key] !== null);
    if (rootKey) {
      roots.push(reactNode[rootKey].stateNode.current);
    } else {
      const legacyRootKey = "_reactRootContainer";
      if (reactNode.hasOwnProperty(legacyRootKey) && reactNode[legacyRootKey] !== null) {
        roots.push(reactNode[legacyRootKey]._internalRoot.current);
      }
    }
    if (node instanceof Element && node.hasAttribute("data-reactroot")) {
      for (const key of Object.keys(node)) {
        if (key.startsWith("__reactInternalInstance") || key.startsWith("__reactFiber"))
          roots.push(node[key]);
      }
    }
    const shadowRoot = node instanceof Element ? node.shadowRoot : null;
    if (shadowRoot)
      findReactRoots(shadowRoot, roots);
  } while (walker.nextNode());
  return roots;
}
var ReactEngine = {
  queryAll(scope, selector) {
    const { name, attributes } = parseAttributeSelector(selector, false);
    const reactRoots = findReactRoots(scope.ownerDocument || scope);
    const trees = reactRoots.map((reactRoot) => buildComponentsTree(reactRoot));
    const treeNodes = trees.map((tree) => filterComponentsTree(tree, (treeNode) => {
      var _a;
      const props = (_a = treeNode.props) != null ? _a : {};
      if (treeNode.key !== void 0)
        props.key = treeNode.key;
      if (name && treeNode.name !== name)
        return false;
      if (treeNode.rootElements.some((domNode) => !isInsideScope(scope, domNode)))
        return false;
      for (const attr of attributes) {
        if (!matchesComponentAttribute(props, attr))
          return false;
      }
      return true;
    })).flat();
    const allRootElements = /* @__PURE__ */ new Set();
    for (const treeNode of treeNodes) {
      for (const domNode of treeNode.rootElements)
        allRootElements.add(domNode);
    }
    return [...allRootElements];
  }
};

// packages/playwright-core/src/server/injected/vueSelectorEngine.ts
function basename(filename, ext) {
  const normalized = filename.replace(/^[a-zA-Z]:/, "").replace(/\\\\/g, "/");
  let result = normalized.substring(normalized.lastIndexOf("/") + 1);
  if (ext && result.endsWith(ext))
    result = result.substring(0, result.length - ext.length);
  return result;
}
function toUpper(_, c) {
  return c ? c.toUpperCase() : "";
}
var classifyRE = /(?:^|[-_/])(\\w)/g;
var classify = (str) => {
  return str && str.replace(classifyRE, toUpper);
};
function buildComponentsTreeVue3(instance) {
  function getComponentTypeName(options) {
    const name = options.name || options._componentTag || options.__playwright_guessedName;
    if (name)
      return name;
    const file = options.__file;
    if (file)
      return classify(basename(file, ".vue"));
  }
  function saveComponentName(instance2, key) {
    instance2.type.__playwright_guessedName = key;
    return key;
  }
  function getInstanceName(instance2) {
    var _a, _b, _c, _d;
    const name = getComponentTypeName(instance2.type || {});
    if (name)
      return name;
    if (instance2.root === instance2)
      return "Root";
    for (const key in (_b = (_a = instance2.parent) == null ? void 0 : _a.type) == null ? void 0 : _b.components) {
      if (((_c = instance2.parent) == null ? void 0 : _c.type.components[key]) === instance2.type)
        return saveComponentName(instance2, key);
    }
    for (const key in (_d = instance2.appContext) == null ? void 0 : _d.components) {
      if (instance2.appContext.components[key] === instance2.type)
        return saveComponentName(instance2, key);
    }
    return "Anonymous Component";
  }
  function isBeingDestroyed(instance2) {
    return instance2._isBeingDestroyed || instance2.isUnmounted;
  }
  function isFragment(instance2) {
    return instance2.subTree.type.toString() === "Symbol(Fragment)";
  }
  function getInternalInstanceChildren(subTree) {
    const list = [];
    if (subTree.component)
      list.push(subTree.component);
    if (subTree.suspense)
      list.push(...getInternalInstanceChildren(subTree.suspense.activeBranch));
    if (Array.isArray(subTree.children)) {
      subTree.children.forEach((childSubTree) => {
        if (childSubTree.component)
          list.push(childSubTree.component);
        else
          list.push(...getInternalInstanceChildren(childSubTree));
      });
    }
    return list.filter((child) => {
      var _a;
      return !isBeingDestroyed(child) && !((_a = child.type.devtools) == null ? void 0 : _a.hide);
    });
  }
  function getRootElementsFromComponentInstance(instance2) {
    if (isFragment(instance2))
      return getFragmentRootElements(instance2.subTree);
    return [instance2.subTree.el];
  }
  function getFragmentRootElements(vnode) {
    if (!vnode.children)
      return [];
    const list = [];
    for (let i = 0, l = vnode.children.length; i < l; i++) {
      const childVnode = vnode.children[i];
      if (childVnode.component)
        list.push(...getRootElementsFromComponentInstance(childVnode.component));
      else if (childVnode.el)
        list.push(childVnode.el);
    }
    return list;
  }
  function buildComponentsTree2(instance2) {
    return {
      name: getInstanceName(instance2),
      children: getInternalInstanceChildren(instance2.subTree).map(buildComponentsTree2),
      rootElements: getRootElementsFromComponentInstance(instance2),
      props: instance2.props
    };
  }
  return buildComponentsTree2(instance);
}
function buildComponentsTreeVue2(instance) {
  function getComponentName2(options) {
    const name = options.displayName || options.name || options._componentTag;
    if (name)
      return name;
    const file = options.__file;
    if (file)
      return classify(basename(file, ".vue"));
  }
  function getInstanceName(instance2) {
    const name = getComponentName2(instance2.$options || instance2.fnOptions || {});
    if (name)
      return name;
    return instance2.$root === instance2 ? "Root" : "Anonymous Component";
  }
  function getInternalInstanceChildren(instance2) {
    if (instance2.$children)
      return instance2.$children;
    if (Array.isArray(instance2.subTree.children))
      return instance2.subTree.children.filter((vnode) => !!vnode.component).map((vnode) => vnode.component);
    return [];
  }
  function buildComponentsTree2(instance2) {
    return {
      name: getInstanceName(instance2),
      children: getInternalInstanceChildren(instance2).map(buildComponentsTree2),
      rootElements: [instance2.$el],
      props: instance2._props
    };
  }
  return buildComponentsTree2(instance);
}
function filterComponentsTree2(treeNode, searchFn, result = []) {
  if (searchFn(treeNode))
    result.push(treeNode);
  for (const child of treeNode.children)
    filterComponentsTree2(child, searchFn, result);
  return result;
}
function findVueRoots(root, roots = []) {
  const document = root.ownerDocument || root;
  const walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT);
  const vue2Roots = /* @__PURE__ */ new Set();
  do {
    const node = walker.currentNode;
    if (node.__vue__)
      vue2Roots.add(node.__vue__.$root);
    if (node.__vue_app__ && node._vnode && node._vnode.component)
      roots.push({ root: node._vnode.component, version: 3 });
    const shadowRoot = node instanceof Element ? node.shadowRoot : null;
    if (shadowRoot)
      findVueRoots(shadowRoot, roots);
  } while (walker.nextNode());
  for (const vue2root of vue2Roots) {
    roots.push({
      version: 2,
      root: vue2root
    });
  }
  return roots;
}
var VueEngine = {
  queryAll(scope, selector) {
    const document = scope.ownerDocument || scope;
    const { name, attributes } = parseAttributeSelector(selector, false);
    const vueRoots = findVueRoots(document);
    const trees = vueRoots.map((vueRoot) => vueRoot.version === 3 ? buildComponentsTreeVue3(vueRoot.root) : buildComponentsTreeVue2(vueRoot.root));
    const treeNodes = trees.map((tree) => filterComponentsTree2(tree, (treeNode) => {
      if (name && treeNode.name !== name)
        return false;
      if (treeNode.rootElements.some((rootElement) => !isInsideScope(scope, rootElement)))
        return false;
      for (const attr of attributes) {
        if (!matchesComponentAttribute(treeNode.props, attr))
          return false;
      }
      return true;
    })).flat();
    const allRootElements = /* @__PURE__ */ new Set();
    for (const treeNode of treeNodes) {
      for (const rootElement of treeNode.rootElements)
        allRootElements.add(rootElement);
    }
    return [...allRootElements];
  }
};

// packages/playwright-core/src/server/injected/roleSelectorEngine.ts
var kSupportedAttributes = ["selected", "checked", "pressed", "expanded", "level", "disabled", "name", "include-hidden"];
kSupportedAttributes.sort();
function validateSupportedRole(attr, roles, role) {
  if (!roles.includes(role))
    throw new Error(\`"\${attr}" attribute is only supported for roles: \${roles.slice().sort().map((role2) => \`"\${role2}"\`).join(", ")}\`);
}
function validateSupportedValues(attr, values) {
  if (attr.op !== "<truthy>" && !values.includes(attr.value))
    throw new Error(\`"\${attr.name}" must be one of \${values.map((v) => JSON.stringify(v)).join(", ")}\`);
}
function validateSupportedOp(attr, ops) {
  if (!ops.includes(attr.op))
    throw new Error(\`"\${attr.name}" does not support "\${attr.op}" matcher\`);
}
function validateAttributes(attrs, role) {
  const options = { role };
  for (const attr of attrs) {
    switch (attr.name) {
      case "checked": {
        validateSupportedRole(attr.name, kAriaCheckedRoles, role);
        validateSupportedValues(attr, [true, false, "mixed"]);
        validateSupportedOp(attr, ["<truthy>", "="]);
        options.checked = attr.op === "<truthy>" ? true : attr.value;
        break;
      }
      case "pressed": {
        validateSupportedRole(attr.name, kAriaPressedRoles, role);
        validateSupportedValues(attr, [true, false, "mixed"]);
        validateSupportedOp(attr, ["<truthy>", "="]);
        options.pressed = attr.op === "<truthy>" ? true : attr.value;
        break;
      }
      case "selected": {
        validateSupportedRole(attr.name, kAriaSelectedRoles, role);
        validateSupportedValues(attr, [true, false]);
        validateSupportedOp(attr, ["<truthy>", "="]);
        options.selected = attr.op === "<truthy>" ? true : attr.value;
        break;
      }
      case "expanded": {
        validateSupportedRole(attr.name, kAriaExpandedRoles, role);
        validateSupportedValues(attr, [true, false]);
        validateSupportedOp(attr, ["<truthy>", "="]);
        options.expanded = attr.op === "<truthy>" ? true : attr.value;
        break;
      }
      case "level": {
        validateSupportedRole(attr.name, kAriaLevelRoles, role);
        if (typeof attr.value === "string")
          attr.value = +attr.value;
        if (attr.op !== "=" || typeof attr.value !== "number" || Number.isNaN(attr.value))
          throw new Error(\`"level" attribute must be compared to a number\`);
        options.level = attr.value;
        break;
      }
      case "disabled": {
        validateSupportedValues(attr, [true, false]);
        validateSupportedOp(attr, ["<truthy>", "="]);
        options.disabled = attr.op === "<truthy>" ? true : attr.value;
        break;
      }
      case "name": {
        if (attr.op === "<truthy>")
          throw new Error(\`"name" attribute must have a value\`);
        if (typeof attr.value !== "string" && !(attr.value instanceof RegExp))
          throw new Error(\`"name" attribute must be a string or a regular expression\`);
        options.name = attr.value;
        options.nameOp = attr.op;
        options.exact = attr.caseSensitive;
        break;
      }
      case "include-hidden": {
        validateSupportedValues(attr, [true, false]);
        validateSupportedOp(attr, ["<truthy>", "="]);
        options.includeHidden = attr.op === "<truthy>" ? true : attr.value;
        break;
      }
      default: {
        throw new Error(\`Unknown attribute "\${attr.name}", must be one of \${kSupportedAttributes.map((a) => \`"\${a}"\`).join(", ")}.\`);
      }
    }
  }
  return options;
}
function queryRole(scope, options, internal) {
  const result = [];
  const match = (element) => {
    if (getAriaRole(element) !== options.role)
      return;
    if (options.selected !== void 0 && getAriaSelected(element) !== options.selected)
      return;
    if (options.checked !== void 0 && getAriaChecked(element) !== options.checked)
      return;
    if (options.pressed !== void 0 && getAriaPressed(element) !== options.pressed)
      return;
    if (options.expanded !== void 0 && getAriaExpanded(element) !== options.expanded)
      return;
    if (options.level !== void 0 && getAriaLevel(element) !== options.level)
      return;
    if (options.disabled !== void 0 && getAriaDisabled(element) !== options.disabled)
      return;
    if (!options.includeHidden) {
      const isHidden = isElementHiddenForAria(element);
      if (isHidden)
        return;
    }
    if (options.name !== void 0) {
      const accessibleName = normalizeWhiteSpace(getElementAccessibleName(element, !!options.includeHidden));
      if (typeof options.name === "string")
        options.name = normalizeWhiteSpace(options.name);
      if (internal && !options.exact && options.nameOp === "=")
        options.nameOp = "*=";
      if (!matchesAttributePart(accessibleName, { name: "", jsonPath: [], op: options.nameOp || "=", value: options.name, caseSensitive: !!options.exact }))
        return;
    }
    result.push(element);
  };
  const query = (root) => {
    const shadows = [];
    if (root.shadowRoot)
      shadows.push(root.shadowRoot);
    for (const element of root.querySelectorAll("*")) {
      match(element);
      if (element.shadowRoot)
        shadows.push(element.shadowRoot);
    }
    shadows.forEach(query);
  };
  query(scope);
  return result;
}
function createRoleEngine(internal) {
  return {
    queryAll: (scope, selector) => {
      const parsed = parseAttributeSelector(selector, true);
      const role = parsed.name.toLowerCase();
      if (!role)
        throw new Error(\`Role must not be empty\`);
      const options = validateAttributes(parsed.attributes, role);
      beginAriaCaches();
      try {
        return queryRole(scope, options, internal);
      } finally {
        endAriaCaches();
      }
    }
  };
}

// packages/playwright-core/src/server/injected/layoutSelectorUtils.ts
function boxRightOf(box1, box2, maxDistance) {
  const distance = box1.left - box2.right;
  if (distance < 0 || maxDistance !== void 0 && distance > maxDistance)
    return;
  return distance + Math.max(box2.bottom - box1.bottom, 0) + Math.max(box1.top - box2.top, 0);
}
function boxLeftOf(box1, box2, maxDistance) {
  const distance = box2.left - box1.right;
  if (distance < 0 || maxDistance !== void 0 && distance > maxDistance)
    return;
  return distance + Math.max(box2.bottom - box1.bottom, 0) + Math.max(box1.top - box2.top, 0);
}
function boxAbove(box1, box2, maxDistance) {
  const distance = box2.top - box1.bottom;
  if (distance < 0 || maxDistance !== void 0 && distance > maxDistance)
    return;
  return distance + Math.max(box1.left - box2.left, 0) + Math.max(box2.right - box1.right, 0);
}
function boxBelow(box1, box2, maxDistance) {
  const distance = box1.top - box2.bottom;
  if (distance < 0 || maxDistance !== void 0 && distance > maxDistance)
    return;
  return distance + Math.max(box1.left - box2.left, 0) + Math.max(box2.right - box1.right, 0);
}
function boxNear(box1, box2, maxDistance) {
  const kThreshold = maxDistance === void 0 ? 50 : maxDistance;
  let score = 0;
  if (box1.left - box2.right >= 0)
    score += box1.left - box2.right;
  if (box2.left - box1.right >= 0)
    score += box2.left - box1.right;
  if (box2.top - box1.bottom >= 0)
    score += box2.top - box1.bottom;
  if (box1.top - box2.bottom >= 0)
    score += box1.top - box2.bottom;
  return score > kThreshold ? void 0 : score;
}
var kLayoutSelectorNames = ["left-of", "right-of", "above", "below", "near"];
function layoutSelectorScore(name, element, inner, maxDistance) {
  const box = element.getBoundingClientRect();
  const scorer = { "left-of": boxLeftOf, "right-of": boxRightOf, "above": boxAbove, "below": boxBelow, "near": boxNear }[name];
  let bestScore;
  for (const e of inner) {
    if (e === element)
      continue;
    const score = scorer(box, e.getBoundingClientRect(), maxDistance);
    if (score === void 0)
      continue;
    if (bestScore === void 0 || score < bestScore)
      bestScore = score;
  }
  return bestScore;
}

// packages/playwright-core/src/server/injected/selectorEvaluator.ts
var SelectorEvaluatorImpl = class {
  constructor(extraEngines) {
    this._engines = /* @__PURE__ */ new Map();
    this._cacheQueryCSS = /* @__PURE__ */ new Map();
    this._cacheMatches = /* @__PURE__ */ new Map();
    this._cacheQuery = /* @__PURE__ */ new Map();
    this._cacheMatchesSimple = /* @__PURE__ */ new Map();
    this._cacheMatchesParents = /* @__PURE__ */ new Map();
    this._cacheCallMatches = /* @__PURE__ */ new Map();
    this._cacheCallQuery = /* @__PURE__ */ new Map();
    this._cacheQuerySimple = /* @__PURE__ */ new Map();
    this._cacheText = /* @__PURE__ */ new Map();
    this._retainCacheCounter = 0;
    for (const [name, engine] of extraEngines)
      this._engines.set(name, engine);
    this._engines.set("not", notEngine);
    this._engines.set("is", isEngine);
    this._engines.set("where", isEngine);
    this._engines.set("has", hasEngine);
    this._engines.set("scope", scopeEngine);
    this._engines.set("light", lightEngine);
    this._engines.set("visible", visibleEngine);
    this._engines.set("text", textEngine);
    this._engines.set("text-is", textIsEngine);
    this._engines.set("text-matches", textMatchesEngine);
    this._engines.set("has-text", hasTextEngine);
    this._engines.set("right-of", createLayoutEngine("right-of"));
    this._engines.set("left-of", createLayoutEngine("left-of"));
    this._engines.set("above", createLayoutEngine("above"));
    this._engines.set("below", createLayoutEngine("below"));
    this._engines.set("near", createLayoutEngine("near"));
    this._engines.set("nth-match", nthMatchEngine);
    const allNames = [...this._engines.keys()];
    allNames.sort();
    const parserNames = [...customCSSNames];
    parserNames.sort();
    if (allNames.join("|") !== parserNames.join("|"))
      throw new Error(\`Please keep customCSSNames in sync with evaluator engines: \${allNames.join("|")} vs \${parserNames.join("|")}\`);
  }
  begin() {
    ++this._retainCacheCounter;
  }
  end() {
    --this._retainCacheCounter;
    if (!this._retainCacheCounter) {
      this._cacheQueryCSS.clear();
      this._cacheMatches.clear();
      this._cacheQuery.clear();
      this._cacheMatchesSimple.clear();
      this._cacheMatchesParents.clear();
      this._cacheCallMatches.clear();
      this._cacheCallQuery.clear();
      this._cacheQuerySimple.clear();
      this._cacheText.clear();
    }
  }
  _cached(cache, main, rest, cb) {
    if (!cache.has(main))
      cache.set(main, []);
    const entries = cache.get(main);
    const entry = entries.find((e) => rest.every((value, index) => e.rest[index] === value));
    if (entry)
      return entry.result;
    const result = cb();
    entries.push({ rest, result });
    return result;
  }
  _checkSelector(s) {
    const wellFormed = typeof s === "object" && s && (Array.isArray(s) || "simples" in s && s.simples.length);
    if (!wellFormed)
      throw new Error(\`Malformed selector "\${s}"\`);
    return s;
  }
  matches(element, s, context) {
    const selector = this._checkSelector(s);
    this.begin();
    try {
      return this._cached(this._cacheMatches, element, [selector, context.scope, context.pierceShadow, context.originalScope], () => {
        if (Array.isArray(selector))
          return this._matchesEngine(isEngine, element, selector, context);
        if (this._hasScopeClause(selector))
          context = this._expandContextForScopeMatching(context);
        if (!this._matchesSimple(element, selector.simples[selector.simples.length - 1].selector, context))
          return false;
        return this._matchesParents(element, selector, selector.simples.length - 2, context);
      });
    } finally {
      this.end();
    }
  }
  query(context, s) {
    const selector = this._checkSelector(s);
    this.begin();
    try {
      return this._cached(this._cacheQuery, selector, [context.scope, context.pierceShadow, context.originalScope], () => {
        if (Array.isArray(selector))
          return this._queryEngine(isEngine, context, selector);
        if (this._hasScopeClause(selector))
          context = this._expandContextForScopeMatching(context);
        const previousScoreMap = this._scoreMap;
        this._scoreMap = /* @__PURE__ */ new Map();
        let elements = this._querySimple(context, selector.simples[selector.simples.length - 1].selector);
        elements = elements.filter((element) => this._matchesParents(element, selector, selector.simples.length - 2, context));
        if (this._scoreMap.size) {
          elements.sort((a, b) => {
            const aScore = this._scoreMap.get(a);
            const bScore = this._scoreMap.get(b);
            if (aScore === bScore)
              return 0;
            if (aScore === void 0)
              return 1;
            if (bScore === void 0)
              return -1;
            return aScore - bScore;
          });
        }
        this._scoreMap = previousScoreMap;
        return elements;
      });
    } finally {
      this.end();
    }
  }
  _markScore(element, score) {
    if (this._scoreMap)
      this._scoreMap.set(element, score);
  }
  _hasScopeClause(selector) {
    return selector.simples.some((simple) => simple.selector.functions.some((f) => f.name === "scope"));
  }
  _expandContextForScopeMatching(context) {
    if (context.scope.nodeType !== 1)
      return context;
    const scope = parentElementOrShadowHost(context.scope);
    if (!scope)
      return context;
    return { ...context, scope, originalScope: context.originalScope || context.scope };
  }
  _matchesSimple(element, simple, context) {
    return this._cached(this._cacheMatchesSimple, element, [simple, context.scope, context.pierceShadow, context.originalScope], () => {
      if (element === context.scope)
        return false;
      if (simple.css && !this._matchesCSS(element, simple.css))
        return false;
      for (const func of simple.functions) {
        if (!this._matchesEngine(this._getEngine(func.name), element, func.args, context))
          return false;
      }
      return true;
    });
  }
  _querySimple(context, simple) {
    if (!simple.functions.length)
      return this._queryCSS(context, simple.css || "*");
    return this._cached(this._cacheQuerySimple, simple, [context.scope, context.pierceShadow, context.originalScope], () => {
      let css = simple.css;
      const funcs = simple.functions;
      if (css === "*" && funcs.length)
        css = void 0;
      let elements;
      let firstIndex = -1;
      if (css !== void 0) {
        elements = this._queryCSS(context, css);
      } else {
        firstIndex = funcs.findIndex((func) => this._getEngine(func.name).query !== void 0);
        if (firstIndex === -1)
          firstIndex = 0;
        elements = this._queryEngine(this._getEngine(funcs[firstIndex].name), context, funcs[firstIndex].args);
      }
      for (let i = 0; i < funcs.length; i++) {
        if (i === firstIndex)
          continue;
        const engine = this._getEngine(funcs[i].name);
        if (engine.matches !== void 0)
          elements = elements.filter((e) => this._matchesEngine(engine, e, funcs[i].args, context));
      }
      for (let i = 0; i < funcs.length; i++) {
        if (i === firstIndex)
          continue;
        const engine = this._getEngine(funcs[i].name);
        if (engine.matches === void 0)
          elements = elements.filter((e) => this._matchesEngine(engine, e, funcs[i].args, context));
      }
      return elements;
    });
  }
  _matchesParents(element, complex, index, context) {
    if (index < 0)
      return true;
    return this._cached(this._cacheMatchesParents, element, [complex, index, context.scope, context.pierceShadow, context.originalScope], () => {
      const { selector: simple, combinator } = complex.simples[index];
      if (combinator === ">") {
        const parent = parentElementOrShadowHostInContext(element, context);
        if (!parent || !this._matchesSimple(parent, simple, context))
          return false;
        return this._matchesParents(parent, complex, index - 1, context);
      }
      if (combinator === "+") {
        const previousSibling = previousSiblingInContext(element, context);
        if (!previousSibling || !this._matchesSimple(previousSibling, simple, context))
          return false;
        return this._matchesParents(previousSibling, complex, index - 1, context);
      }
      if (combinator === "") {
        let parent = parentElementOrShadowHostInContext(element, context);
        while (parent) {
          if (this._matchesSimple(parent, simple, context)) {
            if (this._matchesParents(parent, complex, index - 1, context))
              return true;
            if (complex.simples[index - 1].combinator === "")
              break;
          }
          parent = parentElementOrShadowHostInContext(parent, context);
        }
        return false;
      }
      if (combinator === "~") {
        let previousSibling = previousSiblingInContext(element, context);
        while (previousSibling) {
          if (this._matchesSimple(previousSibling, simple, context)) {
            if (this._matchesParents(previousSibling, complex, index - 1, context))
              return true;
            if (complex.simples[index - 1].combinator === "~")
              break;
          }
          previousSibling = previousSiblingInContext(previousSibling, context);
        }
        return false;
      }
      if (combinator === ">=") {
        let parent = element;
        while (parent) {
          if (this._matchesSimple(parent, simple, context)) {
            if (this._matchesParents(parent, complex, index - 1, context))
              return true;
            if (complex.simples[index - 1].combinator === "")
              break;
          }
          parent = parentElementOrShadowHostInContext(parent, context);
        }
        return false;
      }
      throw new Error(\`Unsupported combinator "\${combinator}"\`);
    });
  }
  _matchesEngine(engine, element, args, context) {
    if (engine.matches)
      return this._callMatches(engine, element, args, context);
    if (engine.query)
      return this._callQuery(engine, args, context).includes(element);
    throw new Error(\`Selector engine should implement "matches" or "query"\`);
  }
  _queryEngine(engine, context, args) {
    if (engine.query)
      return this._callQuery(engine, args, context);
    if (engine.matches)
      return this._queryCSS(context, "*").filter((element) => this._callMatches(engine, element, args, context));
    throw new Error(\`Selector engine should implement "matches" or "query"\`);
  }
  _callMatches(engine, element, args, context) {
    return this._cached(this._cacheCallMatches, element, [engine, context.scope, context.pierceShadow, context.originalScope, ...args], () => {
      return engine.matches(element, args, context, this);
    });
  }
  _callQuery(engine, args, context) {
    return this._cached(this._cacheCallQuery, engine, [context.scope, context.pierceShadow, context.originalScope, ...args], () => {
      return engine.query(context, args, this);
    });
  }
  _matchesCSS(element, css) {
    return element.matches(css);
  }
  _queryCSS(context, css) {
    return this._cached(this._cacheQueryCSS, css, [context.scope, context.pierceShadow, context.originalScope], () => {
      let result = [];
      function query(root) {
        result = result.concat([...root.querySelectorAll(css)]);
        if (!context.pierceShadow)
          return;
        if (root.shadowRoot)
          query(root.shadowRoot);
        for (const element of root.querySelectorAll("*")) {
          if (element.shadowRoot)
            query(element.shadowRoot);
        }
      }
      query(context.scope);
      return result;
    });
  }
  _getEngine(name) {
    const engine = this._engines.get(name);
    if (!engine)
      throw new Error(\`Unknown selector engine "\${name}"\`);
    return engine;
  }
};
var isEngine = {
  matches(element, args, context, evaluator) {
    if (args.length === 0)
      throw new Error(\`"is" engine expects non-empty selector list\`);
    return args.some((selector) => evaluator.matches(element, selector, context));
  },
  query(context, args, evaluator) {
    if (args.length === 0)
      throw new Error(\`"is" engine expects non-empty selector list\`);
    let elements = [];
    for (const arg of args)
      elements = elements.concat(evaluator.query(context, arg));
    return args.length === 1 ? elements : sortInDOMOrder(elements);
  }
};
var hasEngine = {
  matches(element, args, context, evaluator) {
    if (args.length === 0)
      throw new Error(\`"has" engine expects non-empty selector list\`);
    return evaluator.query({ ...context, scope: element }, args).length > 0;
  }
  // TODO: we can implement efficient "query" by matching "args" and returning
  // all parents/descendants, just have to be careful with the ":scope" matching.
};
var scopeEngine = {
  matches(element, args, context, evaluator) {
    if (args.length !== 0)
      throw new Error(\`"scope" engine expects no arguments\`);
    const actualScope = context.originalScope || context.scope;
    if (actualScope.nodeType === 9)
      return element === actualScope.documentElement;
    return element === actualScope;
  },
  query(context, args, evaluator) {
    if (args.length !== 0)
      throw new Error(\`"scope" engine expects no arguments\`);
    const actualScope = context.originalScope || context.scope;
    if (actualScope.nodeType === 9) {
      const root = actualScope.documentElement;
      return root ? [root] : [];
    }
    if (actualScope.nodeType === 1)
      return [actualScope];
    return [];
  }
};
var notEngine = {
  matches(element, args, context, evaluator) {
    if (args.length === 0)
      throw new Error(\`"not" engine expects non-empty selector list\`);
    return !evaluator.matches(element, args, context);
  }
};
var lightEngine = {
  query(context, args, evaluator) {
    return evaluator.query({ ...context, pierceShadow: false }, args);
  },
  matches(element, args, context, evaluator) {
    return evaluator.matches(element, args, { ...context, pierceShadow: false });
  }
};
var visibleEngine = {
  matches(element, args, context, evaluator) {
    if (args.length)
      throw new Error(\`"visible" engine expects no arguments\`);
    return isElementVisible(element);
  }
};
var textEngine = {
  matches(element, args, context, evaluator) {
    if (args.length !== 1 || typeof args[0] !== "string")
      throw new Error(\`"text" engine expects a single string\`);
    const text = normalizeWhiteSpace(args[0]).toLowerCase();
    const matcher = (elementText2) => elementText2.normalized.toLowerCase().includes(text);
    return elementMatchesText(evaluator._cacheText, element, matcher) === "self";
  }
};
var textIsEngine = {
  matches(element, args, context, evaluator) {
    if (args.length !== 1 || typeof args[0] !== "string")
      throw new Error(\`"text-is" engine expects a single string\`);
    const text = normalizeWhiteSpace(args[0]);
    const matcher = (elementText2) => {
      if (!text && !elementText2.immediate.length)
        return true;
      return elementText2.immediate.some((s) => normalizeWhiteSpace(s) === text);
    };
    return elementMatchesText(evaluator._cacheText, element, matcher) !== "none";
  }
};
var textMatchesEngine = {
  matches(element, args, context, evaluator) {
    if (args.length === 0 || typeof args[0] !== "string" || args.length > 2 || args.length === 2 && typeof args[1] !== "string")
      throw new Error(\`"text-matches" engine expects a regexp body and optional regexp flags\`);
    const re = new RegExp(args[0], args.length === 2 ? args[1] : void 0);
    const matcher = (elementText2) => re.test(elementText2.full);
    return elementMatchesText(evaluator._cacheText, element, matcher) === "self";
  }
};
var hasTextEngine = {
  matches(element, args, context, evaluator) {
    if (args.length !== 1 || typeof args[0] !== "string")
      throw new Error(\`"has-text" engine expects a single string\`);
    if (shouldSkipForTextMatching(element))
      return false;
    const text = normalizeWhiteSpace(args[0]).toLowerCase();
    const matcher = (elementText2) => elementText2.normalized.toLowerCase().includes(text);
    return matcher(elementText(evaluator._cacheText, element));
  }
};
function createLayoutEngine(name) {
  return {
    matches(element, args, context, evaluator) {
      const maxDistance = args.length && typeof args[args.length - 1] === "number" ? args[args.length - 1] : void 0;
      const queryArgs = maxDistance === void 0 ? args : args.slice(0, args.length - 1);
      if (args.length < 1 + (maxDistance === void 0 ? 0 : 1))
        throw new Error(\`"\${name}" engine expects a selector list and optional maximum distance in pixels\`);
      const inner = evaluator.query(context, queryArgs);
      const score = layoutSelectorScore(name, element, inner, maxDistance);
      if (score === void 0)
        return false;
      evaluator._markScore(element, score);
      return true;
    }
  };
}
var nthMatchEngine = {
  query(context, args, evaluator) {
    let index = args[args.length - 1];
    if (args.length < 2)
      throw new Error(\`"nth-match" engine expects non-empty selector list and an index argument\`);
    if (typeof index !== "number" || index < 1)
      throw new Error(\`"nth-match" engine expects a one-based index as the last argument\`);
    const elements = isEngine.query(context, args.slice(0, args.length - 1), evaluator);
    index--;
    return index < elements.length ? [elements[index]] : [];
  }
};
function parentElementOrShadowHostInContext(element, context) {
  if (element === context.scope)
    return;
  if (!context.pierceShadow)
    return element.parentElement || void 0;
  return parentElementOrShadowHost(element);
}
function previousSiblingInContext(element, context) {
  if (element === context.scope)
    return;
  return element.previousElementSibling || void 0;
}
function sortInDOMOrder(elements) {
  const elementToEntry = /* @__PURE__ */ new Map();
  const roots = [];
  const result = [];
  function append(element) {
    let entry = elementToEntry.get(element);
    if (entry)
      return entry;
    const parent = parentElementOrShadowHost(element);
    if (parent) {
      const parentEntry = append(parent);
      parentEntry.children.push(element);
    } else {
      roots.push(element);
    }
    entry = { children: [], taken: false };
    elementToEntry.set(element, entry);
    return entry;
  }
  for (const e of elements)
    append(e).taken = true;
  function visit(element) {
    const entry = elementToEntry.get(element);
    if (entry.taken)
      result.push(element);
    if (entry.children.length > 1) {
      const set = new Set(entry.children);
      entry.children = [];
      let child = element.firstElementChild;
      while (child && entry.children.length < set.size) {
        if (set.has(child))
          entry.children.push(child);
        child = child.nextElementSibling;
      }
      child = element.shadowRoot ? element.shadowRoot.firstElementChild : null;
      while (child && entry.children.length < set.size) {
        if (set.has(child))
          entry.children.push(child);
        child = child.nextElementSibling;
      }
    }
    entry.children.forEach(visit);
  }
  roots.forEach(visit);
  return result;
}

// packages/playwright-core/src/server/injected/selectorGenerator.ts
var cacheAllowText = /* @__PURE__ */ new Map();
var cacheDisallowText = /* @__PURE__ */ new Map();
var kTextScoreRange = 10;
var kExactPenalty = kTextScoreRange / 2;
var kTestIdScore = 1;
var kOtherTestIdScore = 2;
var kIframeByAttributeScore = 10;
var kBeginPenalizedScore = 50;
var kPlaceholderScore = 100;
var kLabelScore = 120;
var kRoleWithNameScore = 140;
var kAltTextScore = 160;
var kTextScore = 180;
var kTitleScore = 200;
var kTextScoreRegex = 250;
var kPlaceholderScoreExact = kPlaceholderScore + kExactPenalty;
var kLabelScoreExact = kLabelScore + kExactPenalty;
var kRoleWithNameScoreExact = kRoleWithNameScore + kExactPenalty;
var kAltTextScoreExact = kAltTextScore + kExactPenalty;
var kTextScoreExact = kTextScore + kExactPenalty;
var kTitleScoreExact = kTitleScore + kExactPenalty;
var kEndPenalizedScore = 300;
var kCSSIdScore = 500;
var kRoleWithoutNameScore = 510;
var kCSSInputTypeNameScore = 520;
var kCSSTagNameScore = 530;
var kNthScore = 1e4;
var kCSSFallbackScore = 1e7;
var kScoreThresholdForTextExpect = 1e3;
function generateSelector(injectedScript, targetElement, options) {
  var _a;
  injectedScript._evaluator.begin();
  beginAriaCaches();
  try {
    let selectors = [];
    if (options.forTextExpect) {
      let targetTokens = cssFallback(injectedScript, targetElement.ownerDocument.documentElement, options);
      for (let element = targetElement; element; element = parentElementOrShadowHost(element)) {
        const tokens = generateSelectorFor(injectedScript, element, { ...options, noText: true });
        if (!tokens)
          continue;
        const score = combineScores(tokens);
        if (score <= kScoreThresholdForTextExpect) {
          targetTokens = tokens;
          break;
        }
      }
      selectors = [joinTokens(targetTokens)];
    } else {
      if (!targetElement.matches("input,textarea,select") && !targetElement.isContentEditable) {
        const interactiveParent = closestCrossShadow(targetElement, "button,select,input,[role=button],[role=checkbox],[role=radio],a,[role=link]", options.root);
        if (interactiveParent && isElementVisible(interactiveParent))
          targetElement = interactiveParent;
      }
      if (options.multiple) {
        const withText = generateSelectorFor(injectedScript, targetElement, options);
        const withoutText = generateSelectorFor(injectedScript, targetElement, { ...options, noText: true });
        let tokens = [withText, withoutText];
        cacheAllowText.clear();
        cacheDisallowText.clear();
        if (withText && hasCSSIdToken(withText))
          tokens.push(generateSelectorFor(injectedScript, targetElement, { ...options, noCSSId: true }));
        if (withoutText && hasCSSIdToken(withoutText))
          tokens.push(generateSelectorFor(injectedScript, targetElement, { ...options, noText: true, noCSSId: true }));
        tokens = tokens.filter(Boolean);
        if (!tokens.length) {
          const css = cssFallback(injectedScript, targetElement, options);
          tokens.push(css);
          if (hasCSSIdToken(css))
            tokens.push(cssFallback(injectedScript, targetElement, { ...options, noCSSId: true }));
        }
        selectors = [...new Set(tokens.map((t) => joinTokens(t)))];
      } else {
        const targetTokens = generateSelectorFor(injectedScript, targetElement, options) || cssFallback(injectedScript, targetElement, options);
        selectors = [joinTokens(targetTokens)];
      }
    }
    const selector = selectors[0];
    const parsedSelector = injectedScript.parseSelector(selector);
    return {
      selector,
      selectors,
      elements: injectedScript.querySelectorAll(parsedSelector, (_a = options.root) != null ? _a : targetElement.ownerDocument)
    };
  } finally {
    cacheAllowText.clear();
    cacheDisallowText.clear();
    endAriaCaches();
    injectedScript._evaluator.end();
  }
}
function filterRegexTokens(textCandidates) {
  return textCandidates.filter((c) => c[0].selector[0] !== "/");
}
function generateSelectorFor(injectedScript, targetElement, options) {
  if (options.root && !isInsideScope(options.root, targetElement))
    throw new Error(\`Target element must belong to the root's subtree\`);
  if (targetElement === options.root)
    return [{ engine: "css", selector: ":scope", score: 1 }];
  if (targetElement.ownerDocument.documentElement === targetElement)
    return [{ engine: "css", selector: "html", score: 1 }];
  const calculate = (element, allowText) => {
    var _a;
    const allowNthMatch = element === targetElement;
    let textCandidates = allowText ? buildTextCandidates(injectedScript, element, element === targetElement) : [];
    if (element !== targetElement) {
      textCandidates = filterRegexTokens(textCandidates);
    }
    const noTextCandidates = buildNoTextCandidates(injectedScript, element, options).filter((token) => !options.omitInternalEngines || !token.engine.startsWith("internal:")).map((token) => [token]);
    let result = chooseFirstSelector(injectedScript, (_a = options.root) != null ? _a : targetElement.ownerDocument, element, [...textCandidates, ...noTextCandidates], allowNthMatch);
    textCandidates = filterRegexTokens(textCandidates);
    const checkWithText = (textCandidatesToUse) => {
      const allowParentText = allowText && !textCandidatesToUse.length;
      const candidates = [...textCandidatesToUse, ...noTextCandidates].filter((c) => {
        if (!result)
          return true;
        return combineScores(c) < combineScores(result);
      });
      let bestPossibleInParent = candidates[0];
      if (!bestPossibleInParent)
        return;
      for (let parent = parentElementOrShadowHost(element); parent && parent !== options.root; parent = parentElementOrShadowHost(parent)) {
        const parentTokens = calculateCached(parent, allowParentText);
        if (!parentTokens)
          continue;
        if (result && combineScores([...parentTokens, ...bestPossibleInParent]) >= combineScores(result))
          continue;
        bestPossibleInParent = chooseFirstSelector(injectedScript, parent, element, candidates, allowNthMatch);
        if (!bestPossibleInParent)
          return;
        const combined = [...parentTokens, ...bestPossibleInParent];
        if (!result || combineScores(combined) < combineScores(result))
          result = combined;
      }
    };
    checkWithText(textCandidates);
    if (element === targetElement && textCandidates.length)
      checkWithText([]);
    return result;
  };
  const calculateCached = (element, allowText) => {
    const cache = allowText ? cacheAllowText : cacheDisallowText;
    let value = cache.get(element);
    if (value === void 0) {
      value = calculate(element, allowText);
      cache.set(element, value);
    }
    return value;
  };
  return calculate(targetElement, !options.noText);
}
function buildNoTextCandidates(injectedScript, element, options) {
  const candidates = [];
  {
    for (const attr of ["data-testid", "data-test-id", "data-test"]) {
      if (attr !== options.testIdAttributeName && element.getAttribute(attr))
        candidates.push({ engine: "css", selector: \`[\${attr}=\${quoteCSSAttributeValue(element.getAttribute(attr))}]\`, score: kOtherTestIdScore });
    }
    if (!options.noCSSId) {
      const idAttr = element.getAttribute("id");
      if (idAttr && !isGuidLike(idAttr))
        candidates.push({ engine: "css", selector: makeSelectorForId(idAttr), score: kCSSIdScore });
    }
    candidates.push({ engine: "css", selector: cssEscape(element.nodeName.toLowerCase()), score: kCSSTagNameScore });
  }
  if (element.nodeName === "IFRAME") {
    for (const attribute of ["name", "title"]) {
      if (element.getAttribute(attribute))
        candidates.push({ engine: "css", selector: \`\${cssEscape(element.nodeName.toLowerCase())}[\${attribute}=\${quoteCSSAttributeValue(element.getAttribute(attribute))}]\`, score: kIframeByAttributeScore });
    }
    if (element.getAttribute(options.testIdAttributeName))
      candidates.push({ engine: "css", selector: \`[\${options.testIdAttributeName}=\${quoteCSSAttributeValue(element.getAttribute(options.testIdAttributeName))}]\`, score: kTestIdScore });
    penalizeScoreForLength([candidates]);
    return candidates;
  }
  if (element.getAttribute(options.testIdAttributeName))
    candidates.push({ engine: "internal:testid", selector: \`[\${options.testIdAttributeName}=\${escapeForAttributeSelector(element.getAttribute(options.testIdAttributeName), true)}]\`, score: kTestIdScore });
  if (element.nodeName === "INPUT" || element.nodeName === "TEXTAREA") {
    const input = element;
    if (input.placeholder) {
      candidates.push({ engine: "internal:attr", selector: \`[placeholder=\${escapeForAttributeSelector(input.placeholder, true)}]\`, score: kPlaceholderScoreExact });
      for (const alternative of suitableTextAlternatives(input.placeholder))
        candidates.push({ engine: "internal:attr", selector: \`[placeholder=\${escapeForAttributeSelector(alternative.text, false)}]\`, score: kPlaceholderScore - alternative.scoreBouns });
    }
  }
  const labels = getElementLabels(injectedScript._evaluator._cacheText, element);
  for (const label of labels) {
    const labelText = label.normalized;
    candidates.push({ engine: "internal:label", selector: escapeForTextSelector(labelText, true), score: kLabelScoreExact });
    for (const alternative of suitableTextAlternatives(labelText))
      candidates.push({ engine: "internal:label", selector: escapeForTextSelector(alternative.text, false), score: kLabelScore - alternative.scoreBouns });
  }
  const ariaRole = getAriaRole(element);
  if (ariaRole && !["none", "presentation"].includes(ariaRole))
    candidates.push({ engine: "internal:role", selector: ariaRole, score: kRoleWithoutNameScore });
  if (element.getAttribute("name") && ["BUTTON", "FORM", "FIELDSET", "FRAME", "IFRAME", "INPUT", "KEYGEN", "OBJECT", "OUTPUT", "SELECT", "TEXTAREA", "MAP", "META", "PARAM"].includes(element.nodeName))
    candidates.push({ engine: "css", selector: \`\${cssEscape(element.nodeName.toLowerCase())}[name=\${quoteCSSAttributeValue(element.getAttribute("name"))}]\`, score: kCSSInputTypeNameScore });
  if (["INPUT", "TEXTAREA"].includes(element.nodeName) && element.getAttribute("type") !== "hidden") {
    if (element.getAttribute("type"))
      candidates.push({ engine: "css", selector: \`\${cssEscape(element.nodeName.toLowerCase())}[type=\${quoteCSSAttributeValue(element.getAttribute("type"))}]\`, score: kCSSInputTypeNameScore });
  }
  if (["INPUT", "TEXTAREA", "SELECT"].includes(element.nodeName) && element.getAttribute("type") !== "hidden")
    candidates.push({ engine: "css", selector: cssEscape(element.nodeName.toLowerCase()), score: kCSSInputTypeNameScore + 1 });
  penalizeScoreForLength([candidates]);
  return candidates;
}
function buildTextCandidates(injectedScript, element, isTargetNode) {
  if (element.nodeName === "SELECT")
    return [];
  const candidates = [];
  const title = element.getAttribute("title");
  if (title) {
    candidates.push([{ engine: "internal:attr", selector: \`[title=\${escapeForAttributeSelector(title, true)}]\`, score: kTitleScoreExact }]);
    for (const alternative of suitableTextAlternatives(title))
      candidates.push([{ engine: "internal:attr", selector: \`[title=\${escapeForAttributeSelector(alternative.text, false)}]\`, score: kTitleScore - alternative.scoreBouns }]);
  }
  const alt = element.getAttribute("alt");
  if (alt && ["APPLET", "AREA", "IMG", "INPUT"].includes(element.nodeName)) {
    candidates.push([{ engine: "internal:attr", selector: \`[alt=\${escapeForAttributeSelector(alt, true)}]\`, score: kAltTextScoreExact }]);
    for (const alternative of suitableTextAlternatives(alt))
      candidates.push([{ engine: "internal:attr", selector: \`[alt=\${escapeForAttributeSelector(alternative.text, false)}]\`, score: kAltTextScore - alternative.scoreBouns }]);
  }
  const text = elementText(injectedScript._evaluator._cacheText, element).normalized;
  if (text) {
    const alternatives = suitableTextAlternatives(text);
    if (isTargetNode) {
      if (text.length <= 80)
        candidates.push([{ engine: "internal:text", selector: escapeForTextSelector(text, true), score: kTextScoreExact }]);
      for (const alternative of alternatives)
        candidates.push([{ engine: "internal:text", selector: escapeForTextSelector(alternative.text, false), score: kTextScore - alternative.scoreBouns }]);
    }
    const cssToken = { engine: "css", selector: cssEscape(element.nodeName.toLowerCase()), score: kCSSTagNameScore };
    for (const alternative of alternatives)
      candidates.push([cssToken, { engine: "internal:has-text", selector: escapeForTextSelector(alternative.text, false), score: kTextScore - alternative.scoreBouns }]);
    if (text.length <= 80) {
      const re = new RegExp("^" + escapeRegExp(text) + "$");
      candidates.push([cssToken, { engine: "internal:has-text", selector: escapeForTextSelector(re, false), score: kTextScoreRegex }]);
    }
  }
  const ariaRole = getAriaRole(element);
  if (ariaRole && !["none", "presentation"].includes(ariaRole)) {
    const ariaName = getElementAccessibleName(element, false);
    if (ariaName) {
      candidates.push([{ engine: "internal:role", selector: \`\${ariaRole}[name=\${escapeForAttributeSelector(ariaName, true)}]\`, score: kRoleWithNameScoreExact }]);
      for (const alternative of suitableTextAlternatives(ariaName))
        candidates.push([{ engine: "internal:role", selector: \`\${ariaRole}[name=\${escapeForAttributeSelector(alternative.text, false)}]\`, score: kRoleWithNameScore - alternative.scoreBouns }]);
    }
  }
  penalizeScoreForLength(candidates);
  return candidates;
}
function makeSelectorForId(id) {
  return /^[a-zA-Z][a-zA-Z0-9\\-\\_]+$/.test(id) ? "#" + id : \`[id="\${cssEscape(id)}"]\`;
}
function hasCSSIdToken(tokens) {
  return tokens.some((token) => token.engine === "css" && (token.selector.startsWith("#") || token.selector.startsWith('[id="')));
}
function cssFallback(injectedScript, targetElement, options) {
  var _a;
  const root = (_a = options.root) != null ? _a : targetElement.ownerDocument;
  const tokens = [];
  function uniqueCSSSelector(prefix) {
    const path = tokens.slice();
    if (prefix)
      path.unshift(prefix);
    const selector = path.join(" > ");
    const parsedSelector = injectedScript.parseSelector(selector);
    const node = injectedScript.querySelector(parsedSelector, root, false);
    return node === targetElement ? selector : void 0;
  }
  function makeStrict(selector) {
    const token = { engine: "css", selector, score: kCSSFallbackScore };
    const parsedSelector = injectedScript.parseSelector(selector);
    const elements = injectedScript.querySelectorAll(parsedSelector, root);
    if (elements.length === 1)
      return [token];
    const nth = { engine: "nth", selector: String(elements.indexOf(targetElement)), score: kNthScore };
    return [token, nth];
  }
  for (let element = targetElement; element && element !== root; element = parentElementOrShadowHost(element)) {
    const nodeName = element.nodeName.toLowerCase();
    let bestTokenForLevel = "";
    if (element.id && !options.noCSSId) {
      const token = makeSelectorForId(element.id);
      const selector = uniqueCSSSelector(token);
      if (selector)
        return makeStrict(selector);
      bestTokenForLevel = token;
    }
    const parent = element.parentNode;
    const classes = [...element.classList];
    for (let i = 0; i < classes.length; ++i) {
      const token = "." + cssEscape(classes.slice(0, i + 1).join("."));
      const selector = uniqueCSSSelector(token);
      if (selector)
        return makeStrict(selector);
      if (!bestTokenForLevel && parent) {
        const sameClassSiblings = parent.querySelectorAll(token);
        if (sameClassSiblings.length === 1)
          bestTokenForLevel = token;
      }
    }
    if (parent) {
      const siblings = [...parent.children];
      const sameTagSiblings = siblings.filter((sibling) => sibling.nodeName.toLowerCase() === nodeName);
      const token = sameTagSiblings.indexOf(element) === 0 ? cssEscape(nodeName) : \`\${cssEscape(nodeName)}:nth-child(\${1 + siblings.indexOf(element)})\`;
      const selector = uniqueCSSSelector(token);
      if (selector)
        return makeStrict(selector);
      if (!bestTokenForLevel)
        bestTokenForLevel = token;
    } else if (!bestTokenForLevel) {
      bestTokenForLevel = cssEscape(nodeName);
    }
    tokens.unshift(bestTokenForLevel);
  }
  return makeStrict(uniqueCSSSelector());
}
function penalizeScoreForLength(groups) {
  for (const group of groups) {
    for (const token of group) {
      if (token.score > kBeginPenalizedScore && token.score < kEndPenalizedScore)
        token.score += Math.min(kTextScoreRange, token.selector.length / 10 | 0);
    }
  }
}
function joinTokens(tokens) {
  const parts = [];
  let lastEngine = "";
  for (const { engine, selector } of tokens) {
    if (parts.length && (lastEngine !== "css" || engine !== "css" || selector.startsWith(":nth-match(")))
      parts.push(">>");
    lastEngine = engine;
    if (engine === "css")
      parts.push(selector);
    else
      parts.push(\`\${engine}=\${selector}\`);
  }
  return parts.join(" ");
}
function combineScores(tokens) {
  let score = 0;
  for (let i = 0; i < tokens.length; i++)
    score += tokens[i].score * (tokens.length - i);
  return score;
}
function chooseFirstSelector(injectedScript, scope, targetElement, selectors, allowNthMatch) {
  const joined = selectors.map((tokens) => ({ tokens, score: combineScores(tokens) }));
  joined.sort((a, b) => a.score - b.score);
  let bestWithIndex = null;
  for (const { tokens } of joined) {
    const parsedSelector = injectedScript.parseSelector(joinTokens(tokens));
    const result = injectedScript.querySelectorAll(parsedSelector, scope);
    if (result[0] === targetElement && result.length === 1) {
      return tokens;
    }
    const index = result.indexOf(targetElement);
    if (!allowNthMatch || bestWithIndex || index === -1 || result.length > 5)
      continue;
    const nth = { engine: "nth", selector: String(index), score: kNthScore };
    bestWithIndex = [...tokens, nth];
  }
  return bestWithIndex;
}
function isGuidLike(id) {
  let lastCharacterType;
  let transitionCount = 0;
  for (let i = 0; i < id.length; ++i) {
    const c = id[i];
    let characterType;
    if (c === "-" || c === "_")
      continue;
    if (c >= "a" && c <= "z")
      characterType = "lower";
    else if (c >= "A" && c <= "Z")
      characterType = "upper";
    else if (c >= "0" && c <= "9")
      characterType = "digit";
    else
      characterType = "other";
    if (characterType === "lower" && lastCharacterType === "upper") {
      lastCharacterType = characterType;
      continue;
    }
    if (lastCharacterType && lastCharacterType !== characterType)
      ++transitionCount;
    lastCharacterType = characterType;
  }
  return transitionCount >= id.length / 4;
}
function trimWordBoundary(text, maxLength) {
  if (text.length <= maxLength)
    return text;
  text = text.substring(0, maxLength);
  const match = text.match(/^(.*)\\b(.+?)$/);
  if (!match)
    return "";
  return match[1].trimEnd();
}
function suitableTextAlternatives(text) {
  let result = [];
  {
    const match = text.match(/^([\\d.,]+)[^.,\\w]/);
    const leadingNumberLength = match ? match[1].length : 0;
    if (leadingNumberLength) {
      const alt = trimWordBoundary(text.substring(leadingNumberLength).trimStart(), 80);
      result.push({ text: alt, scoreBouns: alt.length <= 30 ? 2 : 1 });
    }
  }
  {
    const match = text.match(/[^.,\\w]([\\d.,]+)$/);
    const trailingNumberLength = match ? match[1].length : 0;
    if (trailingNumberLength) {
      const alt = trimWordBoundary(text.substring(0, text.length - trailingNumberLength).trimEnd(), 80);
      result.push({ text: alt, scoreBouns: alt.length <= 30 ? 2 : 1 });
    }
  }
  if (text.length <= 30) {
    result.push({ text, scoreBouns: 0 });
  } else {
    result.push({ text: trimWordBoundary(text, 80), scoreBouns: 0 });
    result.push({ text: trimWordBoundary(text, 30), scoreBouns: 1 });
  }
  result = result.filter((r) => r.text);
  if (!result.length)
    result.push({ text: text.substring(0, 80), scoreBouns: 0 });
  return result;
}

// packages/playwright-core/src/utils/isomorphic/locatorGenerators.ts
function asLocator(lang, selector, isFrameLocator = false) {
  return asLocators(lang, selector, isFrameLocator)[0];
}
function asLocators(lang, selector, isFrameLocator = false, maxOutputSize = 20, preferredQuote) {
  try {
    return innerAsLocators(new generators[lang](preferredQuote), parseSelector(selector), isFrameLocator, maxOutputSize);
  } catch (e) {
    return [selector];
  }
}
function innerAsLocators(factory, parsed, isFrameLocator = false, maxOutputSize = 20) {
  const parts = [...parsed.parts];
  for (let index = 0; index < parts.length - 1; index++) {
    if (parts[index].name === "nth" && parts[index + 1].name === "internal:control" && parts[index + 1].body === "enter-frame") {
      const [nth] = parts.splice(index, 1);
      parts.splice(index + 1, 0, nth);
    }
  }
  const tokens = [];
  let nextBase = isFrameLocator ? "frame-locator" : "page";
  for (let index = 0; index < parts.length; index++) {
    const part = parts[index];
    const base = nextBase;
    nextBase = "locator";
    if (part.name === "nth") {
      if (part.body === "0")
        tokens.push([factory.generateLocator(base, "first", ""), factory.generateLocator(base, "nth", "0")]);
      else if (part.body === "-1")
        tokens.push([factory.generateLocator(base, "last", ""), factory.generateLocator(base, "nth", "-1")]);
      else
        tokens.push([factory.generateLocator(base, "nth", part.body)]);
      continue;
    }
    if (part.name === "internal:text") {
      const { exact, text } = detectExact(part.body);
      tokens.push([factory.generateLocator(base, "text", text, { exact })]);
      continue;
    }
    if (part.name === "internal:has-text") {
      const { exact, text } = detectExact(part.body);
      if (!exact) {
        tokens.push([factory.generateLocator(base, "has-text", text, { exact })]);
        continue;
      }
    }
    if (part.name === "internal:has-not-text") {
      const { exact, text } = detectExact(part.body);
      if (!exact) {
        tokens.push([factory.generateLocator(base, "has-not-text", text, { exact })]);
        continue;
      }
    }
    if (part.name === "internal:has") {
      const inners = innerAsLocators(factory, part.body.parsed, false, maxOutputSize);
      tokens.push(inners.map((inner) => factory.generateLocator(base, "has", inner)));
      continue;
    }
    if (part.name === "internal:has-not") {
      const inners = innerAsLocators(factory, part.body.parsed, false, maxOutputSize);
      tokens.push(inners.map((inner) => factory.generateLocator(base, "hasNot", inner)));
      continue;
    }
    if (part.name === "internal:and") {
      const inners = innerAsLocators(factory, part.body.parsed, false, maxOutputSize);
      tokens.push(inners.map((inner) => factory.generateLocator(base, "and", inner)));
      continue;
    }
    if (part.name === "internal:or") {
      const inners = innerAsLocators(factory, part.body.parsed, false, maxOutputSize);
      tokens.push(inners.map((inner) => factory.generateLocator(base, "or", inner)));
      continue;
    }
    if (part.name === "internal:chain") {
      const inners = innerAsLocators(factory, part.body.parsed, false, maxOutputSize);
      tokens.push(inners.map((inner) => factory.generateLocator(base, "chain", inner)));
      continue;
    }
    if (part.name === "internal:label") {
      const { exact, text } = detectExact(part.body);
      tokens.push([factory.generateLocator(base, "label", text, { exact })]);
      continue;
    }
    if (part.name === "internal:role") {
      const attrSelector = parseAttributeSelector(part.body, true);
      const options = { attrs: [] };
      for (const attr of attrSelector.attributes) {
        if (attr.name === "name") {
          options.exact = attr.caseSensitive;
          options.name = attr.value;
        } else {
          if (attr.name === "level" && typeof attr.value === "string")
            attr.value = +attr.value;
          options.attrs.push({ name: attr.name === "include-hidden" ? "includeHidden" : attr.name, value: attr.value });
        }
      }
      tokens.push([factory.generateLocator(base, "role", attrSelector.name, options)]);
      continue;
    }
    if (part.name === "internal:testid") {
      const attrSelector = parseAttributeSelector(part.body, true);
      const { value } = attrSelector.attributes[0];
      tokens.push([factory.generateLocator(base, "test-id", value)]);
      continue;
    }
    if (part.name === "internal:attr") {
      const attrSelector = parseAttributeSelector(part.body, true);
      const { name, value, caseSensitive } = attrSelector.attributes[0];
      const text = value;
      const exact = !!caseSensitive;
      if (name === "placeholder") {
        tokens.push([factory.generateLocator(base, "placeholder", text, { exact })]);
        continue;
      }
      if (name === "alt") {
        tokens.push([factory.generateLocator(base, "alt", text, { exact })]);
        continue;
      }
      if (name === "title") {
        tokens.push([factory.generateLocator(base, "title", text, { exact })]);
        continue;
      }
    }
    let locatorType = "default";
    const nextPart = parts[index + 1];
    if (nextPart && nextPart.name === "internal:control" && nextPart.body === "enter-frame") {
      locatorType = "frame";
      nextBase = "frame-locator";
      index++;
    }
    const selectorPart = stringifySelector({ parts: [part] });
    const locatorPart = factory.generateLocator(base, locatorType, selectorPart);
    if (locatorType === "default" && nextPart && ["internal:has-text", "internal:has-not-text"].includes(nextPart.name)) {
      const { exact, text } = detectExact(nextPart.body);
      if (!exact) {
        const nextLocatorPart = factory.generateLocator("locator", nextPart.name === "internal:has-text" ? "has-text" : "has-not-text", text, { exact });
        const options = {};
        if (nextPart.name === "internal:has-text")
          options.hasText = text;
        else
          options.hasNotText = text;
        const combinedPart = factory.generateLocator(base, "default", selectorPart, options);
        tokens.push([factory.chainLocators([locatorPart, nextLocatorPart]), combinedPart]);
        index++;
        continue;
      }
    }
    let locatorPartWithEngine;
    if (["xpath", "css"].includes(part.name)) {
      const selectorPart2 = stringifySelector(
        { parts: [part] },
        /* forceEngineName */
        true
      );
      locatorPartWithEngine = factory.generateLocator(base, locatorType, selectorPart2);
    }
    tokens.push([locatorPart, locatorPartWithEngine].filter(Boolean));
  }
  return combineTokens(factory, tokens, maxOutputSize);
}
function combineTokens(factory, tokens, maxOutputSize) {
  const currentTokens = tokens.map(() => "");
  const result = [];
  const visit = (index) => {
    if (index === tokens.length) {
      result.push(factory.chainLocators(currentTokens));
      return currentTokens.length < maxOutputSize;
    }
    for (const taken of tokens[index]) {
      currentTokens[index] = taken;
      if (!visit(index + 1))
        return false;
    }
    return true;
  };
  visit(0);
  return result;
}
function detectExact(text) {
  let exact = false;
  const match = text.match(/^\\/(.*)\\/([igm]*)$/);
  if (match)
    return { text: new RegExp(match[1], match[2]) };
  if (text.endsWith('"')) {
    text = JSON.parse(text);
    exact = true;
  } else if (text.endsWith('"s')) {
    text = JSON.parse(text.substring(0, text.length - 1));
    exact = true;
  } else if (text.endsWith('"i')) {
    text = JSON.parse(text.substring(0, text.length - 1));
    exact = false;
  }
  return { exact, text };
}
var JavaScriptLocatorFactory = class {
  constructor(preferredQuote) {
    this.preferredQuote = preferredQuote;
  }
  generateLocator(base, kind, body, options = {}) {
    switch (kind) {
      case "default":
        if (options.hasText !== void 0)
          return \`locator(\${this.quote(body)}, { hasText: \${this.toHasText(options.hasText)} })\`;
        if (options.hasNotText !== void 0)
          return \`locator(\${this.quote(body)}, { hasNotText: \${this.toHasText(options.hasNotText)} })\`;
        return \`locator(\${this.quote(body)})\`;
      case "frame":
        return \`frameLocator(\${this.quote(body)})\`;
      case "nth":
        return \`nth(\${body})\`;
      case "first":
        return \`first()\`;
      case "last":
        return \`last()\`;
      case "role":
        const attrs = [];
        if (isRegExp(options.name)) {
          attrs.push(\`name: \${this.regexToSourceString(options.name)}\`);
        } else if (typeof options.name === "string") {
          attrs.push(\`name: \${this.quote(options.name)}\`);
          if (options.exact)
            attrs.push(\`exact: true\`);
        }
        for (const { name, value } of options.attrs)
          attrs.push(\`\${name}: \${typeof value === "string" ? this.quote(value) : value}\`);
        const attrString = attrs.length ? \`, { \${attrs.join(", ")} }\` : "";
        return \`getByRole(\${this.quote(body)}\${attrString})\`;
      case "has-text":
        return \`filter({ hasText: \${this.toHasText(body)} })\`;
      case "has-not-text":
        return \`filter({ hasNotText: \${this.toHasText(body)} })\`;
      case "has":
        return \`filter({ has: \${body} })\`;
      case "hasNot":
        return \`filter({ hasNot: \${body} })\`;
      case "and":
        return \`and(\${body})\`;
      case "or":
        return \`or(\${body})\`;
      case "chain":
        return \`locator(\${body})\`;
      case "test-id":
        return \`getByTestId(\${this.toTestIdValue(body)})\`;
      case "text":
        return this.toCallWithExact("getByText", body, !!options.exact);
      case "alt":
        return this.toCallWithExact("getByAltText", body, !!options.exact);
      case "placeholder":
        return this.toCallWithExact("getByPlaceholder", body, !!options.exact);
      case "label":
        return this.toCallWithExact("getByLabel", body, !!options.exact);
      case "title":
        return this.toCallWithExact("getByTitle", body, !!options.exact);
      default:
        throw new Error("Unknown selector kind " + kind);
    }
  }
  chainLocators(locators) {
    return locators.join(".");
  }
  regexToSourceString(re) {
    return normalizeEscapedRegexQuotes(String(re));
  }
  toCallWithExact(method, body, exact) {
    if (isRegExp(body))
      return \`\${method}(\${this.regexToSourceString(body)})\`;
    return exact ? \`\${method}(\${this.quote(body)}, { exact: true })\` : \`\${method}(\${this.quote(body)})\`;
  }
  toHasText(body) {
    if (isRegExp(body))
      return this.regexToSourceString(body);
    return this.quote(body);
  }
  toTestIdValue(value) {
    if (isRegExp(value))
      return this.regexToSourceString(value);
    return this.quote(value);
  }
  quote(text) {
    var _a;
    return escapeWithQuotes(text, (_a = this.preferredQuote) != null ? _a : "'");
  }
};
var PythonLocatorFactory = class {
  generateLocator(base, kind, body, options = {}) {
    switch (kind) {
      case "default":
        if (options.hasText !== void 0)
          return \`locator(\${this.quote(body)}, has_text=\${this.toHasText(options.hasText)})\`;
        if (options.hasNotText !== void 0)
          return \`locator(\${this.quote(body)}, has_not_text=\${this.toHasText(options.hasNotText)})\`;
        return \`locator(\${this.quote(body)})\`;
      case "frame":
        return \`frame_locator(\${this.quote(body)})\`;
      case "nth":
        return \`nth(\${body})\`;
      case "first":
        return \`first\`;
      case "last":
        return \`last\`;
      case "role":
        const attrs = [];
        if (isRegExp(options.name)) {
          attrs.push(\`name=\${this.regexToString(options.name)}\`);
        } else if (typeof options.name === "string") {
          attrs.push(\`name=\${this.quote(options.name)}\`);
          if (options.exact)
            attrs.push(\`exact=True\`);
        }
        for (const { name, value } of options.attrs) {
          let valueString = typeof value === "string" ? this.quote(value) : value;
          if (typeof value === "boolean")
            valueString = value ? "True" : "False";
          attrs.push(\`\${toSnakeCase(name)}=\${valueString}\`);
        }
        const attrString = attrs.length ? \`, \${attrs.join(", ")}\` : "";
        return \`get_by_role(\${this.quote(body)}\${attrString})\`;
      case "has-text":
        return \`filter(has_text=\${this.toHasText(body)})\`;
      case "has-not-text":
        return \`filter(has_not_text=\${this.toHasText(body)})\`;
      case "has":
        return \`filter(has=\${body})\`;
      case "hasNot":
        return \`filter(has_not=\${body})\`;
      case "and":
        return \`and_(\${body})\`;
      case "or":
        return \`or_(\${body})\`;
      case "chain":
        return \`locator(\${body})\`;
      case "test-id":
        return \`get_by_test_id(\${this.toTestIdValue(body)})\`;
      case "text":
        return this.toCallWithExact("get_by_text", body, !!options.exact);
      case "alt":
        return this.toCallWithExact("get_by_alt_text", body, !!options.exact);
      case "placeholder":
        return this.toCallWithExact("get_by_placeholder", body, !!options.exact);
      case "label":
        return this.toCallWithExact("get_by_label", body, !!options.exact);
      case "title":
        return this.toCallWithExact("get_by_title", body, !!options.exact);
      default:
        throw new Error("Unknown selector kind " + kind);
    }
  }
  chainLocators(locators) {
    return locators.join(".");
  }
  regexToString(body) {
    const suffix = body.flags.includes("i") ? ", re.IGNORECASE" : "";
    return \`re.compile(r"\${normalizeEscapedRegexQuotes(body.source).replace(/\\\\\\//, "/").replace(/"/g, '\\\\"')}"\${suffix})\`;
  }
  toCallWithExact(method, body, exact) {
    if (isRegExp(body))
      return \`\${method}(\${this.regexToString(body)})\`;
    if (exact)
      return \`\${method}(\${this.quote(body)}, exact=True)\`;
    return \`\${method}(\${this.quote(body)})\`;
  }
  toHasText(body) {
    if (isRegExp(body))
      return this.regexToString(body);
    return \`\${this.quote(body)}\`;
  }
  toTestIdValue(value) {
    if (isRegExp(value))
      return this.regexToString(value);
    return this.quote(value);
  }
  quote(text) {
    return escapeWithQuotes(text, '"');
  }
};
var JavaLocatorFactory = class {
  generateLocator(base, kind, body, options = {}) {
    let clazz;
    switch (base) {
      case "page":
        clazz = "Page";
        break;
      case "frame-locator":
        clazz = "FrameLocator";
        break;
      case "locator":
        clazz = "Locator";
        break;
    }
    switch (kind) {
      case "default":
        if (options.hasText !== void 0)
          return \`locator(\${this.quote(body)}, new \${clazz}.LocatorOptions().setHasText(\${this.toHasText(options.hasText)}))\`;
        if (options.hasNotText !== void 0)
          return \`locator(\${this.quote(body)}, new \${clazz}.LocatorOptions().setHasNotText(\${this.toHasText(options.hasNotText)}))\`;
        return \`locator(\${this.quote(body)})\`;
      case "frame":
        return \`frameLocator(\${this.quote(body)})\`;
      case "nth":
        return \`nth(\${body})\`;
      case "first":
        return \`first()\`;
      case "last":
        return \`last()\`;
      case "role":
        const attrs = [];
        if (isRegExp(options.name)) {
          attrs.push(\`.setName(\${this.regexToString(options.name)})\`);
        } else if (typeof options.name === "string") {
          attrs.push(\`.setName(\${this.quote(options.name)})\`);
          if (options.exact)
            attrs.push(\`.setExact(true)\`);
        }
        for (const { name, value } of options.attrs)
          attrs.push(\`.set\${toTitleCase(name)}(\${typeof value === "string" ? this.quote(value) : value})\`);
        const attrString = attrs.length ? \`, new \${clazz}.GetByRoleOptions()\${attrs.join("")}\` : "";
        return \`getByRole(AriaRole.\${toSnakeCase(body).toUpperCase()}\${attrString})\`;
      case "has-text":
        return \`filter(new \${clazz}.FilterOptions().setHasText(\${this.toHasText(body)}))\`;
      case "has-not-text":
        return \`filter(new \${clazz}.FilterOptions().setHasNotText(\${this.toHasText(body)}))\`;
      case "has":
        return \`filter(new \${clazz}.FilterOptions().setHas(\${body}))\`;
      case "hasNot":
        return \`filter(new \${clazz}.FilterOptions().setHasNot(\${body}))\`;
      case "and":
        return \`and(\${body})\`;
      case "or":
        return \`or(\${body})\`;
      case "chain":
        return \`locator(\${body})\`;
      case "test-id":
        return \`getByTestId(\${this.toTestIdValue(body)})\`;
      case "text":
        return this.toCallWithExact(clazz, "getByText", body, !!options.exact);
      case "alt":
        return this.toCallWithExact(clazz, "getByAltText", body, !!options.exact);
      case "placeholder":
        return this.toCallWithExact(clazz, "getByPlaceholder", body, !!options.exact);
      case "label":
        return this.toCallWithExact(clazz, "getByLabel", body, !!options.exact);
      case "title":
        return this.toCallWithExact(clazz, "getByTitle", body, !!options.exact);
      default:
        throw new Error("Unknown selector kind " + kind);
    }
  }
  chainLocators(locators) {
    return locators.join(".");
  }
  regexToString(body) {
    const suffix = body.flags.includes("i") ? ", Pattern.CASE_INSENSITIVE" : "";
    return \`Pattern.compile(\${this.quote(normalizeEscapedRegexQuotes(body.source))}\${suffix})\`;
  }
  toCallWithExact(clazz, method, body, exact) {
    if (isRegExp(body))
      return \`\${method}(\${this.regexToString(body)})\`;
    if (exact)
      return \`\${method}(\${this.quote(body)}, new \${clazz}.\${toTitleCase(method)}Options().setExact(true))\`;
    return \`\${method}(\${this.quote(body)})\`;
  }
  toHasText(body) {
    if (isRegExp(body))
      return this.regexToString(body);
    return this.quote(body);
  }
  toTestIdValue(value) {
    if (isRegExp(value))
      return this.regexToString(value);
    return this.quote(value);
  }
  quote(text) {
    return escapeWithQuotes(text, '"');
  }
};
var CSharpLocatorFactory = class {
  generateLocator(base, kind, body, options = {}) {
    switch (kind) {
      case "default":
        if (options.hasText !== void 0)
          return \`Locator(\${this.quote(body)}, new() { \${this.toHasText(options.hasText)} })\`;
        if (options.hasNotText !== void 0)
          return \`Locator(\${this.quote(body)}, new() { \${this.toHasNotText(options.hasNotText)} })\`;
        return \`Locator(\${this.quote(body)})\`;
      case "frame":
        return \`FrameLocator(\${this.quote(body)})\`;
      case "nth":
        return \`Nth(\${body})\`;
      case "first":
        return \`First\`;
      case "last":
        return \`Last\`;
      case "role":
        const attrs = [];
        if (isRegExp(options.name)) {
          attrs.push(\`NameRegex = \${this.regexToString(options.name)}\`);
        } else if (typeof options.name === "string") {
          attrs.push(\`Name = \${this.quote(options.name)}\`);
          if (options.exact)
            attrs.push(\`Exact = true\`);
        }
        for (const { name, value } of options.attrs)
          attrs.push(\`\${toTitleCase(name)} = \${typeof value === "string" ? this.quote(value) : value}\`);
        const attrString = attrs.length ? \`, new() { \${attrs.join(", ")} }\` : "";
        return \`GetByRole(AriaRole.\${toTitleCase(body)}\${attrString})\`;
      case "has-text":
        return \`Filter(new() { \${this.toHasText(body)} })\`;
      case "has-not-text":
        return \`Filter(new() { \${this.toHasNotText(body)} })\`;
      case "has":
        return \`Filter(new() { Has = \${body} })\`;
      case "hasNot":
        return \`Filter(new() { HasNot = \${body} })\`;
      case "and":
        return \`And(\${body})\`;
      case "or":
        return \`Or(\${body})\`;
      case "chain":
        return \`Locator(\${body})\`;
      case "test-id":
        return \`GetByTestId(\${this.toTestIdValue(body)})\`;
      case "text":
        return this.toCallWithExact("GetByText", body, !!options.exact);
      case "alt":
        return this.toCallWithExact("GetByAltText", body, !!options.exact);
      case "placeholder":
        return this.toCallWithExact("GetByPlaceholder", body, !!options.exact);
      case "label":
        return this.toCallWithExact("GetByLabel", body, !!options.exact);
      case "title":
        return this.toCallWithExact("GetByTitle", body, !!options.exact);
      default:
        throw new Error("Unknown selector kind " + kind);
    }
  }
  chainLocators(locators) {
    return locators.join(".");
  }
  regexToString(body) {
    const suffix = body.flags.includes("i") ? ", RegexOptions.IgnoreCase" : "";
    return \`new Regex(\${this.quote(normalizeEscapedRegexQuotes(body.source))}\${suffix})\`;
  }
  toCallWithExact(method, body, exact) {
    if (isRegExp(body))
      return \`\${method}(\${this.regexToString(body)})\`;
    if (exact)
      return \`\${method}(\${this.quote(body)}, new() { Exact = true })\`;
    return \`\${method}(\${this.quote(body)})\`;
  }
  toHasText(body) {
    if (isRegExp(body))
      return \`HasTextRegex = \${this.regexToString(body)}\`;
    return \`HasText = \${this.quote(body)}\`;
  }
  toTestIdValue(value) {
    if (isRegExp(value))
      return this.regexToString(value);
    return this.quote(value);
  }
  toHasNotText(body) {
    if (isRegExp(body))
      return \`HasNotTextRegex = \${this.regexToString(body)}\`;
    return \`HasNotText = \${this.quote(body)}\`;
  }
  quote(text) {
    return escapeWithQuotes(text, '"');
  }
};
var JsonlLocatorFactory = class {
  generateLocator(base, kind, body, options = {}) {
    return JSON.stringify({
      kind,
      body,
      options
    });
  }
  chainLocators(locators) {
    const objects = locators.map((l) => JSON.parse(l));
    for (let i = 0; i < objects.length - 1; ++i)
      objects[i].next = objects[i + 1];
    return JSON.stringify(objects[0]);
  }
};
var generators = {
  javascript: JavaScriptLocatorFactory,
  python: PythonLocatorFactory,
  java: JavaLocatorFactory,
  csharp: CSharpLocatorFactory,
  jsonl: JsonlLocatorFactory
};
function isRegExp(obj) {
  return obj instanceof RegExp;
}

// packages/playwright-core/src/server/injected/highlight.css?inline
var highlight_default = ":host{font-size:13px;font-family:system-ui,Ubuntu,Droid Sans,sans-serif;color:#333}svg{position:absolute;height:0}x-pw-tooltip{backdrop-filter:blur(5px);background-color:#fff;border-radius:6px;box-shadow:0 .5rem 1.2rem #0000004d;display:none;font-size:12.8px;font-weight:400;left:0;line-height:1.5;max-width:600px;position:absolute;top:0;padding:0;flex-direction:column;overflow:hidden}x-pw-tooltip-line{display:flex;max-width:600px;padding:6px;user-select:none;cursor:pointer}x-pw-tooltip-line.selectable:hover{background-color:#f2f2f2;overflow:hidden}x-pw-tooltip-footer{display:flex;max-width:600px;padding:6px;user-select:none;color:#777}x-pw-dialog{background-color:#fff;pointer-events:auto;border-radius:6px;box-shadow:0 .5rem 1.2rem #0000004d;display:flex;flex-direction:column;position:absolute;width:400px;height:150px;z-index:10;font-size:13px}x-pw-dialog-body{display:flex;flex-direction:column;flex:auto}x-pw-dialog-body label{margin:5px 8px;display:flex;flex-direction:row;align-items:center}x-pw-highlight{position:absolute;top:0;left:0;width:0;height:0}x-pw-action-point{position:absolute;width:20px;height:20px;background:red;border-radius:10px;margin:-10px 0 0 -10px;z-index:2}x-pw-separator{height:1px;margin:6px 9px;background:rgb(148 148 148 / 90%)}x-pw-tool-gripper{height:28px;width:24px;margin:2px 0;cursor:grab}x-pw-tool-gripper:active{cursor:grabbing}x-pw-tool-gripper>x-div{width:16px;height:16px;margin:6px 4px;clip-path:url(#icon-gripper);background-color:#555}x-pw-tools-list>label{display:flex;align-items:center;margin:0 10px;user-select:none}x-pw-tools-list{display:flex;width:100%;border-bottom:1px solid #dddddd}x-pw-tool-item{pointer-events:auto;cursor:pointer;height:28px;width:28px;border-radius:3px}x-pw-tool-item:not(.disabled):hover{background-color:#dbdbdb}x-pw-tool-item.active{background-color:#8acae480}x-pw-tool-item.active:not(.disabled):hover{background-color:#8acae4c4}x-pw-tool-item>x-div{width:16px;height:16px;margin:6px;background-color:#3a3a3a}x-pw-tool-item.disabled>x-div{background-color:#61616180;cursor:default}x-pw-tool-item.record.active{background-color:transparent}x-pw-tool-item.record.active:hover{background-color:#dbdbdb}x-pw-tool-item.record.active>x-div{background-color:#a1260d}x-pw-tool-item.accept>x-div{background-color:#388a34}x-pw-tool-item.record>x-div{clip-path:url(#icon-circle-large-filled)}x-pw-tool-item.pick-locator>x-div{clip-path:url(#icon-inspect)}x-pw-tool-item.text>x-div{clip-path:url(#icon-whole-word)}x-pw-tool-item.visibility>x-div{clip-path:url(#icon-eye)}x-pw-tool-item.value>x-div{clip-path:url(#icon-symbol-constant)}x-pw-tool-item.accept>x-div{clip-path:url(#icon-check)}x-pw-tool-item.cancel>x-div{clip-path:url(#icon-close)}x-pw-tool-item.succeeded>x-div{clip-path:url(#icon-pass);background-color:#388a34!important}x-pw-overlay{position:absolute;top:0;max-width:min-content;z-index:2147483647;background:transparent;pointer-events:auto}x-pw-overlay x-pw-tools-list{background-color:#fffd;box-shadow:#0000001a 0 5px 5px;border-radius:3px;border-bottom:none}x-pw-overlay x-pw-tool-item{margin:2px}textarea.text-editor{font-family:system-ui,Ubuntu,Droid Sans,sans-serif;flex:auto;border:none;margin:6px 10px;color:#333;outline:1px solid transparent!important;resize:none;padding:0;font-size:13px}textarea.text-editor.does-not-match{outline:1px solid red!important}x-div{display:block}x-spacer{flex:auto}*{box-sizing:border-box}*[hidden]{display:none!important}x-locator-editor{flex:none;width:100%;height:60px;padding:4px;border-bottom:1px solid #dddddd;outline:1px solid transparent}x-locator-editor.does-not-match{outline:1px solid red}.CodeMirror{width:100%!important;height:100%!important}\\n";

// packages/playwright-core/src/server/injected/highlight.ts
var Highlight = class {
  constructor(injectedScript) {
    this._highlightEntries = [];
    this._highlightOptions = {};
    this._language = "javascript";
    this._injectedScript = injectedScript;
    const document = injectedScript.document;
    this._isUnderTest = injectedScript.isUnderTest;
    this._glassPaneElement = document.createElement("x-pw-glass");
    this._glassPaneElement.style.position = "fixed";
    this._glassPaneElement.style.top = "0";
    this._glassPaneElement.style.right = "0";
    this._glassPaneElement.style.bottom = "0";
    this._glassPaneElement.style.left = "0";
    this._glassPaneElement.style.zIndex = "2147483646";
    this._glassPaneElement.style.pointerEvents = "none";
    this._glassPaneElement.style.display = "flex";
    this._glassPaneElement.style.backgroundColor = "transparent";
    for (const eventName of ["click", "auxclick", "dragstart", "input", "keydown", "keyup", "pointerdown", "pointerup", "mousedown", "mouseup", "mouseleave", "focus", "scroll"]) {
      this._glassPaneElement.addEventListener(eventName, (e) => {
        e.stopPropagation();
        e.stopImmediatePropagation();
        if (e.type === "click" && e.button === 0 && this._highlightOptions.tooltipListItemSelected)
          this._highlightOptions.tooltipListItemSelected(void 0);
      });
    }
    this._actionPointElement = document.createElement("x-pw-action-point");
    this._actionPointElement.setAttribute("hidden", "true");
    this._glassPaneShadow = this._glassPaneElement.attachShadow({ mode: this._isUnderTest ? "open" : "closed" });
    if (typeof this._glassPaneShadow.adoptedStyleSheets.push === "function") {
      const sheet = new this._injectedScript.window.CSSStyleSheet();
      sheet.replaceSync(highlight_default);
      this._glassPaneShadow.adoptedStyleSheets.push(sheet);
    } else {
      const styleElement = this._injectedScript.document.createElement("style");
      styleElement.textContent = highlight_default;
      this._glassPaneShadow.appendChild(styleElement);
    }
    this._glassPaneShadow.appendChild(this._actionPointElement);
  }
  install() {
    this._injectedScript.document.documentElement.appendChild(this._glassPaneElement);
  }
  setLanguage(language) {
    this._language = language;
  }
  runHighlightOnRaf(selector) {
    if (this._rafRequest)
      cancelAnimationFrame(this._rafRequest);
    this.updateHighlight(this._injectedScript.querySelectorAll(selector, this._injectedScript.document.documentElement), { tooltipText: asLocator(this._language, stringifySelector(selector)) });
    this._rafRequest = this._injectedScript.builtinRequestAnimationFrame(() => this.runHighlightOnRaf(selector));
  }
  uninstall() {
    if (this._rafRequest)
      cancelAnimationFrame(this._rafRequest);
    this._glassPaneElement.remove();
  }
  showActionPoint(x, y) {
    this._actionPointElement.style.top = y + "px";
    this._actionPointElement.style.left = x + "px";
    this._actionPointElement.hidden = false;
  }
  hideActionPoint() {
    this._actionPointElement.hidden = true;
  }
  clearHighlight() {
    var _a, _b;
    for (const entry of this._highlightEntries) {
      (_a = entry.highlightElement) == null ? void 0 : _a.remove();
      (_b = entry.tooltipElement) == null ? void 0 : _b.remove();
    }
    this._highlightEntries = [];
    this._highlightOptions = {};
    this._glassPaneElement.style.pointerEvents = "none";
  }
  updateHighlight(elements, options) {
    this._innerUpdateHighlight(elements, options);
  }
  maskElements(elements, color) {
    this._innerUpdateHighlight(elements, { color });
  }
  _innerUpdateHighlight(elements, options) {
    let color = options.color;
    if (!color)
      color = elements.length > 1 ? "#f6b26b7f" : "#6fa8dc7f";
    if (this._highlightIsUpToDate(elements, options))
      return;
    this.clearHighlight();
    this._highlightOptions = options;
    this._glassPaneElement.style.pointerEvents = options.tooltipListItemSelected ? "initial" : "none";
    for (let i = 0; i < elements.length; ++i) {
      const highlightElement = this._createHighlightElement();
      this._glassPaneShadow.appendChild(highlightElement);
      let tooltipElement;
      if (options.tooltipList || options.tooltipText || options.tooltipFooter) {
        tooltipElement = this._injectedScript.document.createElement("x-pw-tooltip");
        this._glassPaneShadow.appendChild(tooltipElement);
        tooltipElement.style.top = "0";
        tooltipElement.style.left = "0";
        tooltipElement.style.display = "flex";
        let lines = [];
        if (options.tooltipList) {
          lines = options.tooltipList;
        } else if (options.tooltipText) {
          const suffix = elements.length > 1 ? \` [\${i + 1} of \${elements.length}]\` : "";
          lines = [options.tooltipText + suffix];
        }
        for (let index = 0; index < lines.length; index++) {
          const element = this._injectedScript.document.createElement("x-pw-tooltip-line");
          element.textContent = lines[index];
          tooltipElement.appendChild(element);
          if (options.tooltipListItemSelected) {
            element.classList.add("selectable");
            element.addEventListener("click", () => {
              var _a;
              return (_a = options.tooltipListItemSelected) == null ? void 0 : _a.call(options, index);
            });
          }
        }
        if (options.tooltipFooter) {
          const footer = this._injectedScript.document.createElement("x-pw-tooltip-footer");
          footer.textContent = options.tooltipFooter;
          tooltipElement.appendChild(footer);
        }
      }
      this._highlightEntries.push({ targetElement: elements[i], tooltipElement, highlightElement });
    }
    for (const entry of this._highlightEntries) {
      entry.box = entry.targetElement.getBoundingClientRect();
      if (!entry.tooltipElement)
        continue;
      const { anchorLeft, anchorTop } = this.tooltipPosition(entry.box, entry.tooltipElement);
      entry.tooltipTop = anchorTop;
      entry.tooltipLeft = anchorLeft;
    }
    for (const entry of this._highlightEntries) {
      if (entry.tooltipElement) {
        entry.tooltipElement.style.top = entry.tooltipTop + "px";
        entry.tooltipElement.style.left = entry.tooltipLeft + "px";
      }
      const box = entry.box;
      entry.highlightElement.style.backgroundColor = color;
      entry.highlightElement.style.left = box.x + "px";
      entry.highlightElement.style.top = box.y + "px";
      entry.highlightElement.style.width = box.width + "px";
      entry.highlightElement.style.height = box.height + "px";
      entry.highlightElement.style.display = "block";
      if (this._isUnderTest)
        console.error("Highlight box for test: " + JSON.stringify({ x: box.x, y: box.y, width: box.width, height: box.height }));
    }
  }
  firstBox() {
    var _a;
    return (_a = this._highlightEntries[0]) == null ? void 0 : _a.box;
  }
  tooltipPosition(box, tooltipElement) {
    const tooltipWidth = tooltipElement.offsetWidth;
    const tooltipHeight = tooltipElement.offsetHeight;
    const totalWidth = this._glassPaneElement.offsetWidth;
    const totalHeight = this._glassPaneElement.offsetHeight;
    let anchorLeft = box.left;
    if (anchorLeft + tooltipWidth > totalWidth - 5)
      anchorLeft = totalWidth - tooltipWidth - 5;
    let anchorTop = box.bottom + 5;
    if (anchorTop + tooltipHeight > totalHeight - 5) {
      if (box.top > tooltipHeight + 5) {
        anchorTop = box.top - tooltipHeight - 5;
      } else {
        anchorTop = totalHeight - 5 - tooltipHeight;
      }
    }
    return { anchorLeft, anchorTop };
  }
  _highlightIsUpToDate(elements, options) {
    var _a, _b;
    if (options.tooltipText !== this._highlightOptions.tooltipText)
      return false;
    if (options.tooltipListItemSelected !== this._highlightOptions.tooltipListItemSelected)
      return false;
    if (options.tooltipFooter !== this._highlightOptions.tooltipFooter)
      return false;
    if (((_a = options.tooltipList) == null ? void 0 : _a.length) !== ((_b = this._highlightOptions.tooltipList) == null ? void 0 : _b.length))
      return false;
    if (options.tooltipList && this._highlightOptions.tooltipList) {
      for (let i = 0; i < options.tooltipList.length; i++) {
        if (options.tooltipList[i] !== this._highlightOptions.tooltipList[i])
          return false;
      }
    }
    if (elements.length !== this._highlightEntries.length)
      return false;
    for (let i = 0; i < this._highlightEntries.length; ++i) {
      if (elements[i] !== this._highlightEntries[i].targetElement)
        return false;
      const oldBox = this._highlightEntries[i].box;
      if (!oldBox)
        return false;
      const box = elements[i].getBoundingClientRect();
      if (box.top !== oldBox.top || box.right !== oldBox.right || box.bottom !== oldBox.bottom || box.left !== oldBox.left)
        return false;
    }
    return true;
  }
  _createHighlightElement() {
    return this._injectedScript.document.createElement("x-pw-highlight");
  }
  appendChild(element) {
    this._glassPaneShadow.appendChild(element);
  }
};

// packages/playwright-core/src/server/injected/simpleDom.ts
var leafRoles = /* @__PURE__ */ new Set([
  "button",
  "checkbox",
  "combobox",
  "link",
  "textbox"
]);
var lastDom;
function generateSimpleDomNode(injectedScript, target) {
  return generate(injectedScript, target).node;
}
function selectorForSimpleDomNodeId(injectedScript, id) {
  const element = lastDom == null ? void 0 : lastDom.elements.get(id);
  if (!element)
    throw new Error(\`Internal error: element with id "\${id}" not found\`);
  return injectedScript.generateSelectorSimple(element);
}
function generate(injectedScript, target) {
  const normalizeWhitespace = (text) => text.replace(/[\\s\\n]+/g, (match) => match.includes("\\n") ? "\\n" : " ");
  const tokens = [];
  const elements = /* @__PURE__ */ new Map();
  let lastId = 0;
  let resultTarget;
  const visit = (node) => {
    if (node.nodeType === Node.TEXT_NODE) {
      tokens.push(node.nodeValue);
      return;
    }
    if (node.nodeType === Node.ELEMENT_NODE) {
      const element = node;
      if (element.nodeName === "SCRIPT" || element.nodeName === "STYLE" || element.nodeName === "NOSCRIPT")
        return;
      if (injectedScript.utils.isElementVisible(element)) {
        const role = injectedScript.utils.getAriaRole(element);
        if (role && leafRoles.has(role)) {
          let value;
          if (element.nodeName === "INPUT" || element.nodeName === "TEXTAREA")
            value = element.value;
          const name = injectedScript.utils.getElementAccessibleName(element, false);
          const structuralId = String(++lastId);
          elements.set(structuralId, element);
          tokens.push(renderTag(injectedScript, role, name, structuralId, { value }));
          if (element === target) {
            const tagNoValue = renderTag(injectedScript, role, name, structuralId);
            resultTarget = { tag: tagNoValue, id: structuralId };
          }
          return;
        }
      }
      for (let child = element.firstChild; child; child = child.nextSibling)
        visit(child);
    }
  };
  injectedScript.utils.beginAriaCaches();
  try {
    visit(injectedScript.document.body);
  } finally {
    injectedScript.utils.endAriaCaches();
  }
  const dom = {
    markup: normalizeWhitespace(tokens.join(" ")),
    elements
  };
  if (target && !resultTarget)
    throw new Error("Target element is not in the simple DOM");
  lastDom = dom;
  return { dom, node: resultTarget ? { dom, ...resultTarget } : void 0 };
}
function renderTag(injectedScript, role, name, id, params) {
  const escapedTextContent = injectedScript.utils.escapeHTML(name);
  const escapedValue = injectedScript.utils.escapeHTMLAttribute((params == null ? void 0 : params.value) || "");
  switch (role) {
    case "button":
      return \`<button id="\${id}">\${escapedTextContent}</button>\`;
    case "link":
      return \`<a id="\${id}">\${escapedTextContent}</a>\`;
    case "textbox":
      return \`<input id="\${id}" title="\${escapedTextContent}" value="\${escapedValue}"></input>\`;
  }
  return \`<div role=\${role} id="\${id}">\${escapedTextContent}</div>\`;
}

// packages/playwright-core/src/server/injected/injectedScript.ts
var InjectedScript = class {
  // eslint-disable-next-line no-restricted-globals
  constructor(window, isUnderTest, sdkLanguage, testIdAttributeNameForStrictErrorAndConsoleCodegen, stableRafCount, browserName, customEngines) {
    this.onGlobalListenersRemoved = /* @__PURE__ */ new Set();
    this._testIdAttributeNameForStrictErrorAndConsoleCodegen = "data-testid";
    // Recorder must use any external dependencies through InjectedScript.
    // Otherwise it will end up with a copy of all modules it uses, and any
    // module-level globals will be duplicated, which leads to subtle bugs.
    this.utils = {
      asLocator,
      beginAriaCaches,
      cacheNormalizedWhitespaces,
      elementText,
      endAriaCaches,
      escapeHTML,
      escapeHTMLAttribute,
      getAriaRole,
      getElementAccessibleDescription,
      getElementAccessibleName,
      isElementVisible,
      isInsideScope,
      normalizeWhiteSpace
    };
    this.window = window;
    this.document = window.document;
    this.isUnderTest = isUnderTest;
    this._sdkLanguage = sdkLanguage;
    this._testIdAttributeNameForStrictErrorAndConsoleCodegen = testIdAttributeNameForStrictErrorAndConsoleCodegen;
    this._evaluator = new SelectorEvaluatorImpl(/* @__PURE__ */ new Map());
    this._engines = /* @__PURE__ */ new Map();
    this._engines.set("xpath", XPathEngine);
    this._engines.set("xpath:light", XPathEngine);
    this._engines.set("_react", ReactEngine);
    this._engines.set("_vue", VueEngine);
    this._engines.set("role", createRoleEngine(false));
    this._engines.set("text", this._createTextEngine(true, false));
    this._engines.set("text:light", this._createTextEngine(false, false));
    this._engines.set("id", this._createAttributeEngine("id", true));
    this._engines.set("id:light", this._createAttributeEngine("id", false));
    this._engines.set("data-testid", this._createAttributeEngine("data-testid", true));
    this._engines.set("data-testid:light", this._createAttributeEngine("data-testid", false));
    this._engines.set("data-test-id", this._createAttributeEngine("data-test-id", true));
    this._engines.set("data-test-id:light", this._createAttributeEngine("data-test-id", false));
    this._engines.set("data-test", this._createAttributeEngine("data-test", true));
    this._engines.set("data-test:light", this._createAttributeEngine("data-test", false));
    this._engines.set("css", this._createCSSEngine());
    this._engines.set("nth", { queryAll: () => [] });
    this._engines.set("visible", this._createVisibleEngine());
    this._engines.set("internal:control", this._createControlEngine());
    this._engines.set("internal:has", this._createHasEngine());
    this._engines.set("internal:has-not", this._createHasNotEngine());
    this._engines.set("internal:and", { queryAll: () => [] });
    this._engines.set("internal:or", { queryAll: () => [] });
    this._engines.set("internal:chain", this._createInternalChainEngine());
    this._engines.set("internal:label", this._createInternalLabelEngine());
    this._engines.set("internal:text", this._createTextEngine(true, true));
    this._engines.set("internal:has-text", this._createInternalHasTextEngine());
    this._engines.set("internal:has-not-text", this._createInternalHasNotTextEngine());
    this._engines.set("internal:attr", this._createNamedAttributeEngine());
    this._engines.set("internal:testid", this._createNamedAttributeEngine());
    this._engines.set("internal:role", createRoleEngine(true));
    for (const { name, engine } of customEngines)
      this._engines.set(name, engine);
    this._stableRafCount = stableRafCount;
    this._browserName = browserName;
    setBrowserName(browserName);
    this._setupGlobalListenersRemovalDetection();
    this._setupHitTargetInterceptors();
    if (isUnderTest)
      this.window.__injectedScript = this;
  }
  builtinSetTimeout(callback, timeout) {
    var _a;
    if ((_a = this.window.__pwClock) == null ? void 0 : _a.builtin)
      return this.window.__pwClock.builtin.setTimeout(callback, timeout);
    return setTimeout(callback, timeout);
  }
  builtinRequestAnimationFrame(callback) {
    var _a;
    if ((_a = this.window.__pwClock) == null ? void 0 : _a.builtin)
      return this.window.__pwClock.builtin.requestAnimationFrame(callback);
    return requestAnimationFrame(callback);
  }
  eval(expression) {
    return this.window.eval(expression);
  }
  testIdAttributeNameForStrictErrorAndConsoleCodegen() {
    return this._testIdAttributeNameForStrictErrorAndConsoleCodegen;
  }
  parseSelector(selector) {
    const result = parseSelector(selector);
    visitAllSelectorParts(result, (part) => {
      if (!this._engines.has(part.name))
        throw this.createStacklessError(\`Unknown engine "\${part.name}" while parsing selector \${selector}\`);
    });
    return result;
  }
  generateSelector(targetElement, options) {
    return generateSelector(this, targetElement, options);
  }
  generateSelectorSimple(targetElement, options) {
    return generateSelector(this, targetElement, { ...options, testIdAttributeName: this._testIdAttributeNameForStrictErrorAndConsoleCodegen }).selector;
  }
  querySelector(selector, root, strict) {
    const result = this.querySelectorAll(selector, root);
    if (strict && result.length > 1)
      throw this.strictModeViolationError(selector, result);
    return result[0];
  }
  _queryNth(elements, part) {
    const list = [...elements];
    let nth = +part.body;
    if (nth === -1)
      nth = list.length - 1;
    return new Set(list.slice(nth, nth + 1));
  }
  _queryLayoutSelector(elements, part, originalRoot) {
    const name = part.name;
    const body = part.body;
    const result = [];
    const inner = this.querySelectorAll(body.parsed, originalRoot);
    for (const element of elements) {
      const score = layoutSelectorScore(name, element, inner, body.distance);
      if (score !== void 0)
        result.push({ element, score });
    }
    result.sort((a, b) => a.score - b.score);
    return new Set(result.map((r) => r.element));
  }
  querySelectorAll(selector, root) {
    if (selector.capture !== void 0) {
      if (selector.parts.some((part) => part.name === "nth"))
        throw this.createStacklessError(\`Can't query n-th element in a request with the capture.\`);
      const withHas = { parts: selector.parts.slice(0, selector.capture + 1) };
      if (selector.capture < selector.parts.length - 1) {
        const parsed = { parts: selector.parts.slice(selector.capture + 1) };
        const has = { name: "internal:has", body: { parsed }, source: stringifySelector(parsed) };
        withHas.parts.push(has);
      }
      return this.querySelectorAll(withHas, root);
    }
    if (!root["querySelectorAll"])
      throw this.createStacklessError("Node is not queryable.");
    if (selector.capture !== void 0) {
      throw this.createStacklessError("Internal error: there should not be a capture in the selector.");
    }
    if (root.nodeType === 11 && selector.parts.length === 1 && selector.parts[0].name === "css" && selector.parts[0].source === ":scope")
      return [root];
    this._evaluator.begin();
    try {
      let roots = /* @__PURE__ */ new Set([root]);
      for (const part of selector.parts) {
        if (part.name === "nth") {
          roots = this._queryNth(roots, part);
        } else if (part.name === "internal:and") {
          const andElements = this.querySelectorAll(part.body.parsed, root);
          roots = new Set(andElements.filter((e) => roots.has(e)));
        } else if (part.name === "internal:or") {
          const orElements = this.querySelectorAll(part.body.parsed, root);
          roots = new Set(sortInDOMOrder(/* @__PURE__ */ new Set([...roots, ...orElements])));
        } else if (kLayoutSelectorNames.includes(part.name)) {
          roots = this._queryLayoutSelector(roots, part, root);
        } else {
          const next = /* @__PURE__ */ new Set();
          for (const root2 of roots) {
            const all = this._queryEngineAll(part, root2);
            for (const one of all)
              next.add(one);
          }
          roots = next;
        }
      }
      return [...roots];
    } finally {
      this._evaluator.end();
    }
  }
  _queryEngineAll(part, root) {
    const result = this._engines.get(part.name).queryAll(root, part.body);
    for (const element of result) {
      if (!("nodeName" in element))
        throw this.createStacklessError(\`Expected a Node but got \${Object.prototype.toString.call(element)}\`);
    }
    return result;
  }
  _createAttributeEngine(attribute, shadow) {
    const toCSS = (selector) => {
      const css = \`[\${attribute}=\${JSON.stringify(selector)}]\`;
      return [{ simples: [{ selector: { css, functions: [] }, combinator: "" }] }];
    };
    return {
      queryAll: (root, selector) => {
        return this._evaluator.query({ scope: root, pierceShadow: shadow }, toCSS(selector));
      }
    };
  }
  _createCSSEngine() {
    return {
      queryAll: (root, body) => {
        return this._evaluator.query({ scope: root, pierceShadow: true }, body);
      }
    };
  }
  _createTextEngine(shadow, internal) {
    const queryAll = (root, selector) => {
      const { matcher, kind } = createTextMatcher(selector, internal);
      const result = [];
      let lastDidNotMatchSelf = null;
      const appendElement = (element) => {
        if (kind === "lax" && lastDidNotMatchSelf && lastDidNotMatchSelf.contains(element))
          return false;
        const matches = elementMatchesText(this._evaluator._cacheText, element, matcher);
        if (matches === "none")
          lastDidNotMatchSelf = element;
        if (matches === "self" || matches === "selfAndChildren" && kind === "strict" && !internal)
          result.push(element);
      };
      if (root.nodeType === Node.ELEMENT_NODE)
        appendElement(root);
      const elements = this._evaluator._queryCSS({ scope: root, pierceShadow: shadow }, "*");
      for (const element of elements)
        appendElement(element);
      return result;
    };
    return { queryAll };
  }
  _createInternalHasTextEngine() {
    return {
      queryAll: (root, selector) => {
        if (root.nodeType !== 1)
          return [];
        const element = root;
        const text = elementText(this._evaluator._cacheText, element);
        const { matcher } = createTextMatcher(selector, true);
        return matcher(text) ? [element] : [];
      }
    };
  }
  _createInternalHasNotTextEngine() {
    return {
      queryAll: (root, selector) => {
        if (root.nodeType !== 1)
          return [];
        const element = root;
        const text = elementText(this._evaluator._cacheText, element);
        const { matcher } = createTextMatcher(selector, true);
        return matcher(text) ? [] : [element];
      }
    };
  }
  _createInternalLabelEngine() {
    return {
      queryAll: (root, selector) => {
        const { matcher } = createTextMatcher(selector, true);
        const allElements = this._evaluator._queryCSS({ scope: root, pierceShadow: true }, "*");
        return allElements.filter((element) => {
          return getElementLabels(this._evaluator._cacheText, element).some((label) => matcher(label));
        });
      }
    };
  }
  _createNamedAttributeEngine() {
    const queryAll = (root, selector) => {
      const parsed = parseAttributeSelector(selector, true);
      if (parsed.name || parsed.attributes.length !== 1)
        throw new Error("Malformed attribute selector: " + selector);
      const { name, value, caseSensitive } = parsed.attributes[0];
      const lowerCaseValue = caseSensitive ? null : value.toLowerCase();
      let matcher;
      if (value instanceof RegExp)
        matcher = (s) => !!s.match(value);
      else if (caseSensitive)
        matcher = (s) => s === value;
      else
        matcher = (s) => s.toLowerCase().includes(lowerCaseValue);
      const elements = this._evaluator._queryCSS({ scope: root, pierceShadow: true }, \`[\${name}]\`);
      return elements.filter((e) => matcher(e.getAttribute(name)));
    };
    return { queryAll };
  }
  _createControlEngine() {
    return {
      queryAll(root, body) {
        if (body === "enter-frame")
          return [];
        if (body === "return-empty")
          return [];
        if (body === "component") {
          if (root.nodeType !== 1)
            return [];
          return [root.childElementCount === 1 ? root.firstElementChild : root];
        }
        throw new Error(\`Internal error, unknown internal:control selector \${body}\`);
      }
    };
  }
  _createHasEngine() {
    const queryAll = (root, body) => {
      if (root.nodeType !== 1)
        return [];
      const has = !!this.querySelector(body.parsed, root, false);
      return has ? [root] : [];
    };
    return { queryAll };
  }
  _createHasNotEngine() {
    const queryAll = (root, body) => {
      if (root.nodeType !== 1)
        return [];
      const has = !!this.querySelector(body.parsed, root, false);
      return has ? [] : [root];
    };
    return { queryAll };
  }
  _createVisibleEngine() {
    const queryAll = (root, body) => {
      if (root.nodeType !== 1)
        return [];
      return isElementVisible(root) === Boolean(body) ? [root] : [];
    };
    return { queryAll };
  }
  _createInternalChainEngine() {
    const queryAll = (root, body) => {
      return this.querySelectorAll(body.parsed, root);
    };
    return { queryAll };
  }
  extend(source, params) {
    const constrFunction = this.window.eval(\`
    (() => {
      const module = {};
      \${source}
      return module.exports.default();
    })()\`);
    return new constrFunction(this, params);
  }
  async viewportRatio(element) {
    return await new Promise((resolve) => {
      const observer = new IntersectionObserver((entries) => {
        resolve(entries[0].intersectionRatio);
        observer.disconnect();
      });
      observer.observe(element);
      this.builtinRequestAnimationFrame(() => {
      });
    });
  }
  getElementBorderWidth(node) {
    if (node.nodeType !== Node.ELEMENT_NODE || !node.ownerDocument || !node.ownerDocument.defaultView)
      return { left: 0, top: 0 };
    const style = node.ownerDocument.defaultView.getComputedStyle(node);
    return { left: parseInt(style.borderLeftWidth || "", 10), top: parseInt(style.borderTopWidth || "", 10) };
  }
  describeIFrameStyle(iframe) {
    if (!iframe.ownerDocument || !iframe.ownerDocument.defaultView)
      return "error:notconnected";
    const defaultView = iframe.ownerDocument.defaultView;
    for (let e = iframe; e; e = parentElementOrShadowHost(e)) {
      if (defaultView.getComputedStyle(e).transform !== "none")
        return "transformed";
    }
    const iframeStyle = defaultView.getComputedStyle(iframe);
    return {
      left: parseInt(iframeStyle.borderLeftWidth || "", 10) + parseInt(iframeStyle.paddingLeft || "", 10),
      top: parseInt(iframeStyle.borderTopWidth || "", 10) + parseInt(iframeStyle.paddingTop || "", 10)
    };
  }
  retarget(node, behavior) {
    let element = node.nodeType === Node.ELEMENT_NODE ? node : node.parentElement;
    if (!element)
      return null;
    if (behavior === "none")
      return element;
    if (!element.matches("input, textarea, select") && !element.isContentEditable) {
      if (behavior === "button-link")
        element = element.closest("button, [role=button], a, [role=link]") || element;
      else
        element = element.closest("button, [role=button], [role=checkbox], [role=radio]") || element;
    }
    if (behavior === "follow-label") {
      if (!element.matches("a, input, textarea, button, select, [role=link], [role=button], [role=checkbox], [role=radio]") && !element.isContentEditable) {
        element = element.closest("label") || element;
      }
      if (element.nodeName === "LABEL")
        element = element.control || element;
    }
    return element;
  }
  async checkElementStates(node, states) {
    if (states.includes("stable")) {
      const stableResult = await this._checkElementIsStable(node);
      if (stableResult === false)
        return { missingState: "stable" };
      if (stableResult === "error:notconnected")
        return stableResult;
    }
    for (const state of states) {
      if (state !== "stable") {
        const result = this.elementState(node, state);
        if (result === false)
          return { missingState: state };
        if (result === "error:notconnected")
          return result;
      }
    }
  }
  async _checkElementIsStable(node) {
    const continuePolling = Symbol("continuePolling");
    let lastRect;
    let stableRafCounter = 0;
    let lastTime = 0;
    const check = () => {
      const element = this.retarget(node, "no-follow-label");
      if (!element)
        return "error:notconnected";
      const time = performance.now();
      if (this._stableRafCount > 1 && time - lastTime < 15)
        return continuePolling;
      lastTime = time;
      const clientRect = element.getBoundingClientRect();
      const rect = { x: clientRect.top, y: clientRect.left, width: clientRect.width, height: clientRect.height };
      if (lastRect) {
        const samePosition = rect.x === lastRect.x && rect.y === lastRect.y && rect.width === lastRect.width && rect.height === lastRect.height;
        if (!samePosition)
          return false;
        if (++stableRafCounter >= this._stableRafCount)
          return true;
      }
      lastRect = rect;
      return continuePolling;
    };
    let fulfill;
    let reject;
    const result = new Promise((f, r) => {
      fulfill = f;
      reject = r;
    });
    const raf = () => {
      try {
        const success = check();
        if (success !== continuePolling)
          fulfill(success);
        else
          this.builtinRequestAnimationFrame(raf);
      } catch (e) {
        reject(e);
      }
    };
    this.builtinRequestAnimationFrame(raf);
    return result;
  }
  elementState(node, state) {
    const element = this.retarget(node, ["stable", "visible", "hidden"].includes(state) ? "none" : "follow-label");
    if (!element || !element.isConnected) {
      if (state === "hidden")
        return true;
      return "error:notconnected";
    }
    if (state === "visible")
      return isElementVisible(element);
    if (state === "hidden")
      return !isElementVisible(element);
    const disabled = getAriaDisabled(element);
    if (state === "disabled")
      return disabled;
    if (state === "enabled")
      return !disabled;
    const editable = !(["INPUT", "TEXTAREA", "SELECT"].includes(element.nodeName) && element.hasAttribute("readonly"));
    if (state === "editable")
      return !disabled && editable;
    if (state === "checked" || state === "unchecked") {
      const need = state === "checked";
      const checked = getChecked(element, false);
      if (checked === "error")
        throw this.createStacklessError("Not a checkbox or radio button");
      return need === checked;
    }
    throw this.createStacklessError(\`Unexpected element state "\${state}"\`);
  }
  selectOptions(node, optionsToSelect) {
    const element = this.retarget(node, "follow-label");
    if (!element)
      return "error:notconnected";
    if (element.nodeName.toLowerCase() !== "select")
      throw this.createStacklessError("Element is not a <select> element");
    const select = element;
    const options = [...select.options];
    const selectedOptions = [];
    let remainingOptionsToSelect = optionsToSelect.slice();
    for (let index = 0; index < options.length; index++) {
      const option = options[index];
      const filter = (optionToSelect) => {
        if (optionToSelect instanceof Node)
          return option === optionToSelect;
        let matches = true;
        if (optionToSelect.valueOrLabel !== void 0)
          matches = matches && (optionToSelect.valueOrLabel === option.value || optionToSelect.valueOrLabel === option.label);
        if (optionToSelect.value !== void 0)
          matches = matches && optionToSelect.value === option.value;
        if (optionToSelect.label !== void 0)
          matches = matches && optionToSelect.label === option.label;
        if (optionToSelect.index !== void 0)
          matches = matches && optionToSelect.index === index;
        return matches;
      };
      if (!remainingOptionsToSelect.some(filter))
        continue;
      selectedOptions.push(option);
      if (select.multiple) {
        remainingOptionsToSelect = remainingOptionsToSelect.filter((o) => !filter(o));
      } else {
        remainingOptionsToSelect = [];
        break;
      }
    }
    if (remainingOptionsToSelect.length)
      return "error:optionsnotfound";
    select.value = void 0;
    selectedOptions.forEach((option) => option.selected = true);
    select.dispatchEvent(new Event("input", { bubbles: true, composed: true }));
    select.dispatchEvent(new Event("change", { bubbles: true }));
    return selectedOptions.map((option) => option.value);
  }
  fill(node, value) {
    const element = this.retarget(node, "follow-label");
    if (!element)
      return "error:notconnected";
    if (element.nodeName.toLowerCase() === "input") {
      const input = element;
      const type = input.type.toLowerCase();
      const kInputTypesToSetValue = /* @__PURE__ */ new Set(["color", "date", "time", "datetime-local", "month", "range", "week"]);
      const kInputTypesToTypeInto = /* @__PURE__ */ new Set(["", "email", "number", "password", "search", "tel", "text", "url"]);
      if (!kInputTypesToTypeInto.has(type) && !kInputTypesToSetValue.has(type))
        throw this.createStacklessError(\`Input of type "\${type}" cannot be filled\`);
      if (type === "number") {
        value = value.trim();
        if (isNaN(Number(value)))
          throw this.createStacklessError("Cannot type text into input[type=number]");
      }
      if (kInputTypesToSetValue.has(type)) {
        value = value.trim();
        input.focus();
        input.value = value;
        if (input.value !== value)
          throw this.createStacklessError("Malformed value");
        element.dispatchEvent(new Event("input", { bubbles: true, composed: true }));
        element.dispatchEvent(new Event("change", { bubbles: true }));
        return "done";
      }
    } else if (element.nodeName.toLowerCase() === "textarea") {
    } else if (!element.isContentEditable) {
      throw this.createStacklessError("Element is not an <input>, <textarea> or [contenteditable] element");
    }
    this.selectText(element);
    return "needsinput";
  }
  selectText(node) {
    const element = this.retarget(node, "follow-label");
    if (!element)
      return "error:notconnected";
    if (element.nodeName.toLowerCase() === "input") {
      const input = element;
      input.select();
      input.focus();
      return "done";
    }
    if (element.nodeName.toLowerCase() === "textarea") {
      const textarea = element;
      textarea.selectionStart = 0;
      textarea.selectionEnd = textarea.value.length;
      textarea.focus();
      return "done";
    }
    const range = element.ownerDocument.createRange();
    range.selectNodeContents(element);
    const selection = element.ownerDocument.defaultView.getSelection();
    if (selection) {
      selection.removeAllRanges();
      selection.addRange(range);
    }
    element.focus();
    return "done";
  }
  _activelyFocused(node) {
    const activeElement = node.getRootNode().activeElement;
    const isFocused = activeElement === node && !!node.ownerDocument && node.ownerDocument.hasFocus();
    return { activeElement, isFocused };
  }
  focusNode(node, resetSelectionIfNotFocused) {
    if (!node.isConnected)
      return "error:notconnected";
    if (node.nodeType !== Node.ELEMENT_NODE)
      throw this.createStacklessError("Node is not an element");
    const { activeElement, isFocused: wasFocused } = this._activelyFocused(node);
    if (node.isContentEditable && !wasFocused && activeElement && activeElement.blur) {
      activeElement.blur();
    }
    node.focus();
    node.focus();
    if (resetSelectionIfNotFocused && !wasFocused && node.nodeName.toLowerCase() === "input") {
      try {
        const input = node;
        input.setSelectionRange(0, 0);
      } catch (e) {
      }
    }
    return "done";
  }
  blurNode(node) {
    if (!node.isConnected)
      return "error:notconnected";
    if (node.nodeType !== Node.ELEMENT_NODE)
      throw this.createStacklessError("Node is not an element");
    node.blur();
    return "done";
  }
  setInputFiles(node, payloads) {
    if (node.nodeType !== Node.ELEMENT_NODE)
      return "Node is not of type HTMLElement";
    const element = node;
    if (element.nodeName !== "INPUT")
      return "Not an <input> element";
    const input = element;
    const type = (input.getAttribute("type") || "").toLowerCase();
    if (type !== "file")
      return "Not an input[type=file] element";
    const files = payloads.map((file) => {
      const bytes = Uint8Array.from(atob(file.buffer), (c) => c.charCodeAt(0));
      return new File([bytes], file.name, { type: file.mimeType, lastModified: file.lastModifiedMs });
    });
    const dt = new DataTransfer();
    for (const file of files)
      dt.items.add(file);
    input.files = dt.files;
    input.dispatchEvent(new Event("input", { bubbles: true, composed: true }));
    input.dispatchEvent(new Event("change", { bubbles: true }));
  }
  expectHitTarget(hitPoint, targetElement) {
    const roots = [];
    let parentElement = targetElement;
    while (parentElement) {
      const root = enclosingShadowRootOrDocument(parentElement);
      if (!root)
        break;
      roots.push(root);
      if (root.nodeType === 9)
        break;
      parentElement = root.host;
    }
    let hitElement;
    for (let index = roots.length - 1; index >= 0; index--) {
      const root = roots[index];
      const elements = root.elementsFromPoint(hitPoint.x, hitPoint.y);
      const singleElement = root.elementFromPoint(hitPoint.x, hitPoint.y);
      if (singleElement && elements[0] && parentElementOrShadowHost(singleElement) === elements[0]) {
        const style = this.window.getComputedStyle(singleElement);
        if ((style == null ? void 0 : style.display) === "contents") {
          elements.unshift(singleElement);
        }
      }
      if (elements[0] && elements[0].shadowRoot === root && elements[1] === singleElement) {
        elements.shift();
      }
      const innerElement = elements[0];
      if (!innerElement)
        break;
      hitElement = innerElement;
      if (index && innerElement !== roots[index - 1].host)
        break;
    }
    const hitParents = [];
    while (hitElement && hitElement !== targetElement) {
      hitParents.push(hitElement);
      hitElement = parentElementOrShadowHost(hitElement);
    }
    if (hitElement === targetElement)
      return "done";
    const hitTargetDescription = this.previewNode(hitParents[0] || this.document.documentElement);
    let rootHitTargetDescription;
    let element = targetElement;
    while (element) {
      const index = hitParents.indexOf(element);
      if (index !== -1) {
        if (index > 1)
          rootHitTargetDescription = this.previewNode(hitParents[index - 1]);
        break;
      }
      element = parentElementOrShadowHost(element);
    }
    if (rootHitTargetDescription)
      return { hitTargetDescription: \`\${hitTargetDescription} from \${rootHitTargetDescription} subtree\` };
    return { hitTargetDescription };
  }
  // Life of a pointer action, for example click.
  //
  // 0. Retry items 1 and 2 while action fails due to navigation or element being detached.
  //   1. Resolve selector to an element.
  //   2. Retry the following steps until the element is detached or frame navigates away.
  //     2a. Wait for the element to be stable (not moving), visible and enabled.
  //     2b. Scroll element into view. Scrolling alternates between:
  //         - Built-in protocol scrolling.
  //         - Anchoring to the top/left, bottom/right and center/center.
  //         This is to scroll elements from under sticky headers/footers.
  //     2c. Click point is calculated, either based on explicitly specified position,
  //         or some visible point of the element based on protocol content quads.
  //     2d. Click point relative to page viewport is converted relative to the target iframe
  //         for the next hit-point check.
  //     2e. (injected) Hit target at the click point must be a descendant of the target element.
  //         This prevents mis-clicking in edge cases like <iframe> overlaying the target.
  //     2f. (injected) Events specific for click (or some other action type) are intercepted on
  //         the Window with capture:true. See 2i for details.
  //         Note: this step is skipped for drag&drop (see inline comments for the reason).
  //     2g. Necessary keyboard modifiers are pressed.
  //     2h. Click event is issued (mousemove + mousedown + mouseup).
  //     2i. (injected) For each event, we check that hit target at the event point
  //         is a descendant of the target element.
  //         This guarantees no race between issuing the event and handling it in the page,
  //         for example due to layout shift.
  //         When hit target check fails, we block all future events in the page.
  //     2j. Keyboard modifiers are restored.
  //     2k. (injected) Event interceptor is removed.
  //     2l. All navigations triggered between 2g-2k are awaited to be either committed or canceled.
  //     2m. If failed, wait for increasing amount of time before the next retry.
  setupHitTargetInterceptor(node, action, hitPoint, blockAllEvents) {
    const element = this.retarget(node, "button-link");
    if (!element || !element.isConnected)
      return "error:notconnected";
    if (hitPoint) {
      const preliminaryResult = this.expectHitTarget(hitPoint, element);
      if (preliminaryResult !== "done")
        return preliminaryResult.hitTargetDescription;
    }
    if (action === "drag")
      return { stop: () => "done" };
    const events = {
      "hover": kHoverHitTargetInterceptorEvents,
      "tap": kTapHitTargetInterceptorEvents,
      "mouse": kMouseHitTargetInterceptorEvents
    }[action];
    let result;
    const listener = (event) => {
      if (!events.has(event.type))
        return;
      if (!event.isTrusted)
        return;
      const point = !!this.window.TouchEvent && event instanceof this.window.TouchEvent ? event.touches[0] : event;
      if (result === void 0 && point)
        result = this.expectHitTarget({ x: point.clientX, y: point.clientY }, element);
      if (blockAllEvents || result !== "done" && result !== void 0) {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
      }
    };
    const stop = () => {
      if (this._hitTargetInterceptor === listener)
        this._hitTargetInterceptor = void 0;
      return result || "done";
    };
    this._hitTargetInterceptor = listener;
    return { stop };
  }
  dispatchEvent(node, type, eventInit) {
    let event;
    eventInit = { bubbles: true, cancelable: true, composed: true, ...eventInit };
    switch (eventType.get(type)) {
      case "mouse":
        event = new MouseEvent(type, eventInit);
        break;
      case "keyboard":
        event = new KeyboardEvent(type, eventInit);
        break;
      case "touch":
        event = new TouchEvent(type, eventInit);
        break;
      case "pointer":
        event = new PointerEvent(type, eventInit);
        break;
      case "focus":
        event = new FocusEvent(type, eventInit);
        break;
      case "drag":
        event = new DragEvent(type, eventInit);
        break;
      case "wheel":
        event = new WheelEvent(type, eventInit);
        break;
      case "deviceorientation":
        try {
          event = new DeviceOrientationEvent(type, eventInit);
        } catch {
          const { bubbles, cancelable, alpha, beta, gamma, absolute } = eventInit;
          event = this.document.createEvent("DeviceOrientationEvent");
          event.initDeviceOrientationEvent(type, bubbles, cancelable, alpha, beta, gamma, absolute);
        }
        break;
      case "devicemotion":
        try {
          event = new DeviceMotionEvent(type, eventInit);
        } catch {
          const { bubbles, cancelable, acceleration, accelerationIncludingGravity, rotationRate, interval } = eventInit;
          event = this.document.createEvent("DeviceMotionEvent");
          event.initDeviceMotionEvent(type, bubbles, cancelable, acceleration, accelerationIncludingGravity, rotationRate, interval);
        }
        break;
      default:
        event = new Event(type, eventInit);
        break;
    }
    node.dispatchEvent(event);
  }
  previewNode(node) {
    if (node.nodeType === Node.TEXT_NODE)
      return oneLine(\`#text=\${node.nodeValue || ""}\`);
    if (node.nodeType !== Node.ELEMENT_NODE)
      return oneLine(\`<\${node.nodeName.toLowerCase()} />\`);
    const element = node;
    const attrs = [];
    for (let i = 0; i < element.attributes.length; i++) {
      const { name, value } = element.attributes[i];
      if (name === "style")
        continue;
      if (!value && booleanAttributes.has(name))
        attrs.push(\` \${name}\`);
      else
        attrs.push(\` \${name}="\${value}"\`);
    }
    attrs.sort((a, b) => a.length - b.length);
    const attrText = trimStringWithEllipsis(attrs.join(""), 500);
    if (autoClosingTags.has(element.nodeName))
      return oneLine(\`<\${element.nodeName.toLowerCase()}\${attrText}/>\`);
    const children = element.childNodes;
    let onlyText = false;
    if (children.length <= 5) {
      onlyText = true;
      for (let i = 0; i < children.length; i++)
        onlyText = onlyText && children[i].nodeType === Node.TEXT_NODE;
    }
    const text = onlyText ? element.textContent || "" : children.length ? "\\u2026" : "";
    return oneLine(\`<\${element.nodeName.toLowerCase()}\${attrText}>\${trimStringWithEllipsis(text, 50)}</\${element.nodeName.toLowerCase()}>\`);
  }
  strictModeViolationError(selector, matches) {
    const infos = matches.slice(0, 10).map((m) => ({
      preview: this.previewNode(m),
      selector: this.generateSelectorSimple(m)
    }));
    const lines = infos.map((info, i) => \`
    \${i + 1}) \${info.preview} aka \${asLocator(this._sdkLanguage, info.selector)}\`);
    if (infos.length < matches.length)
      lines.push("\\n    ...");
    return this.createStacklessError(\`strict mode violation: \${asLocator(this._sdkLanguage, stringifySelector(selector))} resolved to \${matches.length} elements:\${lines.join("")}
\`);
  }
  createStacklessError(message) {
    if (this._browserName === "firefox") {
      const error2 = new Error("Error: " + message);
      error2.stack = "";
      return error2;
    }
    const error = new Error(message);
    delete error.stack;
    return error;
  }
  createHighlight() {
    return new Highlight(this);
  }
  maskSelectors(selectors, color) {
    if (this._highlight)
      this.hideHighlight();
    this._highlight = new Highlight(this);
    this._highlight.install();
    const elements = [];
    for (const selector of selectors)
      elements.push(this.querySelectorAll(selector, this.document.documentElement));
    this._highlight.maskElements(elements.flat(), color);
  }
  highlight(selector) {
    if (!this._highlight) {
      this._highlight = new Highlight(this);
      this._highlight.install();
    }
    this._highlight.runHighlightOnRaf(selector);
  }
  hideHighlight() {
    if (this._highlight) {
      this._highlight.uninstall();
      delete this._highlight;
    }
  }
  markTargetElements(markedElements, callId) {
    const customEvent = new CustomEvent("__playwright_target__", {
      bubbles: true,
      cancelable: true,
      detail: callId,
      composed: true
    });
    for (const element of markedElements)
      element.dispatchEvent(customEvent);
  }
  _setupGlobalListenersRemovalDetection() {
    const customEventName = "__playwright_global_listeners_check__";
    let seenEvent = false;
    const handleCustomEvent = () => seenEvent = true;
    this.window.addEventListener(customEventName, handleCustomEvent);
    new MutationObserver((entries) => {
      const newDocumentElement = entries.some((entry) => Array.from(entry.addedNodes).includes(this.document.documentElement));
      if (!newDocumentElement)
        return;
      seenEvent = false;
      this.window.dispatchEvent(new CustomEvent(customEventName));
      if (seenEvent)
        return;
      this.window.addEventListener(customEventName, handleCustomEvent);
      for (const callback of this.onGlobalListenersRemoved)
        callback();
    }).observe(this.document, { childList: true });
  }
  _setupHitTargetInterceptors() {
    const listener = (event) => {
      var _a;
      return (_a = this._hitTargetInterceptor) == null ? void 0 : _a.call(this, event);
    };
    const addHitTargetInterceptorListeners = () => {
      for (const event of kAllHitTargetInterceptorEvents)
        this.window.addEventListener(event, listener, { capture: true, passive: false });
    };
    addHitTargetInterceptorListeners();
    this.onGlobalListenersRemoved.add(addHitTargetInterceptorListeners);
  }
  async expect(element, options, elements) {
    const isArray = options.expression === "to.have.count" || options.expression.endsWith(".array");
    if (isArray)
      return this.expectArray(elements, options);
    if (!element) {
      if (!options.isNot && options.expression === "to.be.hidden")
        return { matches: true };
      if (options.isNot && options.expression === "to.be.visible")
        return { matches: false };
      if (!options.isNot && options.expression === "to.be.detached")
        return { matches: true };
      if (options.isNot && options.expression === "to.be.attached")
        return { matches: false };
      if (options.isNot && options.expression === "to.be.in.viewport")
        return { matches: false };
      return { matches: options.isNot, missingReceived: true };
    }
    return await this.expectSingleElement(element, options);
  }
  async expectSingleElement(element, options) {
    var _a, _b;
    const expression = options.expression;
    {
      let elementState;
      if (expression === "to.have.attribute") {
        elementState = element.hasAttribute(options.expressionArg);
      } else if (expression === "to.be.checked") {
        elementState = this.elementState(element, "checked");
      } else if (expression === "to.be.unchecked") {
        elementState = this.elementState(element, "unchecked");
      } else if (expression === "to.be.disabled") {
        elementState = this.elementState(element, "disabled");
      } else if (expression === "to.be.editable") {
        elementState = this.elementState(element, "editable");
      } else if (expression === "to.be.readonly") {
        elementState = !this.elementState(element, "editable");
      } else if (expression === "to.be.empty") {
        if (element.nodeName === "INPUT" || element.nodeName === "TEXTAREA")
          elementState = !element.value;
        else
          elementState = !((_a = element.textContent) == null ? void 0 : _a.trim());
      } else if (expression === "to.be.enabled") {
        elementState = this.elementState(element, "enabled");
      } else if (expression === "to.be.focused") {
        elementState = this._activelyFocused(element).isFocused;
      } else if (expression === "to.be.hidden") {
        elementState = this.elementState(element, "hidden");
      } else if (expression === "to.be.visible") {
        elementState = this.elementState(element, "visible");
      } else if (expression === "to.be.attached") {
        elementState = true;
      } else if (expression === "to.be.detached") {
        elementState = false;
      }
      if (elementState !== void 0) {
        if (elementState === "error:notcheckbox")
          throw this.createStacklessError("Element is not a checkbox");
        if (elementState === "error:notconnected")
          throw this.createStacklessError("Element is not connected");
        return { received: elementState, matches: elementState };
      }
    }
    {
      if (expression === "to.have.property") {
        let target = element;
        const properties = options.expressionArg.split(".");
        for (let i = 0; i < properties.length - 1; i++) {
          if (typeof target !== "object" || !(properties[i] in target))
            return { received: void 0, matches: false };
          target = target[properties[i]];
        }
        const received = target[properties[properties.length - 1]];
        const matches = deepEquals(received, options.expectedValue);
        return { received, matches };
      }
    }
    {
      if (expression === "to.be.in.viewport") {
        const ratio = await this.viewportRatio(element);
        return { received: \`viewport ratio \${ratio}\`, matches: ratio > 0 && ratio > ((_b = options.expectedNumber) != null ? _b : 0) - 1e-9 };
      }
    }
    {
      if (expression === "to.have.values") {
        element = this.retarget(element, "follow-label");
        if (element.nodeName !== "SELECT" || !element.multiple)
          throw this.createStacklessError("Not a select element with a multiple attribute");
        const received = [...element.selectedOptions].map((o) => o.value);
        if (received.length !== options.expectedText.length)
          return { received, matches: false };
        return { received, matches: received.map((r, i) => new ExpectedTextMatcher(options.expectedText[i]).matches(r)).every(Boolean) };
      }
    }
    {
      let received;
      if (expression === "to.have.attribute.value") {
        const value = element.getAttribute(options.expressionArg);
        if (value === null)
          return { received: null, matches: false };
        received = value;
      } else if (expression === "to.have.class") {
        received = element.classList.toString();
      } else if (expression === "to.have.css") {
        received = this.window.getComputedStyle(element).getPropertyValue(options.expressionArg);
      } else if (expression === "to.have.id") {
        received = element.id;
      } else if (expression === "to.have.text") {
        received = options.useInnerText ? element.innerText : elementText(/* @__PURE__ */ new Map(), element).full;
      } else if (expression === "to.have.accessible.name") {
        received = getElementAccessibleName(
          element,
          false
          /* includeHidden */
        );
      } else if (expression === "to.have.accessible.description") {
        received = getElementAccessibleDescription(
          element,
          false
          /* includeHidden */
        );
      } else if (expression === "to.have.role") {
        received = getAriaRole(element) || "";
      } else if (expression === "to.have.title") {
        received = this.document.title;
      } else if (expression === "to.have.url") {
        received = this.document.location.href;
      } else if (expression === "to.have.value") {
        element = this.retarget(element, "follow-label");
        if (element.nodeName !== "INPUT" && element.nodeName !== "TEXTAREA" && element.nodeName !== "SELECT")
          throw this.createStacklessError("Not an input element");
        received = element.value;
      }
      if (received !== void 0 && options.expectedText) {
        const matcher = new ExpectedTextMatcher(options.expectedText[0]);
        return { received, matches: matcher.matches(received) };
      }
    }
    throw this.createStacklessError("Unknown expect matcher: " + expression);
  }
  expectArray(elements, options) {
    const expression = options.expression;
    if (expression === "to.have.count") {
      const received2 = elements.length;
      const matches = received2 === options.expectedNumber;
      return { received: received2, matches };
    }
    let received;
    if (expression === "to.have.text.array" || expression === "to.contain.text.array")
      received = elements.map((e) => options.useInnerText ? e.innerText : elementText(/* @__PURE__ */ new Map(), e).full);
    else if (expression === "to.have.class.array")
      received = elements.map((e) => e.classList.toString());
    if (received && options.expectedText) {
      const lengthShouldMatch = expression !== "to.contain.text.array";
      const matchesLength = received.length === options.expectedText.length || !lengthShouldMatch;
      if (!matchesLength)
        return { received, matches: false };
      const matchers = options.expectedText.map((e) => new ExpectedTextMatcher(e));
      let mIndex = 0, rIndex = 0;
      while (mIndex < matchers.length && rIndex < received.length) {
        if (matchers[mIndex].matches(received[rIndex]))
          ++mIndex;
        ++rIndex;
      }
      return { received, matches: mIndex === matchers.length };
    }
    throw this.createStacklessError("Unknown expect matcher: " + expression);
  }
  generateSimpleDomNode(selector) {
    const element = this.querySelector(this.parseSelector(selector), this.document.documentElement, true);
    if (!element)
      return;
    return generateSimpleDomNode(this, element);
  }
  selectorForSimpleDomNodeId(nodeId) {
    return selectorForSimpleDomNodeId(this, nodeId);
  }
};
var autoClosingTags = /* @__PURE__ */ new Set(["AREA", "BASE", "BR", "COL", "COMMAND", "EMBED", "HR", "IMG", "INPUT", "KEYGEN", "LINK", "MENUITEM", "META", "PARAM", "SOURCE", "TRACK", "WBR"]);
var booleanAttributes = /* @__PURE__ */ new Set(["checked", "selected", "disabled", "readonly", "multiple"]);
function oneLine(s) {
  return s.replace(/\\n/g, "\\u21B5").replace(/\\t/g, "\\u21C6");
}
var eventType = /* @__PURE__ */ new Map([
  ["auxclick", "mouse"],
  ["click", "mouse"],
  ["dblclick", "mouse"],
  ["mousedown", "mouse"],
  ["mouseeenter", "mouse"],
  ["mouseleave", "mouse"],
  ["mousemove", "mouse"],
  ["mouseout", "mouse"],
  ["mouseover", "mouse"],
  ["mouseup", "mouse"],
  ["mouseleave", "mouse"],
  ["mousewheel", "mouse"],
  ["keydown", "keyboard"],
  ["keyup", "keyboard"],
  ["keypress", "keyboard"],
  ["textInput", "keyboard"],
  ["touchstart", "touch"],
  ["touchmove", "touch"],
  ["touchend", "touch"],
  ["touchcancel", "touch"],
  ["pointerover", "pointer"],
  ["pointerout", "pointer"],
  ["pointerenter", "pointer"],
  ["pointerleave", "pointer"],
  ["pointerdown", "pointer"],
  ["pointerup", "pointer"],
  ["pointermove", "pointer"],
  ["pointercancel", "pointer"],
  ["gotpointercapture", "pointer"],
  ["lostpointercapture", "pointer"],
  ["focus", "focus"],
  ["blur", "focus"],
  ["drag", "drag"],
  ["dragstart", "drag"],
  ["dragend", "drag"],
  ["dragover", "drag"],
  ["dragenter", "drag"],
  ["dragleave", "drag"],
  ["dragexit", "drag"],
  ["drop", "drag"],
  ["wheel", "wheel"],
  ["deviceorientation", "deviceorientation"],
  ["deviceorientationabsolute", "deviceorientation"],
  ["devicemotion", "devicemotion"]
]);
var kHoverHitTargetInterceptorEvents = /* @__PURE__ */ new Set(["mousemove"]);
var kTapHitTargetInterceptorEvents = /* @__PURE__ */ new Set(["pointerdown", "pointerup", "touchstart", "touchend", "touchcancel"]);
var kMouseHitTargetInterceptorEvents = /* @__PURE__ */ new Set(["mousedown", "mouseup", "pointerdown", "pointerup", "click", "auxclick", "dblclick", "contextmenu"]);
var kAllHitTargetInterceptorEvents = /* @__PURE__ */ new Set([...kHoverHitTargetInterceptorEvents, ...kTapHitTargetInterceptorEvents, ...kMouseHitTargetInterceptorEvents]);
function cssUnquote(s) {
  s = s.substring(1, s.length - 1);
  if (!s.includes("\\\\"))
    return s;
  const r = [];
  let i = 0;
  while (i < s.length) {
    if (s[i] === "\\\\" && i + 1 < s.length)
      i++;
    r.push(s[i++]);
  }
  return r.join("");
}
function createTextMatcher(selector, internal) {
  if (selector[0] === "/" && selector.lastIndexOf("/") > 0) {
    const lastSlash = selector.lastIndexOf("/");
    const re = new RegExp(selector.substring(1, lastSlash), selector.substring(lastSlash + 1));
    return { matcher: (elementText2) => re.test(elementText2.full), kind: "regex" };
  }
  const unquote = internal ? JSON.parse.bind(JSON) : cssUnquote;
  let strict = false;
  if (selector.length > 1 && selector[0] === '"' && selector[selector.length - 1] === '"') {
    selector = unquote(selector);
    strict = true;
  } else if (internal && selector.length > 1 && selector[0] === '"' && selector[selector.length - 2] === '"' && selector[selector.length - 1] === "i") {
    selector = unquote(selector.substring(0, selector.length - 1));
    strict = false;
  } else if (internal && selector.length > 1 && selector[0] === '"' && selector[selector.length - 2] === '"' && selector[selector.length - 1] === "s") {
    selector = unquote(selector.substring(0, selector.length - 1));
    strict = true;
  } else if (selector.length > 1 && selector[0] === "'" && selector[selector.length - 1] === "'") {
    selector = unquote(selector);
    strict = true;
  }
  selector = normalizeWhiteSpace(selector);
  if (strict) {
    if (internal)
      return { kind: "strict", matcher: (elementText2) => elementText2.normalized === selector };
    const strictTextNodeMatcher = (elementText2) => {
      if (!selector && !elementText2.immediate.length)
        return true;
      return elementText2.immediate.some((s) => normalizeWhiteSpace(s) === selector);
    };
    return { matcher: strictTextNodeMatcher, kind: "strict" };
  }
  selector = selector.toLowerCase();
  return { kind: "lax", matcher: (elementText2) => elementText2.normalized.toLowerCase().includes(selector) };
}
var ExpectedTextMatcher = class {
  constructor(expected) {
    this._normalizeWhiteSpace = expected.normalizeWhiteSpace;
    this._ignoreCase = expected.ignoreCase;
    this._string = expected.matchSubstring ? void 0 : this.normalize(expected.string);
    this._substring = expected.matchSubstring ? this.normalize(expected.string) : void 0;
    if (expected.regexSource) {
      const flags = new Set((expected.regexFlags || "").split(""));
      if (expected.ignoreCase === false)
        flags.delete("i");
      if (expected.ignoreCase === true)
        flags.add("i");
      this._regex = new RegExp(expected.regexSource, [...flags].join(""));
    }
  }
  matches(text) {
    if (!this._regex)
      text = this.normalize(text);
    if (this._string !== void 0)
      return text === this._string;
    if (this._substring !== void 0)
      return text.includes(this._substring);
    if (this._regex)
      return !!this._regex.test(text);
    return false;
  }
  normalize(s) {
    if (!s)
      return s;
    if (this._normalizeWhiteSpace)
      s = normalizeWhiteSpace(s);
    if (this._ignoreCase)
      s = s.toLocaleLowerCase();
    return s;
  }
};
function deepEquals(a, b) {
  if (a === b)
    return true;
  if (a && b && typeof a === "object" && typeof b === "object") {
    if (a.constructor !== b.constructor)
      return false;
    if (Array.isArray(a)) {
      if (a.length !== b.length)
        return false;
      for (let i = 0; i < a.length; ++i) {
        if (!deepEquals(a[i], b[i]))
          return false;
      }
      return true;
    }
    if (a instanceof RegExp)
      return a.source === b.source && a.flags === b.flags;
    if (a.valueOf !== Object.prototype.valueOf)
      return a.valueOf() === b.valueOf();
    if (a.toString !== Object.prototype.toString)
      return a.toString() === b.toString();
    const keys = Object.keys(a);
    if (keys.length !== Object.keys(b).length)
      return false;
    for (let i = 0; i < keys.length; ++i) {
      if (!b.hasOwnProperty(keys[i]))
        return false;
    }
    for (const key of keys) {
      if (!deepEquals(a[key], b[key]))
        return false;
    }
    return true;
  }
  if (typeof a === "number" && typeof b === "number")
    return isNaN(a) && isNaN(b);
  return false;
}
`});var rp,ip=x(()=>{rp=`
var __commonJS = obj => {
  let required = false;
  let result;
  return function __require() {
    if (!required) {
      required = true;
      let fn;
      for (const name in obj) { fn = obj[name]; break; }
      const module = { exports: {} };
      fn(module.exports, module);
      result = module.exports;
    }
    return result;
  }
};
var __export = (target, all) => {for (var name in all) target[name] = all[name];};
var __toESM = mod => ({ ...mod, 'default': mod });
var __toCommonJS = mod => ({ ...mod, __esModule: true });


// packages/playwright-core/src/server/injected/utilityScript.ts
var utilityScript_exports = {};
__export(utilityScript_exports, {
  UtilityScript: () => UtilityScript
});
module.exports = __toCommonJS(utilityScript_exports);

// packages/playwright-core/src/server/isomorphic/utilityScriptSerializers.ts
function source() {
  function isRegExp(obj) {
    try {
      return obj instanceof RegExp || Object.prototype.toString.call(obj) === "[object RegExp]";
    } catch (error) {
      return false;
    }
  }
  function isDate(obj) {
    try {
      return obj instanceof Date || Object.prototype.toString.call(obj) === "[object Date]";
    } catch (error) {
      return false;
    }
  }
  function isURL(obj) {
    try {
      return obj instanceof URL || Object.prototype.toString.call(obj) === "[object URL]";
    } catch (error) {
      return false;
    }
  }
  function isError(obj) {
    var _a;
    try {
      return obj instanceof Error || obj && ((_a = Object.getPrototypeOf(obj)) == null ? void 0 : _a.name) === "Error";
    } catch (error) {
      return false;
    }
  }
  function parseEvaluationResultValue2(value, handles = [], refs = /* @__PURE__ */ new Map()) {
    if (Object.is(value, void 0))
      return void 0;
    if (typeof value === "object" && value) {
      if ("ref" in value)
        return refs.get(value.ref);
      if ("v" in value) {
        if (value.v === "undefined")
          return void 0;
        if (value.v === "null")
          return null;
        if (value.v === "NaN")
          return NaN;
        if (value.v === "Infinity")
          return Infinity;
        if (value.v === "-Infinity")
          return -Infinity;
        if (value.v === "-0")
          return -0;
        return void 0;
      }
      if ("d" in value)
        return new Date(value.d);
      if ("u" in value)
        return new URL(value.u);
      if ("bi" in value)
        return BigInt(value.bi);
      if ("e" in value) {
        const error = new Error(value.e.m);
        error.name = value.e.n;
        error.stack = value.e.s;
        return error;
      }
      if ("r" in value)
        return new RegExp(value.r.p, value.r.f);
      if ("a" in value) {
        const result2 = [];
        refs.set(value.id, result2);
        for (const a of value.a)
          result2.push(parseEvaluationResultValue2(a, handles, refs));
        return result2;
      }
      if ("o" in value) {
        const result2 = {};
        refs.set(value.id, result2);
        for (const { k, v } of value.o)
          result2[k] = parseEvaluationResultValue2(v, handles, refs);
        return result2;
      }
      if ("h" in value)
        return handles[value.h];
    }
    return value;
  }
  function serializeAsCallArgument2(value, handleSerializer) {
    return serialize(value, handleSerializer, { visited: /* @__PURE__ */ new Map(), lastId: 0 });
  }
  function serialize(value, handleSerializer, visitorInfo) {
    if (value && typeof value === "object") {
      if (typeof globalThis.Window === "function" && value instanceof globalThis.Window)
        return "ref: <Window>";
      if (typeof globalThis.Document === "function" && value instanceof globalThis.Document)
        return "ref: <Document>";
      if (typeof globalThis.Node === "function" && value instanceof globalThis.Node)
        return "ref: <Node>";
    }
    return innerSerialize(value, handleSerializer, visitorInfo);
  }
  function innerSerialize(value, handleSerializer, visitorInfo) {
    var _a;
    const result2 = handleSerializer(value);
    if ("fallThrough" in result2)
      value = result2.fallThrough;
    else
      return result2;
    if (typeof value === "symbol")
      return { v: "undefined" };
    if (Object.is(value, void 0))
      return { v: "undefined" };
    if (Object.is(value, null))
      return { v: "null" };
    if (Object.is(value, NaN))
      return { v: "NaN" };
    if (Object.is(value, Infinity))
      return { v: "Infinity" };
    if (Object.is(value, -Infinity))
      return { v: "-Infinity" };
    if (Object.is(value, -0))
      return { v: "-0" };
    if (typeof value === "boolean")
      return value;
    if (typeof value === "number")
      return value;
    if (typeof value === "string")
      return value;
    if (typeof value === "bigint")
      return { bi: value.toString() };
    if (isError(value)) {
      let stack;
      if ((_a = value.stack) == null ? void 0 : _a.startsWith(value.name + ": " + value.message)) {
        stack = value.stack;
      } else {
        stack = \`\${value.name}: \${value.message}
\${value.stack}\`;
      }
      return { e: { n: value.name, m: value.message, s: stack } };
    }
    if (isDate(value))
      return { d: value.toJSON() };
    if (isURL(value))
      return { u: value.toJSON() };
    if (isRegExp(value))
      return { r: { p: value.source, f: value.flags } };
    const id = visitorInfo.visited.get(value);
    if (id)
      return { ref: id };
    if (Array.isArray(value)) {
      const a = [];
      const id2 = ++visitorInfo.lastId;
      visitorInfo.visited.set(value, id2);
      for (let i = 0; i < value.length; ++i)
        a.push(serialize(value[i], handleSerializer, visitorInfo));
      return { a, id: id2 };
    }
    if (typeof value === "object") {
      const o = [];
      const id2 = ++visitorInfo.lastId;
      visitorInfo.visited.set(value, id2);
      for (const name of Object.keys(value)) {
        let item;
        try {
          item = value[name];
        } catch (e) {
          continue;
        }
        if (name === "toJSON" && typeof item === "function")
          o.push({ k: name, v: { o: [], id: 0 } });
        else
          o.push({ k: name, v: serialize(item, handleSerializer, visitorInfo) });
      }
      let jsonWrapper;
      try {
        if (o.length === 0 && value.toJSON && typeof value.toJSON === "function")
          jsonWrapper = { value: value.toJSON() };
      } catch (e) {
      }
      if (jsonWrapper)
        return innerSerialize(jsonWrapper.value, handleSerializer, visitorInfo);
      return { o, id: id2 };
    }
  }
  return { parseEvaluationResultValue: parseEvaluationResultValue2, serializeAsCallArgument: serializeAsCallArgument2 };
}
var result = source();
var parseEvaluationResultValue = result.parseEvaluationResultValue;
var serializeAsCallArgument = result.serializeAsCallArgument;

// packages/playwright-core/src/server/injected/utilityScript.ts
var UtilityScript = class {
  constructor(isUnderTest) {
    this.serializeAsCallArgument = serializeAsCallArgument;
    this.parseEvaluationResultValue = parseEvaluationResultValue;
    if (isUnderTest)
      this._setBuiltins();
  }
  evaluate(isFunction, returnByValue, expression, argCount, ...argsAndHandles) {
    const args = argsAndHandles.slice(0, argCount);
    const handles = argsAndHandles.slice(argCount);
    const parameters = [];
    for (let i = 0; i < args.length; i++)
      parameters[i] = this.parseEvaluationResultValue(args[i], handles);
    let result2 = globalThis.eval(expression);
    if (isFunction === true) {
      result2 = result2(...parameters);
    } else if (isFunction === false) {
      result2 = result2;
    } else {
      if (typeof result2 === "function")
        result2 = result2(...parameters);
    }
    return returnByValue ? this._promiseAwareJsonValueNoThrow(result2) : result2;
  }
  jsonValue(returnByValue, value) {
    if (Object.is(value, void 0))
      return void 0;
    return serializeAsCallArgument(value, (value2) => ({ fallThrough: value2 }));
  }
  _promiseAwareJsonValueNoThrow(value) {
    const safeJson = (value2) => {
      try {
        return this.jsonValue(true, value2);
      } catch (e) {
        return void 0;
      }
    };
    if (value && typeof value === "object" && typeof value.then === "function") {
      return (async () => {
        const promiseValue = await value;
        return safeJson(promiseValue);
      })();
    }
    return safeJson(value);
  }
  _setBuiltins() {
    var _a, _b;
    const window = globalThis;
    window.builtinSetTimeout = (callback, timeout) => {
      var _a2;
      if ((_a2 = window.__pwClock) == null ? void 0 : _a2.builtin)
        return window.__pwClock.builtin.setTimeout(callback, timeout);
      return setTimeout(callback, timeout);
    };
    window.builtinClearTimeout = (id) => {
      var _a2;
      if ((_a2 = window.__pwClock) == null ? void 0 : _a2.builtin)
        return window.__pwClock.builtin.clearTimeout(id);
      return clearTimeout(id);
    };
    window.builtinSetInterval = (callback, timeout) => {
      var _a2;
      if ((_a2 = window.__pwClock) == null ? void 0 : _a2.builtin)
        return window.__pwClock.builtin.setInterval(callback, timeout);
      return setInterval(callback, timeout);
    };
    window.builtinClearInterval = (id) => {
      var _a2;
      if ((_a2 = window.__pwClock) == null ? void 0 : _a2.builtin)
        return window.__pwClock.builtin.clearInterval(id);
      return clearInterval(id);
    };
    window.builtinRequestAnimationFrame = (callback) => {
      var _a2;
      if ((_a2 = window.__pwClock) == null ? void 0 : _a2.builtin)
        return window.__pwClock.builtin.requestAnimationFrame(callback);
      return requestAnimationFrame(callback);
    };
    window.builtinCancelAnimationFrame = (id) => {
      var _a2;
      if ((_a2 = window.__pwClock) == null ? void 0 : _a2.builtin)
        return window.__pwClock.builtin.cancelAnimationFrame(id);
      return cancelAnimationFrame(id);
    };
    window.builtinDate = ((_a = window.__pwClock) == null ? void 0 : _a.builtin.Date) || Date;
    window.builtinPerformance = ((_b = window.__pwClock) == null ? void 0 : _b.builtin.performance) || performance;
  }
};
`});function zc(){function i(c){try{return c instanceof RegExp||Object.prototype.toString.call(c)==="[object RegExp]"}catch{return!1}}function e(c){try{return c instanceof Date||Object.prototype.toString.call(c)==="[object Date]"}catch{return!1}}function t(c){try{return c instanceof URL||Object.prototype.toString.call(c)==="[object URL]"}catch{return!1}}function n(c){try{return c instanceof Error||c&&Object.getPrototypeOf(c)?.name==="Error"}catch{return!1}}function r(c,h=[],m=new Map){if(!Object.is(c,void 0)){if(typeof c=="object"&&c){if("ref"in c)return m.get(c.ref);if("v"in c)return c.v==="undefined"?void 0:c.v==="null"?null:c.v==="NaN"?NaN:c.v==="Infinity"?1/0:c.v==="-Infinity"?-1/0:c.v==="-0"?-0:void 0;if("d"in c)return new Date(c.d);if("u"in c)return new URL(c.u);if("bi"in c)return BigInt(c.bi);if("e"in c){let f=new Error(c.e.m);return f.name=c.e.n,f.stack=c.e.s,f}if("r"in c)return new RegExp(c.r.p,c.r.f);if("a"in c){let f=[];m.set(c.id,f);for(let g of c.a)f.push(r(g,h,m));return f}if("o"in c){let f={};m.set(c.id,f);for(let{k:g,v:b}of c.o)f[g]=r(b,h,m);return f}if("h"in c)return h[c.h]}return c}}function s(c,h){return o(c,h,{visited:new Map,lastId:0})}function o(c,h,m){if(c&&typeof c=="object"){if(typeof globalThis.Window=="function"&&c instanceof globalThis.Window)return"ref: <Window>";if(typeof globalThis.Document=="function"&&c instanceof globalThis.Document)return"ref: <Document>";if(typeof globalThis.Node=="function"&&c instanceof globalThis.Node)return"ref: <Node>"}return l(c,h,m)}function l(c,h,m){let f=h(c);if("fallThrough"in f)c=f.fallThrough;else return f;if(typeof c=="symbol")return{v:"undefined"};if(Object.is(c,void 0))return{v:"undefined"};if(Object.is(c,null))return{v:"null"};if(Object.is(c,NaN))return{v:"NaN"};if(Object.is(c,1/0))return{v:"Infinity"};if(Object.is(c,-1/0))return{v:"-Infinity"};if(Object.is(c,-0))return{v:"-0"};if(typeof c=="boolean"||typeof c=="number"||typeof c=="string")return c;if(typeof c=="bigint")return{bi:c.toString()};if(n(c)){let b;return c.stack?.startsWith(c.name+": "+c.message)?b=c.stack:b=`${c.name}: ${c.message}
${c.stack}`,{e:{n:c.name,m:c.message,s:b}}}if(e(c))return{d:c.toJSON()};if(t(c))return{u:c.toJSON()};if(i(c))return{r:{p:c.source,f:c.flags}};let g=m.visited.get(c);if(g)return{ref:g};if(Array.isArray(c)){let b=[],v=++m.lastId;m.visited.set(c,v);for(let S=0;S<c.length;++S)b.push(o(c[S],h,m));return{a:b,id:v}}if(typeof c=="object"){let b=[],v=++m.lastId;m.visited.set(c,v);for(let _ of Object.keys(c)){let k;try{k=c[_]}catch{continue}_==="toJSON"&&typeof k=="function"?b.push({k:_,v:{o:[],id:0}}):b.push({k:_,v:o(k,h,m)})}let S;try{b.length===0&&c.toJSON&&typeof c.toJSON=="function"&&(S={value:c.toJSON()})}catch{}return S?l(S.value,h,m):{o:b,id:v}}}return{parseEvaluationResultValue:r,serializeAsCallArgument:s}}var sp,zo,op,Uo=x(()=>{sp=zc(),zo=sp.parseEvaluationResultValue,op=sp.serializeAsCallArgument});async function ps(i,e,t,...n){return _n(i,String(t),{returnByValue:e,isFunction:typeof t=="function"},...n)}async function _n(i,e,t,...n){let r=await i.utilityScript();e=Uc(e,t.isFunction);let s=[],o=[],l=f=>(s.push(f),s.length-1);n=n.map(f=>op(f,g=>{if(g instanceof Kt){if(!g._objectId)return{fallThrough:g._value};if(g._disposed)throw new vn("JSHandle is disposed!");let b=i.adoptIfNeeded(g);return b===null?{h:l(Promise.resolve(g))}:(o.push(b),{h:l(b)})}return{fallThrough:g}}));let c=[];for(let f of await Promise.all(s)){if(f._context!==i)throw new vn("JSHandles can be evaluated only in the context they were created!");c.push(f._objectId)}let h=[t.isFunction,t.returnByValue,e,n.length,...n],m="(utilityScript, ...args) => utilityScript.evaluate(...args)";try{return await i.evaluateWithArguments(m,t.returnByValue||!1,r,h,c)}finally{o.map(f=>f.then(g=>g.dispose()))}}function ap(i){if(i==="NaN")return NaN;if(i==="Infinity")return 1/0;if(i==="-Infinity")return-1/0;if(i==="-0")return-0}function Uc(i,e){if(i=i.trim(),e)try{new Function("("+i+")")}catch{i.startsWith("async ")?i="async function "+i.substring(6):i="function "+i;try{new Function("("+i+")")}catch{throw new Error("Passed function is not well-serializable!")}}return/^(async)?\s*function(\s|\()/.test(i)&&(i="("+i+")"),i}function ot(i){return i instanceof vn}function lp(i){let e=[];for(let{name:r,value:s}of i){let o=+r;isNaN(o)||o<0||e.push({index:o,value:s})}e.sort((r,s)=>r.index-s.index);let t=-1,n=[];for(let{index:r,value:s}of e){let o=r-t-1;o===1?n.push("empty"):o>1&&n.push(`empty x ${o}`),n.push(String(s)),t=r}return"["+n.join(", ")+"]"}var $n,Kt,vn,ms=x(()=>{ip();Uo();ye();qe();O();$n=class extends se{_delegate;_utilityScriptPromise;_contextDestroyedScope=new Re;worldNameForTest;constructor(e,t,n){super(e,"execution-context"),this.worldNameForTest=n,this._delegate=t}contextDestroyed(e){this._contextDestroyedScope.close(new Error(e))}async _raceAgainstContextDestroyed(e){return this._contextDestroyedScope.race(e)}rawEvaluateJSON(e){return this._raceAgainstContextDestroyed(this._delegate.rawEvaluateJSON(e))}rawEvaluateHandle(e){return this._raceAgainstContextDestroyed(this._delegate.rawEvaluateHandle(e))}rawCallFunctionNoReply(e,...t){this._delegate.rawCallFunctionNoReply(e,...t)}evaluateWithArguments(e,t,n,r,s){return this._raceAgainstContextDestroyed(this._delegate.evaluateWithArguments(e,t,n,r,s))}getProperties(e,t){return this._raceAgainstContextDestroyed(this._delegate.getProperties(e,t))}createHandle(e){return this._delegate.createHandle(this,e)}releaseHandle(e){return this._delegate.releaseHandle(e)}adoptIfNeeded(e){return null}utilityScript(){if(!this._utilityScriptPromise){let e=`
      (() => {
        const module = {};
        ${rp}
        return new (module.exports.UtilityScript())(${ce()});
      })();`;this._utilityScriptPromise=this._raceAgainstContextDestroyed(this._delegate.rawEvaluateHandle(e).then(t=>new Kt(this,"object","UtilityScript",t)))}return this._utilityScriptPromise}async objectCount(e){return this._delegate.objectCount(e)}async doSlowMo(){}},Kt=class extends se{__jshandle=!0;_context;_disposed=!1;_objectId;_value;_objectType;_preview;_previewCallback;constructor(e,t,n,r,s){super(e,"handle"),this._context=e,this._objectId=r,this._value=s,this._objectType=t,this._preview=this._objectId?n||`JSHandle@${this._objectType}`:String(s),this._objectId&&globalThis.leakedJSHandles&&globalThis.leakedJSHandles.set(this,new Error("Leaked JSHandle"))}callFunctionNoReply(e,t){this._context.rawCallFunctionNoReply(e,this,t)}async evaluate(e,t){return ps(this._context,!0,e,this,t)}async evaluateHandle(e,t){return ps(this._context,!1,e,this,t)}async evaluateExpression(e,t,n){let r=await _n(this._context,e,{...t,returnByValue:!0},this,n);return await this._context.doSlowMo(),r}async evaluateExpressionHandle(e,t,n){let r=await _n(this._context,e,{...t,returnByValue:!1},this,n);return await this._context.doSlowMo(),r}async getProperty(e){let t=await this.evaluateHandle((s,o)=>{let l={__proto__:null};return l[o]=s[o],l},e),r=(await t.getProperties()).get(e);return t.dispose(),r}async getProperties(){return this._objectId?this._context.getProperties(this._context,this._objectId):new Map}rawValue(){return this._value}async jsonValue(){if(!this._objectId)return this._value;let e=await this._context.utilityScript();return this._context.evaluateWithArguments("(utilityScript, ...args) => utilityScript.jsonValue(...args)",!0,e,[!0],[this._objectId])}asElement(){return null}dispose(){this._disposed||(this._disposed=!0,this._objectId&&(this._context.releaseHandle(this._objectId).catch(e=>{}),globalThis.leakedJSHandles&&globalThis.leakedJSHandles.delete(this)))}toString(){return this._preview}_setPreviewCallback(e){this._previewCallback=e}preview(){return this._preview}worldNameForTest(){return this._context.worldNameForTest}_setPreview(e){this._preview=e,this._previewCallback&&this._previewCallback(e)}async objectCount(){if(!this._objectId)throw new Error("Can only count objects for a handle that points to the constructor prototype");return this._context.objectCount(this._objectId)}};vn=class extends Error{}});async function cp(i){try{await i()}catch{}}var z,Vc,Nt=x(()=>{Vt();O();qe();z=class{_forceAbortPromise=new U;_cleanups=[];_logName="api";_state="before";_deadline=0;_timeout=0;metadata;instrumentation;sdkObject;constructor(e,t){this.metadata=e,this.sdkObject=t,this.instrumentation=t.instrumentation,this._forceAbortPromise.catch(n=>null)}setLogName(e){this._logName=e}abort(e){this._forceAbortPromise.reject(e)}async run(e,t){t&&(this._timeout=t,this._deadline=t?X()+t:0),E(this._state==="before"),this._state="running",this.sdkObject.attribution.context?._activeProgressControllers.add(this);let n={log:o=>{this._state==="running"&&this.metadata.log.push(o),this.instrumentation.onCallLog(this.sdkObject,this.metadata,this._logName,o)},timeUntilDeadline:()=>this._deadline?this._deadline-X():2147483647,isRunning:()=>this._state==="running",cleanupWhenAborted:o=>{this._state==="running"?this._cleanups.push(o):cp(o)},throwIfAborted:()=>{if(this._state==="aborted")throw new Vc},beforeInputAction:async o=>{await this.instrumentation.onBeforeInputAction(this.sdkObject,this.metadata,o)},metadata:this.metadata},r=new qr(`Timeout ${this._timeout}ms exceeded.`),s=setTimeout(()=>this._forceAbortPromise.reject(r),n.timeUntilDeadline());try{let o=e(n),l=await Promise.race([o,this._forceAbortPromise]);return this._state="finished",l}catch(o){throw this._state="aborted",await Promise.all(this._cleanups.splice(0).map(cp)),o}finally{this.sdkObject.attribution.context?._activeProgressControllers.delete(this),clearTimeout(s)}}};Vc=class extends Error{}});import Gc from"path";async function Lw(i){return(await Promise.all(i.map(async t=>(await fs.promises.stat(t)).size))).reduce((t,n)=>t+n,0)>=mo}async function Go(i,e){let{payloads:t,streams:n,directoryStream:r}=e,{localPaths:s,localDirectory:o}=e;if([t,s,o,n,r].filter(Boolean).length!==1)throw new Error("Exactly one of payloads, localPaths and streams must be provided");if(n&&(s=n.map(h=>h.path())),r&&(o=r.path()),s)for(let h of s)E(Gc.isAbsolute(h)&&Gc.resolve(h)===h,"Paths provided to localPaths must be absolute and fully resolved.");let l=t;if(!i._page._browserContext._browser._isCollocatedWithServer&&s){if(await Lw(s))throw new Error("Cannot transfer files larger than 50Mb to a browser not co-located with the server");l=await Promise.all(s.map(async h=>({name:Gc.basename(h),buffer:await fs.promises.readFile(h),lastModifiedMs:(await fs.promises.stat(h)).mtimeMs}))),s=void 0}let c=l?.map(h=>({name:h.name,mimeType:h.mimeType||mime.getType(h.name)||"application/octet-stream",buffer:h.buffer.toString("base64"),lastModifiedMs:h.lastModifiedMs}));return{localPaths:s,localDirectory:o,filePayloads:c}}var Kc=x(()=>{O()});function dp(i){return i instanceof Ur}function Me(i){if(i==="error:notconnected")throw new Error("Element is not attached to the DOM");return i}function Ow(i){return{x:(i.x*100|0)/100,y:(i.y*100|0)/100}}function Mw(i){let e=i.x-Math.floor(i.x);e>.49&&e<.51&&(i.x-=.02);let t=i.y-Math.floor(i.y);t>.49&&t<.51&&(i.y-=.02)}var Ur,Ko,Jo,up,Jc=x(()=>{np();gn();ms();Nt();O();Kc();Ur=class extends Error{};Ko=class extends $n{frame;_injectedScriptPromise;world;constructor(e,t,n){super(t,e,n||"content-script"),this.frame=t,this.world=n}adoptIfNeeded(e){return e instanceof Jo&&e._context!==this?this.frame._page._delegate.adoptElementHandle(e,this):null}async evaluate(e,t){return ps(this,!0,e,t)}async evaluateHandle(e,t){return ps(this,!1,e,t)}async evaluateExpression(e,t,n){return _n(this,e,{...t,returnByValue:!0},n)}async evaluateExpressionHandle(e,t,n){return _n(this,e,{...t,returnByValue:!1},n)}createHandle(e){return this.frame._page._delegate.isElementHandle(e)?new Jo(this,e.objectId):super.createHandle(e)}injectedScript(){if(!this._injectedScriptPromise){let e=[],t=this.frame._page.context().selectors();for(let[s,{source:o}]of t._engines)e.push(`{ name: '${s}', engine: (${o}) }`);let n=this.frame.attribution.playwright.options.sdkLanguage,r=`
        (() => {
        const module = {};
        ${tp}
        return new (module.exports.InjectedScript())(
          globalThis,
          ${ce()},
          "${n}",
          ${JSON.stringify(t.testIdAttributeName())},
          ${this.frame._page._delegate.rafCountForStablePosition()},
          "${this.frame._page._browserContext._browser.options.name}",
          [${e.join(`,
`)}]
        );
        })();
      `;this._injectedScriptPromise=this.rawEvaluateHandle(r).then(s=>new Kt(this,"object","InjectedScript",s))}return this._injectedScriptPromise}},Jo=class extends Kt{__elementhandle=!0;_page;_frame;constructor(e,t){super(e,"node",void 0,t),this._page=e.frame._page,this._frame=e.frame,this._initializePreview().catch(n=>{})}async _initializePreview(){let e=await this._context.injectedScript();this._setPreview(await e.evaluate((t,n)=>"JSHandle@"+t.previewNode(n),this))}asElement(){return this}async evaluateInUtility(e,t){try{let n=await this._frame._utilityContext();return await n.evaluate(e,[await n.injectedScript(),this,t])}catch(n){if(ot(n)||mt(n))throw n;return"error:notconnected"}}async evaluateHandleInUtility(e,t){try{let n=await this._frame._utilityContext();return await n.evaluateHandle(e,[await n.injectedScript(),this,t])}catch(n){if(ot(n)||mt(n))throw n;return"error:notconnected"}}async ownerFrame(){let e=await this._page._delegate.getOwnerFrame(this);if(!e)return null;let t=this._page._frameManager.frame(e);if(t)return t;for(let n of this._page._browserContext.pages()){let r=n._frameManager.frame(e);if(r)return r}return null}async isIframeElement(){return this.evaluateInUtility(([e,t])=>t&&(t.nodeName==="IFRAME"||t.nodeName==="FRAME"),{})}async contentFrame(){return Me(await this.isIframeElement())?this._page._delegate.getContentFrame(this):null}async getAttribute(e,t){return this._frame.getAttribute(e,":scope",t,{},this)}async inputValue(e){return this._frame.inputValue(e,":scope",{},this)}async textContent(e){return this._frame.textContent(e,":scope",{},this)}async innerText(e){return this._frame.innerText(e,":scope",{},this)}async innerHTML(e){return this._frame.innerHTML(e,":scope",{},this)}async dispatchEvent(e,t,n={}){return this._frame.dispatchEvent(e,":scope",t,n,{},this)}async _scrollRectIntoViewIfNeeded(e){return await this._page._delegate.scrollRectIntoViewIfNeeded(this,e)}async _waitAndScrollIntoViewIfNeeded(e,t){let n=await this._retryAction(e,"scroll into view",async()=>{e.log("  waiting for element to be stable");let r=await this.evaluateInUtility(async([s,o,{waitForVisible:l}])=>await s.checkElementStates(o,l?["visible","stable"]:["stable"]),{waitForVisible:t});return r||await this._scrollRectIntoViewIfNeeded()},{});Me(n)}async scrollIntoViewIfNeeded(e,t={}){return new z(e,this).run(r=>this._waitAndScrollIntoViewIfNeeded(r,!1),this._page._timeoutSettings.timeout(t))}async _clickablePoint(){let e=l=>l.map(c=>({x:Math.min(Math.max(c.x,0),r.width),y:Math.min(Math.max(c.y,0),r.height)})),t=l=>{let c=0;for(let h=0;h<l.length;++h){let m=l[h],f=l[(h+1)%l.length];c+=(m.x*f.y-f.x*m.y)/2}return Math.abs(c)},[n,r]=await Promise.all([this._page._delegate.getContentQuads(this),this._page.mainFrame()._utilityContext().then(l=>l.evaluate(()=>({width:innerWidth,height:innerHeight})))]);if(n==="error:notconnected")return n;if(!n||!n.length)return"error:notvisible";let s=n.map(l=>e(l)).filter(l=>t(l)>.99);if(!s.length)return"error:notinviewport";let o={x:0,y:0};for(let l of s[0])o.x+=l.x/4,o.y+=l.y/4;return Mw(o),o}async _offsetPoint(e){let[t,n]=await Promise.all([this.boundingBox(),this.evaluateInUtility(([r,s])=>r.getElementBorderWidth(s),{}).catch(r=>{})]);return!t||!n?"error:notvisible":n==="error:notconnected"?n:{x:t.x+n.left+e.x,y:t.y+n.top+e.y}}async _retryAction(e,t,n,r){let s=0,o=[0,20,100,100,500];for(;e.isRunning();){if(s){e.log(`retrying ${t} action${r.trial?" (trial run)":""}, attempt #${s}`);let c=o[Math.min(s-1,o.length-1)];if(c){e.log(`  waiting ${c}ms`);let h=await this.evaluateInUtility(([m,f,g])=>new Promise(b=>setTimeout(b,g)),c);if(h==="error:notconnected")return h}}else e.log(`attempting ${t} action${r.trial?" (trial run)":""}`);!r.skipLocatorHandlersCheckpoint&&!r.force&&await this._frame._page.performLocatorHandlersCheckpoint(e);let l=await n(s);if(++s,l==="error:notvisible"){if(r.force)throw new Ur("Element is not visible");e.log("  element is not visible");continue}if(l==="error:notinviewport"){if(r.force)throw new Ur("Element is outside of the viewport");e.log("  element is outside of the viewport");continue}if(l==="error:optionsnotfound"){e.log("  did not find some options");continue}if(typeof l=="object"&&"hitTargetDescription"in l){e.log(`  ${l.hitTargetDescription} intercepts pointer events`);continue}if(typeof l=="object"&&"missingState"in l){e.log(`  element is not ${l.missingState}`);continue}return l}return"done"}async _retryPointerAction(e,t,n,r,s){let o=t==="move and up";return await this._retryAction(e,t,async l=>{let c=[void 0,{block:"end",inline:"end"},{block:"center",inline:"center"},{block:"start",inline:"start"}],h=c[l%c.length];return await this._performPointerAction(e,t,n,r,h,s)},{...s,skipLocatorHandlersCheckpoint:o})}async _performPointerAction(e,t,n,r,s,o){let{force:l=!1,position:c}=o,h=async()=>s?await this.evaluateInUtility(([S,_,k])=>(_.nodeType===1&&_.scrollIntoView(k),"done"),s):await this._scrollRectIntoViewIfNeeded(c?{x:c.x,y:c.y,width:0,height:0}:void 0);if(this._frame.parentFrame()&&(e.throwIfAborted(),await h().catch(()=>{})),o.__testHookBeforeStable&&await o.__testHookBeforeStable(),!l){let S=n?["visible","enabled","stable"]:["visible","stable"];e.log(`  waiting for element to be ${n?"visible, enabled and stable":"visible and stable"}`);let _=await this.evaluateInUtility(async([k,D,{elementStates:H}])=>await k.checkElementStates(D,H),{elementStates:S});if(_)return _;e.log(`  element is ${n?"visible, enabled and stable":"visible and stable"}`)}o.__testHookAfterStable&&await o.__testHookAfterStable(),e.log("  scrolling into view if needed"),e.throwIfAborted();let m=await h();if(m!=="done")return m;e.log("  done scrolling");let f=c?await this._offsetPoint(c):await this._clickablePoint();if(typeof f=="string")return f;let g=Ow(f);e.metadata.point=g,await e.beforeInputAction(this);let b;if(l)e.log("  forcing action");else{o.__testHookBeforeHitTarget&&await o.__testHookBeforeHitTarget();let S=await this._checkFrameIsHitTarget(g);if(S==="error:notconnected"||"hitTargetDescription"in S)return S;let _=S.framePoint,k=t==="move and up"?"drag":t==="hover"||t==="tap"?t:"mouse",D=await this.evaluateHandleInUtility(([H,A,{actionType:I,hitPoint:F,trial:q}])=>H.setupHitTargetInterceptor(A,I,F,q),{actionType:k,hitPoint:_,trial:!!o.trial});if(D==="error:notconnected")return D;if(!D._objectId){let H=D.rawValue();return H==="error:notconnected"?H:{hitTargetDescription:H}}b=D,e.cleanupWhenAborted(()=>{b.evaluate(H=>H.stop()).catch(H=>{}),b.dispose()})}let v=await this._page._frameManager.waitForSignalsCreatedBy(e,o.waitAfter===!0,async()=>{o.__testHookBeforePointerAction&&await o.__testHookBeforePointerAction(),e.throwIfAborted();let S;if(o&&o.modifiers&&(S=await this._page.keyboard.ensureModifiers(o.modifiers)),e.log(`  performing ${t} action`),await r(g),S&&await this._page.keyboard.ensureModifiers(S),b){let _=this._frame.raceAgainstEvaluationStallingEvents(()=>b.evaluate(k=>k.stop())).catch(k=>"done").finally(()=>{b?.dispose()});if(o.waitAfter!==!1){let k=await _;if(k!=="done")return k}}return e.log(`  ${o.trial?"trial ":""}${t} action done`),e.log("  waiting for scheduled navigations to finish"),o.__testHookAfterPointerAction&&await o.__testHookAfterPointerAction(),"done"});return v!=="done"?v:(e.log("  navigations have finished"),"done")}async hover(e,t){return new z(e,this).run(async r=>{let s=await this._hover(r,t);return Me(s),void 0},this._page._timeoutSettings.timeout(t))}_hover(e,t){return this._retryPointerAction(e,"hover",!1,n=>this._page.mouse.move(n.x,n.y),{...t,waitAfter:"disabled"})}async click(e,t={}){return new z(e,this).run(async r=>{let s=await this._click(r,{...t,waitAfter:!t.noWaitAfter});return Me(s),void 0},this._page._timeoutSettings.timeout(t))}_click(e,t){return this._retryPointerAction(e,"click",!0,n=>this._page.mouse.click(n.x,n.y,t),t)}async dblclick(e,t){return new z(e,this).run(async r=>{let s=await this._dblclick(r,t);return Me(s),void 0},this._page._timeoutSettings.timeout(t))}_dblclick(e,t){return this._retryPointerAction(e,"dblclick",!0,n=>this._page.mouse.dblclick(n.x,n.y,t),{...t,waitAfter:"disabled"})}async tap(e,t={}){return new z(e,this).run(async r=>{let s=await this._tap(r,t);return Me(s),void 0},this._page._timeoutSettings.timeout(t))}_tap(e,t){return this._retryPointerAction(e,"tap",!0,n=>this._page.touchscreen.tap(n.x,n.y),{...t,waitAfter:"disabled"})}async selectOption(e,t,n,r){return new z(e,this).run(async o=>{let l=await this._selectOption(o,t,n,r);return Me(l)},this._page._timeoutSettings.timeout(r))}async _selectOption(e,t,n,r){let s=[];return await this._retryAction(e,"select option",async()=>{await e.beforeInputAction(this),r.force||e.log("  waiting for element to be visible and enabled");let o=[...t,...n],l=await this.evaluateInUtility(async([c,h,{optionsToSelect:m,force:f}])=>{if(!f){let g=await c.checkElementStates(h,["visible","enabled"]);if(g)return g}return c.selectOptions(h,m)},{optionsToSelect:o,force:r.force});return Array.isArray(l)?(e.log("  selected specified option(s)"),s=l,"done"):l},r),s}async fill(e,t,n={}){return new z(e,this).run(async s=>{let o=await this._fill(s,t,n);Me(o)},this._page._timeoutSettings.timeout(n))}async _fill(e,t,n){return e.log(`  fill("${t}")`),await this._retryAction(e,"fill",async()=>{await e.beforeInputAction(this),n.force||e.log("  waiting for element to be visible, enabled and editable");let r=await this.evaluateInUtility(async([s,o,{value:l,force:c}])=>{if(!c){let h=await s.checkElementStates(o,["visible","enabled","editable"]);if(h)return h}return s.fill(o,l)},{value:t,force:n.force});return e.throwIfAborted(),r==="needsinput"?(t?await this._page.keyboard.insertText(t):await this._page.keyboard.press("Delete"),"done"):r},n)}async selectText(e,t={}){return new z(e,this).run(async r=>{let s=await this._retryAction(r,"selectText",async()=>(t.force||r.log("  waiting for element to be visible"),await this.evaluateInUtility(async([o,l,{force:c}])=>{if(!c){let h=await o.checkElementStates(l,["visible"]);if(h)return h}return o.selectText(l)},{force:t.force})),t);Me(s)},this._page._timeoutSettings.timeout(t))}async setInputFiles(e,t){let n=await Go(this._frame,t);return new z(e,this).run(async s=>{let o=await this._setInputFiles(s,n);return Me(o),void 0},this._page._timeoutSettings.timeout(t))}async _setInputFiles(e,t){let{filePayloads:n,localPaths:r,localDirectory:s}=t,o=n&&n.length>1||r&&r.length>1,l=await this.evaluateHandleInUtility(([h,m,{multiple:f,directoryUpload:g}])=>{let b=h.retarget(m,"follow-label");if(!b)return;if(b.tagName!=="INPUT")throw h.createStacklessError("Node is not an HTMLInputElement");let v=b;if(f&&!v.multiple&&!v.webkitdirectory)throw h.createStacklessError("Non-multiple file input can only accept single file");if(g&&!v.webkitdirectory)throw h.createStacklessError("File input does not support directories, pass individual files instead");if(!g&&v.webkitdirectory)throw h.createStacklessError("[webkitdirectory] input requires passing a path to a directory");return v},{multiple:o,directoryUpload:!!s});if(l==="error:notconnected"||!l.asElement())return"error:notconnected";let c=l.asElement();if(await e.beforeInputAction(this),e.throwIfAborted(),r||s){let h=s?[s]:r;await Promise.all(h.map(f=>fs.promises.access(f,fs.constants.F_OK)));let m=s?this.evaluate(f=>new Promise(g=>{f.addEventListener("input",g,{once:!0})})).catch(()=>{}):Promise.resolve();await this._page._delegate.setInputFilePaths(c,h),await m}else await this._page._delegate.setInputFiles(c,n);return"done"}async focus(e){await new z(e,this).run(async n=>{let r=await this._focus(n);return Me(r),void 0},0)}async _focus(e,t){return e.throwIfAborted(),await this.evaluateInUtility(([n,r,s])=>n.focusNode(r,s),t)}async _blur(e){return e.throwIfAborted(),await this.evaluateInUtility(([t,n])=>t.blurNode(n),{})}async type(e,t,n){return new z(e,this).run(async s=>{let o=await this._type(s,t,n);return Me(o),void 0},this._page._timeoutSettings.timeout(n))}async _type(e,t,n){e.log(`elementHandle.type("${t}")`),await e.beforeInputAction(this);let r=await this._focus(e,!0);return r!=="done"?r:(e.throwIfAborted(),await this._page.keyboard.type(t,n),"done")}async press(e,t,n){return new z(e,this).run(async s=>{let o=await this._press(s,t,n);return Me(o),void 0},this._page._timeoutSettings.timeout(n))}async _press(e,t,n){return e.log(`elementHandle.press("${t}")`),await e.beforeInputAction(this),this._page._frameManager.waitForSignalsCreatedBy(e,!n.noWaitAfter,async()=>{let r=await this._focus(e,!0);return r!=="done"?r:(e.throwIfAborted(),await this._page.keyboard.press(t,n),"done")})}async check(e,t){return new z(e,this).run(async r=>{let s=await this._setChecked(r,!0,t);return Me(s),void 0},this._page._timeoutSettings.timeout(t))}async uncheck(e,t){return new z(e,this).run(async r=>{let s=await this._setChecked(r,!1,t);return Me(s),void 0},this._page._timeoutSettings.timeout(t))}async _setChecked(e,t,n){let r=async()=>{let o=await this.evaluateInUtility(([l,c])=>l.elementState(c,"checked"),{});return Me(o)};if(await r()===t)return"done";let s=await this._click(e,{...n,waitAfter:"disabled"});if(s!=="done")return s;if(n.trial)return"done";if(await r()!==t)throw new Ur("Clicking the checkbox did not change its state");return"done"}async boundingBox(){return this._page._delegate.getBoundingBox(this)}async screenshot(e,t={}){return new z(e,this).run(r=>this._page._screenshotter.screenshotElement(r,this,t),this._page._timeoutSettings.timeout(t))}async querySelector(e,t){return this._frame.selectors.query(e,t,this)}async querySelectorAll(e){return this._frame.selectors.queryAll(e,this)}async evalOnSelector(e,t,n,r,s){return this._frame.evalOnSelector(e,t,n,r,s,this)}async evalOnSelectorAll(e,t,n,r){return this._frame.evalOnSelectorAll(e,t,n,r,this)}async isVisible(e){return this._frame.isVisible(e,":scope",{},this)}async isHidden(e){return this._frame.isHidden(e,":scope",{},this)}async isEnabled(e){return this._frame.isEnabled(e,":scope",{},this)}async isDisabled(e){return this._frame.isDisabled(e,":scope",{},this)}async isEditable(e){return this._frame.isEditable(e,":scope",{},this)}async isChecked(e){return this._frame.isChecked(e,":scope",{},this)}async waitForElementState(e,t,n={}){return new z(e,this).run(async s=>{let o=`wait for ${t}`,l=await this._retryAction(s,o,async()=>await this.evaluateInUtility(async([c,h,m])=>await c.checkElementStates(h,[m])||"done",t),{});Me(l)},this._page._timeoutSettings.timeout(n))}async waitForSelector(e,t,n={}){return this._frame.waitForSelector(e,t,n,this)}async _adoptTo(e){if(this._context!==e){let t=await this._page._delegate.adoptElementHandle(this,e);return this.dispose(),t}return this}async _checkFrameIsHitTarget(e){let t=this._frame,n=[];for(;t.parentFrame();){let r=await t.frameElement(),s=await r.boundingBox(),o=await r.evaluateInUtility(([c,h])=>c.describeIFrameStyle(h),{}).catch(c=>"error:notconnected");if(!s||o==="error:notconnected")return"error:notconnected";if(o==="transformed")return{framePoint:void 0};let l={x:e.x-s.x-o.left,y:e.y-s.y-o.top};n.push({frame:t,frameElement:r,pointInFrame:l}),t=t.parentFrame()}n.push({frame:t,frameElement:null,pointInFrame:e});for(let r=n.length-1;r>0;r--){let s=n[r-1].frameElement,o=n[r].pointInFrame,l=await s.evaluateInUtility(([c,h,m])=>c.expectHitTarget(m,h),o);if(l!=="done")return l}return{framePoint:n[0].pointInFrame}}};up="Unable to adopt element handle from a different document"});var pp,mp=x(()=>{pp=new Set(["load","domcontentloaded","networkidle","commit"])});async function fp(i,e){if(i._context===e)return i;let t=await i._page._delegate.adoptElementHandle(i,e);return i.dispose(),t}var Xo,gp=x(()=>{ir();O();Xo=class{frame;constructor(e){this.frame=e}_parseSelector(e,t){let n=typeof t?.strict=="boolean"?t.strict:!!this.frame._page.context()._options.strictSelectors;return this.frame._page.context().selectors().parseSelector(e,n)}async query(e,t,n){let r=await this.resolveInjectedForSelector(e,t,n);if(!r)return null;let s=await r.injected.evaluateHandle((l,{info:c,scope:h})=>l.querySelector(c.parsed,h||document,c.strict),{info:r.info,scope:r.scope}),o=s.asElement();return o?fp(o,await r.frame._mainContext()):(s.dispose(),null)}async queryArrayInMainWorld(e,t){let n=await this.resolveInjectedForSelector(e,{mainWorld:!0},t);if(!n)throw new Error(`Failed to find frame for selector "${e}"`);return await n.injected.evaluateHandle((r,{info:s,scope:o})=>r.querySelectorAll(s.parsed,o||document),{info:n.info,scope:n.scope})}async queryCount(e){let t=await this.resolveInjectedForSelector(e);if(!t)throw new Error(`Failed to find frame for selector "${e}"`);return await t.injected.evaluate((n,{info:r})=>n.querySelectorAll(r.parsed,document).length,{info:t.info})}async queryAll(e,t){let n=await this.resolveInjectedForSelector(e,{},t);if(!n)return[];let r=await n.injected.evaluateHandle((c,{info:h,scope:m})=>c.querySelectorAll(h.parsed,m||document),{info:n.info,scope:n.scope}),s=await r.getProperties();r.dispose();let o=await n.frame._mainContext(),l=[];for(let c of s.values()){let h=c.asElement();h?l.push(fp(h,o)):c.dispose()}return Promise.all(l)}async resolveFrameForSelector(e,t={},n){let r=this.frame,s=wh(e);for(let o of s)yo(o,(l,c)=>{if(c&&l.name==="internal:control"&&l.body==="enter-frame"){let h=ke(this.frame._page.attribution.playwright.options.sdkLanguage,e);throw new me(`Frame locators are not allowed inside composite locators, while querying "${h}"`)}});for(let o=0;o<s.length-1;++o){let l=this._parseSelector(s[o],t),f=(await(await(await r._context(l.world)).injectedScript()).evaluateHandle((b,{info:v,scope:S,selectorString:_})=>{let k=b.querySelector(v.parsed,S||document,v.strict);if(k&&k.nodeName!=="IFRAME"&&k.nodeName!=="FRAME")throw b.createStacklessError(`Selector "${_}" resolved to ${b.previewNode(k)}, <iframe> was expected`);return k},{info:l,scope:o===0?n:void 0,selectorString:mn(l.parsed)})).asElement();if(!f)return null;let g=await r._page._delegate.getContentFrame(f);if(f.dispose(),!g)return null;r=g}return r!==this.frame&&(n=void 0),{frame:r,info:r.selectors._parseSelector(s[s.length-1],t),scope:n}}async resolveInjectedForSelector(e,t,n){let r=await this.resolveFrameForSelector(e,t,n);return r?{injected:await(await r.frame._context(t?.mainWorld?"main":r.info.world)).injectedScript(),info:r.info,frame:r.frame,scope:r.scope}:void 0}}});function Xc(i,e){if(e==="networkidle0"&&(e="networkidle"),!pp.has(e))throw new Error(`${i}: expected one of (load|domcontentloaded|networkidle|commit)`);return e}function Hw(i,e){return i==="to.be.checked"?e?"checked":"unchecked":i==="to.be.unchecked"?e?"unchecked":"checked":i==="to.be.visible"?e?"visible":"hidden":i==="to.be.hidden"?e?"hidden":"visible":i==="to.be.enabled"?e?"enabled":"disabled":i==="to.be.disabled"?e?"disabled":"enabled":i==="to.be.editable"?e?"editable":"readonly":i==="to.be.readonly"?e?"readonly":"editable":i==="to.be.empty"?e?"empty":"not empty":i==="to.be.focused"?e?"focused":"not focused":e}var dr,wp,Qo,Qe,Qc,ur=x(()=>{Jc();Ot();It();ms();Gt();nt();mp();Oe();Nt();O();qe();Te();ye();gn();ir();gp();Vt();Kc();dr=class extends Error{documentId;constructor(e,t){super(t),this.documentId=e}},wp="<dummy>",Qo=class{_page;_frames=new Map;_mainFrame;_consoleMessageTags=new Map;_signalBarriers=new Set;_webSockets=new Map;_openedDialogs=new Set;_closeAllOpeningDialogs=!1;constructor(e){this._page=e,this._mainFrame=void 0}createDummyMainFrameIfNeeded(){this._mainFrame||this.frameAttached(wp,null)}dispose(){for(let e of this._frames.values())e._stopNetworkIdleTimer(),e._invalidateNonStallingEvaluations("Target crashed")}mainFrame(){return this._mainFrame}frames(){let e=[];return t(this._mainFrame),e;function t(n){e.push(n);for(let r of n.childFrames())t(r)}}frame(e){return this._frames.get(e)||null}frameAttached(e,t){let n=t?this._frames.get(t):null;if(n){E(!this._frames.has(e));let r=new Qe(this._page,e,n);return this._frames.set(e,r),this._page.emit(re.Events.FrameAttached,r),r}else return this._mainFrame?(this._frames.delete(this._mainFrame._id),this._mainFrame._id=e):(E(!this._frames.has(e)),this._mainFrame=new Qe(this._page,e,n)),this._frames.set(e,this._mainFrame),this._mainFrame}async waitForSignalsCreatedBy(e,t,n){if(!t)return n();let r=new Qc(e);this._signalBarriers.add(r),e&&e.cleanupWhenAborted(()=>this._signalBarriers.delete(r));let s=await n();return await this._page._delegate.inputActionEpilogue(),await r.waitFor(),this._signalBarriers.delete(r),await new Promise(Br()),s}frameWillPotentiallyRequestNavigation(){for(let e of this._signalBarriers)e.retain()}frameDidPotentiallyRequestNavigation(){for(let e of this._signalBarriers)e.release()}frameRequestedNavigation(e,t){let n=this._frames.get(e);if(!n)return;for(let s of this._signalBarriers)s.addFrameNavigation(n);if(n.pendingDocument()&&n.pendingDocument().documentId===t)return;let r=t?Array.from(n._inflightRequests).find(s=>s._documentId===t):void 0;n.setPendingDocument({documentId:t,request:r})}frameCommittedNewDocumentNavigation(e,t,n,r,s){let o=this._frames.get(e);this.removeChildFramesRecursively(o),this.clearWebSockets(o),o._url=t,o._name=n;let l,c=o.pendingDocument();c?(c.documentId===void 0&&(c.documentId=r),c.documentId===r?o._currentDocument=c:(l=c,o._currentDocument={documentId:r,request:void 0}),o.setPendingDocument(void 0)):o._currentDocument={documentId:r,request:void 0},o._onClearLifecycle();let h={url:t,name:n,newDocument:o._currentDocument,isPublic:!0};this._fireInternalFrameNavigation(o,h),s||(N.log("api",`  navigated to "${t}"`),this._page.frameNavigatedToNewDocument(o)),o.setPendingDocument(l)}frameCommittedSameDocumentNavigation(e,t){let n=this._frames.get(e);if(!n)return;n._url=t;let r={url:t,name:n._name,isPublic:!0};this._fireInternalFrameNavigation(n,r),N.log("api",`  navigated to "${t}"`)}frameAbortedNavigation(e,t,n){let r=this._frames.get(e);if(!r||!r.pendingDocument()||n!==void 0&&r.pendingDocument().documentId!==n)return;let s={url:r._url,name:r._name,newDocument:r.pendingDocument(),error:new dr(n,t),isPublic:!(n&&r._redirectedNavigations.has(n))};r.setPendingDocument(void 0),this._fireInternalFrameNavigation(r,s)}frameDetached(e){let t=this._frames.get(e);t&&(this._removeFramesRecursively(t),this._page.mainFrame()._recalculateNetworkIdle())}frameLifecycleEvent(e,t){let n=this._frames.get(e);n&&n._onLifecycleEvent(t)}requestStarted(e,t){let n=e.frame();if(this._inflightRequestStarted(e),e._documentId&&n.setPendingDocument({documentId:e._documentId,request:e}),e._isFavicon){t?.continue({isFallback:!0}).catch(()=>{});return}if(this._page.emitOnContext(j.Events.Request,e),t){let r=new zr(e,t);if(this._page._serverRequestInterceptor?.(r,e)||this._page._clientRequestInterceptor?.(r,e)||this._page._browserContext._requestInterceptor?.(r,e))return;r.continue({isFallback:!0}).catch(()=>{})}}requestReceivedResponse(e){e.request()._isFavicon||this._page.emitOnContext(j.Events.Response,e)}reportRequestFinished(e,t){this._inflightRequestFinished(e),!e._isFavicon&&this._page.emitOnContext(j.Events.RequestFinished,{request:e,response:t})}requestFailed(e,t){let n=e.frame();if(this._inflightRequestFinished(e),n.pendingDocument()&&n.pendingDocument().request===e){let r=e.failure().errorText;t&&(r+="; maybe frame was detached?"),this.frameAbortedNavigation(n._id,r,n.pendingDocument().documentId)}e._isFavicon||this._page.emitOnContext(j.Events.RequestFailed,e)}dialogDidOpen(e){for(let t of this._frames.values())t._invalidateNonStallingEvaluations("JavaScript dialog interrupted evaluation");this._closeAllOpeningDialogs?e.close().then(()=>{}):this._openedDialogs.add(e)}dialogWillClose(e){this._openedDialogs.delete(e)}async closeOpenDialogs(){await Promise.all([...this._openedDialogs].map(e=>e.close())).catch(()=>{}),this._openedDialogs.clear()}setCloseAllOpeningDialogs(e){this._closeAllOpeningDialogs=e}removeChildFramesRecursively(e){for(let t of e.childFrames())this._removeFramesRecursively(t)}_removeFramesRecursively(e){this.removeChildFramesRecursively(e),e._onDetached(),this._frames.delete(e._id),this._page.isClosed()||this._page.emit(re.Events.FrameDetached,e)}_inflightRequestFinished(e){let t=e.frame();e._isFavicon||t._inflightRequests.has(e)&&(t._inflightRequests.delete(e),t._inflightRequests.size===0&&t._startNetworkIdleTimer())}_inflightRequestStarted(e){let t=e.frame();e._isFavicon||(t._inflightRequests.add(e),t._inflightRequests.size===1&&t._stopNetworkIdleTimer())}interceptConsoleMessage(e){if(e.type()!=="debug")return!1;let t=e.text(),n=this._consoleMessageTags.get(t);return n?(this._consoleMessageTags.delete(t),n(),!0):!1}clearWebSockets(e){e.parentFrame()||this._webSockets.clear()}onWebSocketCreated(e,t){let n=new yn(this._page,t);this._webSockets.set(e,n)}onWebSocketRequest(e){let t=this._webSockets.get(e);t&&t.markAsNotified()&&this._page.emit(re.Events.WebSocket,t)}onWebSocketResponse(e,t,n){let r=this._webSockets.get(e);t<400||r&&r.error(`${n}: ${t}`)}onWebSocketFrameSent(e,t,n){let r=this._webSockets.get(e);r&&r.frameSent(t,n)}webSocketFrameReceived(e,t,n){let r=this._webSockets.get(e);r&&r.frameReceived(t,n)}webSocketClosed(e){let t=this._webSockets.get(e);t&&t.closed(),this._webSockets.delete(e)}webSocketError(e,t){let n=this._webSockets.get(e);n&&n.error(t)}_fireInternalFrameNavigation(e,t){e.emit(Qe.Events.InternalNavigation,t)}},Qe=class i extends se{static Events={InternalNavigation:"internalnavigation",AddLifecycle:"addlifecycle",RemoveLifecycle:"removelifecycle"};_id;_firedLifecycleEvents=new Set;_firedNetworkIdleSelf=!1;_currentDocument;_pendingDocument;_page;_parentFrame;_url="";_contextData=new Map;_childFrames=new Set;_name="";_inflightRequests=new Set;_networkIdleTimer;_setContentCounter=0;_detachedScope=new Re;_raceAgainstEvaluationStallingEventsPromises=new Set;_redirectedNavigations=new Map;selectors;constructor(e,t,n){super(e,"frame"),this.attribution.frame=this,this._id=t,this._page=e,this._parentFrame=n,this._currentDocument={documentId:void 0,request:void 0},this.selectors=new Xo(this),this._contextData.set("main",{contextPromise:new U,context:null}),this._contextData.set("utility",{contextPromise:new U,context:null}),this._setContext("main",null),this._setContext("utility",null),this._parentFrame&&this._parentFrame._childFrames.add(this),this._firedLifecycleEvents.add("commit"),t!==wp&&this._startNetworkIdleTimer()}isDetached(){return this._detachedScope.isClosed()}_onLifecycleEvent(e){this._firedLifecycleEvents.has(e)||(this._firedLifecycleEvents.add(e),this.emit(i.Events.AddLifecycle,e),this===this._page.mainFrame()&&this._url!=="about:blank"&&N.log("api",`  "${e}" event fired`),this._page.mainFrame()._recalculateNetworkIdle())}_onClearLifecycle(){for(let e of this._firedLifecycleEvents)this.emit(i.Events.RemoveLifecycle,e);this._firedLifecycleEvents.clear(),this._inflightRequests=new Set(Array.from(this._inflightRequests).filter(e=>e===this._currentDocument.request)),this._stopNetworkIdleTimer(),this._inflightRequests.size===0&&this._startNetworkIdleTimer(),this._page.mainFrame()._recalculateNetworkIdle(this),this._onLifecycleEvent("commit")}setPendingDocument(e){this._pendingDocument=e,e&&this._invalidateNonStallingEvaluations("Navigation interrupted the evaluation")}pendingDocument(){return this._pendingDocument}_invalidateNonStallingEvaluations(e){if(!this._raceAgainstEvaluationStallingEventsPromises.size)return;let t=new Error(e);for(let n of this._raceAgainstEvaluationStallingEventsPromises)n.reject(t)}async raceAgainstEvaluationStallingEvents(e){if(this._pendingDocument)throw new Error("Frame is currently attempting a navigation");if(this._page._frameManager._openedDialogs.size)throw new Error("Open JavaScript dialog prevents evaluation");let t=new U;this._raceAgainstEvaluationStallingEventsPromises.add(t);try{return await Promise.race([e(),t])}finally{this._raceAgainstEvaluationStallingEventsPromises.delete(t)}}nonStallingRawEvaluateInExistingMainContext(e){return this.raceAgainstEvaluationStallingEvents(()=>{let t=this._existingMainContext();if(!t)throw new Error("Frame does not yet have a main execution context");return t.rawEvaluateJSON(e)})}nonStallingEvaluateInExistingContext(e,t){return this.raceAgainstEvaluationStallingEvents(()=>{let n=this._contextData.get(t)?.context;if(!n)throw new Error("Frame does not yet have the execution context");return n.evaluateExpression(e,{isFunction:!1})})}_recalculateNetworkIdle(e){let t=this._firedNetworkIdleSelf;for(let n of this._childFrames)n._recalculateNetworkIdle(e),n._firedLifecycleEvents.has("networkidle")||(t=!1);t&&!this._firedLifecycleEvents.has("networkidle")&&(this._firedLifecycleEvents.add("networkidle"),this.emit(i.Events.AddLifecycle,"networkidle"),this===this._page.mainFrame()&&this._url!=="about:blank"&&N.log("api",'  "networkidle" event fired')),e!==this&&this._firedLifecycleEvents.has("networkidle")&&!t&&(this._firedLifecycleEvents.delete("networkidle"),this.emit(i.Events.RemoveLifecycle,"networkidle"))}async raceNavigationAction(e,t,n){return Re.raceMultiple([this._detachedScope,this._page.openScope],n().catch(r=>{if(r instanceof dr&&r.documentId){let s=this._redirectedNavigations.get(r.documentId);if(s)return e.log(`waiting for redirected navigation to "${s.url}"`),s.gotoPromise}throw r}))}redirectNavigation(e,t,n){let r=new z(ge(),this),s={url:e,gotoPromise:r.run(o=>this._gotoAction(o,e,{referer:n}),0)};this._redirectedNavigations.set(t,s),s.gotoPromise.finally(()=>this._redirectedNavigations.delete(t))}async goto(e,t,n={}){let r=_c(this._page._browserContext._options.baseURL,t);return new z(e,this).run(o=>this._goto(o,r,n),this._page._timeoutSettings.navigationTimeout(n))}async _goto(e,t,n){return this.raceNavigationAction(e,n,async()=>this._gotoAction(e,t,n))}async _gotoAction(e,t,n){let r=Xc("waitUntil",n.waitUntil===void 0?"load":n.waitUntil);e.log(`navigating to "${t}", waiting until "${r}"`);let o=(this._page.extraHTTPHeaders()||[]).find(v=>v.name.toLowerCase()==="referer"),l=o?o.value:void 0;if(n.referer!==void 0){if(l!==void 0&&l!==n.referer)throw new Error('"referer" is already specified as extra HTTP header');l=n.referer}t=le.completeUserURL(t);let c=[],h=v=>c.push(v);this.on(i.Events.InternalNavigation,h);let m=await this._page._delegate.navigateFrame(this,t,l).finally(()=>this.off(i.Events.InternalNavigation,h)),f;if(m.newDocumentId){let v=_=>_.newDocument&&(_.newDocument.documentId===m.newDocumentId||!_.error),S=c.filter(v);if(S.length?f=S[0]:f=await le.waitForEvent(e,this,i.Events.InternalNavigation,v).promise,f.newDocument.documentId!==m.newDocumentId)throw new dr(m.newDocumentId,`Navigation to "${t}" is interrupted by another navigation to "${f.url}"`);if(f.error)throw f.error}else{let v=_=>!_.newDocument,S=c.filter(v);S.length?f=S[0]:f=await le.waitForEvent(e,this,i.Events.InternalNavigation,v).promise}this._firedLifecycleEvents.has(r)||await le.waitForEvent(e,this,i.Events.AddLifecycle,v=>v===r).promise;let g=f.newDocument?f.newDocument.request:void 0;return g?g._finalRequest().response():null}async _waitForNavigation(e,t,n){let r=Xc("waitUntil",n.waitUntil===void 0?"load":n.waitUntil);e.log(`waiting for navigation until "${r}"`);let s=await le.waitForEvent(e,this,i.Events.InternalNavigation,l=>l.error?!0:t&&!l.newDocument?!1:(e.log(`  navigated to "${this._url}"`),!0)).promise;if(s.error)throw s.error;this._firedLifecycleEvents.has(r)||await le.waitForEvent(e,this,i.Events.AddLifecycle,l=>l===r).promise;let o=s.newDocument?s.newDocument.request:void 0;return o?o._finalRequest().response():null}async _waitForLoadState(e,t){let n=Xc("state",t);this._firedLifecycleEvents.has(n)||await le.waitForEvent(e,this,i.Events.AddLifecycle,r=>r===n).promise}async frameElement(){return this._page._delegate.getFrameElement(this)}_context(e){return this._contextData.get(e).contextPromise.then(t=>{if(t instanceof $n)return t;throw new Error(t.destroyedReason)})}_mainContext(){return this._context("main")}_existingMainContext(){return this._contextData.get("main")?.context||null}_utilityContext(){return this._context("utility")}async evaluateExpression(e,t={},n){return await(await this._context(t.world??"main")).evaluateExpression(e,t,n)}async evaluateExpressionHandle(e,t={},n){return await(await this._context(t.world??"main")).evaluateExpressionHandle(e,t,n)}async querySelector(e,t){return N.log("api",`    finding element using the selector "${e}"`),this.selectors.query(e,t)}async waitForSelector(e,t,n,r){let s=new z(e,this);if(n.visibility)throw new Error("options.visibility is not supported, did you mean options.state?");if(n.waitFor&&n.waitFor!=="visible")throw new Error("options.waitFor is not supported, did you mean options.state?");let{state:o="visible"}=n;if(!["attached","detached","visible","hidden"].includes(o))throw new Error("state: expected one of (attached|detached|visible|hidden)");return s.run(async l=>(l.log(`waiting for ${this._asLocator(t)}${o==="attached"?"":" to be "+o}`),await this.waitForSelectorInternal(l,t,n,r)),this._page._timeoutSettings.timeout(n))}async waitForSelectorInternal(e,t,n,r){let{state:s="visible"}=n,o=this.retryWithProgressAndTimeouts(e,[0,20,50,100,100,500],async l=>{let c=await this.selectors.resolveInjectedForSelector(t,n,r);if(e.throwIfAborted(),!c)return s==="hidden"||s==="detached"?null:l;let h=await c.injected.evaluateHandle((S,{info:_,root:k})=>{let D=S.querySelectorAll(_.parsed,k||document),H=D[0],A=H?S.utils.isElementVisible(H):!1,I="";if(D.length>1){if(_.strict)throw S.strictModeViolationError(_.parsed,D);I=`  locator resolved to ${D.length} elements. Proceeding with the first one: ${S.previewNode(D[0])}`}else H&&(I=`  locator resolved to ${A?"visible":"hidden"} ${S.previewNode(H)}`);return{log:I,element:H,visible:A,attached:!!H}},{info:c.info,root:c.frame===this?r:void 0}),{log:m,visible:f,attached:g}=await h.evaluate(S=>({log:S.log,visible:S.visible,attached:S.attached}));if(m&&e.log(m),!{attached:g,detached:!g,visible:f,hidden:!f}[s])return h.dispose(),l;if(n.omitReturnValue)return h.dispose(),null;let v=s==="attached"||s==="visible"?await h.evaluateHandle(S=>S.element):null;if(h.dispose(),!v)return null;n.__testHookBeforeAdoptNode&&await n.__testHookBeforeAdoptNode();try{return await v._adoptTo(await c.frame._mainContext())}catch{return l}});return r?r._context._raceAgainstContextDestroyed(o):o}async dispatchEvent(e,t,n,r={},s={},o){await this._callOnElementOnceMatches(e,t,(l,c,h)=>{l.dispatchEvent(c,h.type,h.eventInit)},{type:n,eventInit:r},{mainWorld:!0,...s},o)}async evalOnSelector(e,t,n,r,s,o){let l=await this.selectors.query(e,{strict:t},o);if(!l)throw new Error(`Failed to find element matching selector "${e}"`);let c=await l.evaluateExpression(n,{isFunction:r},s);return l.dispose(),c}async evalOnSelectorAll(e,t,n,r,s){let o=await this.selectors.queryArrayInMainWorld(e,s),l=await o.evaluateExpression(t,{isFunction:n},r);return o.dispose(),l}async maskSelectors(e,t){await(await(await this._utilityContext()).injectedScript()).evaluate((s,{parsed:o,color:l})=>{s.maskSelectors(o,l)},{parsed:e,color:t})}async querySelectorAll(e){return this.selectors.queryAll(e)}async queryCount(e){return await this.selectors.queryCount(e)}async content(){try{return await(await this._utilityContext()).evaluate(()=>{let t="";return document.doctype&&(t=new XMLSerializer().serializeToString(document.doctype)),document.documentElement&&(t+=document.documentElement.outerHTML),t})}catch(e){throw ot(e)||mt(e)?e:new Error("Unable to retrieve content because the page is navigating and changing the content.")}}async setContent(e,t,n={}){return new z(e,this).run(async s=>{await this.raceNavigationAction(s,n,async()=>{let o=n.waitUntil===void 0?"load":n.waitUntil;s.log(`setting frame content, waiting until "${o}"`);let l=`--playwright--set--content--${this._id}--${++this._setContentCounter}--`,c=await this._utilityContext(),h=new Promise((f,g)=>{this._page._frameManager._consoleMessageTags.set(l,()=>{this._onClearLifecycle(),this._waitForLoadState(s,o).then(f).catch(g)})}),m=c.evaluate(({html:f,tag:g})=>{document.open(),console.debug(g),document.write(f),document.close()},{html:t,tag:l});return await Promise.all([m,h]),null})},this._page._timeoutSettings.navigationTimeout(n))}name(){return this._name||""}url(){return this._url}origin(){if(this._url.startsWith("http"))return qo(this._url)?.origin}parentFrame(){return this._parentFrame}childFrames(){return Array.from(this._childFrames)}async addScriptTag(e){let{url:t=null,content:n=null,type:r=""}=e;if(!t&&!n)throw new Error("Provide an object with a `url`, `path` or `content` property");let s=await this._mainContext();return this._raceWithCSPError(async()=>{if(t!==null)return(await s.evaluateHandle(o,{url:t,type:r})).asElement();let c=(await s.evaluateHandle(l,{content:n,type:r})).asElement();return this._page._delegate.cspErrorsAsynchronousForInlineScripts&&await s.evaluate(()=>!0),c});async function o(c){let h=document.createElement("script");h.src=c.url,c.type&&(h.type=c.type);let m=new Promise((f,g)=>{h.onload=f,h.onerror=b=>g(typeof b=="string"?new Error(b):new Error(`Failed to load script at ${h.src}`))});return document.head.appendChild(h),await m,h}function l(c){let h=document.createElement("script");h.type=c.type||"text/javascript",h.text=c.content;let m=null;if(h.onerror=f=>m=f,document.head.appendChild(h),m)throw m;return h}}async addStyleTag(e){let{url:t=null,content:n=null}=e;if(!t&&!n)throw new Error("Provide an object with a `url`, `path` or `content` property");let r=await this._mainContext();return this._raceWithCSPError(async()=>t!==null?(await r.evaluateHandle(s,t)).asElement():(await r.evaluateHandle(o,n)).asElement());async function s(l){let c=document.createElement("link");c.rel="stylesheet",c.href=l;let h=new Promise((m,f)=>{c.onload=m,c.onerror=f});return document.head.appendChild(c),await h,c}async function o(l){let c=document.createElement("style");c.type="text/css",c.appendChild(document.createTextNode(l));let h=new Promise((m,f)=>{c.onload=m,c.onerror=f});return document.head.appendChild(c),await h,c}}async _raceWithCSPError(e){let t=[],n,r,s,o=e().then(c=>n=c).catch(c=>r=c),l=new Promise(c=>{t.push(L.addEventListener(this._page._browserContext,j.Events.Console,h=>{h.page()!==this._page||h.type()!=="error"||(h.text().includes("Content-Security-Policy")||h.text().includes("Content Security Policy"))&&(s=h,c())}))});if(await Promise.race([o,l]),L.removeEventListeners(t),s)throw new Error(s.text());if(r)throw r;return n}async retryWithProgressAndTimeouts(e,t,n){let r=Symbol("continuePolling");t=[0,...t];let s=0;for(;e.isRunning();){let o=t[Math.min(s++,t.length-1)];if(o){let l=new Promise(c=>setTimeout(c,o));await Re.raceMultiple([this._page.openScope,this._detachedScope],l)}e.throwIfAborted();try{let l=await n(r);if(l===r)continue;return l}catch(l){if(this._isErrorThatCannotBeRetried(l))throw l;continue}}e.throwIfAborted()}_isErrorThatCannotBeRetried(e){return!!(ot(e)||mt(e)||dp(e)||Mn(e)||this.isDetached())}async _retryWithProgressIfNotConnected(e,t,n,r,s){return e.log(`waiting for ${this._asLocator(t)}`),this.retryWithProgressAndTimeouts(e,[0,20,50,100,100,500],async o=>{r&&await this._page.performLocatorHandlersCheckpoint(e);let l=await this.selectors.resolveInjectedForSelector(t,{strict:n});if(e.throwIfAborted(),!l)return o;let c=await l.injected.evaluateHandle((g,{info:b})=>{let v=g.querySelectorAll(b.parsed,document),S=v[0],_="";if(v.length>1){if(b.strict)throw g.strictModeViolationError(b.parsed,v);_=`  locator resolved to ${v.length} elements. Proceeding with the first one: ${g.previewNode(v[0])}`}else S&&(_=`  locator resolved to ${g.previewNode(S)}`);return{log:_,success:!!S,element:S}},{info:l.info}),{log:h,success:m}=await c.evaluate(g=>({log:g.log,success:g.success}));if(h&&e.log(h),!m)return c.dispose(),o;let f=await c.evaluateHandle(g=>g.element);c.dispose();try{let g=await s(f);return g==="error:notconnected"?(e.log("element was detached from the DOM, retrying"),o):g}finally{f?.dispose()}})}async rafrafTimeoutScreenshotElementWithProgress(e,t,n,r){return await this._retryWithProgressIfNotConnected(e,t,!0,!0,async s=>(await s._frame.rafrafTimeout(n),await this._page._screenshotter.screenshotElement(e,s,r)))}async click(e,t,n){return new z(e,this).run(async s=>(await this._retryWithProgressIfNotConnected(s,t,n.strict,!n.force,o=>o._click(s,{...n,waitAfter:!n.noWaitAfter})),void 0),this._page._timeoutSettings.timeout(n))}async dblclick(e,t,n={}){return new z(e,this).run(async s=>(await this._retryWithProgressIfNotConnected(s,t,n.strict,!n.force,o=>o._dblclick(s,n)),void 0),this._page._timeoutSettings.timeout(n))}async dragAndDrop(e,t,n,r={}){await new z(e,this).run(async o=>{await this._retryWithProgressIfNotConnected(o,t,r.strict,!r.force,async l=>l._retryPointerAction(o,"move and down",!1,async c=>{await this._page.mouse.move(c.x,c.y),await this._page.mouse.down()},{...r,waitAfter:"disabled",position:r.sourcePosition,timeout:o.timeUntilDeadline()})),await this._retryWithProgressIfNotConnected(o,n,r.strict,!1,async l=>l._retryPointerAction(o,"move and up",!1,async c=>{await this._page.mouse.move(c.x,c.y),await this._page.mouse.up()},{...r,waitAfter:"disabled",position:r.targetPosition,timeout:o.timeUntilDeadline()}))},this._page._timeoutSettings.timeout(r))}async tap(e,t,n){if(!this._page._browserContext._options.hasTouch)throw new Error("The page does not support tap. Use hasTouch context option to enable touch support.");return new z(e,this).run(async s=>(await this._retryWithProgressIfNotConnected(s,t,n.strict,!n.force,o=>o._tap(s,n)),void 0),this._page._timeoutSettings.timeout(n))}async fill(e,t,n,r){return new z(e,this).run(async o=>(await this._retryWithProgressIfNotConnected(o,t,r.strict,!r.force,l=>l._fill(o,n,r)),void 0),this._page._timeoutSettings.timeout(r))}async focus(e,t,n={}){await new z(e,this).run(async s=>{await this._retryWithProgressIfNotConnected(s,t,n.strict,!0,o=>o._focus(s))},this._page._timeoutSettings.timeout(n))}async blur(e,t,n={}){await new z(e,this).run(async s=>{await this._retryWithProgressIfNotConnected(s,t,n.strict,!0,o=>o._blur(s))},this._page._timeoutSettings.timeout(n))}async textContent(e,t,n={},r){return this._callOnElementOnceMatches(e,t,(s,o)=>o.textContent,void 0,n,r)}async innerText(e,t,n={},r){return this._callOnElementOnceMatches(e,t,(s,o)=>{if(o.namespaceURI!=="http://www.w3.org/1999/xhtml")throw s.createStacklessError("Node is not an HTMLElement");return o.innerText},void 0,n,r)}async innerHTML(e,t,n={},r){return this._callOnElementOnceMatches(e,t,(s,o)=>o.innerHTML,void 0,n,r)}async getAttribute(e,t,n,r={},s){return this._callOnElementOnceMatches(e,t,(o,l,c)=>l.getAttribute(c.name),{name:n},r,s)}async inputValue(e,t,n={},r){return this._callOnElementOnceMatches(e,t,(s,o)=>{let l=s.retarget(o,"follow-label");if(!l||l.nodeName!=="INPUT"&&l.nodeName!=="TEXTAREA"&&l.nodeName!=="SELECT")throw s.createStacklessError("Node is not an <input>, <textarea> or <select> element");return l.value},void 0,n,r)}async highlight(e){let t=await this.selectors.resolveInjectedForSelector(e);if(t)return await t.injected.evaluate((n,{info:r})=>n.highlight(r.parsed),{info:t.info})}async hideHighlight(){return this.raceAgainstEvaluationStallingEvents(async()=>await(await(await this._utilityContext()).injectedScript()).evaluate(n=>n.hideHighlight()))}async _elementState(e,t,n,r={},s){let o=await this._callOnElementOnceMatches(e,t,(l,c,h)=>l.elementState(c,h.state),{state:n},r,s);return Me(o)}async isVisible(e,t,n={},r){return new z(e,this).run(async o=>(o.log(`  checking visibility of ${this._asLocator(t)}`),await this.isVisibleInternal(t,n,r)),this._page._timeoutSettings.timeout({}))}async isVisibleInternal(e,t={},n){try{let r=await this.selectors.resolveInjectedForSelector(e,t,n);return r?await r.injected.evaluate((s,{info:o,root:l})=>{let c=s.querySelector(o.parsed,l||document,o.strict),h=c?s.elementState(c,"visible"):!1;return h==="error:notconnected"?!1:h},{info:r.info,root:r.frame===this?n:void 0}):!1}catch(r){if(ot(r)||Mn(r)||mt(r))throw r;return!1}}async isHidden(e,t,n={},r){return!await this.isVisible(e,t,n,r)}async isDisabled(e,t,n={},r){return this._elementState(e,t,"disabled",n,r)}async isEnabled(e,t,n={},r){return this._elementState(e,t,"enabled",n,r)}async isEditable(e,t,n={},r){return this._elementState(e,t,"editable",n,r)}async isChecked(e,t,n={},r){return this._elementState(e,t,"checked",n,r)}async hover(e,t,n={}){return new z(e,this).run(async s=>(await this._retryWithProgressIfNotConnected(s,t,n.strict,!n.force,o=>o._hover(s,n)),void 0),this._page._timeoutSettings.timeout(n))}async selectOption(e,t,n,r,s={}){return new z(e,this).run(async l=>await this._retryWithProgressIfNotConnected(l,t,s.strict,!s.force,c=>c._selectOption(l,n,r,s)),this._page._timeoutSettings.timeout(s))}async setInputFiles(e,t,n){let r=await Go(this,n);return new z(e,this).run(async o=>(await this._retryWithProgressIfNotConnected(o,t,n.strict,!0,l=>l._setInputFiles(o,r)),void 0),this._page._timeoutSettings.timeout(n))}async type(e,t,n,r={}){return new z(e,this).run(async o=>(await this._retryWithProgressIfNotConnected(o,t,r.strict,!0,l=>l._type(o,n,r)),void 0),this._page._timeoutSettings.timeout(r))}async press(e,t,n,r={}){return new z(e,this).run(async o=>(await this._retryWithProgressIfNotConnected(o,t,r.strict,!0,l=>l._press(o,n,r)),void 0),this._page._timeoutSettings.timeout(r))}async check(e,t,n={}){return new z(e,this).run(async s=>(await this._retryWithProgressIfNotConnected(s,t,n.strict,!n.force,o=>o._setChecked(s,!0,n)),void 0),this._page._timeoutSettings.timeout(n))}async uncheck(e,t,n={}){return new z(e,this).run(async s=>(await this._retryWithProgressIfNotConnected(s,t,n.strict,!n.force,o=>o._setChecked(s,!1,n)),void 0),this._page._timeoutSettings.timeout(n))}async waitForTimeout(e,t){return new z(e,this).run(async()=>{await new Promise(r=>setTimeout(r,t))})}async expect(e,t,n){let r=await this._expectImpl(e,t,n);return r.matches===n.isNot&&(e.error={error:{name:"Expect",message:"Expect failed"}}),r}async _expectImpl(e,t,n){let r={isSet:!1};try{let s=this._page._timeoutSettings.timeout(n),o=s>0?X():0;await new z(e,this).run(async l=>{l.log(`${e.apiName}${s?` with timeout ${s}ms`:""}`),l.log(`waiting for ${this._asLocator(t)}`),await this._page.performLocatorHandlersCheckpoint(l)},s);try{let l=await new z(e,this).run(async c=>await this._expectInternal(c,t,n,r));if(l.matches!==n.isNot)return l}catch(l){if(ot(l)||Mn(l))throw l}if(s>0){let l=X()-o;s-=l}return s<0?{matches:n.isNot,log:e.log,timedOut:!0,received:r.received}:await new z(e,this).run(async l=>await this.retryWithProgressAndTimeouts(l,[100,250,500,1e3],async c=>{await this._page.performLocatorHandlersCheckpoint(l);let{matches:h,received:m}=await this._expectInternal(l,t,n,r);return h===n.isNot?c:{matches:h,received:m}}),s)}catch(s){if(ot(s)||Mn(s))throw s;let o={matches:n.isNot,log:e.log};return r.isSet&&(o.received=r.received),s instanceof qr&&(o.timedOut=!0),o}}async _expectInternal(e,t,n,r){let s=await this.selectors.resolveFrameForSelector(t,{strict:!0});e.throwIfAborted();let{frame:o,info:l}=s||{frame:this,info:void 0},c=n.expression==="to.have.property"?"main":l?.world??"utility",m=await(await o._context(c)).injectedScript();e.throwIfAborted();let{log:f,matches:g,received:b,missingReceived:v}=await m.evaluate(async(S,{info:_,options:k,callId:D})=>{let H=_?S.querySelectorAll(_.parsed,document):[],A=k.expression==="to.have.count"||k.expression.endsWith(".array"),I="";if(A)I=`  locator resolved to ${H.length} element${H.length===1?"":"s"}`;else{if(H.length>1)throw S.strictModeViolationError(_.parsed,H);H.length&&(I=`  locator resolved to ${S.previewNode(H[0])}`)}return D&&S.markTargetElements(new Set(H),D),{log:I,...await S.expect(H[0],k,H)}},{info:l,options:n,callId:e.metadata.id});return f&&e.log(f),g===n.isNot&&(r.received=v?"<element(s) not found>":b,r.isSet=!0,!v&&!Array.isArray(b)&&e.log(`  unexpected value "${Hw(n.expression,b)}"`)),{matches:g,received:b}}async _waitForFunctionExpression(e,t,n,r,s,o="main"){let l=new z(e,this);return typeof s.pollingInterval=="number"&&E(s.pollingInterval>0,"Cannot poll with non-positive interval: "+s.pollingInterval),t=Uc(t,n),l.run(async c=>this.retryWithProgressAndTimeouts(c,[100],async()=>{let f=await(await(o==="main"?await this._mainContext():await this._utilityContext()).injectedScript()).evaluateHandle((g,{expression:b,isFunction:v,polling:S,arg:_})=>{let k=()=>{let q=globalThis.eval(b);return v===!0?q=q(_):v===!1?q=q:typeof q=="function"&&(q=q(_)),q},D,H,A=!1,I=new Promise((q,W)=>{D=q,H=W}),F=()=>{if(!A)try{let q=k();if(q){D(q);return}typeof S!="number"?g.builtinRequestAnimationFrame(F):g.builtinSetTimeout(F,S)}catch(q){H(q)}};return F(),{result:I,abort:()=>A=!0}},{expression:t,isFunction:n,polling:s.pollingInterval,arg:r});return c.cleanupWhenAborted(()=>f.evaluate(g=>g.abort()).catch(()=>{})),f.evaluateHandle(g=>g.result)}),this._page._timeoutSettings.timeout(s))}async waitForFunctionValueInUtility(e,t){let n=`() => {
      const result = (${t})();
      if (!result)
        return result;
      return JSON.stringify(result);
    }`,r=await this._waitForFunctionExpression(ge(),n,!0,void 0,{timeout:e.timeUntilDeadline()},"utility");return JSON.parse(r.rawValue())}async title(){return(await this._utilityContext()).evaluate(()=>document.title)}async rafrafTimeout(e){if(e===0)return;let t=await this._utilityContext();await Promise.all([t.evaluate(()=>new Promise(n=>{requestAnimationFrame(()=>{requestAnimationFrame(n)})})),new Promise(n=>setTimeout(n,e))])}_onDetached(){this._stopNetworkIdleTimer(),this._detachedScope.close(new Error("Frame was detached"));for(let e of this._contextData.values())e.context&&e.context.contextDestroyed("Frame was detached"),e.contextPromise.resolve({destroyedReason:"Frame was detached"});this._parentFrame&&this._parentFrame._childFrames.delete(this),this._parentFrame=null}async _callOnElementOnceMatches(e,t,n,r,s={},o){let l=n.toString();return new z(e,this).run(async h=>{h.log(`waiting for ${this._asLocator(t)}`);let m=this.retryWithProgressAndTimeouts(h,[0,20,50,100,100,500],async f=>{let g=await this.selectors.resolveInjectedForSelector(t,s,o);if(h.throwIfAborted(),!g)return f;let{log:b,success:v,value:S}=await g.injected.evaluate((_,{info:k,callbackText:D,taskData:H,callId:A,root:I})=>{let F=_.eval(D),q=_.querySelector(k.parsed,I||document,k.strict);if(!q)return{success:!1};let W=`  locator resolved to ${_.previewNode(q)}`;return A&&_.markTargetElements(new Set([q]),A),{log:W,success:!0,value:F(_,q,H)}},{info:g.info,callbackText:l,taskData:r,callId:h.metadata.id,root:g.frame===this?o:void 0});return b&&h.log(b),v?S:f});return o?o._context._raceAgainstContextDestroyed(m):m},this._page._timeoutSettings.timeout(s))}_setContext(e,t){let n=this._contextData.get(e);n.context=t,t?n.contextPromise.resolve(t):n.contextPromise=new U}_contextCreated(e,t){let n=this._contextData.get(e);n.context&&(n.context.contextDestroyed("Execution context was destroyed, most likely because of a navigation"),this._setContext(e,null)),this._setContext(e,t)}_contextDestroyed(e){if(!this._detachedScope.isClosed()){e.contextDestroyed("Execution context was destroyed, most likely because of a navigation");for(let[t,n]of this._contextData)n.context===e&&this._setContext(t,null)}}_startNetworkIdleTimer(){E(!this._networkIdleTimer),!(this._firedLifecycleEvents.has("networkidle")||this._detachedScope.isClosed())&&(this._networkIdleTimer=setTimeout(()=>{this._firedNetworkIdleSelf=!0,this._page.mainFrame()._recalculateNetworkIdle()},500))}_stopNetworkIdleTimer(){this._networkIdleTimer&&clearTimeout(this._networkIdleTimer),this._networkIdleTimer=void 0,this._firedNetworkIdleSelf=!1}async extendInjectedScript(e,t){return(await(await this._context("main")).injectedScript()).evaluateHandle((s,{source:o,arg:l})=>s.extend(o,l),{source:e,arg:t})}async resetStorageForCurrentOriginBestEffort(e){await(await this._utilityContext()).evaluate(async({ls:n})=>{sessionStorage.clear(),localStorage.clear();for(let s of n||[])localStorage[s.name]=s.value;let r=navigator.serviceWorker?await navigator.serviceWorker.getRegistrations():[];await Promise.all(r.map(async s=>{!s.installing&&!s.waiting&&!s.active?s.unregister().catch(()=>{}):await s.unregister().catch(()=>{})}));for(let s of await indexedDB.databases?.()||[])s.name&&indexedDB.deleteDatabase(s.name)},{ls:e?.localStorage}).catch(()=>{})}_asLocator(e){return ke(this._page.attribution.playwright.options.sdkLanguage,e)}},Qc=class{_progress;_protectCount=0;_promise=new U;constructor(e){this._progress=e,this.retain()}waitFor(){return this.release(),this._promise}async addFrameNavigation(e){if(e.parentFrame())return;this.retain();let t=le.waitForEvent(null,e,Qe.Events.InternalNavigation,n=>n.isPublic?(!n.error&&this._progress&&this._progress.log(`  navigated to "${e._url}"`),!0):!1);await Re.raceMultiple([e._page.openScope,e._detachedScope],t.promise).catch(()=>{}),t.dispose(),this.release()}retain(){++this._protectCount}release(){--this._protectCount,this._protectCount||this._promise.resolve()}}});var yp,_p=x(()=>{yp={Escape:{keyCode:27,key:"Escape"},F1:{keyCode:112,key:"F1"},F2:{keyCode:113,key:"F2"},F3:{keyCode:114,key:"F3"},F4:{keyCode:115,key:"F4"},F5:{keyCode:116,key:"F5"},F6:{keyCode:117,key:"F6"},F7:{keyCode:118,key:"F7"},F8:{keyCode:119,key:"F8"},F9:{keyCode:120,key:"F9"},F10:{keyCode:121,key:"F10"},F11:{keyCode:122,key:"F11"},F12:{keyCode:123,key:"F12"},Backquote:{keyCode:192,shiftKey:"~",key:"`"},Digit1:{keyCode:49,shiftKey:"!",key:"1"},Digit2:{keyCode:50,shiftKey:"@",key:"2"},Digit3:{keyCode:51,shiftKey:"#",key:"3"},Digit4:{keyCode:52,shiftKey:"$",key:"4"},Digit5:{keyCode:53,shiftKey:"%",key:"5"},Digit6:{keyCode:54,shiftKey:"^",key:"6"},Digit7:{keyCode:55,shiftKey:"&",key:"7"},Digit8:{keyCode:56,shiftKey:"*",key:"8"},Digit9:{keyCode:57,shiftKey:"(",key:"9"},Digit0:{keyCode:48,shiftKey:")",key:"0"},Minus:{keyCode:189,shiftKey:"_",key:"-"},Equal:{keyCode:187,shiftKey:"+",key:"="},Backslash:{keyCode:220,shiftKey:"|",key:"\\"},Backspace:{keyCode:8,key:"Backspace"},Tab:{keyCode:9,key:"Tab"},KeyQ:{keyCode:81,shiftKey:"Q",key:"q"},KeyW:{keyCode:87,shiftKey:"W",key:"w"},KeyE:{keyCode:69,shiftKey:"E",key:"e"},KeyR:{keyCode:82,shiftKey:"R",key:"r"},KeyT:{keyCode:84,shiftKey:"T",key:"t"},KeyY:{keyCode:89,shiftKey:"Y",key:"y"},KeyU:{keyCode:85,shiftKey:"U",key:"u"},KeyI:{keyCode:73,shiftKey:"I",key:"i"},KeyO:{keyCode:79,shiftKey:"O",key:"o"},KeyP:{keyCode:80,shiftKey:"P",key:"p"},BracketLeft:{keyCode:219,shiftKey:"{",key:"["},BracketRight:{keyCode:221,shiftKey:"}",key:"]"},CapsLock:{keyCode:20,key:"CapsLock"},KeyA:{keyCode:65,shiftKey:"A",key:"a"},KeyS:{keyCode:83,shiftKey:"S",key:"s"},KeyD:{keyCode:68,shiftKey:"D",key:"d"},KeyF:{keyCode:70,shiftKey:"F",key:"f"},KeyG:{keyCode:71,shiftKey:"G",key:"g"},KeyH:{keyCode:72,shiftKey:"H",key:"h"},KeyJ:{keyCode:74,shiftKey:"J",key:"j"},KeyK:{keyCode:75,shiftKey:"K",key:"k"},KeyL:{keyCode:76,shiftKey:"L",key:"l"},Semicolon:{keyCode:186,shiftKey:":",key:";"},Quote:{keyCode:222,shiftKey:'"',key:"'"},Enter:{keyCode:13,key:"Enter",text:"\r"},ShiftLeft:{keyCode:160,keyCodeWithoutLocation:16,key:"Shift",location:1},KeyZ:{keyCode:90,shiftKey:"Z",key:"z"},KeyX:{keyCode:88,shiftKey:"X",key:"x"},KeyC:{keyCode:67,shiftKey:"C",key:"c"},KeyV:{keyCode:86,shiftKey:"V",key:"v"},KeyB:{keyCode:66,shiftKey:"B",key:"b"},KeyN:{keyCode:78,shiftKey:"N",key:"n"},KeyM:{keyCode:77,shiftKey:"M",key:"m"},Comma:{keyCode:188,shiftKey:"<",key:","},Period:{keyCode:190,shiftKey:">",key:"."},Slash:{keyCode:191,shiftKey:"?",key:"/"},ShiftRight:{keyCode:161,keyCodeWithoutLocation:16,key:"Shift",location:2},ControlLeft:{keyCode:162,keyCodeWithoutLocation:17,key:"Control",location:1},MetaLeft:{keyCode:91,key:"Meta",location:1},AltLeft:{keyCode:164,keyCodeWithoutLocation:18,key:"Alt",location:1},Space:{keyCode:32,key:" "},AltRight:{keyCode:165,keyCodeWithoutLocation:18,key:"Alt",location:2},AltGraph:{keyCode:225,key:"AltGraph"},MetaRight:{keyCode:92,key:"Meta",location:2},ContextMenu:{keyCode:93,key:"ContextMenu"},ControlRight:{keyCode:163,keyCodeWithoutLocation:17,key:"Control",location:2},PrintScreen:{keyCode:44,key:"PrintScreen"},ScrollLock:{keyCode:145,key:"ScrollLock"},Pause:{keyCode:19,key:"Pause"},PageUp:{keyCode:33,key:"PageUp"},PageDown:{keyCode:34,key:"PageDown"},Insert:{keyCode:45,key:"Insert"},Delete:{keyCode:46,key:"Delete"},Home:{keyCode:36,key:"Home"},End:{keyCode:35,key:"End"},ArrowLeft:{keyCode:37,key:"ArrowLeft"},ArrowUp:{keyCode:38,key:"ArrowUp"},ArrowRight:{keyCode:39,key:"ArrowRight"},ArrowDown:{keyCode:40,key:"ArrowDown"},NumLock:{keyCode:144,key:"NumLock"},NumpadDivide:{keyCode:111,key:"/",location:3},NumpadMultiply:{keyCode:106,key:"*",location:3},NumpadSubtract:{keyCode:109,key:"-",location:3},Numpad7:{keyCode:36,shiftKeyCode:103,key:"Home",shiftKey:"7",location:3},Numpad8:{keyCode:38,shiftKeyCode:104,key:"ArrowUp",shiftKey:"8",location:3},Numpad9:{keyCode:33,shiftKeyCode:105,key:"PageUp",shiftKey:"9",location:3},Numpad4:{keyCode:37,shiftKeyCode:100,key:"ArrowLeft",shiftKey:"4",location:3},Numpad5:{keyCode:12,shiftKeyCode:101,key:"Clear",shiftKey:"5",location:3},Numpad6:{keyCode:39,shiftKeyCode:102,key:"ArrowRight",shiftKey:"6",location:3},NumpadAdd:{keyCode:107,key:"+",location:3},Numpad1:{keyCode:35,shiftKeyCode:97,key:"End",shiftKey:"1",location:3},Numpad2:{keyCode:40,shiftKeyCode:98,key:"ArrowDown",shiftKey:"2",location:3},Numpad3:{keyCode:34,shiftKeyCode:99,key:"PageDown",shiftKey:"3",location:3},Numpad0:{keyCode:45,shiftKeyCode:96,key:"Insert",shiftKey:"0",location:3},NumpadDecimal:{keyCode:46,shiftKeyCode:110,key:"\0",shiftKey:".",location:3},NumpadEnter:{keyCode:13,key:"Enter",text:"\r",location:3}}});function Pp(i){return i==="ControlOrMeta"?process.platform==="darwin"?"Meta":"Control":i}function $w(i){return Pp(i)}function jw(i){let e=new Map;for(let t in i){let n=i[t],r={key:n.key||"",keyCode:n.keyCode||0,keyCodeWithoutLocation:n.keyCodeWithoutLocation||n.keyCode||0,code:t,text:n.text||"",location:n.location||0};n.key.length===1&&(r.text=r.key);let s;if(n.shiftKey&&(E(n.shiftKey.length===1),s={...r},s.key=n.shiftKey,s.text=n.shiftKey,n.shiftKeyCode&&(s.keyCode=n.shiftKeyCode)),e.set(t,{...r,shifted:s}),vp.has(t))for(let o of vp.get(t))e.set(o,r);n.location||(r.key.length===1&&e.set(r.key,r),s&&e.set(s.key,{...s,shifted:void 0}))}return e}var Sp,Yo,Zo,ea,vp,xp,ta,Yc=x(()=>{O();_p();Sp=3,Yo=["Alt","Control","Meta","Shift"],Zo=class{_pressedModifiers=new Set;_pressedKeys=new Set;_raw;constructor(e){this._raw=e}async down(e){let t=this._keyDescriptionForString(e),n=this._pressedKeys.has(t.code);this._pressedKeys.add(t.code),Yo.includes(t.key)&&this._pressedModifiers.add(t.key);let r=t.text;await this._raw.keydown(this._pressedModifiers,t.code,t.keyCode,t.keyCodeWithoutLocation,t.key,t.location,n,r)}_keyDescriptionForString(e){let t=Pp(e),n=xp.get(t);return E(n,`Unknown key: "${t}"`),n=this._pressedModifiers.has("Shift")&&n.shifted?n.shifted:n,this._pressedModifiers.size>1||!this._pressedModifiers.has("Shift")&&this._pressedModifiers.size===1?{...n,text:""}:n}async up(e){let t=this._keyDescriptionForString(e);Yo.includes(t.key)&&this._pressedModifiers.delete(t.key),this._pressedKeys.delete(t.code),await this._raw.keyup(this._pressedModifiers,t.code,t.keyCode,t.keyCodeWithoutLocation,t.key,t.location)}async insertText(e){await this._raw.sendText(e)}async type(e,t){let n=t&&t.delay||void 0;for(let r of e)xp.has(r)?await this.press(r,{delay:n}):(n&&await new Promise(s=>setTimeout(s,n)),await this.insertText(r))}async press(e,t={}){function n(s){let o=[],l="";for(let c of s)c==="+"&&l?(o.push(l),l=""):l+=c;return o.push(l),o}let r=n(e);e=r[r.length-1];for(let s=0;s<r.length-1;++s)await this.down(r[s]);await this.down(e),t.delay&&await new Promise(s=>setTimeout(s,t.delay)),await this.up(e);for(let s=r.length-2;s>=0;--s)await this.up(r[s])}async ensureModifiers(e){let t=e.map($w);for(let r of t)if(!Yo.includes(r))throw new Error("Unknown modifier "+r);let n=Array.from(this._pressedModifiers);for(let r of Yo){let s=t.includes(r),o=this._pressedModifiers.has(r);s&&!o?await this.down(r):!s&&o&&await this.up(r)}return n}_modifiers(){return this._pressedModifiers}};ea=class{_keyboard;_x=0;_y=0;_lastButton="none";_buttons=new Set;_raw;_page;constructor(e,t){this._raw=e,this._page=t,this._keyboard=this._page.keyboard}async move(e,t,n={},r){r&&(r.point={x:e,y:t});let{steps:s=1}=n,o=this._x,l=this._y;this._x=e,this._y=t;for(let c=1;c<=s;c++){let h=o+(e-o)*(c/s),m=l+(t-l)*(c/s);await this._raw.move(h,m,this._lastButton,this._buttons,this._keyboard._modifiers(),!!n.forClick)}}async down(e={},t){t&&(t.point={x:this._x,y:this._y});let{button:n="left",clickCount:r=1}=e;this._lastButton=n,this._buttons.add(n),await this._raw.down(this._x,this._y,this._lastButton,this._buttons,this._keyboard._modifiers(),r)}async up(e={},t){t&&(t.point={x:this._x,y:this._y});let{button:n="left",clickCount:r=1}=e;this._lastButton="none",this._buttons.delete(n),await this._raw.up(this._x,this._y,n,this._buttons,this._keyboard._modifiers(),r)}async click(e,t,n={},r){r&&(r.point={x:e,y:t});let{delay:s=null,clickCount:o=1}=n;if(s){this.move(e,t,{forClick:!0});for(let l=1;l<=o;++l)await this.down({...n,clickCount:l}),await new Promise(c=>setTimeout(c,s)),await this.up({...n,clickCount:l}),l<o&&await new Promise(c=>setTimeout(c,s))}else{let l=[];l.push(this.move(e,t,{forClick:!0}));for(let c=1;c<=o;++c)l.push(this.down({...n,clickCount:c})),l.push(this.up({...n,clickCount:c}));await Promise.all(l)}}async dblclick(e,t,n={}){await this.click(e,t,{...n,clickCount:2})}async wheel(e,t){await this._raw.wheel(this._x,this._y,this._buttons,this._keyboard._modifiers(),e,t)}},vp=new Map([["ShiftLeft",["Shift"]],["ControlLeft",["Control"]],["AltLeft",["Alt"]],["MetaLeft",["Meta"]],["Enter",[`
`,"\r"]]]),xp=jw(yp);ta=class{_raw;_page;constructor(e,t){this._raw=e,this._page=t}async tap(e,t,n){if(n&&(n.point={x:e,y:t}),!this._page._browserContext._options.hasTouch)throw new Error("hasTouch must be enabled on the browser context before using the touchscreen.");await this._raw.tap(e,t,this._page.keyboard._modifiers())}}});function qw(i,e,t,n){if(n){let l=document.createElement("style");l.textContent="body {}",document.head.appendChild(l),document.documentElement.getBoundingClientRect(),l.remove()}if(!i&&!e&&!t)return;let r=(l,c=[])=>{c.push(l);let h=document.createTreeWalker(l,NodeFilter.SHOW_ELEMENT);do{let m=h.currentNode,f=m instanceof Element?m.shadowRoot:null;f&&r(f,c)}while(h.nextNode());return c},s=r(document),o=[];if(i)for(let l of s){let c=document.createElement("style");c.textContent=i,l===document?document.documentElement.append(c):l.append(c),o.push(()=>{c.remove()})}if(e){let l=new Map;for(let c of s)c.querySelectorAll("input,textarea,[contenteditable]").forEach(h=>{l.set(h,{value:h.style.getPropertyValue("caret-color"),priority:h.style.getPropertyPriority("caret-color")}),h.style.setProperty("caret-color","transparent","important")});o.push(()=>{for(let[c,h]of l)c.style.setProperty("caret-color",h.value,h.priority)})}if(t){let l=new Set,c=h=>{for(let m of h.getAnimations()){if(!m.effect||m.playbackRate===0||l.has(m))continue;let f=m.effect.getComputedTiming().endTime;if(Number.isFinite(f))try{m.finish()}catch{}else try{m.cancel(),l.add(m)}catch{}}};for(let h of s){let m=c.bind(null,h);m(),h.addEventListener("transitionrun",m),h.addEventListener("animationstart",m),o.push(()=>{h.removeEventListener("transitionrun",m),h.removeEventListener("animationstart",m)})}o.push(()=>{for(let h of l)try{h.play()}catch{}})}window.__pwCleanupScreenshot=()=>{for(let l of o)l();delete window.__pwCleanupScreenshot}}function kp(i,e){let t={x:Math.max(0,Math.min(i.x,e.width)),y:Math.max(0,Math.min(i.y,e.height))},n={x:Math.max(0,Math.min(i.x+i.width,e.width)),y:Math.max(0,Math.min(i.y+i.height,e.height))},r={x:t.x,y:t.y,width:n.x-t.x,height:n.y-t.y};return E(r.width&&r.height,"Clipped area is either empty or outside the resulting image"),r}function ia(i){let e=null;return i.type&&(E(i.type==="png"||i.type==="jpeg","Unknown options.type value: "+i.type),e=i.type),e||(e="png"),i.quality!==void 0&&(E(e==="jpeg","options.quality is unsupported for the "+e+" screenshots"),E(typeof i.quality=="number","Expected options.quality to be a number but found "+typeof i.quality),E(Number.isInteger(i.quality),"Expected options.quality to be an integer"),E(i.quality>=0&&i.quality<=100,"Expected options.quality to be between 0 and 100 (inclusive), got "+i.quality)),i.clip&&(E(typeof i.clip.x=="number","Expected options.clip.x to be a number but found "+typeof i.clip.x),E(typeof i.clip.y=="number","Expected options.clip.y to be a number but found "+typeof i.clip.y),E(typeof i.clip.width=="number","Expected options.clip.width to be a number but found "+typeof i.clip.width),E(typeof i.clip.height=="number","Expected options.clip.height to be a number but found "+typeof i.clip.height),E(i.clip.width!==0,"Expected options.clip.width not to be 0."),E(i.clip.height!==0,"Expected options.clip.height not to be 0.")),e}var na,ra,Ep=x(()=>{Ot();O();vc();na=class{_queue=new ra;_page;constructor(e){this._page=e,this._queue=new ra}async _originalViewportSize(e){let t=this._page.viewportSize(),n=t;return n||(n=await this._page.mainFrame().waitForFunctionValueInUtility(e,()=>({width:window.innerWidth,height:window.innerHeight}))),{viewportSize:n,originalViewportSize:t}}async _fullPageSize(e){return await this._page.mainFrame().waitForFunctionValueInUtility(e,()=>!document.body||!document.documentElement?null:{width:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.body.clientWidth,document.documentElement.clientWidth),height:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)})}async screenshotPage(e,t){let n=ia(t);return this._queue.postTask(async()=>{e.log("taking page screenshot");let{viewportSize:r}=await this._originalViewportSize(e);if(await this._preparePageForScreenshot(e,this._page.mainFrame(),t.style,t.caret!=="initial",t.animations==="disabled"),e.throwIfAborted(),t.fullPage){let l=await this._fullPageSize(e),c={x:0,y:0,width:l.width,height:l.height},h=l.width<=r.width&&l.height<=r.height;t.clip&&(c=kp(t.clip,c));let m=await this._screenshot(e,n,c,void 0,h,t);return e.throwIfAborted(),await this._restorePageAfterScreenshot(),m}let s=t.clip?kp(t.clip,r):{x:0,y:0,...r},o=await this._screenshot(e,n,void 0,s,!0,t);return e.throwIfAborted(),await this._restorePageAfterScreenshot(),o})}async screenshotElement(e,t,n){let r=ia(n);return this._queue.postTask(async()=>{e.log("taking element screenshot");let{viewportSize:s}=await this._originalViewportSize(e);await this._preparePageForScreenshot(e,t._frame,n.style,n.caret!=="initial",n.animations==="disabled"),e.throwIfAborted(),await t._waitAndScrollIntoViewIfNeeded(e,!0),e.throwIfAborted();let o=await t.boundingBox();E(o,"Node is either not visible or not an HTMLElement"),E(o.width!==0,"Node has 0 width."),E(o.height!==0,"Node has 0 height.");let l=o.width<=s.width&&o.height<=s.height;e.throwIfAborted();let c=await this._page.mainFrame().waitForFunctionValueInUtility(e,()=>({x:window.scrollX,y:window.scrollY})),h={...o};h.x+=c.x,h.y+=c.y;let m=await this._screenshot(e,r,le.enclosingIntRect(h),void 0,l,n);return e.throwIfAborted(),await this._restorePageAfterScreenshot(),m})}async _preparePageForScreenshot(e,t,n,r,s){s&&e.log("  disabled all CSS animations");let o=this._page._delegate.shouldToggleStyleSheetToSyncAnimations();await this._page.safeNonStallingEvaluateInAllFrames("("+qw.toString()+`)(${JSON.stringify(n)}, ${r}, ${s}, ${o})`,"utility"),process.env.PW_TEST_SCREENSHOT_NO_FONTS_READY||(e.log("waiting for fonts to load..."),await t.nonStallingEvaluateInExistingContext("document.fonts.ready","utility").catch(()=>{}),e.log("fonts loaded")),e.cleanupWhenAborted(()=>this._restorePageAfterScreenshot())}async _restorePageAfterScreenshot(){await this._page.safeNonStallingEvaluateInAllFrames("window.__pwCleanupScreenshot && window.__pwCleanupScreenshot()","utility")}async _maskElements(e,t){let n=new Mr,r=async()=>{await Promise.all([...n.keys()].map(async s=>{await s.hideHighlight()}))};return!t.mask||!t.mask.length||(await Promise.all((t.mask||[]).map(async({frame:s,selector:o})=>{let l=await s.selectors.resolveFrameForSelector(o);l&&n.set(l.frame,l.info.parsed)})),e.throwIfAborted(),await Promise.all([...n.keys()].map(async s=>{await s.maskSelectors(n.get(s),t.maskColor||"#F0F")})),e.cleanupWhenAborted(r)),r}async _screenshot(e,t,n,r,s,o){o.__testHookBeforeScreenshot&&await o.__testHookBeforeScreenshot(),e.throwIfAborted();let l=o.omitBackground&&t==="png";l&&(await this._page._delegate.setBackgroundColor({r:0,g:0,b:0,a:0}),e.cleanupWhenAborted(()=>this._page._delegate.setBackgroundColor())),e.throwIfAborted();let c=await this._maskElements(e,o);e.throwIfAborted();let h=t==="jpeg"?o.quality??80:void 0,m=await this._page._delegate.takeScreenshot(e,t,n,r,h,s,o.scale||"device");return e.throwIfAborted(),await c(),e.throwIfAborted(),l&&await this._page._delegate.setBackgroundColor(),e.throwIfAborted(),o.__testHookAfterScreenshot&&await o.__testHookAfterScreenshot(),m}},ra=class{_chain;constructor(){this._chain=Promise.resolve()}postTask(e){let t=this._chain.then(e);return this._chain=t.catch(()=>{}),t}}});var sa,Tp=x(()=>{sa=class{_type;_text;_args;_location;_page;constructor(e,t,n,r,s){this._page=e,this._type=t,this._text=n,this._args=r,this._location=s||{url:"",lineNumber:0,columnNumber:0}}page(){return this._page}type(){return this._type}text(){return this._text===void 0&&(this._text=this._args.map(e=>e.preview()).join(" ")),this._text}args(){return this._args}location(){return this._location}}});function Rp(i,e,t){if(e.isInteresting(t)&&i.add(e),!e.isLeafNode()){t=t||e.isControl();for(let n of e.children())Rp(i,n,t)}}function oa(i,e){let t=[];for(let r of i.children())t.push(...oa(r,e));if(e&&!e.has(i))return t;let n=i.serialize();return t.length&&(n.children=t),[n]}var aa,Ap=x(()=>{aa=class{_getAXTree;constructor(e){this._getAXTree=e}async snapshot(e={}){let{interestingOnly:t=!0,root:n=null}=e,{tree:r,needle:s}=await this._getAXTree(n||void 0);if(!t)return n?s&&oa(s)[0]:oa(r)[0];let o=new Set;return Rp(o,r,!1),n&&(!s||!o.has(s))?null:oa(s||r,o)[0]}}});var la,Fp=x(()=>{la=class{_page;_elementHandle;_isMultiple;constructor(e,t,n){this._page=e,this._elementHandle=t,this._isMultiple=n}element(){return this._elementHandle}isMultiple(){return this._isMultiple}page(){return this._page}}});function zw(i,e,t,n){let r=globalThis[i];globalThis[e]=(...s)=>{let o=globalThis[e];if(t&&s.slice(1).some(g=>g!==void 0))throw new Error(`exposeBindingHandle supports a single argument, ${s.length} received`);let l=o.callbacks;l||(l=new Map,o.callbacks=l);let c=(o.lastSeq||0)+1;o.lastSeq=c;let h=o.handles;h||(h=new Map,o.handles=h);let m=new Promise((g,b)=>l.set(c,{resolve:g,reject:b})),f;if(t)h.set(c,s[0]),f={name:e,seq:c};else{let g=[];for(let b=0;b<s.length;b++)g[b]=n.serializeAsCallArgument(s[b],v=>({fallThrough:v}));f={name:e,seq:c,serializedArgs:g}}return r(JSON.stringify(f)),m},globalThis[e].__installed=!0}var re,jn,qn,Vr,Zc,nt=x(()=>{ur();Yc();ms();Ep();bn();Oe();Tp();Ap();Fp();Nt();O();qe();Te();Vl();ye();ir();Uo();Vt();O();re=class i extends se{static Events={Close:"close",Crash:"crash",Download:"download",FileChooser:"filechooser",FrameAttached:"frameattached",FrameDetached:"framedetached",InternalFrameNavigatedToNewDocument:"internalframenavigatedtonewdocument",LocatorHandlerTriggered:"locatorhandlertriggered",ScreencastFrame:"screencastframe",Video:"video",WebSocket:"websocket",Worker:"worker"};_closedState="open";_closedPromise=new U;_initialized=!1;_eventsToEmitAfterInitialized=[];_crashed=!1;openScope=new Re;_browserContext;keyboard;mouse;touchscreen;_timeoutSettings;_delegate;_emulatedSize;_extraHTTPHeaders;_emulatedMedia={};_interceptFileChooser=!1;_pageBindings=new Map;initScripts=[];_screenshotter;_frameManager;accessibility;_workers=new Map;pdf;coverage;_clientRequestInterceptor;_serverRequestInterceptor;_ownedContext;_pageIsError;_video=null;_opener;_isServerSideOnly=!1;_locatorHandlers=new Map;_lastLocatorHandlerUid=0;_locatorHandlerRunningCounter=0;_frameThrottler=new Zc(10,35,200);_closeReason;constructor(e,t){super(t,"page"),this.attribution.page=this,this._delegate=e,this._browserContext=t,this.accessibility=new aa(e.getAccessibilityTree.bind(e)),this.keyboard=new Zo(e.rawKeyboard),this.mouse=new ea(e.rawMouse,this),this.touchscreen=new ta(e.rawTouchscreen,this),this._timeoutSettings=new Le(t._timeoutSettings),this._screenshotter=new na(this),this._frameManager=new Qo(this),e.pdf&&(this.pdf=e.pdf.bind(e)),this.coverage=e.coverage?e.coverage():null}async initOpener(e){if(!e)return;let t=await e.pageOrError();t instanceof i&&!t.isClosed()&&(this._opener=t)}reportAsNew(e=void 0,t=j.Events.Page){if(e){if(this._browserContext.isClosingOrClosed())return;this._setIsError(e)}this._initialized=!0,this.emitOnContext(t,this);for(let{event:n,args:r}of this._eventsToEmitAfterInitialized)this._browserContext.emit(n,...r);this._eventsToEmitAfterInitialized=[],this.isClosed()?this.emit(i.Events.Close):this.instrumentation.onPageOpen(this)}initializedOrUndefined(){return this._initialized?this:void 0}emitOnContext(e,...t){this._isServerSideOnly||this._browserContext.emit(e,...t)}emitOnContextOnceInitialized(e,...t){this._isServerSideOnly||(this._initialized?this._browserContext.emit(e,...t):this._eventsToEmitAfterInitialized.push({event:e,args:t}))}async resetForReuse(e){this.setDefaultNavigationTimeout(void 0),this.setDefaultTimeout(void 0),this._locatorHandlers.clear(),await this._removeExposedBindings(),await this._removeInitScripts(),await this.setClientRequestInterceptor(void 0),await this._setServerRequestInterceptor(void 0),await this.setFileChooserIntercepted(!1),await this.mainFrame().goto(e,"about:blank"),this._emulatedSize=void 0,this._emulatedMedia={},this._extraHTTPHeaders=void 0,this._interceptFileChooser=!1,await Promise.all([this._delegate.updateEmulatedViewportSize(),this._delegate.updateEmulateMedia(),this._delegate.updateFileChooserInterception()]),await this._delegate.resetForReuse()}_didClose(){this._frameManager.dispose(),this._frameThrottler.dispose(),E(this._closedState!=="closed","Page closed twice"),this._closedState="closed",this.emit(i.Events.Close),this._closedPromise.resolve(),this.instrumentation.onPageClose(this),this.openScope.close(new pt)}_didCrash(){this._frameManager.dispose(),this._frameThrottler.dispose(),this.emit(i.Events.Crash),this._crashed=!0,this.instrumentation.onPageClose(this),this.openScope.close(new Error("Page crashed"))}async _onFileChooserOpened(e){let t;try{t=await e.evaluate(r=>!!r.multiple)}catch{return}if(!this.listenerCount(i.Events.FileChooser)){e.dispose();return}let n=new la(this,e,t);this.emit(i.Events.FileChooser,n)}context(){return this._browserContext}opener(){return this._opener}mainFrame(){return this._frameManager.mainFrame()}frames(){return this._frameManager.frames()}setDefaultNavigationTimeout(e){this._timeoutSettings.setDefaultNavigationTimeout(e)}setDefaultTimeout(e){this._timeoutSettings.setDefaultTimeout(e)}async exposeBinding(e,t,n){if(this._pageBindings.has(e))throw new Error(`Function "${e}" has been already registered`);if(this._browserContext._pageBindings.has(e))throw new Error(`Function "${e}" has been already registered in the browser context`);let r=new qn(e,n,t);this._pageBindings.set(e,r),await this._delegate.addInitScript(r.initScript),await Promise.all(this.frames().map(s=>s.evaluateExpression(r.initScript.source).catch(o=>{})))}async _removeExposedBindings(){for(let[e,t]of this._pageBindings)t.internal||this._pageBindings.delete(e)}setExtraHTTPHeaders(e){return this._extraHTTPHeaders=e,this._delegate.updateExtraHTTPHeaders()}extraHTTPHeaders(){return this._extraHTTPHeaders}async _onBindingCalled(e,t){this._closedState!=="closed"&&await qn.dispatch(this,e,t)}_addConsoleMessage(e,t,n,r){let s=new sa(this,e,r,t,n);if(this._frameManager.interceptConsoleMessage(s)){t.forEach(l=>l.dispose());return}this.emitOnContextOnceInitialized(j.Events.Console,s)}async reload(e,t){return new z(e,this).run(r=>this.mainFrame().raceNavigationAction(r,t,async()=>{let[s]=await Promise.all([this.mainFrame()._waitForNavigation(r,!0,t),this._delegate.reload()]);return s}),this._timeoutSettings.navigationTimeout(t))}async goBack(e,t){return new z(e,this).run(r=>this.mainFrame().raceNavigationAction(r,t,async()=>{let s,o=this.mainFrame()._waitForNavigation(r,!1,t).catch(h=>(s=h,null));if(!await this._delegate.goBack())return null;let c=await o;if(s)throw s;return c}),this._timeoutSettings.navigationTimeout(t))}async goForward(e,t){return new z(e,this).run(r=>this.mainFrame().raceNavigationAction(r,t,async()=>{let s,o=this.mainFrame()._waitForNavigation(r,!1,t).catch(h=>(s=h,null));if(!await this._delegate.goForward())return null;let c=await o;if(s)throw s;return c}),this._timeoutSettings.navigationTimeout(t))}registerLocatorHandler(e,t){let n=++this._lastLocatorHandlerUid;return this._locatorHandlers.set(n,{selector:e,noWaitAfter:t}),n}resolveLocatorHandler(e,t){let n=this._locatorHandlers.get(e);t&&this._locatorHandlers.delete(e),n&&(n.resolved?.resolve(),n.resolved=void 0)}unregisterLocatorHandler(e){this._locatorHandlers.delete(e)}async performLocatorHandlersCheckpoint(e){if(!this._locatorHandlerRunningCounter){for(let[t,n]of this._locatorHandlers)if(n.resolved||await this.mainFrame().isVisibleInternal(n.selector,{strict:!0})&&(n.resolved=new U,this.emit(i.Events.LocatorHandlerTriggered,t)),n.resolved){++this._locatorHandlerRunningCounter,e.log(`  found ${ke(this.attribution.playwright.options.sdkLanguage,n.selector)}, intercepting action to run the handler`);let r=n.resolved.then(async()=>{e.throwIfAborted(),n.noWaitAfter?e.log("  locator handler has finished"):(e.log(`  locator handler has finished, waiting for ${ke(this.attribution.playwright.options.sdkLanguage,n.selector)} to be hidden`),await this.mainFrame().waitForSelectorInternal(e,n.selector,{state:"hidden"}))});await this.openScope.race(r).finally(()=>--this._locatorHandlerRunningCounter),e.throwIfAborted(),e.log("  interception handler has finished, continuing")}}}async emulateMedia(e){e.media!==void 0&&(this._emulatedMedia.media=e.media),e.colorScheme!==void 0&&(this._emulatedMedia.colorScheme=e.colorScheme),e.reducedMotion!==void 0&&(this._emulatedMedia.reducedMotion=e.reducedMotion),e.forcedColors!==void 0&&(this._emulatedMedia.forcedColors=e.forcedColors),await this._delegate.updateEmulateMedia()}emulatedMedia(){let e=this._browserContext._options;return{media:this._emulatedMedia.media||"no-override",colorScheme:this._emulatedMedia.colorScheme!==void 0?this._emulatedMedia.colorScheme:e.colorScheme??"light",reducedMotion:this._emulatedMedia.reducedMotion!==void 0?this._emulatedMedia.reducedMotion:e.reducedMotion??"no-preference",forcedColors:this._emulatedMedia.forcedColors!==void 0?this._emulatedMedia.forcedColors:e.forcedColors??"none"}}async setViewportSize(e){this._emulatedSize={viewport:{...e},screen:{...e}},await this._delegate.updateEmulatedViewportSize()}viewportSize(){return this.emulatedSize()?.viewport||null}emulatedSize(){if(this._emulatedSize)return this._emulatedSize;let e=this._browserContext._options;return e.viewport?{viewport:e.viewport,screen:e.screen||e.viewport}:null}async bringToFront(){await this._delegate.bringToFront()}async addInitScript(e){let t=new Vr(e);this.initScripts.push(t),await this._delegate.addInitScript(t)}async _removeInitScripts(){this.initScripts=this.initScripts.filter(e=>e.internal),await this._delegate.removeNonInternalInitScripts()}needsRequestInterception(){return!!this._clientRequestInterceptor||!!this._serverRequestInterceptor||!!this._browserContext._requestInterceptor}async setClientRequestInterceptor(e){this._clientRequestInterceptor=e,await this._delegate.updateRequestInterception()}async _setServerRequestInterceptor(e){this._serverRequestInterceptor=e,await this._delegate.updateRequestInterception()}async expectScreenshot(e,t={}){let n=t.locator,r=n?async(m,f)=>await n.frame.rafrafTimeoutScreenshotElementWithProgress(m,n.selector,f,t||{}):async(m,f)=>(await this.performLocatorHandlersCheckpoint(m),await this.mainFrame().rafrafTimeout(f),await this._screenshotter.screenshotPage(m,t||{})),s=Uu("image/png"),o=new z(e,this);if(!t.expected&&t.isNot)return{errorMessage:'"not" matcher requires expected result'};try{if(ia(t||{})!=="png")throw new Error("Only PNG screenshots are supported")}catch(m){return{errorMessage:m.message}}let l,c=(m,f,g)=>{let b=m&&f?s(m,f,t):void 0;return b!==void 0&&!!b==!!t.isNot?!0:(b&&(l={errorMessage:b.errorMessage,diff:b.diff,actual:m,previous:g}),!1)},h=this._timeoutSettings.timeout(t);return o.run(async m=>{let f,g,b=[0,100,250,500];m.log(`${e.apiName}${h?` with timeout ${h}ms`:""}`),t.expected?m.log("  verifying given screenshot expectation"):m.log("  generating new stable screenshot expectation");let v=!0;for(;;){if(m.throwIfAborted(),this.isClosed())throw new Error("The page has closed");let S=b.shift()??1e3;if(S&&m.log(`waiting ${S}ms before taking screenshot`),g=f,f=await r(m,S).catch(k=>{m.log("failed to take screenshot - "+k.message)}),!f)continue;let _=t.expected&&v?t.expected:g;if(c(f,_,g))break;l&&m.log(l.errorMessage),v=!1}if(v||m.log("captured a stable screenshot"),!t.expected)return{actual:f};if(v)return m.log("screenshot matched expectation"),{};if(c(f,t.expected,g))return m.log("screenshot matched expectation"),{};throw new Error(l.errorMessage)},h).catch(m=>{if(ot(m)||Mn(m))throw m;return{log:m.message?[...e.log,m.message]:e.log,...l,errorMessage:m.message}})}async screenshot(e,t={}){return new z(e,this).run(r=>this._screenshotter.screenshotPage(r,t),this._timeoutSettings.timeout(t))}async close(e,t={}){if(this._closedState==="closed")return;t.reason&&(this._closeReason=t.reason);let n=!!t.runBeforeUnload;this._closedState!=="closing"&&(this._closedState="closing",await this._delegate.closePage(n).catch(r=>N.log("error",r))),n||await this._closedPromise,this._ownedContext&&await this._ownedContext.close(t)}_setIsError(e){this._pageIsError=e,this._frameManager.createDummyMainFrameIfNeeded()}isClosed(){return this._closedState==="closed"}hasCrashed(){return this._crashed}isClosedOrClosingOrCrashed(){return this._closedState!=="open"||this._crashed}_addWorker(e,t){this._workers.set(e,t),this.emit(i.Events.Worker,t)}_removeWorker(e){let t=this._workers.get(e);t&&(t.didClose(),this._workers.delete(e))}_clearWorkers(){for(let[e,t]of this._workers)t.didClose(),this._workers.delete(e)}async setFileChooserIntercepted(e){this._interceptFileChooser=e,await this._delegate.updateFileChooserInterception()}fileChooserIntercepted(){return this._interceptFileChooser}frameNavigatedToNewDocument(e){this.emit(i.Events.InternalFrameNavigatedToNewDocument,e);let t=e.origin();t&&this._browserContext.addVisitedOrigin(t)}allInitScripts(){return[...[...this._browserContext._pageBindings.values(),...this._pageBindings.values()].map(t=>t.initScript),...this._browserContext.initScripts,...this.initScripts]}getBinding(e){return this._pageBindings.get(e)||this._browserContext._pageBindings.get(e)}setScreencastOptions(e){this._delegate.setScreencastOptions(e).catch(t=>N.log("error",t)),this._frameThrottler.setThrottlingEnabled(!!e)}throttleScreencastFrameAck(e){this._frameThrottler.ack(e)}temporarilyDisableTracingScreencastThrottling(){this._frameThrottler.recharge()}async safeNonStallingEvaluateInAllFrames(e,t,n={}){await Promise.all(this.frames().map(async r=>{try{await r.nonStallingEvaluateInExistingContext(e,t)}catch(s){if(n.throwOnJSErrors&&ot(s))throw s}}))}async hideHighlight(){await Promise.all(this.frames().map(e=>e.hideHighlight().catch(()=>{})))}markAsServerSideOnly(){this._isServerSideOnly=!0}},jn=class i extends se{static Events={Close:"close"};_url;_executionContextPromise;_executionContextCallback;_existingExecutionContext=null;openScope=new Re;constructor(e,t){super(e,"worker"),this._url=t,this._executionContextCallback=()=>{},this._executionContextPromise=new Promise(n=>this._executionContextCallback=n)}_createExecutionContext(e){this._existingExecutionContext=new $n(this,e,"worker"),this._executionContextCallback(this._existingExecutionContext)}url(){return this._url}didClose(){this._existingExecutionContext&&this._existingExecutionContext.contextDestroyed("Worker was closed"),this.emit(i.Events.Close,this),this.openScope.close(new Error("Worker closed"))}async evaluateExpression(e,t,n){return _n(await this._executionContextPromise,e,{returnByValue:!0,isFunction:t},n)}async evaluateExpressionHandle(e,t,n){return _n(await this._executionContextPromise,e,{returnByValue:!1,isFunction:t},n)}},qn=class i{static kPlaywrightBinding="__playwright__binding__";name;playwrightFunction;initScript;needsHandle;internal;constructor(e,t,n){this.name=e,this.playwrightFunction=t,this.initScript=new Vr(`(${zw.toString()})(${JSON.stringify(i.kPlaywrightBinding)}, ${JSON.stringify(e)}, ${n}, (${zc})())`,!0),this.needsHandle=n,this.internal=e.startsWith("__pw")}static async dispatch(e,t,n){let{name:r,seq:s,serializedArgs:o}=JSON.parse(t);try{E(n.world);let h=e.getBinding(r);if(!h)throw new Error(`Function "${r}" is not exposed`);let m;if(h.needsHandle){let f=await n.evaluateHandle(l,{name:r,seq:s}).catch(g=>null);m=await h.playwrightFunction({frame:n.frame,page:e,context:e._browserContext},f)}else{let f=o.map(g=>zo(g));m=await h.playwrightFunction({frame:n.frame,page:e,context:e._browserContext},...f)}n.evaluate(c,{name:r,seq:s,result:m}).catch(f=>N.log("error",f))}catch(h){n.evaluate(c,{name:r,seq:s,error:h}).catch(m=>N.log("error",m))}function l(h){let m=globalThis[h.name].handles.get(h.seq);return globalThis[h.name].handles.delete(h.seq),m}function c(h){let m=globalThis[h.name].callbacks;"error"in h?m.get(h.seq).reject(h.error):m.get(h.seq).resolve(h.result),m.delete(h.seq)}}};Vr=class{source;internal;constructor(e,t){let n=Y();this.source=`(() => {
      globalThis.__pwInitScripts = globalThis.__pwInitScripts || {};
      const hasInitScript = globalThis.__pwInitScripts[${JSON.stringify(n)}];
      if (hasInitScript)
        return;
      globalThis.__pwInitScripts[${JSON.stringify(n)}] = true;
      ${e}
    })();`,this.internal=!!t}},Zc=class{_acks=[];_defaultInterval;_throttlingInterval;_nonThrottledFrames;_budget;_throttlingEnabled=!1;_timeoutId;constructor(e,t,n){this._nonThrottledFrames=e,this._budget=e,this._defaultInterval=t,this._throttlingInterval=n,this._tick()}dispose(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}setThrottlingEnabled(e){this._throttlingEnabled=e}recharge(){for(let e of this._acks)e();this._acks=[],this._budget=this._nonThrottledFrames,this._timeoutId&&(clearTimeout(this._timeoutId),this._tick())}ack(e){if(!this._timeoutId){e();return}this._acks.push(e)}_tick(){let e=this._acks.shift();e&&(--this._budget,e()),this._throttlingEnabled&&this._budget<=0?this._timeoutId=setTimeout(()=>this._tick(),this._throttlingInterval):this._timeoutId=setTimeout(()=>this._tick(),this._defaultInterval)}}});var Ip,ca,Lp,ed=x(()=>{Ip=new Set(["Page.goBack","Page.goForward","Page.reload","Page.keyboardDown","Page.keyboardUp","Page.keyboardInsertText","Page.keyboardType","Page.keyboardPress","Page.mouseMove","Page.mouseDown","Page.mouseUp","Page.mouseClick","Page.mouseWheel","Page.touchscreenTap","Frame.blur","Frame.check","Frame.click","Frame.dragAndDrop","Frame.dblclick","Frame.dispatchEvent","Frame.fill","Frame.focus","Frame.goto","Frame.hover","Frame.press","Frame.selectOption","Frame.setInputFiles","Frame.tap","Frame.type","Frame.uncheck","ElementHandle.check","ElementHandle.click","ElementHandle.dblclick","ElementHandle.dispatchEvent","ElementHandle.fill","ElementHandle.focus","ElementHandle.hover","ElementHandle.press","ElementHandle.scrollIntoViewIfNeeded","ElementHandle.selectOption","ElementHandle.selectText","ElementHandle.setInputFiles","ElementHandle.tap","ElementHandle.type","ElementHandle.uncheck"]),ca=new Set(["EventTarget.waitForEventInfo","BrowserContext.waitForEventInfo","Page.waitForEventInfo","WebSocket.waitForEventInfo","ElectronApplication.waitForEventInfo","AndroidDevice.waitForEventInfo","Page.emulateMedia","Page.goBack","Page.goForward","Page.reload","Page.expectScreenshot","Page.screenshot","Page.setViewportSize","Page.keyboardDown","Page.keyboardUp","Page.keyboardInsertText","Page.keyboardType","Page.keyboardPress","Page.mouseMove","Page.mouseDown","Page.mouseUp","Page.mouseClick","Page.mouseWheel","Page.touchscreenTap","Frame.evalOnSelector","Frame.evalOnSelectorAll","Frame.addScriptTag","Frame.addStyleTag","Frame.blur","Frame.check","Frame.click","Frame.dragAndDrop","Frame.dblclick","Frame.dispatchEvent","Frame.evaluateExpression","Frame.evaluateExpressionHandle","Frame.fill","Frame.focus","Frame.getAttribute","Frame.goto","Frame.hover","Frame.innerHTML","Frame.innerText","Frame.inputValue","Frame.isChecked","Frame.isDisabled","Frame.isEnabled","Frame.isHidden","Frame.isVisible","Frame.isEditable","Frame.press","Frame.selectOption","Frame.setContent","Frame.setInputFiles","Frame.tap","Frame.textContent","Frame.type","Frame.uncheck","Frame.waitForTimeout","Frame.waitForFunction","Frame.waitForSelector","Frame.expect","JSHandle.evaluateExpression","ElementHandle.evaluateExpression","JSHandle.evaluateExpressionHandle","ElementHandle.evaluateExpressionHandle","ElementHandle.evalOnSelector","ElementHandle.evalOnSelectorAll","ElementHandle.check","ElementHandle.click","ElementHandle.dblclick","ElementHandle.dispatchEvent","ElementHandle.fill","ElementHandle.focus","ElementHandle.hover","ElementHandle.innerHTML","ElementHandle.innerText","ElementHandle.inputValue","ElementHandle.isChecked","ElementHandle.isDisabled","ElementHandle.isEditable","ElementHandle.isEnabled","ElementHandle.isHidden","ElementHandle.isVisible","ElementHandle.press","ElementHandle.screenshot","ElementHandle.scrollIntoViewIfNeeded","ElementHandle.selectOption","ElementHandle.selectText","ElementHandle.setInputFiles","ElementHandle.tap","ElementHandle.textContent","ElementHandle.type","ElementHandle.uncheck","ElementHandle.waitForElementState","ElementHandle.waitForSelector"]),Lp=new Set(["Frame.check","Frame.click","Frame.dragAndDrop","Frame.dblclick","Frame.fill","Frame.hover","Frame.press","Frame.selectOption","Frame.setInputFiles","Frame.tap","Frame.type","Frame.uncheck","ElementHandle.check","ElementHandle.click","ElementHandle.dblclick","ElementHandle.fill","ElementHandle.hover","ElementHandle.press","ElementHandle.selectOption","ElementHandle.setInputFiles","ElementHandle.tap","ElementHandle.type","ElementHandle.uncheck"])});import{EventEmitter as Uw}from"events";function Gw(i,e){return i.attribution.playwright.options.isServer||!i.attribution.browser?.options.headful&&!ce()?!1:e.method==="pause"}function Kw(i){if(!i.apiName)return!1;if(i.method==="close")return!0;if(i.method==="waitForSelector"||i.method==="waitForEventInfo")return!1;let e=i.type+"."+i.method;return ca.has(e)&&!Lp.has(i.type+"."+i.method)}function Jw(i){return Ip.has(i.type+"."+i.method)}var Vw,hr,td=x(()=>{O();Oe();ed();Vw=Symbol("Debugger"),hr=class i extends Uw{_pauseOnNextStatement=!1;_pausedCallsMetadata=new Map;_enabled;_context;static Events={PausedStateChanged:"pausedstatechanged"};_muted=!1;_slowMo;constructor(e){super(),this._context=e,this._context[Vw]=this,this._enabled=it()==="inspector",this._enabled&&this.pauseOnNextStatement(),e.instrumentation.addListener(this,e),this._context.once(j.Events.Close,()=>{this._context.instrumentation.removeListener(this)}),this._slowMo=this._context._browser.options.slowMo}async setMuted(e){this._muted=e}async onBeforeCall(e,t){this._muted||(Gw(e,t)||this._pauseOnNextStatement&&Kw(t))&&await this.pause(e,t)}async _doSlowMo(){await new Promise(e=>setTimeout(e,this._slowMo))}async onAfterCall(e,t){this._slowMo&&Jw(t)&&await this._doSlowMo()}async onBeforeInputAction(e,t){this._muted||this._enabled&&this._pauseOnNextStatement&&await this.pause(e,t)}async pause(e,t){if(this._muted)return;this._enabled=!0,t.pauseStartTime=X();let n=new Promise(r=>{this._pausedCallsMetadata.set(t,{resolve:r,sdkObject:e})});return this.emit(i.Events.PausedStateChanged),n}resume(e){if(!this.isPaused())return;this._pauseOnNextStatement=e;let t=X();for(let[n,{resolve:r}]of this._pausedCallsMetadata)n.pauseEndTime=t,r();this._pausedCallsMetadata.clear(),this.emit(i.Events.PausedStateChanged)}pauseOnNextStatement(){this._pauseOnNextStatement=!0}isPaused(e){return e?this._pausedCallsMetadata.has(e):!!this._pausedCallsMetadata.size}pausedDetails(){let e=[];for(let[t,{sdkObject:n}]of this._pausedCallsMetadata)e.push({metadata:t,sdkObject:n});return e}}});var St,Gr=x(()=>{O();qe();ye();Vt();St=class extends se{_localPath;_unaccessibleErrorMessage;_cancelCallback;_finishedPromise=new U;_saveCallbacks=[];_finished=!1;_deleted=!1;_failureError;constructor(e,t,n,r){super(e,"artifact"),this._localPath=t,this._unaccessibleErrorMessage=n,this._cancelCallback=r}finishedPromise(){return this._finishedPromise}localPath(){return this._localPath}async localPathAfterFinished(){if(this._unaccessibleErrorMessage)throw new Error(this._unaccessibleErrorMessage);if(await this._finishedPromise,this._failureError)throw this._failureError;return this._localPath}saveAs(e){if(this._unaccessibleErrorMessage)throw new Error(this._unaccessibleErrorMessage);if(this._deleted)throw new Error("File already deleted. Save before deleting.");if(this._failureError)throw this._failureError;if(this._finished){e(this._localPath).catch(()=>{});return}this._saveCallbacks.push(e)}async failureError(){return this._unaccessibleErrorMessage?this._unaccessibleErrorMessage:(await this._finishedPromise,this._failureError?.message||null)}async cancel(){return E(this._cancelCallback!==void 0),this._cancelCallback()}async delete(){if(this._unaccessibleErrorMessage)return;let e=await this.localPathAfterFinished();this._deleted||(this._deleted=!0,e&&await fs.promises.unlink(e).catch(t=>{}))}async deleteOnContextClose(){this._deleted||(this._deleted=!0,this._unaccessibleErrorMessage||await fs.promises.unlink(this._localPath).catch(e=>{}),await this.reportFinished(new pt))}async reportFinished(e){if(!this._finished){if(this._finished=!0,this._failureError=e,e)for(let t of this._saveCallbacks)await t("",e);else for(let t of this._saveCallbacks)await t(this._localPath);this._saveCallbacks=[],this._finishedPromise.resolve()}}}});function Mp(i,e,t,n){return{_frameref:n.includeTraceInfo?t:void 0,_monotonicTime:n.includeTraceInfo?X():void 0,startedDateTime:new Date().toISOString(),time:-1,request:{method:i,url:e.toString(),httpVersion:Op,cookies:[],headers:[],queryString:[...e.searchParams].map(s=>({name:s[0],value:s[1]})),headersSize:-1,bodySize:-1},response:{status:-1,statusText:"",httpVersion:Op,cookies:[],headers:[],content:{size:-1,mimeType:"x-unknown"},headersSize:-1,bodySize:-1,redirectURL:"",_transferSize:n.omitSizes?void 0:-1},cache:{},timings:{send:-1,wait:-1,receive:-1}}}function Np(i){let e={name:"",value:""},t=!0;for(let n of i.split(/; */)){let r=n.indexOf("="),s=r!==-1?n.substr(0,r).trim():n.trim(),o=r!==-1?n.substr(r+1,n.length).trim():"";if(t){t=!1,e.name=s,e.value=o;continue}s==="Domain"&&(e.domain=o),s==="Expires"&&(e.expires=rd(o)),s==="HttpOnly"&&(e.httpOnly=!0),s==="Max-Age"&&(e.expires=rd(Date.now()+ +o*1e3)),s==="Path"&&(e.path=o),s==="SameSite"&&(e.sameSite=o),s==="Secure"&&(e.secure=!0)}return e}function rd(i){try{return new Date(i).toISOString()}catch{}}var Op,Kr,nd,id=x(()=>{Oe();hs();Ot();Gt();O();It();qe();O();ur();Op="HTTP/1.1",Kr=class{_context;_barrierPromises=new Set;_delegate;_options;_pageEntries=new Map;_eventListeners=[];_started=!1;_entrySymbol;_baseURL;_page;constructor(e,t,n,r){this._context=e,this._page=t,this._delegate=n,this._options=r,r.slimMode&&(r.omitSecurityDetails=!0,r.omitCookies=!0,r.omitTiming=!0,r.omitServerIP=!0,r.omitSizes=!0,r.omitPages=!0),this._entrySymbol=Symbol("requestHarEntry"),this._baseURL=e instanceof Mt?e._defaultOptions().baseURL:e._options.baseURL}start(e){if(this._started)return;this._options.omitScripts=e.omitScripts,this._started=!0;let t=this._context instanceof Mt?this._context:this._context.fetchRequest;this._eventListeners=[L.addEventListener(t,Mt.Events.Request,n=>this._onAPIRequest(n)),L.addEventListener(t,Mt.Events.RequestFinished,n=>this._onAPIRequestFinished(n))],this._context instanceof j&&this._eventListeners.push(L.addEventListener(this._context,j.Events.Page,n=>this._createPageEntryIfNeeded(n)),L.addEventListener(this._context,j.Events.Request,n=>this._onRequest(n)),L.addEventListener(this._context,j.Events.RequestFinished,({request:n,response:r})=>this._onRequestFinished(n,r).catch(()=>{})),L.addEventListener(this._context,j.Events.RequestFailed,n=>this._onRequestFailed(n)),L.addEventListener(this._context,j.Events.Response,n=>this._onResponse(n)),L.addEventListener(this._context,j.Events.RequestAborted,n=>this._onRequestAborted(n)),L.addEventListener(this._context,j.Events.RequestFulfilled,n=>this._onRequestFulfilled(n)),L.addEventListener(this._context,j.Events.RequestContinued,n=>this._onRequestContinued(n)))}_shouldIncludeEntryWithUrl(e){return!this._options.urlFilter||tt(this._baseURL,e,this._options.urlFilter)}_entryForRequest(e){return e[this._entrySymbol]}_createPageEntryIfNeeded(e){if(!e||this._options.omitPages||this._page&&e!==this._page)return;let t=this._pageEntries.get(e);if(!t){let n=new Date;t={startedDateTime:n.toISOString(),id:e.guid,title:"",pageTimings:this._options.omitTiming?{}:{onContentLoad:-1,onLoad:-1}},t[nd]=n,e.mainFrame().on(Qe.Events.AddLifecycle,r=>{r==="load"&&this._onLoad(e,t),r==="domcontentloaded"&&this._onDOMContentLoaded(e,t)}),this._pageEntries.set(e,t)}return t}_onDOMContentLoaded(e,t){let n=e.mainFrame().evaluateExpression(String(()=>({title:document.title,domContentLoaded:performance.timing.domContentLoadedEventStart})),{isFunction:!0,world:"utility"}).then(r=>{t.title=r.title,this._options.omitTiming||(t.pageTimings.onContentLoad=r.domContentLoaded)}).catch(()=>{});this._addBarrier(e,n)}_onLoad(e,t){let n=e.mainFrame().evaluateExpression(String(()=>({title:document.title,loaded:performance.timing.loadEventStart})),{isFunction:!0,world:"utility"}).then(r=>{t.title=r.title,this._options.omitTiming||(t.pageTimings.onLoad=r.loaded)}).catch(()=>{});this._addBarrier(e,n)}_addBarrier(e,t){if(!e)return null;if(!this._options.waitForContentOnStop)return;let n=e.openScope.safeRace(t);this._barrierPromises.add(n),n.then(()=>this._barrierPromises.delete(n))}_onAPIRequest(e){if(!this._shouldIncludeEntryWithUrl(e.url.toString()))return;let t=Mp(e.method,e.url,void 0,this._options);t._apiRequest=!0,this._options.omitCookies||(t.request.cookies=e.cookies),t.request.headers=Object.entries(e.headers).map(([n,r])=>({name:n,value:r})),t.request.postData=this._postDataForBuffer(e.postData||null,e.headers["content-type"],this._options.content),this._options.omitSizes||(t.request.bodySize=e.postData?.length||0),e[this._entrySymbol]=t,this._started&&this._delegate.onEntryStarted(t)}_onAPIRequestFinished(e){let t=this._entryForRequest(e.requestEvent);if(!t)return;t.response.status=e.statusCode,t.response.statusText=e.statusMessage,t.response.httpVersion=e.httpVersion,t.response.redirectURL=e.headers.location||"";for(let s=0;s<e.rawHeaders.length;s+=2)t.response.headers.push({name:e.rawHeaders[s],value:e.rawHeaders[s+1]});t.response.cookies=this._options.omitCookies?[]:e.cookies.map(s=>({...s,expires:s.expires===-1?void 0:rd(s.expires)}));let n=t.response.content,r=e.headers["content-type"];r&&(n.mimeType=r),this._storeResponseContent(e.body,n,"other"),this._started&&this._delegate.onEntryFinished(t)}_onRequest(e){if(!this._shouldIncludeEntryWithUrl(e.url()))return;let t=e.frame()?._page;if(this._page&&t!==this._page)return;let n=qo(e.url());if(!n)return;let r=this._createPageEntryIfNeeded(t),s=Mp(e.method(),n,e.frame()?.guid,this._options);if(r&&(s.pageref=r.id),this._recordRequestHeadersAndCookies(s,e.headers()),s.request.postData=this._postDataForRequest(e,this._options.content),this._options.omitSizes||(s.request.bodySize=e.bodySize()),e.redirectedFrom()){let o=this._entryForRequest(e.redirectedFrom());o&&(o.response.redirectURL=e.url())}e[this._entrySymbol]=s,E(this._started),this._delegate.onEntryStarted(s)}_recordRequestHeadersAndCookies(e,t){if(!this._options.omitCookies){e.request.cookies=[];for(let n of t.filter(r=>r.name.toLowerCase()==="cookie"))e.request.cookies.push(...n.value.split(";").map(Np))}e.request.headers=t}_recordRequestOverrides(e,t){!t._hasOverrides()||!this._options.recordRequestOverrides||(e.request.method=t.method(),e.request.url=t.url(),e.request.postData=this._postDataForRequest(t,this._options.content),this._recordRequestHeadersAndCookies(e,t.headers()))}async _onRequestFinished(e,t){if(!t)return;let n=this._entryForRequest(e);if(!n)return;let r=e.frame()?._page;this._options.omitServerIP||this._addBarrier(r||e.serviceWorker(),t.serverAddr().then(h=>{h?.ipAddress&&(n.serverIPAddress=h.ipAddress),h?.port&&(n._serverPort=h.port)})),this._options.omitSecurityDetails||this._addBarrier(r||e.serviceWorker(),t.securityDetails().then(h=>{h&&(n._securityDetails=h)}));let s=t.httpVersion();n.request.httpVersion=s,n.response.httpVersion=s;let o=this._options.omitSizes?void 0:{_encodedBodySize:-1,_decodedBodySize:-1,barrier:new U,_check:function(){this._encodedBodySize!==-1&&this._decodedBodySize!==-1&&(n.response.content.compression=Math.max(0,this._decodedBodySize-this._encodedBodySize),this.barrier.resolve())},setEncodedBodySize:function(h){this._encodedBodySize=h,this._check()},setDecodedBodySize:function(h){this._decodedBodySize=h,this._check()}};o&&this._addBarrier(r||e.serviceWorker(),o.barrier);let l=t.body().then(h=>{if(this._options.omitScripts&&e.resourceType()==="script"){o?.setDecodedBodySize(0);return}let m=n.response.content;o?.setDecodedBodySize(h.length),this._storeResponseContent(h,m,e.resourceType())}).catch(()=>{o?.setDecodedBodySize(0)}).then(()=>{this._started&&this._delegate.onEntryFinished(n)});this._addBarrier(r||e.serviceWorker(),l);let c=t.timing();n.timings.receive=t.request()._responseEndTiming!==-1?le.millisToRoundishMillis(t.request()._responseEndTiming-c.responseStart):-1,this._computeHarEntryTotalTime(n),this._options.omitSizes||this._addBarrier(r||e.serviceWorker(),t.sizes().then(h=>{n.response.bodySize=h.responseBodySize,n.response.headersSize=h.responseHeadersSize,n.response._transferSize=h.transferSize,n.request.headersSize=h.requestHeadersSize,o?.setEncodedBodySize(h.responseBodySize)}))}async _onRequestFailed(e){let t=this._entryForRequest(e);t&&(e._failureText!==null&&(t.response._failureText=e._failureText),this._recordRequestOverrides(t,e),this._started&&this._delegate.onEntryFinished(t))}_onRequestAborted(e){let t=this._entryForRequest(e);t&&(t._wasAborted=!0)}_onRequestFulfilled(e){let t=this._entryForRequest(e);t&&(t._wasFulfilled=!0)}_onRequestContinued(e){let t=this._entryForRequest(e);t&&(t._wasContinued=!0)}_storeResponseContent(e,t,n){if(!e){t.size=0;return}if(this._options.omitSizes||(t.size=e.length),this._options.content==="embed")bh(t.mimeType)&&n!=="font"?t.text=e.toString():(t.text=e.toString("base64"),t.encoding="base64");else if(this._options.content==="attach"){let r=Wt(e)+"."+(mime.getExtension(t.mimeType)||"dat");this._options.includeTraceInfo?t._sha1=r:t._file=r,this._started&&this._delegate.onContentBlob(r,e)}}_onResponse(e){let t=this._entryForRequest(e.request());if(!t)return;let n=e.frame()?._page,r=this._createPageEntryIfNeeded(n),s=e.request();if(t.response={status:e.status(),statusText:e.statusText(),httpVersion:e.httpVersion(),cookies:[],headers:[],content:{size:-1,mimeType:"x-unknown"},headersSize:-1,bodySize:-1,redirectURL:"",_transferSize:this._options.omitSizes?void 0:-1},!this._options.omitTiming){let o=r?r[nd].valueOf():0,l=e.timing();r&&o>l.startTime&&(r.startedDateTime=new Date(l.startTime).toISOString());let c=l.domainLookupEnd!==-1?le.millisToRoundishMillis(l.domainLookupEnd-l.domainLookupStart):-1,h=l.connectEnd!==-1?le.millisToRoundishMillis(l.connectEnd-l.connectStart):-1,m=l.connectEnd!==-1?le.millisToRoundishMillis(l.connectEnd-l.secureConnectionStart):-1,f=l.responseStart!==-1?le.millisToRoundishMillis(l.responseStart-l.requestStart):-1,g=-1;t.timings={dns:c,connect:h,ssl:m,send:0,wait:f,receive:g},this._computeHarEntryTotalTime(t)}this._recordRequestOverrides(t,s),this._addBarrier(n||s.serviceWorker(),s.rawRequestHeaders().then(o=>{this._recordRequestHeadersAndCookies(t,o)})),this._recordResponseHeaders(t,e.headers()),this._addBarrier(n||s.serviceWorker(),e.rawResponseHeaders().then(o=>{this._recordResponseHeaders(t,o)}))}_recordResponseHeaders(e,t){this._options.omitCookies||(e.response.cookies=t.filter(r=>r.name.toLowerCase()==="set-cookie").map(r=>Np(r.value))),e.response.headers=t;let n=t.find(r=>r.name.toLowerCase()==="content-type");n&&(e.response.content.mimeType=n.value)}_computeHarEntryTotalTime(e){e.time=[e.timings.dns,e.timings.connect,e.timings.ssl,e.timings.wait,e.timings.receive].reduce((t,n)=>(n||-1)>0?n+t:t,0)}async flush(){await Promise.all(this._barrierPromises)}stop(){this._started=!1,L.removeEventListeners(this._eventListeners),this._barrierPromises.clear();let e=this._context instanceof j?this._context:void 0,t={version:"1.2",creator:{name:"Playwright",version:Ri()},browser:{name:e?._browser.options.name||"",version:e?._browser.version()||""},pages:this._pageEntries.size?Array.from(this._pageEntries.values()):void 0,entries:[]};if(!this._options.omitTiming)for(let n of t.pages||[]){let r=n[nd].valueOf();typeof n.pageTimings.onContentLoad=="number"&&n.pageTimings.onContentLoad>=0?n.pageTimings.onContentLoad-=r:n.pageTimings.onContentLoad=-1,typeof n.pageTimings.onLoad=="number"&&n.pageTimings.onLoad>=0?n.pageTimings.onLoad-=r:n.pageTimings.onLoad=-1}return this._pageEntries.clear(),t}_postDataForRequest(e,t){let n=e.postDataBuffer();if(!n)return;let r=e.headerValue("content-type");return this._postDataForBuffer(n,r,t)}_postDataForBuffer(e,t,n){if(!e)return;t??="application/octet-stream";let r={mimeType:t,text:"",params:[]};if(n==="embed"&&t!=="application/octet-stream"&&(r.text=e.toString()),n==="attach"){let s=Wt(e)+"."+(mime.getExtension(t)||"dat");this._options.includeTraceInfo?r._sha1=s:r._file=s,this._delegate.onContentBlob(s,e)}if(t==="application/x-www-form-urlencoded"){let s=new URLSearchParams(e.toString());for(let[o,l]of s.entries())r.params.push({name:o,value:l})}return r}};nd=Symbol("startedDate")});function Hp(i,e){if(window[i])return;let t="__playwright_shadow_root_",n="__playwright_value_",r="__playwright_checked_",s="__playwright_selected_",o="__playwright_scroll_top_",l="__playwright_scroll_left_",c="__playwright_style_sheet_",h="__playwright_target__",m="__playwright_custom_elements__",f="__playwright_current_src__",g=Symbol("__playwright_snapshot_frameid_"),b=Symbol("__playwright_snapshot_cache_"),v=Symbol("__playwright_end_of_list_");function S(H){delete H[b]}function _(H){return H[b]||(H[b]={}),H[b]}function k(H){try{let A=new URL(H);return A.hash="",A.toString()}catch{return H}}class D{_lastSnapshotNumber=0;_staleStyleSheets=new Set;_readingStyleSheet=!1;_fakeBase;_observer;constructor(){let A=F=>{F.parentStyleSheet&&this._invalidateStyleSheet(F.parentStyleSheet)};this._interceptNativeMethod(window.CSSStyleSheet.prototype,"insertRule",F=>this._invalidateStyleSheet(F)),this._interceptNativeMethod(window.CSSStyleSheet.prototype,"deleteRule",F=>this._invalidateStyleSheet(F)),this._interceptNativeMethod(window.CSSStyleSheet.prototype,"addRule",F=>this._invalidateStyleSheet(F)),this._interceptNativeMethod(window.CSSStyleSheet.prototype,"removeRule",F=>this._invalidateStyleSheet(F)),this._interceptNativeGetter(window.CSSStyleSheet.prototype,"rules",F=>this._invalidateStyleSheet(F)),this._interceptNativeGetter(window.CSSStyleSheet.prototype,"cssRules",F=>this._invalidateStyleSheet(F)),this._interceptNativeMethod(window.CSSStyleSheet.prototype,"replaceSync",F=>this._invalidateStyleSheet(F)),this._interceptNativeMethod(window.CSSGroupingRule.prototype,"insertRule",A),this._interceptNativeMethod(window.CSSGroupingRule.prototype,"deleteRule",A),this._interceptNativeGetter(window.CSSGroupingRule.prototype,"cssRules",A),this._interceptNativeAsyncMethod(window.CSSStyleSheet.prototype,"replace",F=>this._invalidateStyleSheet(F)),this._fakeBase=document.createElement("base"),this._observer=new MutationObserver(F=>this._handleMutations(F));let I={attributes:!0,subtree:!0};this._observer.observe(document,I),this._refreshListenersWhenNeeded()}_refreshListenersWhenNeeded(){this._refreshListeners();let A="__playwright_snapshotter_global_listeners_check__",I=!1,F=()=>I=!0;window.addEventListener(A,F),new MutationObserver(W=>{W.some(J=>Array.from(J.addedNodes).includes(document.documentElement))&&(I=!1,window.dispatchEvent(new CustomEvent(A)),I||(window.addEventListener(A,F),this._refreshListeners()))}).observe(document,{childList:!0})}_refreshListeners(){document.addEventListener("__playwright_target__",A=>{if(!A.detail)return;let I=A.detail;A.composedPath()[0].__playwright_target__=I})}_interceptNativeMethod(A,I,F){let q=A[I];q&&(A[I]=function(...W){let C=q.call(this,...W);return F(this,C),C})}_interceptNativeAsyncMethod(A,I,F){let q=A[I];q&&(A[I]=async function(...W){let C=await q.call(this,...W);return F(this,C),C})}_interceptNativeGetter(A,I,F){let q=Object.getOwnPropertyDescriptor(A,I);Object.defineProperty(A,I,{...q,get:function(){let W=q.get.call(this);return F(this,W),W}})}_handleMutations(A){for(let I of A)_(I.target).attributesCached=void 0}_invalidateStyleSheet(A){this._readingStyleSheet||this._staleStyleSheets.add(A)}_updateStyleElementStyleSheetTextIfNeeded(A,I){let F=_(A);if(this._staleStyleSheets.has(A)||I&&F.cssText===void 0){this._staleStyleSheets.delete(A);try{F.cssText=this._getSheetText(A)}catch{F.cssText=""}}return F.cssText}_updateLinkStyleSheetTextIfNeeded(A,I){let F=_(A);if(this._staleStyleSheets.has(A)){this._staleStyleSheets.delete(A);try{return F.cssText=this._getSheetText(A),F.cssRef=I,F.cssText}catch{}}return F.cssRef===void 0?void 0:I-F.cssRef}markIframe(A,I){A[g]=I}reset(){this._staleStyleSheets.clear();let A=I=>{if(S(I),I.nodeType===Node.ELEMENT_NODE){let F=I;F.shadowRoot&&A(F.shadowRoot)}for(let F=I.firstChild;F;F=F.nextSibling)A(F)};A(document.documentElement),A(this._fakeBase)}__sanitizeMetaAttribute(A,I,F){if(A==="charset")return"utf-8";if(F.toLowerCase()!=="content-type"||A!=="content")return I;let[q,...W]=I.split(";");if(q!=="text/html"||W.length<=0)return I;let C=W.findIndex(J=>J.trim().startsWith("charset="));return C>-1&&(W[C]="charset=utf-8"),`${q}; ${W.join("; ")}`}_sanitizeUrl(A){return A.startsWith("javascript:")||A.startsWith("vbscript:")?"":A}_sanitizeSrcSet(A){return A.split(",").map(I=>{I=I.trim();let F=I.lastIndexOf(" ");return F===-1?this._sanitizeUrl(I):this._sanitizeUrl(I.substring(0,F).trim())+I.substring(F)}).join(", ")}_resolveUrl(A,I){if(I==="")return"";try{return new URL(I,A).href}catch{return I}}_getSheetBase(A){let I=A;for(;I.parentStyleSheet;)I=I.parentStyleSheet;return I.ownerNode?I.ownerNode.baseURI:document.baseURI}_getSheetText(A){this._readingStyleSheet=!0;try{let I=[];for(let F of A.cssRules)I.push(F.cssText);return I.join(`
`)}finally{this._readingStyleSheet=!1}}captureSnapshot(){let A=performance.now(),I=++this._lastSnapshotNumber,F=0,q=0,W=0;this._handleMutations(this._observer.takeRecords());let C=new Set,J=te=>{let Se=te.nodeType,ie=Se===Node.DOCUMENT_FRAGMENT_NODE?"template":te.nodeName;if(Se!==Node.ELEMENT_NODE&&Se!==Node.DOCUMENT_FRAGMENT_NODE&&Se!==Node.TEXT_NODE||ie==="SCRIPT")return;if(ie==="LINK"&&Se===Node.ELEMENT_NODE){let V=te.getAttribute("rel")?.toLowerCase();if(V==="preload"||V==="prefetch")return}if(e&&ie==="NOSCRIPT"||ie==="META"&&te.httpEquiv.toLowerCase()==="content-security-policy"||(ie==="IFRAME"||ie==="FRAME")&&W)return;let Pe=_(te),jt=[],M=!!Pe.cached,Q=0,ee=V=>{M=M&&Pe.cached[jt.length]===V,jt.push(V)},an=V=>(Pe.attributesCached=!0,M?{equals:!0,n:[[I-Pe.ref[0],Pe.ref[1]]]}:(F+=Q,Pe.ref=[I,F++],Pe.cached=jt,{equals:!1,n:V}));if(Se===Node.TEXT_NODE){let V=te.nodeValue||"";return ee(V),an(V)}if(ie==="STYLE"){let V=te.sheet,ue;return V&&(ue=this._updateStyleElementStyleSheetTextIfNeeded(V)),ue=ue||te.textContent||"",ee(ue),Q++,an([ie,{},ue])}let et={},Tn=[ie,et],Hl=V=>{let ue=J(V);ue&&(Tn.push(ue.n),ee(V),M=M&&ue.equals)},wg=V=>{let ue=oe(V);ue&&(Tn.push(ue.n),ee(V),M=M&&ue.equals)};if(Se===Node.DOCUMENT_FRAGMENT_NODE&&(et[t]="open"),Se===Node.ELEMENT_NODE){let V=te;if(V.localName.includes("-")&&window.customElements?.get(V.localName)&&C.add(V.localName),ie==="INPUT"||ie==="TEXTAREA"){let ue=V.value;ee(n),ee(ue),et[n]=ue}if(ie==="INPUT"&&["checkbox","radio"].includes(V.type)){let ue=V.checked?"true":"false";ee(r),ee(ue),et[r]=ue}if(ie==="OPTION"){let ue=V.selected?"true":"false";ee(s),ee(ue),et[s]=ue}V.scrollTop&&(ee(o),ee(V.scrollTop),et[o]=""+V.scrollTop),V.scrollLeft&&(ee(l),ee(V.scrollLeft),et[l]=""+V.scrollLeft),V.shadowRoot&&(++q,Hl(V.shadowRoot),--q),"__playwright_target__"in V&&(ee(h),ee(V.__playwright_target__),et[h]=V.__playwright_target__)}ie==="HEAD"&&(++W,this._fakeBase.setAttribute("href",document.baseURI),Hl(this._fakeBase));for(let V=te.firstChild;V;V=V.nextSibling)Hl(V);ie==="HEAD"&&--W,ee(v);let ro=null;if(te.ownerDocument.documentElement===te?ro=te.ownerDocument:te.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&(ro=te),ro){for(let V of ro.adoptedStyleSheets||[])wg(V);ee(v)}if(ie==="IFRAME"||ie==="FRAME"){let ue=te[g],Je="src",Xe=ue?`/snapshot/${ue}`:"";ee(Je),ee(Xe),et[Je]=Xe}if(ie==="BODY"&&C.size){let V=[...C].join(",");ee(m),ee(V),et[m]=V}if(ie==="IMG"||ie==="PICTURE"){let V=ie==="PICTURE"?"":this._sanitizeUrl(te.currentSrc);ee(f),ee(V),et[f]=V}if(M&&Pe.attributesCached&&!q)return an(Tn);if(Se===Node.ELEMENT_NODE){let V=te;for(let ue=0;ue<V.attributes.length;ue++){let Je=V.attributes[ue].name;if(ie==="LINK"&&Je==="integrity"||ie==="IFRAME"&&(Je==="src"||Je==="srcdoc"||Je==="sandbox")||ie==="FRAME"&&Je==="src")continue;let Xe=V.attributes[ue].value;ie==="META"?Xe=this.__sanitizeMetaAttribute(Je,Xe,te.httpEquiv):Je==="src"&&ie==="IMG"?Xe=this._sanitizeUrl(Xe):Je==="srcset"&&ie==="IMG"?Xe=this._sanitizeSrcSet(Xe):Je==="srcset"&&ie==="SOURCE"?Xe=this._sanitizeSrcSet(Xe):Je==="href"&&ie==="LINK"?Xe=this._sanitizeUrl(Xe):Je.startsWith("on")&&(Xe=""),ee(Je),ee(Xe),et[Je]=Xe}ee(v)}return Tn.length===2&&!Object.keys(et).length&&Tn.pop(),an(Tn)},oe=te=>{let Se=_(te),ie=Se.cssText,Pe=this._updateStyleElementStyleSheetTextIfNeeded(te,!0);return Pe===ie?{equals:!0,n:[[I-Se.ref[0],Se.ref[1]]]}:(Se.ref=[I,F++],{equals:!1,n:["template",{[c]:Pe}]})},Ze;if(document.documentElement){let{n:te}=J(document.documentElement);Ze=te}else Ze=["html"];let $e={html:Ze,doctype:document.doctype?document.doctype.name:void 0,resourceOverrides:[],viewport:{width:window.innerWidth,height:window.innerHeight},url:location.href,timestamp:A,collectionTime:0};for(let te of this._staleStyleSheets){if(te.href===null)continue;let Se=this._updateLinkStyleSheetTextIfNeeded(te,I);if(Se===void 0)continue;let ie=this._getSheetBase(te),Pe=k(this._resolveUrl(ie,te.href));$e.resourceOverrides.push({url:Pe,content:Se,contentType:"text/css"})}return $e.collectionTime=performance.now()-$e.timestamp,$e}}window[i]=new D}var Dp=x(()=>{});var da,Bp=x(()=>{Oe();nt();It();Te();Dp();O();da=class{_context;_delegate;_eventListeners=[];_snapshotStreamer;_initialized=!1;_started=!1;constructor(e,t){this._context=e,this._delegate=t;let n=Y();this._snapshotStreamer="__playwright_snapshot_streamer_"+n}started(){return this._started}async start(){this._started=!0,this._initialized||(this._initialized=!0,await this._initialize()),await this.reset()}async reset(){this._started&&await this._runInAllFrames(`window["${this._snapshotStreamer}"].reset()`)}async stop(){this._started=!1}resetForReuse(){this._initialized=!1}async _initialize(){for(let n of this._context.pages())this._onPage(n);this._eventListeners=[L.addEventListener(this._context,j.Events.Page,this._onPage.bind(this))];let{javaScriptEnabled:e}=this._context._options,t=`(${Hp})("${this._snapshotStreamer}", ${e||e===void 0})`;await this._context.addInitScript(t),await this._runInAllFrames(t)}async _runInAllFrames(e){let t=[];for(let n of this._context.pages())t.push(...n.frames());await Promise.all(t.map(n=>n.nonStallingRawEvaluateInExistingMainContext(e).catch(r=>N.log("error",r))))}dispose(){L.removeEventListeners(this._eventListeners)}async captureSnapshot(e,t,n,r){let s=`window["${this._snapshotStreamer}"].captureSnapshot(${JSON.stringify(n)})`;r?.callFunctionNoReply((l,c)=>{let h=new CustomEvent("__playwright_target__",{bubbles:!0,cancelable:!0,detail:c,composed:!0});l.dispatchEvent(h)},t);let o=e.frames().map(async l=>{let c=await l.nonStallingRawEvaluateInExistingMainContext(s).catch(m=>N.log("error",m));if(!c||!this._started)return;let h={callId:t,snapshotName:n,pageId:e.guid,frameId:l.guid,frameUrl:c.url,doctype:c.doctype,html:c.html,viewport:c.viewport,timestamp:X(),collectionTime:c.collectionTime,resourceOverrides:[],isMainFrame:e.mainFrame()===l};for(let{url:m,content:f,contentType:g}of c.resourceOverrides)if(typeof f=="string"){let b=Buffer.from(f),v=Wt(b)+"."+(mime.getExtension(g)||"dat");this._delegate.onSnapshotterBlob({sha1:v,buffer:b}),h.resourceOverrides.push({url:m,sha1:v})}else h.resourceOverrides.push({url:m,ref:f});this._delegate.onFrameSnapshot(h)});await Promise.all(o)}_onPage(e){for(let t of e.frames())this._annotateFrameHierarchy(t);this._eventListeners.push(L.addEventListener(e,re.Events.FrameAttached,t=>this._annotateFrameHierarchy(t)))}async _annotateFrameHierarchy(e){try{let t=await e.frameElement(),n=e.parentFrame();if(!n)return;await(await n._mainContext())?.evaluate(({snapshotStreamer:s,frameElement:o,frameId:l})=>{window[s].markIframe(o,l)},{snapshotStreamer:this._snapshotStreamer,frameElement:t,frameId:e.guid}),t.dispose()}catch{}}}});import Xw from"os";import Ht from"path";function gs(i,e){if(Array.isArray(i))return i.map(t=>gs(t,e));if(i instanceof K)return`<${i._type}>`;if(i instanceof Buffer)return"<Buffer>";if(i instanceof Date)return i;if(typeof i=="object"){let t={};for(let n in i){if(n==="sha1"||n==="_sha1"||n.endsWith("Sha1")){let r=i[n];r&&e.add(r)}t[n]=gs(i[n],e)}return t}return i}function Zw(i){return ca.has(i.type+"."+i.method)}function eb(i){return i.internal||i.method.startsWith("tracing")?null:{type:"before",callId:i.id,startTime:i.startTime,apiName:i.apiName||i.type+"."+i.method,class:i.type,method:i.method,params:i.params,stepId:i.stepId,pageId:i.pageId}}function tb(i){return i.internal||i.method.startsWith("tracing")?null:{type:"input",callId:i.id,point:i.point}}function nb(i,e){return i.internal||i.method.startsWith("tracing")?null:{type:"log",callId:i.id,time:X(),message:e}}function rb(i){return i.internal||i.method.startsWith("tracing")?null:{type:"after",callId:i.id,endTime:i.endTime,error:i.error?.error,result:i.result,point:i.point}}var Qw,Yw,Jr,sd=x(()=>{ed();O();Gr();Oe();ye();nt();id();Bp();_e();Vt();Qw=7,Yw={width:800,height:600,quality:90},Jr=class extends se{_fs=new po;_snapshotter;_harTracer;_screencastListeners=[];_eventListeners=[];_context;_state;_isStopping=!1;_precreatedTracesDir;_tracesTmpDir;_allResources=new Set;_contextCreatedEvent;_pendingHarEntries=new Set;constructor(e,t){super(e,"tracing"),this._context=e,this._precreatedTracesDir=t,this._harTracer=new Kr(e,null,this,{content:"attach",includeTraceInfo:!0,recordRequestOverrides:!1,waitForContentOnStop:!1});let n="selectors"in e?e.selectors().testIdAttributeName():void 0;this._contextCreatedEvent={version:Qw,type:"context-options",origin:"library",browserName:"",options:{},platform:process.platform,wallTime:0,monotonicTime:0,sdkLanguage:e.attribution.playwright.options.sdkLanguage,testIdAttributeName:n},e instanceof j&&(this._snapshotter=new da(e,this),E(t,"tracesDir must be specified for BrowserContext"),this._contextCreatedEvent.browserName=e._browser.options.name,this._contextCreatedEvent.channel=e._browser.options.channel,this._contextCreatedEvent.options=e._options)}async resetForReuse(){await this.stopChunk({mode:"discard"}).catch(()=>{}),await this.stop(),this._snapshotter?.resetForReuse()}async start(e){if(this._isStopping)throw new Error("Cannot start tracing while stopping");if(this._state)throw new Error("Tracing has been already started");this._contextCreatedEvent.sdkLanguage=this._context.attribution.playwright.options.sdkLanguage;let t=e.name||Y(),n=this._createTracesDirIfNeeded();this._state={options:e,traceName:t,tracesDir:n,traceFile:Ht.join(n,t+".trace"),networkFile:Ht.join(n,t+".network"),resourcesDir:Ht.join(n,"resources"),chunkOrdinal:0,traceSha1s:new Set,networkSha1s:new Set,recording:!1,callIds:new Set},this._fs.mkdir(this._state.resourcesDir),this._fs.writeFile(this._state.networkFile,""),e.snapshots&&this._harTracer.start({omitScripts:!e.live})}async startChunk(e={}){if(this._state&&this._state.recording&&await this.stopChunk({mode:"discard"}),!this._state)throw new Error("Must start tracing before starting a new chunk");if(this._isStopping)throw new Error("Cannot start a trace chunk while stopping");this._state.recording=!0,this._state.callIds.clear(),e.name&&e.name!==this._state.traceName?this._changeTraceName(this._state,e.name):this._allocateNewTraceFile(this._state),this._fs.mkdir(Ht.dirname(this._state.traceFile));let t={...this._contextCreatedEvent,title:e.title,wallTime:Date.now(),monotonicTime:X()};return this._fs.appendFile(this._state.traceFile,JSON.stringify(t)+`
`),this._context.instrumentation.addListener(this,this._context),this._eventListeners.push(L.addEventListener(this._context,j.Events.Console,this._onConsoleMessage.bind(this)),L.addEventListener(this._context,j.Events.PageError,this._onPageError.bind(this))),this._state.options.screenshots&&this._startScreencast(),this._state.options.snapshots&&await this._snapshotter?.start(),{traceName:this._state.traceName}}_startScreencast(){if(this._context instanceof j){for(let e of this._context.pages())this._startScreencastInPage(e);this._screencastListeners.push(L.addEventListener(this._context,j.Events.Page,this._startScreencastInPage.bind(this)))}}_stopScreencast(){if(L.removeEventListeners(this._screencastListeners),this._context instanceof j)for(let e of this._context.pages())e.setScreencastOptions(null)}_allocateNewTraceFile(e){let t=e.chunkOrdinal?`-chunk${e.chunkOrdinal}`:"";e.chunkOrdinal++,e.traceFile=Ht.join(e.tracesDir,`${e.traceName}${t}.trace`)}_changeTraceName(e,t){e.traceName=t,e.chunkOrdinal=0,this._allocateNewTraceFile(e);let n=Ht.join(e.tracesDir,t+".network");this._fs.copyFile(e.networkFile,n),e.networkFile=n}async stop(){if(this._state){if(this._isStopping)throw new Error("Tracing is already stopping");if(this._state.recording)throw new Error("Must stop trace file before stopping tracing");this._harTracer.stop(),this.flushHarEntries(),await this._fs.syncAndGetError(),this._state=void 0}}async deleteTmpTracesDir(){this._tracesTmpDir&&await In([this._tracesTmpDir])}_createTracesDirIfNeeded(){return this._precreatedTracesDir?this._precreatedTracesDir:(this._tracesTmpDir=fs.mkdtempSync(Ht.join(Xw.tmpdir(),"playwright-tracing-")),this._tracesTmpDir)}abort(){this._snapshotter?.dispose(),this._harTracer.stop()}async flush(){this.abort(),await this._fs.syncAndGetError()}async stopChunk(e){if(this._isStopping)throw new Error("Tracing is already stopping");if(this._isStopping=!0,!this._state||!this._state.recording){if(this._isStopping=!1,e.mode!=="discard")throw new Error("Must start tracing before stopping");return{}}this._context.instrumentation.removeListener(this),L.removeEventListeners(this._eventListeners),this._state.options.screenshots&&this._stopScreencast(),this._state.options.snapshots&&await this._snapshotter?.stop(),this.flushHarEntries();let t=Ht.join(this._state.tracesDir,this._state.traceName+`-pwnetcopy-${this._state.chunkOrdinal}.network`),n=[];n.push({name:"trace.trace",value:this._state.traceFile}),n.push({name:"trace.network",value:t});for(let l of new Set([...this._state.traceSha1s,...this._state.networkSha1s]))n.push({name:Ht.join("resources",l),value:Ht.join(this._state.resourcesDir,l)});if(this._state.traceSha1s=new Set,e.mode==="discard")return this._isStopping=!1,this._state.recording=!1,{};this._fs.copyFile(this._state.networkFile,t);let r=this._state.traceFile+".zip";e.mode==="archive"&&this._fs.zip(n,r);let s=await this._fs.syncAndGetError();if(this._isStopping=!1,this._state&&(this._state.recording=!1),s){if(this._context instanceof j&&!this._context._browser.isConnected())return{};throw s}if(e.mode==="entries")return{entries:n};let o=new St(this._context,r);return o.reportFinished(),{artifact:o}}async _captureSnapshot(e,t,n,r){this._snapshotter&&t.attribution.page&&this._snapshotter.started()&&Zw(n)&&await this._snapshotter.captureSnapshot(t.attribution.page,n.id,e,r).catch(()=>{})}onBeforeCall(e,t){let n=eb(t);return n?(e.attribution.page?.temporarilyDisableTracingScreencastThrottling(),n.beforeSnapshot=`before@${t.id}`,this._state?.callIds.add(t.id),this._appendTraceEvent(n),this._captureSnapshot(n.beforeSnapshot,e,t)):Promise.resolve()}onBeforeInputAction(e,t,n){if(!this._state?.callIds.has(t.id))return Promise.resolve();let r=tb(t);return r?(e.attribution.page?.temporarilyDisableTracingScreencastThrottling(),r.inputSnapshot=`input@${t.id}`,this._appendTraceEvent(r),this._captureSnapshot(r.inputSnapshot,e,t,n)):Promise.resolve()}onCallLog(e,t,n,r){if(t.isServerSide||t.internal||n!=="api")return;let s=nb(t,r);s&&this._appendTraceEvent(s)}async onAfterCall(e,t){if(!this._state?.callIds.has(t.id))return;this._state?.callIds.delete(t.id);let n=rb(t);if(n)return e.attribution.page?.temporarilyDisableTracingScreencastThrottling(),n.afterSnapshot=`after@${t.id}`,this._appendTraceEvent(n),this._captureSnapshot(n.afterSnapshot,e,t)}onEntryStarted(e){this._pendingHarEntries.add(e)}onEntryFinished(e){this._pendingHarEntries.delete(e);let n=gs({type:"resource-snapshot",snapshot:e},this._state.networkSha1s);this._fs.appendFile(this._state.networkFile,JSON.stringify(n)+`
`,!0)}flushHarEntries(){let e=[];for(let t of this._pendingHarEntries){let r=gs({type:"resource-snapshot",snapshot:t},this._state.networkSha1s);e.push(JSON.stringify(r))}this._pendingHarEntries.clear(),e.length&&this._fs.appendFile(this._state.networkFile,e.join(`
`)+`
`,!0)}onContentBlob(e,t){this._appendResource(e,t)}onSnapshotterBlob(e){this._appendResource(e.sha1,e.buffer)}onFrameSnapshot(e){this._appendTraceEvent({type:"frame-snapshot",snapshot:e})}_onConsoleMessage(e){let t={type:"console",messageType:e.type(),text:e.text(),args:e.args().map(n=>({preview:n.toString(),value:n.rawValue()})),location:e.location(),time:X(),pageId:e.page()?.guid};this._appendTraceEvent(t)}_onPageError(e,t){let n={type:"event",time:X(),class:"BrowserContext",method:"pageError",params:{error:Bn(e)},pageId:t.guid};this._appendTraceEvent(n)}_startScreencastInPage(e){e.setScreencastOptions(Yw);let t=e.guid;this._screencastListeners.push(L.addEventListener(e,re.Events.ScreencastFrame,n=>{let r=n.timestamp||Date.now(),s=`${t}-${r}.jpeg`,o={type:"screencast-frame",pageId:e.guid,sha1:s,width:n.width,height:n.height,timestamp:X()};this._appendResource(s,n.buffer),this._appendTraceEvent(o)}))}_appendTraceEvent(e){let t=gs(e,this._state.traceSha1s),n=this._state.options.live||e.type!=="event"&&e.type!=="console"&&e.type!=="log";this._fs.appendFile(this._state.traceFile,JSON.stringify(t)+`
`,n)}_appendResource(e,t){if(this._allResources.has(e))return;this._allResources.add(e);let n=Ht.join(this._state.resourcesDir,e);this._fs.writeFile(n,t,!0)}}});import ib from"path";function sb(i){let e=[];return $p(i,e,"",!1,void 0),e.join("")}function $p(i,e,t,n,r){if(typeof i!="object"||i===null){e.push(JSON.stringify(i));return}let s=Array.isArray(i);if(!s&&i.constructor.name!=="Object"){e.push(JSON.stringify(i));return}let o=s?i:Object.entries(i).filter(h=>h[1]!==void 0);if(!o.length){e.push(s?"[]":"{}");return}let l=`${t}  `,c;s?c=n?{open:"[",close:"]"}:{open:`[
${l}`,close:`
${t}]`}:c=n?{open:"{ ",close:" }"}:{open:`{
${l}`,close:`
${t}}`},e.push(c.open);for(let h=0;h<o.length;++h){let m=o[h];h&&e.push(n?", ":`,
${l}`),s||e.push(`${JSON.stringify(m[0])}: `);let f=s?void 0:m[0],g=n||f==="timings"||r==="headers";$p(s?m:m[1],e,l,g,f)}e.push(c.close)}var bs,jp=x(()=>{Gr();id();qe();O();bs=class{_artifact;_isFlushed=!1;_tracer;_entries=[];_zipFile=null;_writtenZipEntries=new Set;constructor(e,t,n){this._artifact=new St(e,ib.join(e._browser.options.artifactsDir,`${Y()}.har`));let r=n.urlRegexSource!==void 0&&n.urlRegexFlags!==void 0?new RegExp(n.urlRegexSource,n.urlRegexFlags):void 0,s=n.path.endsWith(".zip"),o=n.content||(s?"attach":"embed");this._tracer=new Kr(e,t,this,{content:o,slimMode:n.mode==="minimal",includeTraceInfo:!1,recordRequestOverrides:!0,waitForContentOnStop:!0,urlFilter:r??n.urlGlob}),this._zipFile=o==="attach"||s?new yazl.ZipFile:null,this._tracer.start({omitScripts:!1})}onEntryStarted(e){this._entries.push(e)}onEntryFinished(e){}onContentBlob(e,t){!this._zipFile||this._writtenZipEntries.has(e)||(this._writtenZipEntries.add(e),this._zipFile.addBuffer(t,e))}async flush(){if(this._isFlushed)return;this._isFlushed=!0,await this._tracer.flush();let e=this._tracer.stop();e.entries=this._entries;let t=sb({log:e});if(this._zipFile){let n=new U;this._zipFile.on("error",r=>n.reject(r)),this._zipFile.addBuffer(Buffer.from(t,"utf-8"),"har.har"),this._zipFile.end(),this._zipFile.outputStream.pipe(fs.createWriteStream(this._artifact.localPath())).on("close",()=>{n.resolve()}),await n}else await fs.promises.writeFile(this._artifact.localPath(),t)}async export(){return await this.flush(),this._artifact.reportFinished(),this._artifact}}});var ua,od=x(()=>{ua=`
var __commonJS = obj => {
  let required = false;
  let result;
  return function __require() {
    if (!required) {
      required = true;
      let fn;
      for (const name in obj) { fn = obj[name]; break; }
      const module = { exports: {} };
      fn(module.exports, module);
      result = module.exports;
    }
    return result;
  }
};
var __export = (target, all) => {for (var name in all) target[name] = all[name];};
var __toESM = mod => ({ ...mod, 'default': mod });
var __toCommonJS = mod => ({ ...mod, __esModule: true });


// packages/playwright-core/src/server/injected/consoleApi.ts
var consoleApi_exports = {};
__export(consoleApi_exports, {
  default: () => consoleApi_default
});
module.exports = __toCommonJS(consoleApi_exports);

// packages/playwright-core/src/utils/isomorphic/stringUtils.ts
function escapeWithQuotes(text, char = "'") {
  const stringified = JSON.stringify(text);
  const escapedText = stringified.substring(1, stringified.length - 1).replace(/\\\\"/g, '"');
  if (char === "'")
    return char + escapedText.replace(/[']/g, "\\\\'") + char;
  if (char === '"')
    return char + escapedText.replace(/["]/g, '\\\\"') + char;
  if (char === "\`")
    return char + escapedText.replace(/[\`]/g, "\`") + char;
  throw new Error("Invalid escape char");
}
function toTitleCase(name) {
  return name.charAt(0).toUpperCase() + name.substring(1);
}
function toSnakeCase(name) {
  return name.replace(/([a-z0-9])([A-Z])/g, "$1_$2").replace(/([A-Z])([A-Z][a-z])/g, "$1_$2").toLowerCase();
}
function normalizeEscapedRegexQuotes(source) {
  return source.replace(/(^|[^\\\\])(\\\\\\\\)*\\\\(['"\`])/g, "$1$2$3");
}
function escapeRegexForSelector(re) {
  if (re.unicode || re.unicodeSets)
    return String(re);
  return String(re).replace(/(^|[^\\\\])(\\\\\\\\)*(["'\`])/g, "$1$2\\\\$3").replace(/>>/g, "\\\\>\\\\>");
}
function escapeForTextSelector(text, exact) {
  if (typeof text !== "string")
    return escapeRegexForSelector(text);
  return \`\${JSON.stringify(text)}\${exact ? "s" : "i"}\`;
}
function escapeForAttributeSelector(value, exact) {
  if (typeof value !== "string")
    return escapeRegexForSelector(value);
  return \`"\${value.replace(/\\\\/g, "\\\\\\\\").replace(/["]/g, '\\\\"')}"\${exact ? "s" : "i"}\`;
}

// packages/playwright-core/src/utils/isomorphic/locatorUtils.ts
function getByAttributeTextSelector(attrName, text, options) {
  return \`internal:attr=[\${attrName}=\${escapeForAttributeSelector(text, (options == null ? void 0 : options.exact) || false)}]\`;
}
function getByTestIdSelector(testIdAttributeName, testId) {
  return \`internal:testid=[\${testIdAttributeName}=\${escapeForAttributeSelector(testId, true)}]\`;
}
function getByLabelSelector(text, options) {
  return "internal:label=" + escapeForTextSelector(text, !!(options == null ? void 0 : options.exact));
}
function getByAltTextSelector(text, options) {
  return getByAttributeTextSelector("alt", text, options);
}
function getByTitleSelector(text, options) {
  return getByAttributeTextSelector("title", text, options);
}
function getByPlaceholderSelector(text, options) {
  return getByAttributeTextSelector("placeholder", text, options);
}
function getByTextSelector(text, options) {
  return "internal:text=" + escapeForTextSelector(text, !!(options == null ? void 0 : options.exact));
}
function getByRoleSelector(role, options = {}) {
  const props = [];
  if (options.checked !== void 0)
    props.push(["checked", String(options.checked)]);
  if (options.disabled !== void 0)
    props.push(["disabled", String(options.disabled)]);
  if (options.selected !== void 0)
    props.push(["selected", String(options.selected)]);
  if (options.expanded !== void 0)
    props.push(["expanded", String(options.expanded)]);
  if (options.includeHidden !== void 0)
    props.push(["include-hidden", String(options.includeHidden)]);
  if (options.level !== void 0)
    props.push(["level", String(options.level)]);
  if (options.name !== void 0)
    props.push(["name", escapeForAttributeSelector(options.name, !!options.exact)]);
  if (options.pressed !== void 0)
    props.push(["pressed", String(options.pressed)]);
  return \`internal:role=\${role}\${props.map(([n, v]) => \`[\${n}=\${v}]\`).join("")}\`;
}

// packages/playwright-core/src/utils/isomorphic/cssTokenizer.ts
var between = function(num, first, last) {
  return num >= first && num <= last;
};
function digit(code) {
  return between(code, 48, 57);
}
function hexdigit(code) {
  return digit(code) || between(code, 65, 70) || between(code, 97, 102);
}
function uppercaseletter(code) {
  return between(code, 65, 90);
}
function lowercaseletter(code) {
  return between(code, 97, 122);
}
function letter(code) {
  return uppercaseletter(code) || lowercaseletter(code);
}
function nonascii(code) {
  return code >= 128;
}
function namestartchar(code) {
  return letter(code) || nonascii(code) || code === 95;
}
function namechar(code) {
  return namestartchar(code) || digit(code) || code === 45;
}
function nonprintable(code) {
  return between(code, 0, 8) || code === 11 || between(code, 14, 31) || code === 127;
}
function newline(code) {
  return code === 10;
}
function whitespace(code) {
  return newline(code) || code === 9 || code === 32;
}
var maximumallowedcodepoint = 1114111;
var InvalidCharacterError = class extends Error {
  constructor(message) {
    super(message);
    this.name = "InvalidCharacterError";
  }
};
function preprocess(str) {
  const codepoints = [];
  for (let i = 0; i < str.length; i++) {
    let code = str.charCodeAt(i);
    if (code === 13 && str.charCodeAt(i + 1) === 10) {
      code = 10;
      i++;
    }
    if (code === 13 || code === 12)
      code = 10;
    if (code === 0)
      code = 65533;
    if (between(code, 55296, 56319) && between(str.charCodeAt(i + 1), 56320, 57343)) {
      const lead = code - 55296;
      const trail = str.charCodeAt(i + 1) - 56320;
      code = Math.pow(2, 16) + lead * Math.pow(2, 10) + trail;
      i++;
    }
    codepoints.push(code);
  }
  return codepoints;
}
function stringFromCode(code) {
  if (code <= 65535)
    return String.fromCharCode(code);
  code -= Math.pow(2, 16);
  const lead = Math.floor(code / Math.pow(2, 10)) + 55296;
  const trail = code % Math.pow(2, 10) + 56320;
  return String.fromCharCode(lead) + String.fromCharCode(trail);
}
function tokenize(str1) {
  const str = preprocess(str1);
  let i = -1;
  const tokens = [];
  let code;
  let line = 0;
  let column = 0;
  let lastLineLength = 0;
  const incrLineno = function() {
    line += 1;
    lastLineLength = column;
    column = 0;
  };
  const locStart = { line, column };
  const codepoint = function(i2) {
    if (i2 >= str.length)
      return -1;
    return str[i2];
  };
  const next = function(num) {
    if (num === void 0)
      num = 1;
    if (num > 3)
      throw "Spec Error: no more than three codepoints of lookahead.";
    return codepoint(i + num);
  };
  const consume = function(num) {
    if (num === void 0)
      num = 1;
    i += num;
    code = codepoint(i);
    if (newline(code))
      incrLineno();
    else
      column += num;
    return true;
  };
  const reconsume = function() {
    i -= 1;
    if (newline(code)) {
      line -= 1;
      column = lastLineLength;
    } else {
      column -= 1;
    }
    locStart.line = line;
    locStart.column = column;
    return true;
  };
  const eof = function(codepoint2) {
    if (codepoint2 === void 0)
      codepoint2 = code;
    return codepoint2 === -1;
  };
  const donothing = function() {
  };
  const parseerror = function() {
  };
  const consumeAToken = function() {
    consumeComments();
    consume();
    if (whitespace(code)) {
      while (whitespace(next()))
        consume();
      return new WhitespaceToken();
    } else if (code === 34) {
      return consumeAStringToken();
    } else if (code === 35) {
      if (namechar(next()) || areAValidEscape(next(1), next(2))) {
        const token = new HashToken("");
        if (wouldStartAnIdentifier(next(1), next(2), next(3)))
          token.type = "id";
        token.value = consumeAName();
        return token;
      } else {
        return new DelimToken(code);
      }
    } else if (code === 36) {
      if (next() === 61) {
        consume();
        return new SuffixMatchToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 39) {
      return consumeAStringToken();
    } else if (code === 40) {
      return new OpenParenToken();
    } else if (code === 41) {
      return new CloseParenToken();
    } else if (code === 42) {
      if (next() === 61) {
        consume();
        return new SubstringMatchToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 43) {
      if (startsWithANumber()) {
        reconsume();
        return consumeANumericToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 44) {
      return new CommaToken();
    } else if (code === 45) {
      if (startsWithANumber()) {
        reconsume();
        return consumeANumericToken();
      } else if (next(1) === 45 && next(2) === 62) {
        consume(2);
        return new CDCToken();
      } else if (startsWithAnIdentifier()) {
        reconsume();
        return consumeAnIdentlikeToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 46) {
      if (startsWithANumber()) {
        reconsume();
        return consumeANumericToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 58) {
      return new ColonToken();
    } else if (code === 59) {
      return new SemicolonToken();
    } else if (code === 60) {
      if (next(1) === 33 && next(2) === 45 && next(3) === 45) {
        consume(3);
        return new CDOToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 64) {
      if (wouldStartAnIdentifier(next(1), next(2), next(3)))
        return new AtKeywordToken(consumeAName());
      else
        return new DelimToken(code);
    } else if (code === 91) {
      return new OpenSquareToken();
    } else if (code === 92) {
      if (startsWithAValidEscape()) {
        reconsume();
        return consumeAnIdentlikeToken();
      } else {
        parseerror();
        return new DelimToken(code);
      }
    } else if (code === 93) {
      return new CloseSquareToken();
    } else if (code === 94) {
      if (next() === 61) {
        consume();
        return new PrefixMatchToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 123) {
      return new OpenCurlyToken();
    } else if (code === 124) {
      if (next() === 61) {
        consume();
        return new DashMatchToken();
      } else if (next() === 124) {
        consume();
        return new ColumnToken();
      } else {
        return new DelimToken(code);
      }
    } else if (code === 125) {
      return new CloseCurlyToken();
    } else if (code === 126) {
      if (next() === 61) {
        consume();
        return new IncludeMatchToken();
      } else {
        return new DelimToken(code);
      }
    } else if (digit(code)) {
      reconsume();
      return consumeANumericToken();
    } else if (namestartchar(code)) {
      reconsume();
      return consumeAnIdentlikeToken();
    } else if (eof()) {
      return new EOFToken();
    } else {
      return new DelimToken(code);
    }
  };
  const consumeComments = function() {
    while (next(1) === 47 && next(2) === 42) {
      consume(2);
      while (true) {
        consume();
        if (code === 42 && next() === 47) {
          consume();
          break;
        } else if (eof()) {
          parseerror();
          return;
        }
      }
    }
  };
  const consumeANumericToken = function() {
    const num = consumeANumber();
    if (wouldStartAnIdentifier(next(1), next(2), next(3))) {
      const token = new DimensionToken();
      token.value = num.value;
      token.repr = num.repr;
      token.type = num.type;
      token.unit = consumeAName();
      return token;
    } else if (next() === 37) {
      consume();
      const token = new PercentageToken();
      token.value = num.value;
      token.repr = num.repr;
      return token;
    } else {
      const token = new NumberToken();
      token.value = num.value;
      token.repr = num.repr;
      token.type = num.type;
      return token;
    }
  };
  const consumeAnIdentlikeToken = function() {
    const str2 = consumeAName();
    if (str2.toLowerCase() === "url" && next() === 40) {
      consume();
      while (whitespace(next(1)) && whitespace(next(2)))
        consume();
      if (next() === 34 || next() === 39)
        return new FunctionToken(str2);
      else if (whitespace(next()) && (next(2) === 34 || next(2) === 39))
        return new FunctionToken(str2);
      else
        return consumeAURLToken();
    } else if (next() === 40) {
      consume();
      return new FunctionToken(str2);
    } else {
      return new IdentToken(str2);
    }
  };
  const consumeAStringToken = function(endingCodePoint) {
    if (endingCodePoint === void 0)
      endingCodePoint = code;
    let string = "";
    while (consume()) {
      if (code === endingCodePoint || eof()) {
        return new StringToken(string);
      } else if (newline(code)) {
        parseerror();
        reconsume();
        return new BadStringToken();
      } else if (code === 92) {
        if (eof(next()))
          donothing();
        else if (newline(next()))
          consume();
        else
          string += stringFromCode(consumeEscape());
      } else {
        string += stringFromCode(code);
      }
    }
    throw new Error("Internal error");
  };
  const consumeAURLToken = function() {
    const token = new URLToken("");
    while (whitespace(next()))
      consume();
    if (eof(next()))
      return token;
    while (consume()) {
      if (code === 41 || eof()) {
        return token;
      } else if (whitespace(code)) {
        while (whitespace(next()))
          consume();
        if (next() === 41 || eof(next())) {
          consume();
          return token;
        } else {
          consumeTheRemnantsOfABadURL();
          return new BadURLToken();
        }
      } else if (code === 34 || code === 39 || code === 40 || nonprintable(code)) {
        parseerror();
        consumeTheRemnantsOfABadURL();
        return new BadURLToken();
      } else if (code === 92) {
        if (startsWithAValidEscape()) {
          token.value += stringFromCode(consumeEscape());
        } else {
          parseerror();
          consumeTheRemnantsOfABadURL();
          return new BadURLToken();
        }
      } else {
        token.value += stringFromCode(code);
      }
    }
    throw new Error("Internal error");
  };
  const consumeEscape = function() {
    consume();
    if (hexdigit(code)) {
      const digits = [code];
      for (let total = 0; total < 5; total++) {
        if (hexdigit(next())) {
          consume();
          digits.push(code);
        } else {
          break;
        }
      }
      if (whitespace(next()))
        consume();
      let value = parseInt(digits.map(function(x) {
        return String.fromCharCode(x);
      }).join(""), 16);
      if (value > maximumallowedcodepoint)
        value = 65533;
      return value;
    } else if (eof()) {
      return 65533;
    } else {
      return code;
    }
  };
  const areAValidEscape = function(c1, c2) {
    if (c1 !== 92)
      return false;
    if (newline(c2))
      return false;
    return true;
  };
  const startsWithAValidEscape = function() {
    return areAValidEscape(code, next());
  };
  const wouldStartAnIdentifier = function(c1, c2, c3) {
    if (c1 === 45)
      return namestartchar(c2) || c2 === 45 || areAValidEscape(c2, c3);
    else if (namestartchar(c1))
      return true;
    else if (c1 === 92)
      return areAValidEscape(c1, c2);
    else
      return false;
  };
  const startsWithAnIdentifier = function() {
    return wouldStartAnIdentifier(code, next(1), next(2));
  };
  const wouldStartANumber = function(c1, c2, c3) {
    if (c1 === 43 || c1 === 45) {
      if (digit(c2))
        return true;
      if (c2 === 46 && digit(c3))
        return true;
      return false;
    } else if (c1 === 46) {
      if (digit(c2))
        return true;
      return false;
    } else if (digit(c1)) {
      return true;
    } else {
      return false;
    }
  };
  const startsWithANumber = function() {
    return wouldStartANumber(code, next(1), next(2));
  };
  const consumeAName = function() {
    let result = "";
    while (consume()) {
      if (namechar(code)) {
        result += stringFromCode(code);
      } else if (startsWithAValidEscape()) {
        result += stringFromCode(consumeEscape());
      } else {
        reconsume();
        return result;
      }
    }
    throw new Error("Internal parse error");
  };
  const consumeANumber = function() {
    let repr = "";
    let type = "integer";
    if (next() === 43 || next() === 45) {
      consume();
      repr += stringFromCode(code);
    }
    while (digit(next())) {
      consume();
      repr += stringFromCode(code);
    }
    if (next(1) === 46 && digit(next(2))) {
      consume();
      repr += stringFromCode(code);
      consume();
      repr += stringFromCode(code);
      type = "number";
      while (digit(next())) {
        consume();
        repr += stringFromCode(code);
      }
    }
    const c1 = next(1), c2 = next(2), c3 = next(3);
    if ((c1 === 69 || c1 === 101) && digit(c2)) {
      consume();
      repr += stringFromCode(code);
      consume();
      repr += stringFromCode(code);
      type = "number";
      while (digit(next())) {
        consume();
        repr += stringFromCode(code);
      }
    } else if ((c1 === 69 || c1 === 101) && (c2 === 43 || c2 === 45) && digit(c3)) {
      consume();
      repr += stringFromCode(code);
      consume();
      repr += stringFromCode(code);
      consume();
      repr += stringFromCode(code);
      type = "number";
      while (digit(next())) {
        consume();
        repr += stringFromCode(code);
      }
    }
    const value = convertAStringToANumber(repr);
    return { type, value, repr };
  };
  const convertAStringToANumber = function(string) {
    return +string;
  };
  const consumeTheRemnantsOfABadURL = function() {
    while (consume()) {
      if (code === 41 || eof()) {
        return;
      } else if (startsWithAValidEscape()) {
        consumeEscape();
        donothing();
      } else {
        donothing();
      }
    }
  };
  let iterationCount = 0;
  while (!eof(next())) {
    tokens.push(consumeAToken());
    iterationCount++;
    if (iterationCount > str.length * 2)
      throw new Error("I'm infinite-looping!");
  }
  return tokens;
}
var CSSParserToken = class {
  constructor() {
    this.tokenType = "";
  }
  toJSON() {
    return { token: this.tokenType };
  }
  toString() {
    return this.tokenType;
  }
  toSource() {
    return "" + this;
  }
};
var BadStringToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "BADSTRING";
  }
};
var BadURLToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "BADURL";
  }
};
var WhitespaceToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "WHITESPACE";
  }
  toString() {
    return "WS";
  }
  toSource() {
    return " ";
  }
};
var CDOToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "CDO";
  }
  toSource() {
    return "<!--";
  }
};
var CDCToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "CDC";
  }
  toSource() {
    return "-->";
  }
};
var ColonToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = ":";
  }
};
var SemicolonToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = ";";
  }
};
var CommaToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = ",";
  }
};
var GroupingToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.value = "";
    this.mirror = "";
  }
};
var OpenCurlyToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = "{";
    this.value = "{";
    this.mirror = "}";
  }
};
var CloseCurlyToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = "}";
    this.value = "}";
    this.mirror = "{";
  }
};
var OpenSquareToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = "[";
    this.value = "[";
    this.mirror = "]";
  }
};
var CloseSquareToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = "]";
    this.value = "]";
    this.mirror = "[";
  }
};
var OpenParenToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = "(";
    this.value = "(";
    this.mirror = ")";
  }
};
var CloseParenToken = class extends GroupingToken {
  constructor() {
    super();
    this.tokenType = ")";
    this.value = ")";
    this.mirror = "(";
  }
};
var IncludeMatchToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "~=";
  }
};
var DashMatchToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "|=";
  }
};
var PrefixMatchToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "^=";
  }
};
var SuffixMatchToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "$=";
  }
};
var SubstringMatchToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "*=";
  }
};
var ColumnToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "||";
  }
};
var EOFToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.tokenType = "EOF";
  }
  toSource() {
    return "";
  }
};
var DelimToken = class extends CSSParserToken {
  constructor(code) {
    super();
    this.tokenType = "DELIM";
    this.value = "";
    this.value = stringFromCode(code);
  }
  toString() {
    return "DELIM(" + this.value + ")";
  }
  toJSON() {
    const json = this.constructor.prototype.constructor.prototype.toJSON.call(this);
    json.value = this.value;
    return json;
  }
  toSource() {
    if (this.value === "\\\\")
      return "\\\\\\n";
    else
      return this.value;
  }
};
var StringValuedToken = class extends CSSParserToken {
  constructor() {
    super(...arguments);
    this.value = "";
  }
  ASCIIMatch(str) {
    return this.value.toLowerCase() === str.toLowerCase();
  }
  toJSON() {
    const json = this.constructor.prototype.constructor.prototype.toJSON.call(this);
    json.value = this.value;
    return json;
  }
};
var IdentToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "IDENT";
    this.value = val;
  }
  toString() {
    return "IDENT(" + this.value + ")";
  }
  toSource() {
    return escapeIdent(this.value);
  }
};
var FunctionToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "FUNCTION";
    this.value = val;
    this.mirror = ")";
  }
  toString() {
    return "FUNCTION(" + this.value + ")";
  }
  toSource() {
    return escapeIdent(this.value) + "(";
  }
};
var AtKeywordToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "AT-KEYWORD";
    this.value = val;
  }
  toString() {
    return "AT(" + this.value + ")";
  }
  toSource() {
    return "@" + escapeIdent(this.value);
  }
};
var HashToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "HASH";
    this.value = val;
    this.type = "unrestricted";
  }
  toString() {
    return "HASH(" + this.value + ")";
  }
  toJSON() {
    const json = this.constructor.prototype.constructor.prototype.toJSON.call(this);
    json.value = this.value;
    json.type = this.type;
    return json;
  }
  toSource() {
    if (this.type === "id")
      return "#" + escapeIdent(this.value);
    else
      return "#" + escapeHash(this.value);
  }
};
var StringToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "STRING";
    this.value = val;
  }
  toString() {
    return '"' + escapeString(this.value) + '"';
  }
};
var URLToken = class extends StringValuedToken {
  constructor(val) {
    super();
    this.tokenType = "URL";
    this.value = val;
  }
  toString() {
    return "URL(" + this.value + ")";
  }
  toSource() {
    return 'url("' + escapeString(this.value) + '")';
  }
};
var NumberToken = class extends CSSParserToken {
  constructor() {
    super();
    this.tokenType = "NUMBER";
    this.type = "integer";
    this.repr = "";
  }
  toString() {
    if (this.type === "integer")
      return "INT(" + this.value + ")";
    return "NUMBER(" + this.value + ")";
  }
  toJSON() {
    const json = super.toJSON();
    json.value = this.value;
    json.type = this.type;
    json.repr = this.repr;
    return json;
  }
  toSource() {
    return this.repr;
  }
};
var PercentageToken = class extends CSSParserToken {
  constructor() {
    super();
    this.tokenType = "PERCENTAGE";
    this.repr = "";
  }
  toString() {
    return "PERCENTAGE(" + this.value + ")";
  }
  toJSON() {
    const json = this.constructor.prototype.constructor.prototype.toJSON.call(this);
    json.value = this.value;
    json.repr = this.repr;
    return json;
  }
  toSource() {
    return this.repr + "%";
  }
};
var DimensionToken = class extends CSSParserToken {
  constructor() {
    super();
    this.tokenType = "DIMENSION";
    this.type = "integer";
    this.repr = "";
    this.unit = "";
  }
  toString() {
    return "DIM(" + this.value + "," + this.unit + ")";
  }
  toJSON() {
    const json = this.constructor.prototype.constructor.prototype.toJSON.call(this);
    json.value = this.value;
    json.type = this.type;
    json.repr = this.repr;
    json.unit = this.unit;
    return json;
  }
  toSource() {
    const source = this.repr;
    let unit = escapeIdent(this.unit);
    if (unit[0].toLowerCase() === "e" && (unit[1] === "-" || between(unit.charCodeAt(1), 48, 57))) {
      unit = "\\\\65 " + unit.slice(1, unit.length);
    }
    return source + unit;
  }
};
function escapeIdent(string) {
  string = "" + string;
  let result = "";
  const firstcode = string.charCodeAt(0);
  for (let i = 0; i < string.length; i++) {
    const code = string.charCodeAt(i);
    if (code === 0)
      throw new InvalidCharacterError("Invalid character: the input contains U+0000.");
    if (between(code, 1, 31) || code === 127 || i === 0 && between(code, 48, 57) || i === 1 && between(code, 48, 57) && firstcode === 45)
      result += "\\\\" + code.toString(16) + " ";
    else if (code >= 128 || code === 45 || code === 95 || between(code, 48, 57) || between(code, 65, 90) || between(code, 97, 122))
      result += string[i];
    else
      result += "\\\\" + string[i];
  }
  return result;
}
function escapeHash(string) {
  string = "" + string;
  let result = "";
  for (let i = 0; i < string.length; i++) {
    const code = string.charCodeAt(i);
    if (code === 0)
      throw new InvalidCharacterError("Invalid character: the input contains U+0000.");
    if (code >= 128 || code === 45 || code === 95 || between(code, 48, 57) || between(code, 65, 90) || between(code, 97, 122))
      result += string[i];
    else
      result += "\\\\" + code.toString(16) + " ";
  }
  return result;
}
function escapeString(string) {
  string = "" + string;
  let result = "";
  for (let i = 0; i < string.length; i++) {
    const code = string.charCodeAt(i);
    if (code === 0)
      throw new InvalidCharacterError("Invalid character: the input contains U+0000.");
    if (between(code, 1, 31) || code === 127)
      result += "\\\\" + code.toString(16) + " ";
    else if (code === 34 || code === 92)
      result += "\\\\" + string[i];
    else
      result += string[i];
  }
  return result;
}

// packages/playwright-core/src/utils/isomorphic/cssParser.ts
var InvalidSelectorError = class extends Error {
};
function parseCSS(selector, customNames) {
  let tokens;
  try {
    tokens = tokenize(selector);
    if (!(tokens[tokens.length - 1] instanceof EOFToken))
      tokens.push(new EOFToken());
  } catch (e) {
    const newMessage = e.message + \` while parsing selector "\${selector}"\`;
    const index = (e.stack || "").indexOf(e.message);
    if (index !== -1)
      e.stack = e.stack.substring(0, index) + newMessage + e.stack.substring(index + e.message.length);
    e.message = newMessage;
    throw e;
  }
  const unsupportedToken = tokens.find((token) => {
    return token instanceof AtKeywordToken || token instanceof BadStringToken || token instanceof BadURLToken || token instanceof ColumnToken || token instanceof CDOToken || token instanceof CDCToken || token instanceof SemicolonToken || // TODO: Consider using these for something, e.g. to escape complex strings.
    // For example :xpath{ (//div/bar[@attr="foo"])[2]/baz }
    // Or this way :xpath( {complex-xpath-goes-here("hello")} )
    token instanceof OpenCurlyToken || token instanceof CloseCurlyToken || // TODO: Consider treating these as strings?
    token instanceof URLToken || token instanceof PercentageToken;
  });
  if (unsupportedToken)
    throw new InvalidSelectorError(\`Unsupported token "\${unsupportedToken.toSource()}" while parsing selector "\${selector}"\`);
  let pos = 0;
  const names = /* @__PURE__ */ new Set();
  function unexpected() {
    return new InvalidSelectorError(\`Unexpected token "\${tokens[pos].toSource()}" while parsing selector "\${selector}"\`);
  }
  function skipWhitespace() {
    while (tokens[pos] instanceof WhitespaceToken)
      pos++;
  }
  function isIdent(p = pos) {
    return tokens[p] instanceof IdentToken;
  }
  function isString(p = pos) {
    return tokens[p] instanceof StringToken;
  }
  function isNumber(p = pos) {
    return tokens[p] instanceof NumberToken;
  }
  function isComma(p = pos) {
    return tokens[p] instanceof CommaToken;
  }
  function isOpenParen(p = pos) {
    return tokens[p] instanceof OpenParenToken;
  }
  function isCloseParen(p = pos) {
    return tokens[p] instanceof CloseParenToken;
  }
  function isFunction(p = pos) {
    return tokens[p] instanceof FunctionToken;
  }
  function isStar(p = pos) {
    return tokens[p] instanceof DelimToken && tokens[p].value === "*";
  }
  function isEOF(p = pos) {
    return tokens[p] instanceof EOFToken;
  }
  function isClauseCombinator(p = pos) {
    return tokens[p] instanceof DelimToken && [">", "+", "~"].includes(tokens[p].value);
  }
  function isSelectorClauseEnd(p = pos) {
    return isComma(p) || isCloseParen(p) || isEOF(p) || isClauseCombinator(p) || tokens[p] instanceof WhitespaceToken;
  }
  function consumeFunctionArguments() {
    const result2 = [consumeArgument()];
    while (true) {
      skipWhitespace();
      if (!isComma())
        break;
      pos++;
      result2.push(consumeArgument());
    }
    return result2;
  }
  function consumeArgument() {
    skipWhitespace();
    if (isNumber())
      return tokens[pos++].value;
    if (isString())
      return tokens[pos++].value;
    return consumeComplexSelector();
  }
  function consumeComplexSelector() {
    const result2 = { simples: [] };
    skipWhitespace();
    if (isClauseCombinator()) {
      result2.simples.push({ selector: { functions: [{ name: "scope", args: [] }] }, combinator: "" });
    } else {
      result2.simples.push({ selector: consumeSimpleSelector(), combinator: "" });
    }
    while (true) {
      skipWhitespace();
      if (isClauseCombinator()) {
        result2.simples[result2.simples.length - 1].combinator = tokens[pos++].value;
        skipWhitespace();
      } else if (isSelectorClauseEnd()) {
        break;
      }
      result2.simples.push({ combinator: "", selector: consumeSimpleSelector() });
    }
    return result2;
  }
  function consumeSimpleSelector() {
    let rawCSSString = "";
    const functions = [];
    while (!isSelectorClauseEnd()) {
      if (isIdent() || isStar()) {
        rawCSSString += tokens[pos++].toSource();
      } else if (tokens[pos] instanceof HashToken) {
        rawCSSString += tokens[pos++].toSource();
      } else if (tokens[pos] instanceof DelimToken && tokens[pos].value === ".") {
        pos++;
        if (isIdent())
          rawCSSString += "." + tokens[pos++].toSource();
        else
          throw unexpected();
      } else if (tokens[pos] instanceof ColonToken) {
        pos++;
        if (isIdent()) {
          if (!customNames.has(tokens[pos].value.toLowerCase())) {
            rawCSSString += ":" + tokens[pos++].toSource();
          } else {
            const name = tokens[pos++].value.toLowerCase();
            functions.push({ name, args: [] });
            names.add(name);
          }
        } else if (isFunction()) {
          const name = tokens[pos++].value.toLowerCase();
          if (!customNames.has(name)) {
            rawCSSString += \`:\${name}(\${consumeBuiltinFunctionArguments()})\`;
          } else {
            functions.push({ name, args: consumeFunctionArguments() });
            names.add(name);
          }
          skipWhitespace();
          if (!isCloseParen())
            throw unexpected();
          pos++;
        } else {
          throw unexpected();
        }
      } else if (tokens[pos] instanceof OpenSquareToken) {
        rawCSSString += "[";
        pos++;
        while (!(tokens[pos] instanceof CloseSquareToken) && !isEOF())
          rawCSSString += tokens[pos++].toSource();
        if (!(tokens[pos] instanceof CloseSquareToken))
          throw unexpected();
        rawCSSString += "]";
        pos++;
      } else {
        throw unexpected();
      }
    }
    if (!rawCSSString && !functions.length)
      throw unexpected();
    return { css: rawCSSString || void 0, functions };
  }
  function consumeBuiltinFunctionArguments() {
    let s = "";
    let balance = 1;
    while (!isEOF()) {
      if (isOpenParen() || isFunction())
        balance++;
      if (isCloseParen())
        balance--;
      if (!balance)
        break;
      s += tokens[pos++].toSource();
    }
    return s;
  }
  const result = consumeFunctionArguments();
  if (!isEOF())
    throw unexpected();
  if (result.some((arg) => typeof arg !== "object" || !("simples" in arg)))
    throw new InvalidSelectorError(\`Error while parsing selector "\${selector}"\`);
  return { selector: result, names: Array.from(names) };
}

// packages/playwright-core/src/utils/isomorphic/selectorParser.ts
var kNestedSelectorNames = /* @__PURE__ */ new Set(["internal:has", "internal:has-not", "internal:and", "internal:or", "internal:chain", "left-of", "right-of", "above", "below", "near"]);
var kNestedSelectorNamesWithDistance = /* @__PURE__ */ new Set(["left-of", "right-of", "above", "below", "near"]);
var customCSSNames = /* @__PURE__ */ new Set(["not", "is", "where", "has", "scope", "light", "visible", "text", "text-matches", "text-is", "has-text", "above", "below", "right-of", "left-of", "near", "nth-match"]);
function parseSelector(selector) {
  const parsedStrings = parseSelectorString(selector);
  const parts = [];
  for (const part of parsedStrings.parts) {
    if (part.name === "css" || part.name === "css:light") {
      if (part.name === "css:light")
        part.body = ":light(" + part.body + ")";
      const parsedCSS = parseCSS(part.body, customCSSNames);
      parts.push({
        name: "css",
        body: parsedCSS.selector,
        source: part.body
      });
      continue;
    }
    if (kNestedSelectorNames.has(part.name)) {
      let innerSelector;
      let distance;
      try {
        const unescaped = JSON.parse("[" + part.body + "]");
        if (!Array.isArray(unescaped) || unescaped.length < 1 || unescaped.length > 2 || typeof unescaped[0] !== "string")
          throw new InvalidSelectorError(\`Malformed selector: \${part.name}=\` + part.body);
        innerSelector = unescaped[0];
        if (unescaped.length === 2) {
          if (typeof unescaped[1] !== "number" || !kNestedSelectorNamesWithDistance.has(part.name))
            throw new InvalidSelectorError(\`Malformed selector: \${part.name}=\` + part.body);
          distance = unescaped[1];
        }
      } catch (e) {
        throw new InvalidSelectorError(\`Malformed selector: \${part.name}=\` + part.body);
      }
      const nested = { name: part.name, source: part.body, body: { parsed: parseSelector(innerSelector), distance } };
      const lastFrame = [...nested.body.parsed.parts].reverse().find((part2) => part2.name === "internal:control" && part2.body === "enter-frame");
      const lastFrameIndex = lastFrame ? nested.body.parsed.parts.indexOf(lastFrame) : -1;
      if (lastFrameIndex !== -1 && selectorPartsEqual(nested.body.parsed.parts.slice(0, lastFrameIndex + 1), parts.slice(0, lastFrameIndex + 1)))
        nested.body.parsed.parts.splice(0, lastFrameIndex + 1);
      parts.push(nested);
      continue;
    }
    parts.push({ ...part, source: part.body });
  }
  if (kNestedSelectorNames.has(parts[0].name))
    throw new InvalidSelectorError(\`"\${parts[0].name}" selector cannot be first\`);
  return {
    capture: parsedStrings.capture,
    parts
  };
}
function selectorPartsEqual(list1, list2) {
  return stringifySelector({ parts: list1 }) === stringifySelector({ parts: list2 });
}
function stringifySelector(selector, forceEngineName) {
  if (typeof selector === "string")
    return selector;
  return selector.parts.map((p, i) => {
    let includeEngine = true;
    if (!forceEngineName && i !== selector.capture) {
      if (p.name === "css")
        includeEngine = false;
      else if (p.name === "xpath" && p.source.startsWith("//") || p.source.startsWith(".."))
        includeEngine = false;
    }
    const prefix = includeEngine ? p.name + "=" : "";
    return \`\${i === selector.capture ? "*" : ""}\${prefix}\${p.source}\`;
  }).join(" >> ");
}
function parseSelectorString(selector) {
  let index = 0;
  let quote;
  let start = 0;
  const result = { parts: [] };
  const append = () => {
    const part = selector.substring(start, index).trim();
    const eqIndex = part.indexOf("=");
    let name;
    let body;
    if (eqIndex !== -1 && part.substring(0, eqIndex).trim().match(/^[a-zA-Z_0-9-+:*]+$/)) {
      name = part.substring(0, eqIndex).trim();
      body = part.substring(eqIndex + 1);
    } else if (part.length > 1 && part[0] === '"' && part[part.length - 1] === '"') {
      name = "text";
      body = part;
    } else if (part.length > 1 && part[0] === "'" && part[part.length - 1] === "'") {
      name = "text";
      body = part;
    } else if (/^\\(*\\/\\//.test(part) || part.startsWith("..")) {
      name = "xpath";
      body = part;
    } else {
      name = "css";
      body = part;
    }
    let capture = false;
    if (name[0] === "*") {
      capture = true;
      name = name.substring(1);
    }
    result.parts.push({ name, body });
    if (capture) {
      if (result.capture !== void 0)
        throw new InvalidSelectorError(\`Only one of the selectors can capture using * modifier\`);
      result.capture = result.parts.length - 1;
    }
  };
  if (!selector.includes(">>")) {
    index = selector.length;
    append();
    return result;
  }
  const shouldIgnoreTextSelectorQuote = () => {
    const prefix = selector.substring(start, index);
    const match = prefix.match(/^\\s*text\\s*=(.*)$/);
    return !!match && !!match[1];
  };
  while (index < selector.length) {
    const c = selector[index];
    if (c === "\\\\" && index + 1 < selector.length) {
      index += 2;
    } else if (c === quote) {
      quote = void 0;
      index++;
    } else if (!quote && (c === '"' || c === "'" || c === "\`") && !shouldIgnoreTextSelectorQuote()) {
      quote = c;
      index++;
    } else if (!quote && c === ">" && selector[index + 1] === ">") {
      append();
      index += 2;
      start = index;
    } else {
      index++;
    }
  }
  append();
  return result;
}
function parseAttributeSelector(selector, allowUnquotedStrings) {
  let wp = 0;
  let EOL = selector.length === 0;
  const next = () => selector[wp] || "";
  const eat1 = () => {
    const result2 = next();
    ++wp;
    EOL = wp >= selector.length;
    return result2;
  };
  const syntaxError = (stage) => {
    if (EOL)
      throw new InvalidSelectorError(\`Unexpected end of selector while parsing selector \\\`\${selector}\\\`\`);
    throw new InvalidSelectorError(\`Error while parsing selector \\\`\${selector}\\\` - unexpected symbol "\${next()}" at position \${wp}\` + (stage ? " during " + stage : ""));
  };
  function skipSpaces() {
    while (!EOL && /\\s/.test(next()))
      eat1();
  }
  function isCSSNameChar(char) {
    return char >= "\\x80" || char >= "0" && char <= "9" || char >= "A" && char <= "Z" || char >= "a" && char <= "z" || char >= "0" && char <= "9" || char === "_" || char === "-";
  }
  function readIdentifier() {
    let result2 = "";
    skipSpaces();
    while (!EOL && isCSSNameChar(next()))
      result2 += eat1();
    return result2;
  }
  function readQuotedString(quote) {
    let result2 = eat1();
    if (result2 !== quote)
      syntaxError("parsing quoted string");
    while (!EOL && next() !== quote) {
      if (next() === "\\\\")
        eat1();
      result2 += eat1();
    }
    if (next() !== quote)
      syntaxError("parsing quoted string");
    result2 += eat1();
    return result2;
  }
  function readRegularExpression() {
    if (eat1() !== "/")
      syntaxError("parsing regular expression");
    let source = "";
    let inClass = false;
    while (!EOL) {
      if (next() === "\\\\") {
        source += eat1();
        if (EOL)
          syntaxError("parsing regular expression");
      } else if (inClass && next() === "]") {
        inClass = false;
      } else if (!inClass && next() === "[") {
        inClass = true;
      } else if (!inClass && next() === "/") {
        break;
      }
      source += eat1();
    }
    if (eat1() !== "/")
      syntaxError("parsing regular expression");
    let flags = "";
    while (!EOL && next().match(/[dgimsuy]/))
      flags += eat1();
    try {
      return new RegExp(source, flags);
    } catch (e) {
      throw new InvalidSelectorError(\`Error while parsing selector \\\`\${selector}\\\`: \${e.message}\`);
    }
  }
  function readAttributeToken() {
    let token = "";
    skipSpaces();
    if (next() === \`'\` || next() === \`"\`)
      token = readQuotedString(next()).slice(1, -1);
    else
      token = readIdentifier();
    if (!token)
      syntaxError("parsing property path");
    return token;
  }
  function readOperator() {
    skipSpaces();
    let op = "";
    if (!EOL)
      op += eat1();
    if (!EOL && op !== "=")
      op += eat1();
    if (!["=", "*=", "^=", "$=", "|=", "~="].includes(op))
      syntaxError("parsing operator");
    return op;
  }
  function readAttribute() {
    eat1();
    const jsonPath = [];
    jsonPath.push(readAttributeToken());
    skipSpaces();
    while (next() === ".") {
      eat1();
      jsonPath.push(readAttributeToken());
      skipSpaces();
    }
    if (next() === "]") {
      eat1();
      return { name: jsonPath.join("."), jsonPath, op: "<truthy>", value: null, caseSensitive: false };
    }
    const operator = readOperator();
    let value = void 0;
    let caseSensitive = true;
    skipSpaces();
    if (next() === "/") {
      if (operator !== "=")
        throw new InvalidSelectorError(\`Error while parsing selector \\\`\${selector}\\\` - cannot use \${operator} in attribute with regular expression\`);
      value = readRegularExpression();
    } else if (next() === \`'\` || next() === \`"\`) {
      value = readQuotedString(next()).slice(1, -1);
      skipSpaces();
      if (next() === "i" || next() === "I") {
        caseSensitive = false;
        eat1();
      } else if (next() === "s" || next() === "S") {
        caseSensitive = true;
        eat1();
      }
    } else {
      value = "";
      while (!EOL && (isCSSNameChar(next()) || next() === "+" || next() === "."))
        value += eat1();
      if (value === "true") {
        value = true;
      } else if (value === "false") {
        value = false;
      } else {
        if (!allowUnquotedStrings) {
          value = +value;
          if (Number.isNaN(value))
            syntaxError("parsing attribute value");
        }
      }
    }
    skipSpaces();
    if (next() !== "]")
      syntaxError("parsing attribute value");
    eat1();
    if (operator !== "=" && typeof value !== "string")
      throw new InvalidSelectorError(\`Error while parsing selector \\\`\${selector}\\\` - cannot use \${operator} in attribute with non-string matching value - \${value}\`);
    return { name: jsonPath.join("."), jsonPath, op: operator, value, caseSensitive };
  }
  const result = {
    name: "",
    attributes: []
  };
  result.name = readIdentifier();
  skipSpaces();
  while (next() === "[") {
    result.attributes.push(readAttribute());
    skipSpaces();
  }
  if (!EOL)
    syntaxError(void 0);
  if (!result.name && !result.attributes.length)
    throw new InvalidSelectorError(\`Error while parsing selector \\\`\${selector}\\\` - selector cannot be empty\`);
  return result;
}

// packages/playwright-core/src/utils/isomorphic/locatorGenerators.ts
function asLocator(lang, selector, isFrameLocator = false) {
  return asLocators(lang, selector, isFrameLocator)[0];
}
function asLocators(lang, selector, isFrameLocator = false, maxOutputSize = 20, preferredQuote) {
  try {
    return innerAsLocators(new generators[lang](preferredQuote), parseSelector(selector), isFrameLocator, maxOutputSize);
  } catch (e) {
    return [selector];
  }
}
function innerAsLocators(factory, parsed, isFrameLocator = false, maxOutputSize = 20) {
  const parts = [...parsed.parts];
  for (let index = 0; index < parts.length - 1; index++) {
    if (parts[index].name === "nth" && parts[index + 1].name === "internal:control" && parts[index + 1].body === "enter-frame") {
      const [nth] = parts.splice(index, 1);
      parts.splice(index + 1, 0, nth);
    }
  }
  const tokens = [];
  let nextBase = isFrameLocator ? "frame-locator" : "page";
  for (let index = 0; index < parts.length; index++) {
    const part = parts[index];
    const base = nextBase;
    nextBase = "locator";
    if (part.name === "nth") {
      if (part.body === "0")
        tokens.push([factory.generateLocator(base, "first", ""), factory.generateLocator(base, "nth", "0")]);
      else if (part.body === "-1")
        tokens.push([factory.generateLocator(base, "last", ""), factory.generateLocator(base, "nth", "-1")]);
      else
        tokens.push([factory.generateLocator(base, "nth", part.body)]);
      continue;
    }
    if (part.name === "internal:text") {
      const { exact, text } = detectExact(part.body);
      tokens.push([factory.generateLocator(base, "text", text, { exact })]);
      continue;
    }
    if (part.name === "internal:has-text") {
      const { exact, text } = detectExact(part.body);
      if (!exact) {
        tokens.push([factory.generateLocator(base, "has-text", text, { exact })]);
        continue;
      }
    }
    if (part.name === "internal:has-not-text") {
      const { exact, text } = detectExact(part.body);
      if (!exact) {
        tokens.push([factory.generateLocator(base, "has-not-text", text, { exact })]);
        continue;
      }
    }
    if (part.name === "internal:has") {
      const inners = innerAsLocators(factory, part.body.parsed, false, maxOutputSize);
      tokens.push(inners.map((inner) => factory.generateLocator(base, "has", inner)));
      continue;
    }
    if (part.name === "internal:has-not") {
      const inners = innerAsLocators(factory, part.body.parsed, false, maxOutputSize);
      tokens.push(inners.map((inner) => factory.generateLocator(base, "hasNot", inner)));
      continue;
    }
    if (part.name === "internal:and") {
      const inners = innerAsLocators(factory, part.body.parsed, false, maxOutputSize);
      tokens.push(inners.map((inner) => factory.generateLocator(base, "and", inner)));
      continue;
    }
    if (part.name === "internal:or") {
      const inners = innerAsLocators(factory, part.body.parsed, false, maxOutputSize);
      tokens.push(inners.map((inner) => factory.generateLocator(base, "or", inner)));
      continue;
    }
    if (part.name === "internal:chain") {
      const inners = innerAsLocators(factory, part.body.parsed, false, maxOutputSize);
      tokens.push(inners.map((inner) => factory.generateLocator(base, "chain", inner)));
      continue;
    }
    if (part.name === "internal:label") {
      const { exact, text } = detectExact(part.body);
      tokens.push([factory.generateLocator(base, "label", text, { exact })]);
      continue;
    }
    if (part.name === "internal:role") {
      const attrSelector = parseAttributeSelector(part.body, true);
      const options = { attrs: [] };
      for (const attr of attrSelector.attributes) {
        if (attr.name === "name") {
          options.exact = attr.caseSensitive;
          options.name = attr.value;
        } else {
          if (attr.name === "level" && typeof attr.value === "string")
            attr.value = +attr.value;
          options.attrs.push({ name: attr.name === "include-hidden" ? "includeHidden" : attr.name, value: attr.value });
        }
      }
      tokens.push([factory.generateLocator(base, "role", attrSelector.name, options)]);
      continue;
    }
    if (part.name === "internal:testid") {
      const attrSelector = parseAttributeSelector(part.body, true);
      const { value } = attrSelector.attributes[0];
      tokens.push([factory.generateLocator(base, "test-id", value)]);
      continue;
    }
    if (part.name === "internal:attr") {
      const attrSelector = parseAttributeSelector(part.body, true);
      const { name, value, caseSensitive } = attrSelector.attributes[0];
      const text = value;
      const exact = !!caseSensitive;
      if (name === "placeholder") {
        tokens.push([factory.generateLocator(base, "placeholder", text, { exact })]);
        continue;
      }
      if (name === "alt") {
        tokens.push([factory.generateLocator(base, "alt", text, { exact })]);
        continue;
      }
      if (name === "title") {
        tokens.push([factory.generateLocator(base, "title", text, { exact })]);
        continue;
      }
    }
    let locatorType = "default";
    const nextPart = parts[index + 1];
    if (nextPart && nextPart.name === "internal:control" && nextPart.body === "enter-frame") {
      locatorType = "frame";
      nextBase = "frame-locator";
      index++;
    }
    const selectorPart = stringifySelector({ parts: [part] });
    const locatorPart = factory.generateLocator(base, locatorType, selectorPart);
    if (locatorType === "default" && nextPart && ["internal:has-text", "internal:has-not-text"].includes(nextPart.name)) {
      const { exact, text } = detectExact(nextPart.body);
      if (!exact) {
        const nextLocatorPart = factory.generateLocator("locator", nextPart.name === "internal:has-text" ? "has-text" : "has-not-text", text, { exact });
        const options = {};
        if (nextPart.name === "internal:has-text")
          options.hasText = text;
        else
          options.hasNotText = text;
        const combinedPart = factory.generateLocator(base, "default", selectorPart, options);
        tokens.push([factory.chainLocators([locatorPart, nextLocatorPart]), combinedPart]);
        index++;
        continue;
      }
    }
    let locatorPartWithEngine;
    if (["xpath", "css"].includes(part.name)) {
      const selectorPart2 = stringifySelector(
        { parts: [part] },
        /* forceEngineName */
        true
      );
      locatorPartWithEngine = factory.generateLocator(base, locatorType, selectorPart2);
    }
    tokens.push([locatorPart, locatorPartWithEngine].filter(Boolean));
  }
  return combineTokens(factory, tokens, maxOutputSize);
}
function combineTokens(factory, tokens, maxOutputSize) {
  const currentTokens = tokens.map(() => "");
  const result = [];
  const visit = (index) => {
    if (index === tokens.length) {
      result.push(factory.chainLocators(currentTokens));
      return currentTokens.length < maxOutputSize;
    }
    for (const taken of tokens[index]) {
      currentTokens[index] = taken;
      if (!visit(index + 1))
        return false;
    }
    return true;
  };
  visit(0);
  return result;
}
function detectExact(text) {
  let exact = false;
  const match = text.match(/^\\/(.*)\\/([igm]*)$/);
  if (match)
    return { text: new RegExp(match[1], match[2]) };
  if (text.endsWith('"')) {
    text = JSON.parse(text);
    exact = true;
  } else if (text.endsWith('"s')) {
    text = JSON.parse(text.substring(0, text.length - 1));
    exact = true;
  } else if (text.endsWith('"i')) {
    text = JSON.parse(text.substring(0, text.length - 1));
    exact = false;
  }
  return { exact, text };
}
var JavaScriptLocatorFactory = class {
  constructor(preferredQuote) {
    this.preferredQuote = preferredQuote;
  }
  generateLocator(base, kind, body, options = {}) {
    switch (kind) {
      case "default":
        if (options.hasText !== void 0)
          return \`locator(\${this.quote(body)}, { hasText: \${this.toHasText(options.hasText)} })\`;
        if (options.hasNotText !== void 0)
          return \`locator(\${this.quote(body)}, { hasNotText: \${this.toHasText(options.hasNotText)} })\`;
        return \`locator(\${this.quote(body)})\`;
      case "frame":
        return \`frameLocator(\${this.quote(body)})\`;
      case "nth":
        return \`nth(\${body})\`;
      case "first":
        return \`first()\`;
      case "last":
        return \`last()\`;
      case "role":
        const attrs = [];
        if (isRegExp(options.name)) {
          attrs.push(\`name: \${this.regexToSourceString(options.name)}\`);
        } else if (typeof options.name === "string") {
          attrs.push(\`name: \${this.quote(options.name)}\`);
          if (options.exact)
            attrs.push(\`exact: true\`);
        }
        for (const { name, value } of options.attrs)
          attrs.push(\`\${name}: \${typeof value === "string" ? this.quote(value) : value}\`);
        const attrString = attrs.length ? \`, { \${attrs.join(", ")} }\` : "";
        return \`getByRole(\${this.quote(body)}\${attrString})\`;
      case "has-text":
        return \`filter({ hasText: \${this.toHasText(body)} })\`;
      case "has-not-text":
        return \`filter({ hasNotText: \${this.toHasText(body)} })\`;
      case "has":
        return \`filter({ has: \${body} })\`;
      case "hasNot":
        return \`filter({ hasNot: \${body} })\`;
      case "and":
        return \`and(\${body})\`;
      case "or":
        return \`or(\${body})\`;
      case "chain":
        return \`locator(\${body})\`;
      case "test-id":
        return \`getByTestId(\${this.toTestIdValue(body)})\`;
      case "text":
        return this.toCallWithExact("getByText", body, !!options.exact);
      case "alt":
        return this.toCallWithExact("getByAltText", body, !!options.exact);
      case "placeholder":
        return this.toCallWithExact("getByPlaceholder", body, !!options.exact);
      case "label":
        return this.toCallWithExact("getByLabel", body, !!options.exact);
      case "title":
        return this.toCallWithExact("getByTitle", body, !!options.exact);
      default:
        throw new Error("Unknown selector kind " + kind);
    }
  }
  chainLocators(locators) {
    return locators.join(".");
  }
  regexToSourceString(re) {
    return normalizeEscapedRegexQuotes(String(re));
  }
  toCallWithExact(method, body, exact) {
    if (isRegExp(body))
      return \`\${method}(\${this.regexToSourceString(body)})\`;
    return exact ? \`\${method}(\${this.quote(body)}, { exact: true })\` : \`\${method}(\${this.quote(body)})\`;
  }
  toHasText(body) {
    if (isRegExp(body))
      return this.regexToSourceString(body);
    return this.quote(body);
  }
  toTestIdValue(value) {
    if (isRegExp(value))
      return this.regexToSourceString(value);
    return this.quote(value);
  }
  quote(text) {
    var _a;
    return escapeWithQuotes(text, (_a = this.preferredQuote) != null ? _a : "'");
  }
};
var PythonLocatorFactory = class {
  generateLocator(base, kind, body, options = {}) {
    switch (kind) {
      case "default":
        if (options.hasText !== void 0)
          return \`locator(\${this.quote(body)}, has_text=\${this.toHasText(options.hasText)})\`;
        if (options.hasNotText !== void 0)
          return \`locator(\${this.quote(body)}, has_not_text=\${this.toHasText(options.hasNotText)})\`;
        return \`locator(\${this.quote(body)})\`;
      case "frame":
        return \`frame_locator(\${this.quote(body)})\`;
      case "nth":
        return \`nth(\${body})\`;
      case "first":
        return \`first\`;
      case "last":
        return \`last\`;
      case "role":
        const attrs = [];
        if (isRegExp(options.name)) {
          attrs.push(\`name=\${this.regexToString(options.name)}\`);
        } else if (typeof options.name === "string") {
          attrs.push(\`name=\${this.quote(options.name)}\`);
          if (options.exact)
            attrs.push(\`exact=True\`);
        }
        for (const { name, value } of options.attrs) {
          let valueString = typeof value === "string" ? this.quote(value) : value;
          if (typeof value === "boolean")
            valueString = value ? "True" : "False";
          attrs.push(\`\${toSnakeCase(name)}=\${valueString}\`);
        }
        const attrString = attrs.length ? \`, \${attrs.join(", ")}\` : "";
        return \`get_by_role(\${this.quote(body)}\${attrString})\`;
      case "has-text":
        return \`filter(has_text=\${this.toHasText(body)})\`;
      case "has-not-text":
        return \`filter(has_not_text=\${this.toHasText(body)})\`;
      case "has":
        return \`filter(has=\${body})\`;
      case "hasNot":
        return \`filter(has_not=\${body})\`;
      case "and":
        return \`and_(\${body})\`;
      case "or":
        return \`or_(\${body})\`;
      case "chain":
        return \`locator(\${body})\`;
      case "test-id":
        return \`get_by_test_id(\${this.toTestIdValue(body)})\`;
      case "text":
        return this.toCallWithExact("get_by_text", body, !!options.exact);
      case "alt":
        return this.toCallWithExact("get_by_alt_text", body, !!options.exact);
      case "placeholder":
        return this.toCallWithExact("get_by_placeholder", body, !!options.exact);
      case "label":
        return this.toCallWithExact("get_by_label", body, !!options.exact);
      case "title":
        return this.toCallWithExact("get_by_title", body, !!options.exact);
      default:
        throw new Error("Unknown selector kind " + kind);
    }
  }
  chainLocators(locators) {
    return locators.join(".");
  }
  regexToString(body) {
    const suffix = body.flags.includes("i") ? ", re.IGNORECASE" : "";
    return \`re.compile(r"\${normalizeEscapedRegexQuotes(body.source).replace(/\\\\\\//, "/").replace(/"/g, '\\\\"')}"\${suffix})\`;
  }
  toCallWithExact(method, body, exact) {
    if (isRegExp(body))
      return \`\${method}(\${this.regexToString(body)})\`;
    if (exact)
      return \`\${method}(\${this.quote(body)}, exact=True)\`;
    return \`\${method}(\${this.quote(body)})\`;
  }
  toHasText(body) {
    if (isRegExp(body))
      return this.regexToString(body);
    return \`\${this.quote(body)}\`;
  }
  toTestIdValue(value) {
    if (isRegExp(value))
      return this.regexToString(value);
    return this.quote(value);
  }
  quote(text) {
    return escapeWithQuotes(text, '"');
  }
};
var JavaLocatorFactory = class {
  generateLocator(base, kind, body, options = {}) {
    let clazz;
    switch (base) {
      case "page":
        clazz = "Page";
        break;
      case "frame-locator":
        clazz = "FrameLocator";
        break;
      case "locator":
        clazz = "Locator";
        break;
    }
    switch (kind) {
      case "default":
        if (options.hasText !== void 0)
          return \`locator(\${this.quote(body)}, new \${clazz}.LocatorOptions().setHasText(\${this.toHasText(options.hasText)}))\`;
        if (options.hasNotText !== void 0)
          return \`locator(\${this.quote(body)}, new \${clazz}.LocatorOptions().setHasNotText(\${this.toHasText(options.hasNotText)}))\`;
        return \`locator(\${this.quote(body)})\`;
      case "frame":
        return \`frameLocator(\${this.quote(body)})\`;
      case "nth":
        return \`nth(\${body})\`;
      case "first":
        return \`first()\`;
      case "last":
        return \`last()\`;
      case "role":
        const attrs = [];
        if (isRegExp(options.name)) {
          attrs.push(\`.setName(\${this.regexToString(options.name)})\`);
        } else if (typeof options.name === "string") {
          attrs.push(\`.setName(\${this.quote(options.name)})\`);
          if (options.exact)
            attrs.push(\`.setExact(true)\`);
        }
        for (const { name, value } of options.attrs)
          attrs.push(\`.set\${toTitleCase(name)}(\${typeof value === "string" ? this.quote(value) : value})\`);
        const attrString = attrs.length ? \`, new \${clazz}.GetByRoleOptions()\${attrs.join("")}\` : "";
        return \`getByRole(AriaRole.\${toSnakeCase(body).toUpperCase()}\${attrString})\`;
      case "has-text":
        return \`filter(new \${clazz}.FilterOptions().setHasText(\${this.toHasText(body)}))\`;
      case "has-not-text":
        return \`filter(new \${clazz}.FilterOptions().setHasNotText(\${this.toHasText(body)}))\`;
      case "has":
        return \`filter(new \${clazz}.FilterOptions().setHas(\${body}))\`;
      case "hasNot":
        return \`filter(new \${clazz}.FilterOptions().setHasNot(\${body}))\`;
      case "and":
        return \`and(\${body})\`;
      case "or":
        return \`or(\${body})\`;
      case "chain":
        return \`locator(\${body})\`;
      case "test-id":
        return \`getByTestId(\${this.toTestIdValue(body)})\`;
      case "text":
        return this.toCallWithExact(clazz, "getByText", body, !!options.exact);
      case "alt":
        return this.toCallWithExact(clazz, "getByAltText", body, !!options.exact);
      case "placeholder":
        return this.toCallWithExact(clazz, "getByPlaceholder", body, !!options.exact);
      case "label":
        return this.toCallWithExact(clazz, "getByLabel", body, !!options.exact);
      case "title":
        return this.toCallWithExact(clazz, "getByTitle", body, !!options.exact);
      default:
        throw new Error("Unknown selector kind " + kind);
    }
  }
  chainLocators(locators) {
    return locators.join(".");
  }
  regexToString(body) {
    const suffix = body.flags.includes("i") ? ", Pattern.CASE_INSENSITIVE" : "";
    return \`Pattern.compile(\${this.quote(normalizeEscapedRegexQuotes(body.source))}\${suffix})\`;
  }
  toCallWithExact(clazz, method, body, exact) {
    if (isRegExp(body))
      return \`\${method}(\${this.regexToString(body)})\`;
    if (exact)
      return \`\${method}(\${this.quote(body)}, new \${clazz}.\${toTitleCase(method)}Options().setExact(true))\`;
    return \`\${method}(\${this.quote(body)})\`;
  }
  toHasText(body) {
    if (isRegExp(body))
      return this.regexToString(body);
    return this.quote(body);
  }
  toTestIdValue(value) {
    if (isRegExp(value))
      return this.regexToString(value);
    return this.quote(value);
  }
  quote(text) {
    return escapeWithQuotes(text, '"');
  }
};
var CSharpLocatorFactory = class {
  generateLocator(base, kind, body, options = {}) {
    switch (kind) {
      case "default":
        if (options.hasText !== void 0)
          return \`Locator(\${this.quote(body)}, new() { \${this.toHasText(options.hasText)} })\`;
        if (options.hasNotText !== void 0)
          return \`Locator(\${this.quote(body)}, new() { \${this.toHasNotText(options.hasNotText)} })\`;
        return \`Locator(\${this.quote(body)})\`;
      case "frame":
        return \`FrameLocator(\${this.quote(body)})\`;
      case "nth":
        return \`Nth(\${body})\`;
      case "first":
        return \`First\`;
      case "last":
        return \`Last\`;
      case "role":
        const attrs = [];
        if (isRegExp(options.name)) {
          attrs.push(\`NameRegex = \${this.regexToString(options.name)}\`);
        } else if (typeof options.name === "string") {
          attrs.push(\`Name = \${this.quote(options.name)}\`);
          if (options.exact)
            attrs.push(\`Exact = true\`);
        }
        for (const { name, value } of options.attrs)
          attrs.push(\`\${toTitleCase(name)} = \${typeof value === "string" ? this.quote(value) : value}\`);
        const attrString = attrs.length ? \`, new() { \${attrs.join(", ")} }\` : "";
        return \`GetByRole(AriaRole.\${toTitleCase(body)}\${attrString})\`;
      case "has-text":
        return \`Filter(new() { \${this.toHasText(body)} })\`;
      case "has-not-text":
        return \`Filter(new() { \${this.toHasNotText(body)} })\`;
      case "has":
        return \`Filter(new() { Has = \${body} })\`;
      case "hasNot":
        return \`Filter(new() { HasNot = \${body} })\`;
      case "and":
        return \`And(\${body})\`;
      case "or":
        return \`Or(\${body})\`;
      case "chain":
        return \`Locator(\${body})\`;
      case "test-id":
        return \`GetByTestId(\${this.toTestIdValue(body)})\`;
      case "text":
        return this.toCallWithExact("GetByText", body, !!options.exact);
      case "alt":
        return this.toCallWithExact("GetByAltText", body, !!options.exact);
      case "placeholder":
        return this.toCallWithExact("GetByPlaceholder", body, !!options.exact);
      case "label":
        return this.toCallWithExact("GetByLabel", body, !!options.exact);
      case "title":
        return this.toCallWithExact("GetByTitle", body, !!options.exact);
      default:
        throw new Error("Unknown selector kind " + kind);
    }
  }
  chainLocators(locators) {
    return locators.join(".");
  }
  regexToString(body) {
    const suffix = body.flags.includes("i") ? ", RegexOptions.IgnoreCase" : "";
    return \`new Regex(\${this.quote(normalizeEscapedRegexQuotes(body.source))}\${suffix})\`;
  }
  toCallWithExact(method, body, exact) {
    if (isRegExp(body))
      return \`\${method}(\${this.regexToString(body)})\`;
    if (exact)
      return \`\${method}(\${this.quote(body)}, new() { Exact = true })\`;
    return \`\${method}(\${this.quote(body)})\`;
  }
  toHasText(body) {
    if (isRegExp(body))
      return \`HasTextRegex = \${this.regexToString(body)}\`;
    return \`HasText = \${this.quote(body)}\`;
  }
  toTestIdValue(value) {
    if (isRegExp(value))
      return this.regexToString(value);
    return this.quote(value);
  }
  toHasNotText(body) {
    if (isRegExp(body))
      return \`HasNotTextRegex = \${this.regexToString(body)}\`;
    return \`HasNotText = \${this.quote(body)}\`;
  }
  quote(text) {
    return escapeWithQuotes(text, '"');
  }
};
var JsonlLocatorFactory = class {
  generateLocator(base, kind, body, options = {}) {
    return JSON.stringify({
      kind,
      body,
      options
    });
  }
  chainLocators(locators) {
    const objects = locators.map((l) => JSON.parse(l));
    for (let i = 0; i < objects.length - 1; ++i)
      objects[i].next = objects[i + 1];
    return JSON.stringify(objects[0]);
  }
};
var generators = {
  javascript: JavaScriptLocatorFactory,
  python: PythonLocatorFactory,
  java: JavaLocatorFactory,
  csharp: CSharpLocatorFactory,
  jsonl: JsonlLocatorFactory
};
function isRegExp(obj) {
  return obj instanceof RegExp;
}

// packages/playwright-core/src/server/injected/consoleApi.ts
var selectorSymbol = Symbol("selector");
var _Locator = class _Locator {
  constructor(injectedScript, selector, options) {
    if (options == null ? void 0 : options.hasText)
      selector += \` >> internal:has-text=\${escapeForTextSelector(options.hasText, false)}\`;
    if (options == null ? void 0 : options.hasNotText)
      selector += \` >> internal:has-not-text=\${escapeForTextSelector(options.hasNotText, false)}\`;
    if (options == null ? void 0 : options.has)
      selector += \` >> internal:has=\` + JSON.stringify(options.has[selectorSymbol]);
    if (options == null ? void 0 : options.hasNot)
      selector += \` >> internal:has-not=\` + JSON.stringify(options.hasNot[selectorSymbol]);
    this[selectorSymbol] = selector;
    if (selector) {
      const parsed = injectedScript.parseSelector(selector);
      this.element = injectedScript.querySelector(parsed, injectedScript.document, false);
      this.elements = injectedScript.querySelectorAll(parsed, injectedScript.document);
    }
    const selectorBase = selector;
    const self = this;
    self.locator = (selector2, options2) => {
      return new _Locator(injectedScript, selectorBase ? selectorBase + " >> " + selector2 : selector2, options2);
    };
    self.getByTestId = (testId) => self.locator(getByTestIdSelector(injectedScript.testIdAttributeNameForStrictErrorAndConsoleCodegen(), testId));
    self.getByAltText = (text, options2) => self.locator(getByAltTextSelector(text, options2));
    self.getByLabel = (text, options2) => self.locator(getByLabelSelector(text, options2));
    self.getByPlaceholder = (text, options2) => self.locator(getByPlaceholderSelector(text, options2));
    self.getByText = (text, options2) => self.locator(getByTextSelector(text, options2));
    self.getByTitle = (text, options2) => self.locator(getByTitleSelector(text, options2));
    self.getByRole = (role, options2 = {}) => self.locator(getByRoleSelector(role, options2));
    self.filter = (options2) => new _Locator(injectedScript, selector, options2);
    self.first = () => self.locator("nth=0");
    self.last = () => self.locator("nth=-1");
    self.nth = (index) => self.locator(\`nth=\${index}\`);
    self.and = (locator) => new _Locator(injectedScript, selectorBase + \` >> internal:and=\` + JSON.stringify(locator[selectorSymbol]));
    self.or = (locator) => new _Locator(injectedScript, selectorBase + \` >> internal:or=\` + JSON.stringify(locator[selectorSymbol]));
  }
};
selectorSymbol;
var Locator = _Locator;
var ConsoleAPI = class {
  constructor(injectedScript) {
    this._injectedScript = injectedScript;
    if (this._injectedScript.window.playwright)
      return;
    this._injectedScript.window.playwright = {
      $: (selector, strict) => this._querySelector(selector, !!strict),
      $$: (selector) => this._querySelectorAll(selector),
      inspect: (selector) => this._inspect(selector),
      selector: (element) => this._selector(element),
      generateLocator: (element, language) => this._generateLocator(element, language),
      resume: () => this._resume(),
      ...new Locator(injectedScript, "")
    };
    delete this._injectedScript.window.playwright.filter;
    delete this._injectedScript.window.playwright.first;
    delete this._injectedScript.window.playwright.last;
    delete this._injectedScript.window.playwright.nth;
    delete this._injectedScript.window.playwright.and;
    delete this._injectedScript.window.playwright.or;
  }
  _querySelector(selector, strict) {
    if (typeof selector !== "string")
      throw new Error(\`Usage: playwright.query('Playwright >> selector').\`);
    const parsed = this._injectedScript.parseSelector(selector);
    return this._injectedScript.querySelector(parsed, this._injectedScript.document, strict);
  }
  _querySelectorAll(selector) {
    if (typeof selector !== "string")
      throw new Error(\`Usage: playwright.$$('Playwright >> selector').\`);
    const parsed = this._injectedScript.parseSelector(selector);
    return this._injectedScript.querySelectorAll(parsed, this._injectedScript.document);
  }
  _inspect(selector) {
    if (typeof selector !== "string")
      throw new Error(\`Usage: playwright.inspect('Playwright >> selector').\`);
    this._injectedScript.window.inspect(this._querySelector(selector, false));
  }
  _selector(element) {
    if (!(element instanceof Element))
      throw new Error(\`Usage: playwright.selector(element).\`);
    return this._injectedScript.generateSelectorSimple(element);
  }
  _generateLocator(element, language) {
    if (!(element instanceof Element))
      throw new Error(\`Usage: playwright.locator(element).\`);
    const selector = this._injectedScript.generateSelectorSimple(element);
    return asLocator(language || "javascript", selector);
  }
  _resume() {
    this._injectedScript.window.__pw_resume().catch(() => {
    });
  }
};
var consoleApi_default = ConsoleAPI;
`});function ob(i,e){i=i.replace(/AriaRole\s*\.\s*([\w]+)/g,(s,o)=>o.toLowerCase()).replace(/(get_by_role|getByRole)\s*\(\s*(?:["'`])([^'"`]+)['"`]/g,(s,o,l)=>`${o}(${l.toLowerCase()}`);let t=[],n="";for(let s=0;s<i.length;++s){let o=i[s];if(o!=='"'&&o!=="'"&&o!=="`"&&o!=="/"){n+=o;continue}let l=i[s-1]==="r"||i[s]==="/";++s;let c="";for(;s<i.length;){if(i[s]==="\\"){l?(i[s+1]!==o&&(c+=i[s]),++s,c+=i[s]):(++s,i[s]==="n"?c+=`
`:i[s]==="r"?c+="\r":i[s]==="t"?c+="	":c+=i[s]),++s;continue}if(i[s]!==o){c+=i[s++];continue}break}t.push({quote:o,text:c}),n+=(o==="/"?"r":"")+"$"+t.length}n=n.toLowerCase().replace(/get_by_alt_text/g,"getbyalttext").replace(/get_by_test_id/g,"getbytestid").replace(/get_by_([\w]+)/g,"getby$1").replace(/has_not_text/g,"hasnottext").replace(/has_text/g,"hastext").replace(/has_not/g,"hasnot").replace(/frame_locator/g,"framelocator").replace(/[{}\s]/g,"").replace(/new\(\)/g,"").replace(/new[\w]+\.[\w]+options\(\)/g,"").replace(/\.set/g,",set").replace(/\.or_\(/g,"or(").replace(/\.and_\(/g,"and(").replace(/:/g,"=").replace(/,re\.ignorecase/g,"i").replace(/,pattern.case_insensitive/g,"i").replace(/,regexoptions.ignorecase/g,"i").replace(/re.compile\(([^)]+)\)/g,"$1").replace(/pattern.compile\(([^)]+)\)/g,"r$1").replace(/newregex\(([^)]+)\)/g,"r$1").replace(/string=/g,"=").replace(/regex=/g,"=").replace(/,,/g,",");let r=t.map(s=>s.quote).filter(s=>"'\"`".includes(s))[0];return{selector:Vp(n,t,e),preferredQuote:r}}function Wp(i){return[...i.matchAll(/\$\d+/g)].length}function zp(i,e){return i.replace(/\$(\d+)/g,(t,n)=>`$${n-e}`)}function Vp(i,e,t){for(;;){let r=i.match(/filter\(,?(has=|hasnot=|sethas\(|sethasnot\()/);if(!r)break;let s=r.index+r[0].length,o=0,l=s;for(;l<i.length&&(i[l]==="("?o++:i[l]===")"&&o--,!(o<0));l++);let c=i.substring(0,s),h=0;["sethas(","sethasnot("].includes(r[1])&&(h=1,c=c.replace(/sethas\($/,"has=").replace(/sethasnot\($/,"hasnot="));let m=Wp(i.substring(0,s)),f=zp(i.substring(s,l),m),g=Wp(f),b=e.slice(m,m+g),v=JSON.stringify(Vp(f,b,t));i=c.replace(/=$/,"2=")+`$${m+1}`+zp(i.substring(l+h),g-1);let S=e.slice(0,m),_=e.slice(m+g);e=S.concat([{quote:'"',text:v}]).concat(_)}i=i.replace(/\,set([\w]+)\(([^)]+)\)/g,(r,s,o)=>","+s.toLowerCase()+"="+o.toLowerCase()).replace(/framelocator\(([^)]+)\)/g,"$1.internal:control=enter-frame").replace(/locator\(([^)]+),hastext=([^),]+)\)/g,"locator($1).internal:has-text=$2").replace(/locator\(([^)]+),hasnottext=([^),]+)\)/g,"locator($1).internal:has-not-text=$2").replace(/locator\(([^)]+),hastext=([^),]+)\)/g,"locator($1).internal:has-text=$2").replace(/locator\(([^)]+)\)/g,"$1").replace(/getbyrole\(([^)]+)\)/g,"internal:role=$1").replace(/getbytext\(([^)]+)\)/g,"internal:text=$1").replace(/getbylabel\(([^)]+)\)/g,"internal:label=$1").replace(/getbytestid\(([^)]+)\)/g,`internal:testid=[${t}=$1]`).replace(/getby(placeholder|alt|title)(?:text)?\(([^)]+)\)/g,"internal:attr=[$1=$2]").replace(/first(\(\))?/g,"nth=0").replace(/last(\(\))?/g,"nth=-1").replace(/nth\(([^)]+)\)/g,"nth=$1").replace(/filter\(,?hastext=([^)]+)\)/g,"internal:has-text=$1").replace(/filter\(,?hasnottext=([^)]+)\)/g,"internal:has-not-text=$1").replace(/filter\(,?has2=([^)]+)\)/g,"internal:has=$1").replace(/filter\(,?hasnot2=([^)]+)\)/g,"internal:has-not=$1").replace(/,exact=false/g,"").replace(/,exact=true/g,"s").replace(/\,/g,"][");let n=i.split(".");for(let r=0;r<n.length-1;r++)if(n[r]==="internal:control=enter-frame"&&n[r+1].startsWith("nth=")){let[s]=n.splice(r,1);n.splice(r+1,0,s)}return n.map(r=>!r.startsWith("internal:")||r==="internal:control"?r.replace(/\$(\d+)/g,(s,o)=>e[+o-1].text):(r=r.includes("[")?r.replace(/\]/,"")+"]":r,r=r.replace(/(?:r)\$(\d+)(i)?/g,(s,o,l)=>{let c=e[+o-1];return r.startsWith("internal:attr")||r.startsWith("internal:testid")||r.startsWith("internal:role")?An(new RegExp(c.text),!1)+(l||""):un(new RegExp(c.text,l),!1)}).replace(/\$(\d+)(i|s)?/g,(s,o,l)=>{let c=e[+o-1];return r.startsWith("internal:has=")||r.startsWith("internal:has-not=")?c.text:r.startsWith("internal:testid")?An(c.text,!0):r.startsWith("internal:attr")||r.startsWith("internal:role")?An(c.text,l==="s"):un(c.text,l==="s")}),r)).join(" >> ")}function Gp(i,e,t){try{return Nn(e),e}catch{}try{let{selector:n,preferredQuote:r}=ob(e,t),s=wc(i,n,void 0,void 0,r),o=Up(i,e);if(s.some(l=>Up(i,l)===o))return n}catch{}return""}function Up(i,e){return e=e.replace(/\s/g,""),i==="javascript"&&(e=e.replace(/\\?["`]/g,"'")),e}var Kp=x(()=>{Fn();bc();ir()});var Jp,Xp=x(()=>{Jp=`
var __commonJS = obj => {
  let required = false;
  let result;
  return function __require() {
    if (!required) {
      required = true;
      let fn;
      for (const name in obj) { fn = obj[name]; break; }
      const module = { exports: {} };
      fn(module.exports, module);
      result = module.exports;
    }
    return result;
  }
};
var __export = (target, all) => {for (var name in all) target[name] = all[name];};
var __toESM = mod => ({ ...mod, 'default': mod });
var __toCommonJS = mod => ({ ...mod, __esModule: true });


// packages/playwright-core/src/server/injected/recorder/recorder.ts
var recorder_exports = {};
__export(recorder_exports, {
  PollingRecorder: () => PollingRecorder,
  Recorder: () => Recorder,
  default: () => recorder_default
});
module.exports = __toCommonJS(recorder_exports);

// packages/playwright-core/src/server/injected/recorder/clipPaths.ts
var svgJson = { "tagName": "svg", "children": [{ "tagName": "defs", "children": [{ "tagName": "clipPath", "attrs": { "width": "16", "height": "16", "viewBox": "0 0 16 16", "fill": "currentColor", "id": "icon-gripper" }, "children": [{ "tagName": "path", "attrs": { "d": "M5 3h2v2H5zm0 4h2v2H5zm0 4h2v2H5zm4-8h2v2H9zm0 4h2v2H9zm0 4h2v2H9z" } }] }, { "tagName": "clipPath", "attrs": { "width": "16", "height": "16", "viewBox": "0 0 16 16", "fill": "currentColor", "id": "icon-circle-large-filled" }, "children": [{ "tagName": "path", "attrs": { "d": "M8 1a6.8 6.8 0 0 1 1.86.253 6.899 6.899 0 0 1 3.083 1.805 6.903 6.903 0 0 1 1.804 3.083C14.916 6.738 15 7.357 15 8s-.084 1.262-.253 1.86a6.9 6.9 0 0 1-.704 1.674 7.157 7.157 0 0 1-2.516 2.509 6.966 6.966 0 0 1-1.668.71A6.984 6.984 0 0 1 8 15a6.984 6.984 0 0 1-1.86-.246 7.098 7.098 0 0 1-1.674-.711 7.3 7.3 0 0 1-1.415-1.094 7.295 7.295 0 0 1-1.094-1.415 7.098 7.098 0 0 1-.71-1.675A6.985 6.985 0 0 1 1 8c0-.643.082-1.262.246-1.86a6.968 6.968 0 0 1 .711-1.667 7.156 7.156 0 0 1 2.509-2.516 6.895 6.895 0 0 1 1.675-.704A6.808 6.808 0 0 1 8 1z" } }] }, { "tagName": "clipPath", "attrs": { "width": "16", "height": "16", "viewBox": "0 0 16 16", "fill": "currentColor", "id": "icon-inspect" }, "children": [{ "tagName": "path", "attrs": { "fill-rule": "evenodd", "clip-rule": "evenodd", "d": "M1 3l1-1h12l1 1v6h-1V3H2v8h5v1H2l-1-1V3zm14.707 9.707L9 6v9.414l2.707-2.707h4zM10 13V8.414l3.293 3.293h-2L10 13z" } }] }, { "tagName": "clipPath", "attrs": { "width": "16", "height": "16", "viewBox": "0 0 16 16", "fill": "currentColor", "id": "icon-whole-word" }, "children": [{ "tagName": "path", "attrs": { "fill-rule": "evenodd", "clip-rule": "evenodd", "d": "M0 11H1V13H15V11H16V14H15H1H0V11Z" } }, { "tagName": "path", "attrs": { "d": "M6.84048 11H5.95963V10.1406H5.93814C5.555 10.7995 4.99104 11.1289 4.24625 11.1289C3.69839 11.1289 3.26871 10.9839 2.95718 10.6938C2.64924 10.4038 2.49527 10.0189 2.49527 9.53906C2.49527 8.51139 3.10041 7.91341 4.3107 7.74512L5.95963 7.51416C5.95963 6.57959 5.58186 6.1123 4.82632 6.1123C4.16389 6.1123 3.56591 6.33789 3.03238 6.78906V5.88672C3.57307 5.54297 4.19612 5.37109 4.90152 5.37109C6.19416 5.37109 6.84048 6.05501 6.84048 7.42285V11ZM5.95963 8.21777L4.63297 8.40039C4.22476 8.45768 3.91682 8.55973 3.70914 8.70654C3.50145 8.84977 3.39761 9.10579 3.39761 9.47461C3.39761 9.74316 3.4925 9.96338 3.68228 10.1353C3.87564 10.3035 4.13166 10.3877 4.45035 10.3877C4.8872 10.3877 5.24706 10.2355 5.52994 9.93115C5.8164 9.62321 5.95963 9.2347 5.95963 8.76562V8.21777Z" } }, { "tagName": "path", "attrs": { "d": "M9.3475 10.2051H9.32601V11H8.44515V2.85742H9.32601V6.4668H9.3475C9.78076 5.73633 10.4146 5.37109 11.2489 5.37109C11.9543 5.37109 12.5057 5.61816 12.9032 6.1123C13.3042 6.60286 13.5047 7.26172 13.5047 8.08887C13.5047 9.00911 13.2809 9.74674 12.8333 10.3018C12.3857 10.8532 11.7734 11.1289 10.9964 11.1289C10.2695 11.1289 9.71989 10.821 9.3475 10.2051ZM9.32601 7.98682V8.75488C9.32601 9.20964 9.47282 9.59635 9.76644 9.91504C10.0636 10.2301 10.4396 10.3877 10.8944 10.3877C11.4279 10.3877 11.8451 10.1836 12.1458 9.77539C12.4502 9.36719 12.6024 8.79964 12.6024 8.07275C12.6024 7.46045 12.4609 6.98063 12.1781 6.6333C11.8952 6.28597 11.512 6.1123 11.0286 6.1123C10.5166 6.1123 10.1048 6.29134 9.7933 6.64941C9.48177 7.00391 9.32601 7.44971 9.32601 7.98682Z" } }] }, { "tagName": "clipPath", "attrs": { "width": "16", "height": "16", "viewBox": "0 0 16 16", "fill": "currentColor", "id": "icon-eye" }, "children": [{ "tagName": "path", "attrs": { "d": "M7.99993 6.00316C9.47266 6.00316 10.6666 7.19708 10.6666 8.66981C10.6666 10.1426 9.47266 11.3365 7.99993 11.3365C6.52715 11.3365 5.33324 10.1426 5.33324 8.66981C5.33324 7.19708 6.52715 6.00316 7.99993 6.00316ZM7.99993 7.00315C7.07946 7.00315 6.33324 7.74935 6.33324 8.66981C6.33324 9.59028 7.07946 10.3365 7.99993 10.3365C8.9204 10.3365 9.6666 9.59028 9.6666 8.66981C9.6666 7.74935 8.9204 7.00315 7.99993 7.00315ZM7.99993 3.66675C11.0756 3.66675 13.7307 5.76675 14.4673 8.70968C14.5344 8.97755 14.3716 9.24908 14.1037 9.31615C13.8358 9.38315 13.5643 9.22041 13.4973 8.95248C12.8713 6.45205 10.6141 4.66675 7.99993 4.66675C5.38454 4.66675 3.12664 6.45359 2.50182 8.95555C2.43491 9.22341 2.16348 9.38635 1.89557 9.31948C1.62766 9.25255 1.46471 8.98115 1.53162 8.71321C2.26701 5.76856 4.9229 3.66675 7.99993 3.66675Z" } }] }, { "tagName": "clipPath", "attrs": { "width": "16", "height": "16", "viewBox": "0 0 16 16", "fill": "currentColor", "id": "icon-symbol-constant" }, "children": [{ "tagName": "path", "attrs": { "fill-rule": "evenodd", "clip-rule": "evenodd", "d": "M4 6h8v1H4V6zm8 3H4v1h8V9z" } }, { "tagName": "path", "attrs": { "fill-rule": "evenodd", "clip-rule": "evenodd", "d": "M1 4l1-1h12l1 1v8l-1 1H2l-1-1V4zm1 0v8h12V4H2z" } }] }, { "tagName": "clipPath", "attrs": { "width": "16", "height": "16", "viewBox": "0 0 16 16", "fill": "currentColor", "id": "icon-check" }, "children": [{ "tagName": "path", "attrs": { "fill-rule": "evenodd", "clip-rule": "evenodd", "d": "M14.431 3.323l-8.47 10-.79-.036-3.35-4.77.818-.574 2.978 4.24 8.051-9.506.764.646z" } }] }, { "tagName": "clipPath", "attrs": { "width": "16", "height": "16", "viewBox": "0 0 16 16", "fill": "currentColor", "id": "icon-close" }, "children": [{ "tagName": "path", "attrs": { "fill-rule": "evenodd", "clip-rule": "evenodd", "d": "M8 8.707l3.646 3.647.708-.707L8.707 8l3.647-3.646-.707-.708L8 7.293 4.354 3.646l-.707.708L7.293 8l-3.646 3.646.707.708L8 8.707z" } }] }, { "tagName": "clipPath", "attrs": { "width": "16", "height": "16", "viewBox": "0 0 16 16", "fill": "currentColor", "id": "icon-pass" }, "children": [{ "tagName": "path", "attrs": { "d": "M6.27 10.87h.71l4.56-4.56-.71-.71-4.2 4.21-1.92-1.92L4 8.6l2.27 2.27z" } }, { "tagName": "path", "attrs": { "fill-rule": "evenodd", "clip-rule": "evenodd", "d": "M8.6 1c1.6.1 3.1.9 4.2 2 1.3 1.4 2 3.1 2 5.1 0 1.6-.6 3.1-1.6 4.4-1 1.2-2.4 2.1-4 2.4-1.6.3-3.2.1-4.6-.7-1.4-.8-2.5-2-3.1-3.5C.9 9.2.8 7.5 1.3 6c.5-1.6 1.4-2.9 2.8-3.8C5.4 1.3 7 .9 8.6 1zm.5 12.9c1.3-.3 2.5-1 3.4-2.1.8-1.1 1.3-2.4 1.2-3.8 0-1.6-.6-3.2-1.7-4.3-1-1-2.2-1.6-3.6-1.7-1.3-.1-2.7.2-3.8 1-1.1.8-1.9 1.9-2.3 3.3-.4 1.3-.4 2.7.2 4 .6 1.3 1.5 2.3 2.7 3 1.2.7 2.6.9 3.9.6z" } }] }] }] };
var clipPaths_default = svgJson;

// packages/playwright-core/src/server/injected/recorder/recorder.ts
var NoneTool = class {
  cursor() {
    return "default";
  }
};
var InspectTool = class {
  constructor(recorder, assertVisibility) {
    this._hoveredModel = null;
    this._hoveredElement = null;
    this._hoveredSelectors = null;
    this._recorder = recorder;
    this._assertVisibility = assertVisibility;
  }
  cursor() {
    return "pointer";
  }
  cleanup() {
    this._hoveredModel = null;
    this._hoveredElement = null;
    this._hoveredSelectors = null;
  }
  onClick(event) {
    var _a;
    consumeEvent(event);
    if (event.button !== 0)
      return;
    if ((_a = this._hoveredModel) == null ? void 0 : _a.selector)
      this._commit(this._hoveredModel.selector);
  }
  onContextMenu(event) {
    if (this._hoveredModel && !this._hoveredModel.tooltipListItemSelected && this._hoveredSelectors && this._hoveredSelectors.length > 1) {
      consumeEvent(event);
      const selectors = this._hoveredSelectors;
      this._hoveredModel.tooltipFooter = void 0;
      this._hoveredModel.tooltipList = selectors.map((selector) => this._recorder.injectedScript.utils.asLocator(this._recorder.state.language, selector));
      this._hoveredModel.tooltipListItemSelected = (index) => {
        if (index === void 0)
          this._reset(true);
        else
          this._commit(selectors[index]);
      };
      this._recorder.updateHighlight(this._hoveredModel, true);
    }
  }
  onPointerDown(event) {
    consumeEvent(event);
  }
  onPointerUp(event) {
    consumeEvent(event);
  }
  onMouseDown(event) {
    consumeEvent(event);
  }
  onMouseUp(event) {
    consumeEvent(event);
  }
  onMouseMove(event) {
    var _a;
    consumeEvent(event);
    let target = this._recorder.deepEventTarget(event);
    if (!target.isConnected)
      target = null;
    if (this._hoveredElement === target)
      return;
    this._hoveredElement = target;
    let model = null;
    let selectors = [];
    if (this._hoveredElement) {
      const generated = this._recorder.injectedScript.generateSelector(this._hoveredElement, { testIdAttributeName: this._recorder.state.testIdAttributeName, multiple: false });
      selectors = generated.selectors;
      model = {
        selector: generated.selector,
        elements: generated.elements,
        tooltipText: this._recorder.injectedScript.utils.asLocator(this._recorder.state.language, generated.selector),
        tooltipFooter: selectors.length > 1 ? \`Click to select, right-click for more options\` : void 0,
        color: this._assertVisibility ? "#8acae480" : void 0
      };
    }
    if (((_a = this._hoveredModel) == null ? void 0 : _a.selector) === (model == null ? void 0 : model.selector))
      return;
    this._hoveredModel = model;
    this._hoveredSelectors = selectors;
    this._recorder.updateHighlight(model, true);
  }
  onMouseEnter(event) {
    consumeEvent(event);
  }
  onMouseLeave(event) {
    consumeEvent(event);
    const window = this._recorder.injectedScript.window;
    if (window.top !== window && this._recorder.deepEventTarget(event).nodeType === Node.DOCUMENT_NODE)
      this._reset(true);
  }
  onKeyDown(event) {
    var _a;
    consumeEvent(event);
    if (event.key === "Escape") {
      if ((_a = this._hoveredModel) == null ? void 0 : _a.tooltipListItemSelected)
        this._reset(true);
      else if (this._assertVisibility)
        this._recorder.setMode("recording");
    }
  }
  onKeyUp(event) {
    consumeEvent(event);
  }
  onScroll(event) {
    this._reset(false);
  }
  _commit(selector) {
    var _a;
    if (this._assertVisibility) {
      this._recorder.recordAction({
        name: "assertVisible",
        selector,
        signals: []
      });
      this._recorder.setMode("recording");
      (_a = this._recorder.overlay) == null ? void 0 : _a.flashToolSucceeded("assertingVisibility");
    } else {
      this._recorder.setSelector(selector);
    }
  }
  _reset(userGesture) {
    this._hoveredElement = null;
    this._hoveredModel = null;
    this._hoveredSelectors = null;
    this._recorder.updateHighlight(null, userGesture);
  }
};
var RecordActionTool = class {
  constructor(recorder) {
    this._performingAction = false;
    this._hoveredModel = null;
    this._hoveredElement = null;
    this._activeModel = null;
    this._expectProgrammaticKeyUp = false;
    this._recorder = recorder;
  }
  cursor() {
    return "pointer";
  }
  cleanup() {
    this._hoveredModel = null;
    this._hoveredElement = null;
    this._activeModel = null;
    this._expectProgrammaticKeyUp = false;
  }
  onClick(event) {
    if (isRangeInput(this._hoveredElement))
      return;
    if (event.button === 2 && event.type === "auxclick")
      return;
    if (this._shouldIgnoreMouseEvent(event))
      return;
    if (this._actionInProgress(event))
      return;
    if (this._consumedDueToNoModel(event, this._hoveredModel))
      return;
    const checkbox = asCheckbox(this._recorder.deepEventTarget(event));
    if (checkbox) {
      this._performAction({
        name: checkbox.checked ? "check" : "uncheck",
        selector: this._hoveredModel.selector,
        signals: []
      });
      return;
    }
    this._performAction({
      name: "click",
      selector: this._hoveredModel.selector,
      position: positionForEvent(event),
      signals: [],
      button: buttonForEvent(event),
      modifiers: modifiersForEvent(event),
      clickCount: event.detail
    });
  }
  onContextMenu(event) {
    if (this._shouldIgnoreMouseEvent(event))
      return;
    if (this._actionInProgress(event))
      return;
    if (this._consumedDueToNoModel(event, this._hoveredModel))
      return;
    this._performAction({
      name: "click",
      selector: this._hoveredModel.selector,
      position: positionForEvent(event),
      signals: [],
      button: "right",
      modifiers: 0,
      clickCount: 0
    });
  }
  onPointerDown(event) {
    if (this._shouldIgnoreMouseEvent(event))
      return;
    if (!this._performingAction)
      consumeEvent(event);
  }
  onPointerUp(event) {
    if (this._shouldIgnoreMouseEvent(event))
      return;
    if (!this._performingAction)
      consumeEvent(event);
  }
  onMouseDown(event) {
    if (this._shouldIgnoreMouseEvent(event))
      return;
    if (!this._performingAction)
      consumeEvent(event);
    this._activeModel = this._hoveredModel;
  }
  onMouseUp(event) {
    if (this._shouldIgnoreMouseEvent(event))
      return;
    if (!this._performingAction)
      consumeEvent(event);
  }
  onMouseMove(event) {
    const target = this._recorder.deepEventTarget(event);
    if (this._hoveredElement === target)
      return;
    this._hoveredElement = target;
    this._updateModelForHoveredElement();
  }
  onMouseLeave(event) {
    const window = this._recorder.injectedScript.window;
    if (window.top !== window && this._recorder.deepEventTarget(event).nodeType === Node.DOCUMENT_NODE) {
      this._hoveredElement = null;
      this._updateModelForHoveredElement();
    }
  }
  onFocus(event) {
    this._onFocus(true);
  }
  onInput(event) {
    const target = this._recorder.deepEventTarget(event);
    if (target.nodeName === "INPUT" && target.type.toLowerCase() === "file") {
      this._recorder.recordAction({
        name: "setInputFiles",
        selector: this._activeModel.selector,
        signals: [],
        files: [...target.files || []].map((file) => file.name)
      });
      return;
    }
    if (isRangeInput(target)) {
      this._recorder.recordAction({
        name: "fill",
        // must use hoveredModel instead of activeModel for it to work in webkit
        selector: this._hoveredModel.selector,
        signals: [],
        text: target.value
      });
      return;
    }
    if (["INPUT", "TEXTAREA"].includes(target.nodeName) || target.isContentEditable) {
      if (target.nodeName === "INPUT" && ["checkbox", "radio"].includes(target.type.toLowerCase())) {
        return;
      }
      if (this._consumedDueWrongTarget(event))
        return;
      this._recorder.recordAction({
        name: "fill",
        selector: this._activeModel.selector,
        signals: [],
        text: target.isContentEditable ? target.innerText : target.value
      });
    }
    if (target.nodeName === "SELECT") {
      const selectElement = target;
      if (this._actionInProgress(event))
        return;
      this._performAction({
        name: "select",
        selector: this._activeModel.selector,
        options: [...selectElement.selectedOptions].map((option) => option.value),
        signals: []
      });
    }
  }
  onKeyDown(event) {
    if (!this._shouldGenerateKeyPressFor(event))
      return;
    if (this._actionInProgress(event)) {
      this._expectProgrammaticKeyUp = true;
      return;
    }
    if (this._consumedDueWrongTarget(event))
      return;
    if (event.key === " ") {
      const checkbox = asCheckbox(this._recorder.deepEventTarget(event));
      if (checkbox) {
        this._performAction({
          name: checkbox.checked ? "uncheck" : "check",
          selector: this._activeModel.selector,
          signals: []
        });
        return;
      }
    }
    this._performAction({
      name: "press",
      selector: this._activeModel.selector,
      signals: [],
      key: event.key,
      modifiers: modifiersForEvent(event)
    });
  }
  onKeyUp(event) {
    if (!this._shouldGenerateKeyPressFor(event))
      return;
    if (!this._expectProgrammaticKeyUp) {
      consumeEvent(event);
      return;
    }
    this._expectProgrammaticKeyUp = false;
  }
  onScroll(event) {
    this._hoveredModel = null;
    this._hoveredElement = null;
    this._recorder.updateHighlight(null, false);
  }
  _onFocus(userGesture) {
    const activeElement = deepActiveElement(this._recorder.document);
    if (userGesture && activeElement === this._recorder.document.body)
      return;
    const result = activeElement ? this._recorder.injectedScript.generateSelector(activeElement, { testIdAttributeName: this._recorder.state.testIdAttributeName }) : null;
    this._activeModel = result && result.selector ? result : null;
    if (userGesture)
      this._hoveredElement = activeElement;
    this._updateModelForHoveredElement();
  }
  _shouldIgnoreMouseEvent(event) {
    const target = this._recorder.deepEventTarget(event);
    const nodeName = target.nodeName;
    if (nodeName === "SELECT" || nodeName === "OPTION")
      return true;
    if (nodeName === "INPUT" && ["date", "range"].includes(target.type))
      return true;
    return false;
  }
  _actionInProgress(event) {
    if (this._performingAction)
      return true;
    consumeEvent(event);
    return false;
  }
  _consumedDueToNoModel(event, model) {
    if (model)
      return false;
    consumeEvent(event);
    return true;
  }
  _consumedDueWrongTarget(event) {
    if (this._activeModel && this._activeModel.elements[0] === this._recorder.deepEventTarget(event))
      return false;
    consumeEvent(event);
    return true;
  }
  _performAction(action) {
    this._hoveredElement = null;
    this._hoveredModel = null;
    this._activeModel = null;
    this._recorder.updateHighlight(null, false);
    this._performingAction = true;
    void this._recorder.performAction(action).then(() => {
      this._performingAction = false;
      this._onFocus(false);
      if (this._recorder.injectedScript.isUnderTest) {
        console.error("Action performed for test: " + JSON.stringify({
          // eslint-disable-line no-console
          hovered: this._hoveredModel ? this._hoveredModel.selector : null,
          active: this._activeModel ? this._activeModel.selector : null
        }));
      }
    });
  }
  _shouldGenerateKeyPressFor(event) {
    if (event.key === "Enter" && (this._recorder.deepEventTarget(event).nodeName === "TEXTAREA" || this._recorder.deepEventTarget(event).isContentEditable))
      return false;
    if (["Backspace", "Delete", "AltGraph"].includes(event.key))
      return false;
    if (event.key === "@" && event.code === "KeyL")
      return false;
    if (navigator.platform.includes("Mac")) {
      if (event.key === "v" && event.metaKey)
        return false;
    } else {
      if (event.key === "v" && event.ctrlKey)
        return false;
      if (event.key === "Insert" && event.shiftKey)
        return false;
    }
    if (["Shift", "Control", "Meta", "Alt", "Process"].includes(event.key))
      return false;
    const hasModifier = event.ctrlKey || event.altKey || event.metaKey;
    if (event.key.length === 1 && !hasModifier)
      return !!asCheckbox(this._recorder.deepEventTarget(event));
    return true;
  }
  _updateModelForHoveredElement() {
    if (!this._hoveredElement || !this._hoveredElement.isConnected) {
      this._hoveredModel = null;
      this._hoveredElement = null;
      this._recorder.updateHighlight(null, true);
      return;
    }
    const { selector, elements } = this._recorder.injectedScript.generateSelector(this._hoveredElement, { testIdAttributeName: this._recorder.state.testIdAttributeName });
    if (this._hoveredModel && this._hoveredModel.selector === selector)
      return;
    this._hoveredModel = selector ? { selector, elements, color: "#dc6f6f7f" } : null;
    this._recorder.updateHighlight(this._hoveredModel, true);
  }
};
var TextAssertionTool = class {
  constructor(recorder, kind) {
    this._hoverHighlight = null;
    this._action = null;
    this._textCache = /* @__PURE__ */ new Map();
    this._recorder = recorder;
    this._kind = kind;
    this._dialog = new Dialog(recorder);
  }
  cursor() {
    return "pointer";
  }
  cleanup() {
    this._dialog.close();
    this._hoverHighlight = null;
  }
  onClick(event) {
    consumeEvent(event);
    if (this._kind === "value") {
      this._commitAssertValue();
    } else {
      if (!this._dialog.isShowing())
        this._showDialog();
    }
  }
  onMouseDown(event) {
    const target = this._recorder.deepEventTarget(event);
    if (this._elementHasValue(target))
      event.preventDefault();
  }
  onPointerUp(event) {
    var _a;
    const target = (_a = this._hoverHighlight) == null ? void 0 : _a.elements[0];
    if (this._kind === "value" && target && (target.nodeName === "INPUT" || target.nodeName === "SELECT") && target.disabled) {
      this._commitAssertValue();
    }
  }
  onMouseMove(event) {
    var _a;
    if (this._dialog.isShowing())
      return;
    const target = this._recorder.deepEventTarget(event);
    if (((_a = this._hoverHighlight) == null ? void 0 : _a.elements[0]) === target)
      return;
    if (this._kind === "text")
      this._hoverHighlight = this._recorder.injectedScript.utils.elementText(this._textCache, target).full ? { elements: [target], selector: "" } : null;
    else
      this._hoverHighlight = this._elementHasValue(target) ? this._recorder.injectedScript.generateSelector(target, { testIdAttributeName: this._recorder.state.testIdAttributeName }) : null;
    if (this._hoverHighlight)
      this._hoverHighlight.color = "#8acae480";
    this._recorder.updateHighlight(this._hoverHighlight, true);
  }
  onKeyDown(event) {
    if (event.key === "Escape")
      this._recorder.setMode("recording");
    consumeEvent(event);
  }
  onScroll(event) {
    this._recorder.updateHighlight(this._hoverHighlight, false);
  }
  _elementHasValue(element) {
    return element.nodeName === "TEXTAREA" || element.nodeName === "SELECT" || element.nodeName === "INPUT" && !["button", "image", "reset", "submit"].includes(element.type);
  }
  _generateAction() {
    var _a;
    this._textCache.clear();
    const target = (_a = this._hoverHighlight) == null ? void 0 : _a.elements[0];
    if (!target)
      return null;
    if (this._kind === "value") {
      if (!this._elementHasValue(target))
        return null;
      const { selector } = this._recorder.injectedScript.generateSelector(target, { testIdAttributeName: this._recorder.state.testIdAttributeName });
      if (target.nodeName === "INPUT" && ["checkbox", "radio"].includes(target.type.toLowerCase())) {
        return {
          name: "assertChecked",
          selector,
          signals: [],
          // Interestingly, inputElement.checked is reversed inside this event handler.
          checked: !target.checked
        };
      } else {
        return {
          name: "assertValue",
          selector,
          signals: [],
          value: target.value
        };
      }
    } else {
      this._hoverHighlight = this._recorder.injectedScript.generateSelector(target, { testIdAttributeName: this._recorder.state.testIdAttributeName, forTextExpect: true });
      this._hoverHighlight.color = "#8acae480";
      this._recorder.updateHighlight(this._hoverHighlight, true);
      return {
        name: "assertText",
        selector: this._hoverHighlight.selector,
        signals: [],
        text: this._recorder.injectedScript.utils.elementText(this._textCache, target).normalized,
        substring: true
      };
    }
  }
  _renderValue(action) {
    if ((action == null ? void 0 : action.name) === "assertText")
      return this._recorder.injectedScript.utils.normalizeWhiteSpace(action.text);
    if ((action == null ? void 0 : action.name) === "assertChecked")
      return String(action.checked);
    if ((action == null ? void 0 : action.name) === "assertValue")
      return action.value;
    return "";
  }
  _commit() {
    if (!this._action || !this._dialog.isShowing())
      return;
    this._dialog.close();
    this._recorder.recordAction(this._action);
    this._recorder.setMode("recording");
  }
  _showDialog() {
    var _a;
    if (!((_a = this._hoverHighlight) == null ? void 0 : _a.elements[0]))
      return;
    this._action = this._generateAction();
    if (!this._action || this._action.name !== "assertText")
      return;
    const action = this._action;
    const textElement = this._recorder.document.createElement("textarea");
    textElement.setAttribute("spellcheck", "false");
    textElement.value = this._renderValue(this._action);
    textElement.classList.add("text-editor");
    const updateAndValidate = () => {
      var _a2;
      const newValue = this._recorder.injectedScript.utils.normalizeWhiteSpace(textElement.value);
      const target = (_a2 = this._hoverHighlight) == null ? void 0 : _a2.elements[0];
      if (!target)
        return;
      action.text = newValue;
      const targetText = this._recorder.injectedScript.utils.elementText(this._textCache, target).normalized;
      const matches = newValue && targetText.includes(newValue);
      textElement.classList.toggle("does-not-match", !matches);
    };
    textElement.addEventListener("input", updateAndValidate);
    const label = "Assert that element contains text";
    const dialogElement = this._dialog.show({
      label,
      body: textElement,
      onCommit: () => this._commit()
    });
    const position = this._recorder.highlight.tooltipPosition(this._recorder.highlight.firstBox(), dialogElement);
    this._dialog.moveTo(position.anchorTop, position.anchorLeft);
    textElement.focus();
  }
  _commitAssertValue() {
    var _a;
    if (this._kind !== "value")
      return;
    const action = this._generateAction();
    if (!action)
      return;
    this._recorder.recordAction(action);
    this._recorder.setMode("recording");
    (_a = this._recorder.overlay) == null ? void 0 : _a.flashToolSucceeded("assertingValue");
  }
};
var Overlay = class {
  constructor(recorder) {
    this._listeners = [];
    this._offsetX = 0;
    this._measure = { width: 0, height: 0 };
    this._recorder = recorder;
    const document = this._recorder.document;
    this._overlayElement = document.createElement("x-pw-overlay");
    this._overlayElement.appendChild(createSvgElement(this._recorder.document, clipPaths_default));
    const toolsListElement = document.createElement("x-pw-tools-list");
    this._overlayElement.appendChild(toolsListElement);
    this._dragHandle = document.createElement("x-pw-tool-gripper");
    this._dragHandle.appendChild(document.createElement("x-div"));
    toolsListElement.appendChild(this._dragHandle);
    this._recordToggle = this._recorder.document.createElement("x-pw-tool-item");
    this._recordToggle.title = "Record";
    this._recordToggle.classList.add("record");
    this._recordToggle.appendChild(this._recorder.document.createElement("x-div"));
    toolsListElement.appendChild(this._recordToggle);
    this._pickLocatorToggle = this._recorder.document.createElement("x-pw-tool-item");
    this._pickLocatorToggle.title = "Pick locator";
    this._pickLocatorToggle.classList.add("pick-locator");
    this._pickLocatorToggle.appendChild(this._recorder.document.createElement("x-div"));
    toolsListElement.appendChild(this._pickLocatorToggle);
    this._assertVisibilityToggle = this._recorder.document.createElement("x-pw-tool-item");
    this._assertVisibilityToggle.title = "Assert visibility";
    this._assertVisibilityToggle.classList.add("visibility");
    this._assertVisibilityToggle.appendChild(this._recorder.document.createElement("x-div"));
    toolsListElement.appendChild(this._assertVisibilityToggle);
    this._assertTextToggle = this._recorder.document.createElement("x-pw-tool-item");
    this._assertTextToggle.title = "Assert text";
    this._assertTextToggle.classList.add("text");
    this._assertTextToggle.appendChild(this._recorder.document.createElement("x-div"));
    toolsListElement.appendChild(this._assertTextToggle);
    this._assertValuesToggle = this._recorder.document.createElement("x-pw-tool-item");
    this._assertValuesToggle.title = "Assert value";
    this._assertValuesToggle.classList.add("value");
    this._assertValuesToggle.appendChild(this._recorder.document.createElement("x-div"));
    toolsListElement.appendChild(this._assertValuesToggle);
    this._updateVisualPosition();
    this._refreshListeners();
  }
  _refreshListeners() {
    removeEventListeners(this._listeners);
    this._listeners = [
      addEventListener(this._dragHandle, "mousedown", (event) => {
        this._dragState = { offsetX: this._offsetX, dragStart: { x: event.clientX, y: 0 } };
      }),
      addEventListener(this._recordToggle, "click", () => {
        this._recorder.setMode(this._recorder.state.mode === "none" || this._recorder.state.mode === "standby" || this._recorder.state.mode === "inspecting" ? "recording" : "standby");
      }),
      addEventListener(this._pickLocatorToggle, "click", () => {
        const newMode = {
          "inspecting": "standby",
          "none": "inspecting",
          "standby": "inspecting",
          "recording": "recording-inspecting",
          "recording-inspecting": "recording",
          "assertingText": "recording-inspecting",
          "assertingVisibility": "recording-inspecting",
          "assertingValue": "recording-inspecting"
        };
        this._recorder.setMode(newMode[this._recorder.state.mode]);
      }),
      addEventListener(this._assertVisibilityToggle, "click", () => {
        if (!this._assertVisibilityToggle.classList.contains("disabled"))
          this._recorder.setMode(this._recorder.state.mode === "assertingVisibility" ? "recording" : "assertingVisibility");
      }),
      addEventListener(this._assertTextToggle, "click", () => {
        if (!this._assertTextToggle.classList.contains("disabled"))
          this._recorder.setMode(this._recorder.state.mode === "assertingText" ? "recording" : "assertingText");
      }),
      addEventListener(this._assertValuesToggle, "click", () => {
        if (!this._assertValuesToggle.classList.contains("disabled"))
          this._recorder.setMode(this._recorder.state.mode === "assertingValue" ? "recording" : "assertingValue");
      })
    ];
  }
  install() {
    this._recorder.highlight.appendChild(this._overlayElement);
    this._refreshListeners();
    this._updateVisualPosition();
  }
  contains(element) {
    return this._recorder.injectedScript.utils.isInsideScope(this._overlayElement, element);
  }
  setUIState(state) {
    this._recordToggle.classList.toggle("active", state.mode === "recording" || state.mode === "assertingText" || state.mode === "assertingVisibility" || state.mode === "assertingValue" || state.mode === "recording-inspecting");
    this._pickLocatorToggle.classList.toggle("active", state.mode === "inspecting" || state.mode === "recording-inspecting");
    this._assertVisibilityToggle.classList.toggle("active", state.mode === "assertingVisibility");
    this._assertVisibilityToggle.classList.toggle("disabled", state.mode === "none" || state.mode === "standby" || state.mode === "inspecting");
    this._assertTextToggle.classList.toggle("active", state.mode === "assertingText");
    this._assertTextToggle.classList.toggle("disabled", state.mode === "none" || state.mode === "standby" || state.mode === "inspecting");
    this._assertValuesToggle.classList.toggle("active", state.mode === "assertingValue");
    this._assertValuesToggle.classList.toggle("disabled", state.mode === "none" || state.mode === "standby" || state.mode === "inspecting");
    if (this._offsetX !== state.overlay.offsetX) {
      this._offsetX = state.overlay.offsetX;
      this._updateVisualPosition();
    }
    if (state.mode === "none")
      this._hideOverlay();
    else
      this._showOverlay();
  }
  flashToolSucceeded(tool) {
    const element = tool === "assertingVisibility" ? this._assertVisibilityToggle : this._assertValuesToggle;
    element.classList.add("succeeded");
    this._recorder.injectedScript.builtinSetTimeout(() => element.classList.remove("succeeded"), 2e3);
  }
  _hideOverlay() {
    this._overlayElement.setAttribute("hidden", "true");
  }
  _showOverlay() {
    if (!this._overlayElement.hasAttribute("hidden"))
      return;
    this._overlayElement.removeAttribute("hidden");
    this._updateVisualPosition();
  }
  _updateVisualPosition() {
    this._measure = this._overlayElement.getBoundingClientRect();
    this._overlayElement.style.left = (this._recorder.injectedScript.window.innerWidth - this._measure.width) / 2 + this._offsetX + "px";
  }
  onMouseMove(event) {
    if (!event.buttons) {
      this._dragState = void 0;
      return false;
    }
    if (this._dragState) {
      this._offsetX = this._dragState.offsetX + event.clientX - this._dragState.dragStart.x;
      const halfGapSize = (this._recorder.injectedScript.window.innerWidth - this._measure.width) / 2 - 10;
      this._offsetX = Math.max(-halfGapSize, Math.min(halfGapSize, this._offsetX));
      this._updateVisualPosition();
      this._recorder.setOverlayState({ offsetX: this._offsetX });
      consumeEvent(event);
      return true;
    }
    return false;
  }
  onMouseUp(event) {
    if (this._dragState) {
      consumeEvent(event);
      return true;
    }
    return false;
  }
  onClick(event) {
    if (this._dragState) {
      this._dragState = void 0;
      consumeEvent(event);
      return true;
    }
    return false;
  }
};
var Recorder = class {
  constructor(injectedScript) {
    this._listeners = [];
    this._actionSelectorModel = null;
    this.state = {
      mode: "none",
      testIdAttributeName: "data-testid",
      language: "javascript",
      overlay: { offsetX: 0 }
    };
    this._delegate = {};
    this.document = injectedScript.document;
    this.injectedScript = injectedScript;
    this.highlight = injectedScript.createHighlight();
    this._tools = {
      "none": new NoneTool(),
      "standby": new NoneTool(),
      "inspecting": new InspectTool(this, false),
      "recording": new RecordActionTool(this),
      "recording-inspecting": new InspectTool(this, false),
      "assertingText": new TextAssertionTool(this, "text"),
      "assertingVisibility": new InspectTool(this, true),
      "assertingValue": new TextAssertionTool(this, "value")
    };
    this._currentTool = this._tools.none;
    if (injectedScript.window.top === injectedScript.window) {
      this.overlay = new Overlay(this);
      this.overlay.setUIState(this.state);
    }
    this._stylesheet = new injectedScript.window.CSSStyleSheet();
    this._stylesheet.replaceSync(\`
      body[data-pw-cursor=pointer] *, body[data-pw-cursor=pointer] *::after { cursor: pointer !important; }
      body[data-pw-cursor=text] *, body[data-pw-cursor=text] *::after { cursor: text !important; }
    \`);
    this.installListeners();
    injectedScript.utils.cacheNormalizedWhitespaces();
    if (injectedScript.isUnderTest)
      console.error("Recorder script ready for test");
  }
  installListeners() {
    var _a;
    removeEventListeners(this._listeners);
    this._listeners = [
      addEventListener(this.document, "click", (event) => this._onClick(event), true),
      addEventListener(this.document, "auxclick", (event) => this._onClick(event), true),
      addEventListener(this.document, "contextmenu", (event) => this._onContextMenu(event), true),
      addEventListener(this.document, "dragstart", (event) => this._onDragStart(event), true),
      addEventListener(this.document, "input", (event) => this._onInput(event), true),
      addEventListener(this.document, "keydown", (event) => this._onKeyDown(event), true),
      addEventListener(this.document, "keyup", (event) => this._onKeyUp(event), true),
      addEventListener(this.document, "pointerdown", (event) => this._onPointerDown(event), true),
      addEventListener(this.document, "pointerup", (event) => this._onPointerUp(event), true),
      addEventListener(this.document, "mousedown", (event) => this._onMouseDown(event), true),
      addEventListener(this.document, "mouseup", (event) => this._onMouseUp(event), true),
      addEventListener(this.document, "mousemove", (event) => this._onMouseMove(event), true),
      addEventListener(this.document, "mouseleave", (event) => this._onMouseLeave(event), true),
      addEventListener(this.document, "mouseenter", (event) => this._onMouseEnter(event), true),
      addEventListener(this.document, "focus", (event) => this._onFocus(event), true),
      addEventListener(this.document, "scroll", (event) => this._onScroll(event), true)
    ];
    this.highlight.install();
    (_a = this.overlay) == null ? void 0 : _a.install();
    this.document.adoptedStyleSheets.push(this._stylesheet);
  }
  _switchCurrentTool() {
    var _a, _b, _c;
    const newTool = this._tools[this.state.mode];
    if (newTool === this._currentTool)
      return;
    (_b = (_a = this._currentTool).cleanup) == null ? void 0 : _b.call(_a);
    this.clearHighlight();
    this._currentTool = newTool;
    (_c = this.injectedScript.document.body) == null ? void 0 : _c.setAttribute("data-pw-cursor", newTool.cursor());
  }
  setUIState(state, delegate) {
    var _a, _b, _c, _d;
    this._delegate = delegate;
    if (state.actionPoint && this.state.actionPoint && state.actionPoint.x === this.state.actionPoint.x && state.actionPoint.y === this.state.actionPoint.y) {
    } else if (!state.actionPoint && !this.state.actionPoint) {
    } else {
      if (state.actionPoint)
        this.highlight.showActionPoint(state.actionPoint.x, state.actionPoint.y);
      else
        this.highlight.hideActionPoint();
    }
    this.state = state;
    this.highlight.setLanguage(state.language);
    this._switchCurrentTool();
    (_a = this.overlay) == null ? void 0 : _a.setUIState(state);
    if (((_b = this._actionSelectorModel) == null ? void 0 : _b.selector) && !((_c = this._actionSelectorModel) == null ? void 0 : _c.elements.length))
      this._actionSelectorModel = null;
    if (state.actionSelector !== ((_d = this._actionSelectorModel) == null ? void 0 : _d.selector))
      this._actionSelectorModel = state.actionSelector ? querySelector(this.injectedScript, state.actionSelector, this.document) : null;
    if (this.state.mode === "none" || this.state.mode === "standby")
      this.updateHighlight(this._actionSelectorModel, false);
  }
  clearHighlight() {
    var _a, _b;
    (_b = (_a = this._currentTool).cleanup) == null ? void 0 : _b.call(_a);
    this.updateHighlight(null, false);
  }
  _onClick(event) {
    var _a, _b, _c;
    if (!event.isTrusted)
      return;
    if ((_a = this.overlay) == null ? void 0 : _a.onClick(event))
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_c = (_b = this._currentTool).onClick) == null ? void 0 : _c.call(_b, event);
  }
  _onContextMenu(event) {
    var _a, _b;
    if (!event.isTrusted)
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_b = (_a = this._currentTool).onContextMenu) == null ? void 0 : _b.call(_a, event);
  }
  _onDragStart(event) {
    var _a, _b;
    if (!event.isTrusted)
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_b = (_a = this._currentTool).onDragStart) == null ? void 0 : _b.call(_a, event);
  }
  _onPointerDown(event) {
    var _a, _b;
    if (!event.isTrusted)
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_b = (_a = this._currentTool).onPointerDown) == null ? void 0 : _b.call(_a, event);
  }
  _onPointerUp(event) {
    var _a, _b;
    if (!event.isTrusted)
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_b = (_a = this._currentTool).onPointerUp) == null ? void 0 : _b.call(_a, event);
  }
  _onMouseDown(event) {
    var _a, _b;
    if (!event.isTrusted)
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_b = (_a = this._currentTool).onMouseDown) == null ? void 0 : _b.call(_a, event);
  }
  _onMouseUp(event) {
    var _a, _b, _c;
    if (!event.isTrusted)
      return;
    if ((_a = this.overlay) == null ? void 0 : _a.onMouseUp(event))
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_c = (_b = this._currentTool).onMouseUp) == null ? void 0 : _c.call(_b, event);
  }
  _onMouseMove(event) {
    var _a, _b, _c;
    if (!event.isTrusted)
      return;
    if ((_a = this.overlay) == null ? void 0 : _a.onMouseMove(event))
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_c = (_b = this._currentTool).onMouseMove) == null ? void 0 : _c.call(_b, event);
  }
  _onMouseEnter(event) {
    var _a, _b;
    if (!event.isTrusted)
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_b = (_a = this._currentTool).onMouseEnter) == null ? void 0 : _b.call(_a, event);
  }
  _onMouseLeave(event) {
    var _a, _b;
    if (!event.isTrusted)
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_b = (_a = this._currentTool).onMouseLeave) == null ? void 0 : _b.call(_a, event);
  }
  _onFocus(event) {
    var _a, _b;
    if (!event.isTrusted)
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_b = (_a = this._currentTool).onFocus) == null ? void 0 : _b.call(_a, event);
  }
  _onScroll(event) {
    var _a, _b;
    if (!event.isTrusted)
      return;
    this.highlight.hideActionPoint();
    (_b = (_a = this._currentTool).onScroll) == null ? void 0 : _b.call(_a, event);
  }
  _onInput(event) {
    var _a, _b;
    if (this._ignoreOverlayEvent(event))
      return;
    (_b = (_a = this._currentTool).onInput) == null ? void 0 : _b.call(_a, event);
  }
  _onKeyDown(event) {
    var _a, _b;
    if (!event.isTrusted)
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_b = (_a = this._currentTool).onKeyDown) == null ? void 0 : _b.call(_a, event);
  }
  _onKeyUp(event) {
    var _a, _b;
    if (!event.isTrusted)
      return;
    if (this._ignoreOverlayEvent(event))
      return;
    (_b = (_a = this._currentTool).onKeyUp) == null ? void 0 : _b.call(_a, event);
  }
  updateHighlight(model, userGesture) {
    var _a, _b;
    let tooltipText = model == null ? void 0 : model.tooltipText;
    if (tooltipText === void 0 && !(model == null ? void 0 : model.tooltipList) && (model == null ? void 0 : model.selector))
      tooltipText = this.injectedScript.utils.asLocator(this.state.language, model.selector);
    this.highlight.updateHighlight((model == null ? void 0 : model.elements) || [], { ...model, tooltipText });
    if (userGesture)
      (_b = (_a = this._delegate).highlightUpdated) == null ? void 0 : _b.call(_a);
  }
  _ignoreOverlayEvent(event) {
    return event.composedPath().some((e) => {
      const nodeName = e.nodeName || "";
      return nodeName.toLowerCase() === "x-pw-glass";
    });
  }
  deepEventTarget(event) {
    var _a;
    for (const element of event.composedPath()) {
      if (!((_a = this.overlay) == null ? void 0 : _a.contains(element)))
        return element;
    }
    return event.composedPath()[0];
  }
  setMode(mode) {
    var _a, _b;
    void ((_b = (_a = this._delegate).setMode) == null ? void 0 : _b.call(_a, mode));
  }
  async performAction(action) {
    var _a, _b;
    await ((_b = (_a = this._delegate).performAction) == null ? void 0 : _b.call(_a, action).catch(() => {
    }));
  }
  recordAction(action) {
    var _a, _b;
    void ((_b = (_a = this._delegate).recordAction) == null ? void 0 : _b.call(_a, action));
  }
  setOverlayState(state) {
    var _a, _b;
    void ((_b = (_a = this._delegate).setOverlayState) == null ? void 0 : _b.call(_a, state));
  }
  setSelector(selector) {
    var _a, _b;
    void ((_b = (_a = this._delegate).setSelector) == null ? void 0 : _b.call(_a, selector));
  }
};
var Dialog = class {
  constructor(recorder) {
    this._dialogElement = null;
    this._recorder = recorder;
  }
  isShowing() {
    return !!this._dialogElement;
  }
  show(options) {
    const acceptButton = this._recorder.document.createElement("x-pw-tool-item");
    acceptButton.title = "Accept";
    acceptButton.classList.add("accept");
    acceptButton.appendChild(this._recorder.document.createElement("x-div"));
    acceptButton.addEventListener("click", () => options.onCommit());
    const cancelButton = this._recorder.document.createElement("x-pw-tool-item");
    cancelButton.title = "Close";
    cancelButton.classList.add("cancel");
    cancelButton.appendChild(this._recorder.document.createElement("x-div"));
    cancelButton.addEventListener("click", () => {
      var _a;
      this.close();
      (_a = options.onCancel) == null ? void 0 : _a.call(options);
    });
    this._dialogElement = this._recorder.document.createElement("x-pw-dialog");
    this._keyboardListener = (event) => {
      var _a;
      if (event.key === "Escape") {
        this.close();
        (_a = options.onCancel) == null ? void 0 : _a.call(options);
        return;
      }
      if (event.key === "Enter" && (event.ctrlKey || event.metaKey)) {
        if (this._dialogElement)
          options.onCommit();
        return;
      }
    };
    this._recorder.document.addEventListener("keydown", this._keyboardListener, true);
    const toolbarElement = this._recorder.document.createElement("x-pw-tools-list");
    const labelElement = this._recorder.document.createElement("label");
    labelElement.textContent = options.label;
    toolbarElement.appendChild(labelElement);
    toolbarElement.appendChild(this._recorder.document.createElement("x-spacer"));
    toolbarElement.appendChild(acceptButton);
    toolbarElement.appendChild(cancelButton);
    this._dialogElement.appendChild(toolbarElement);
    const bodyElement = this._recorder.document.createElement("x-pw-dialog-body");
    bodyElement.appendChild(options.body);
    this._dialogElement.appendChild(bodyElement);
    this._recorder.highlight.appendChild(this._dialogElement);
    return this._dialogElement;
  }
  moveTo(top, left) {
    if (!this._dialogElement)
      return;
    this._dialogElement.style.top = top + "px";
    this._dialogElement.style.left = left + "px";
  }
  close() {
    if (!this._dialogElement)
      return;
    this._dialogElement.remove();
    this._recorder.document.removeEventListener("keydown", this._keyboardListener);
    this._dialogElement = null;
  }
};
function deepActiveElement(document) {
  let activeElement = document.activeElement;
  while (activeElement && activeElement.shadowRoot && activeElement.shadowRoot.activeElement)
    activeElement = activeElement.shadowRoot.activeElement;
  return activeElement;
}
function modifiersForEvent(event) {
  return (event.altKey ? 1 : 0) | (event.ctrlKey ? 2 : 0) | (event.metaKey ? 4 : 0) | (event.shiftKey ? 8 : 0);
}
function buttonForEvent(event) {
  switch (event.which) {
    case 1:
      return "left";
    case 2:
      return "middle";
    case 3:
      return "right";
  }
  return "left";
}
function positionForEvent(event) {
  const targetElement = event.target;
  if (targetElement.nodeName !== "CANVAS")
    return;
  return {
    x: event.offsetX,
    y: event.offsetY
  };
}
function consumeEvent(e) {
  e.preventDefault();
  e.stopPropagation();
  e.stopImmediatePropagation();
}
function asCheckbox(node) {
  if (!node || node.nodeName !== "INPUT")
    return null;
  const inputElement = node;
  return ["checkbox", "radio"].includes(inputElement.type) ? inputElement : null;
}
function isRangeInput(node) {
  if (!node || node.nodeName !== "INPUT")
    return false;
  const inputElement = node;
  return inputElement.type.toLowerCase() === "range";
}
function addEventListener(target, eventName, listener, useCapture) {
  target.addEventListener(eventName, listener, useCapture);
  const remove = () => {
    target.removeEventListener(eventName, listener, useCapture);
  };
  return remove;
}
function removeEventListeners(listeners) {
  for (const listener of listeners)
    listener();
  listeners.splice(0, listeners.length);
}
function querySelector(injectedScript, selector, ownerDocument) {
  try {
    const parsedSelector = injectedScript.parseSelector(selector);
    return {
      selector,
      elements: injectedScript.querySelectorAll(parsedSelector, ownerDocument)
    };
  } catch (e) {
    return {
      selector,
      elements: []
    };
  }
}
function createSvgElement(doc, { tagName, attrs, children }) {
  const elem = doc.createElementNS("http://www.w3.org/2000/svg", tagName);
  if (attrs) {
    for (const [k, v] of Object.entries(attrs))
      elem.setAttribute(k, v);
  }
  if (children) {
    for (const c of children)
      elem.appendChild(createSvgElement(doc, c));
  }
  return elem;
}
var PollingRecorder = class {
  constructor(injectedScript) {
    this._recorder = new Recorder(injectedScript);
    this._embedder = injectedScript.window;
    injectedScript.onGlobalListenersRemoved.add(() => this._recorder.installListeners());
    const refreshOverlay = () => {
      this._pollRecorderMode().catch((e) => console.log(e));
    };
    this._embedder.__pw_refreshOverlay = refreshOverlay;
    refreshOverlay();
  }
  async _pollRecorderMode() {
    const pollPeriod = 1e3;
    if (this._pollRecorderModeTimer)
      clearTimeout(this._pollRecorderModeTimer);
    const state = await this._embedder.__pw_recorderState().catch(() => {
    });
    if (!state) {
      this._pollRecorderModeTimer = this._recorder.injectedScript.builtinSetTimeout(() => this._pollRecorderMode(), pollPeriod);
      return;
    }
    const win = this._recorder.document.defaultView;
    if (win.top !== win) {
      state.actionPoint = void 0;
    }
    this._recorder.setUIState(state, this);
    this._pollRecorderModeTimer = this._recorder.injectedScript.builtinSetTimeout(() => this._pollRecorderMode(), pollPeriod);
  }
  async performAction(action, simpleDomNode) {
    await this._embedder.__pw_recorderPerformAction(action, simpleDomNode);
  }
  async recordAction(action, simpleDomNode) {
    await this._embedder.__pw_recorderRecordAction(action, simpleDomNode);
  }
  async setSelector(selector) {
    await this._embedder.__pw_recorderSetSelector(selector);
  }
  async setMode(mode) {
    await this._embedder.__pw_recorderSetMode(mode);
  }
  async setOverlayState(state) {
    await this._embedder.__pw_recorderSetOverlayState(state);
  }
};
var recorder_default = PollingRecorder;
`});function Qp(i,e,t){let n=e.generateHeader(t),r=e.generateFooter(t.saveStorage),s=i.map(l=>e.generateAction(l)).filter(Boolean),o=[n,...s,r].join(`
`);return{header:n,footer:r,actionTexts:s,text:o}}function Xr(i,e){let t={};for(let n in e)JSON.stringify(i[n])!==JSON.stringify(e[n])&&(t[n]=e[n]);return t}function Wn(i){let e,t,n;for(let r of i.signals)r.name==="popup"?e=r:r.name==="download"?t=r:r.name==="dialog"&&(n=r);return{popup:e,download:t,dialog:n}}function Dt(i){let e=[];return i&1&&e.push("Alt"),i&2&&e.push("ControlOrMeta"),i&4&&e.push("ControlOrMeta"),i&8&&e.push("Shift"),e}function Jt(i){let e=Dt(i.modifiers),t={};return i.button!=="left"&&(t.button=i.button),e.length&&(t.modifiers=e),i.clickCount>2&&(t.clickCount=i.clickCount),i.position&&(t.position=i.position),t}var pr=x(()=>{});var Zp,Yp=x(()=>{Zp={"Blackberry PlayBook":{userAgent:"Mozilla/5.0 (PlayBook; U; RIM Tablet OS 2.1.0; en-US) AppleWebKit/536.2+ (KHTML like Gecko) Version/18.0 Safari/536.2+",viewport:{width:600,height:1024},deviceScaleFactor:1,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Blackberry PlayBook landscape":{userAgent:"Mozilla/5.0 (PlayBook; U; RIM Tablet OS 2.1.0; en-US) AppleWebKit/536.2+ (KHTML like Gecko) Version/18.0 Safari/536.2+",viewport:{width:1024,height:600},deviceScaleFactor:1,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"BlackBerry Z30":{userAgent:"Mozilla/5.0 (BB10; Touch) AppleWebKit/537.10+ (KHTML, like Gecko) Version/18.0 Mobile Safari/537.10+",viewport:{width:360,height:640},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"BlackBerry Z30 landscape":{userAgent:"Mozilla/5.0 (BB10; Touch) AppleWebKit/537.10+ (KHTML, like Gecko) Version/18.0 Mobile Safari/537.10+",viewport:{width:640,height:360},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Galaxy Note 3":{userAgent:"Mozilla/5.0 (Linux; U; Android 4.3; en-us; SM-N900T Build/JSS15J) AppleWebKit/534.30 (KHTML, like Gecko) Version/18.0 Mobile Safari/534.30",viewport:{width:360,height:640},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Galaxy Note 3 landscape":{userAgent:"Mozilla/5.0 (Linux; U; Android 4.3; en-us; SM-N900T Build/JSS15J) AppleWebKit/534.30 (KHTML, like Gecko) Version/18.0 Mobile Safari/534.30",viewport:{width:640,height:360},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Galaxy Note II":{userAgent:"Mozilla/5.0 (Linux; U; Android 4.1; en-us; GT-N7100 Build/JRO03C) AppleWebKit/534.30 (KHTML, like Gecko) Version/18.0 Mobile Safari/534.30",viewport:{width:360,height:640},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Galaxy Note II landscape":{userAgent:"Mozilla/5.0 (Linux; U; Android 4.1; en-us; GT-N7100 Build/JRO03C) AppleWebKit/534.30 (KHTML, like Gecko) Version/18.0 Mobile Safari/534.30",viewport:{width:640,height:360},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Galaxy S III":{userAgent:"Mozilla/5.0 (Linux; U; Android 4.0; en-us; GT-I9300 Build/IMM76D) AppleWebKit/534.30 (KHTML, like Gecko) Version/18.0 Mobile Safari/534.30",viewport:{width:360,height:640},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Galaxy S III landscape":{userAgent:"Mozilla/5.0 (Linux; U; Android 4.0; en-us; GT-I9300 Build/IMM76D) AppleWebKit/534.30 (KHTML, like Gecko) Version/18.0 Mobile Safari/534.30",viewport:{width:640,height:360},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Galaxy S5":{userAgent:"Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:360,height:640},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Galaxy S5 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:640,height:360},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Galaxy S8":{userAgent:"Mozilla/5.0 (Linux; Android 7.0; SM-G950U Build/NRD90M) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:360,height:740},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Galaxy S8 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 7.0; SM-G950U Build/NRD90M) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:740,height:360},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Galaxy S9+":{userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; SM-G965U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:320,height:658},deviceScaleFactor:4.5,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Galaxy S9+ landscape":{userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; SM-G965U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:658,height:320},deviceScaleFactor:4.5,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Galaxy Tab S4":{userAgent:"Mozilla/5.0 (Linux; Android 8.1.0; SM-T837A) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Safari/537.36",viewport:{width:712,height:1138},deviceScaleFactor:2.25,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Galaxy Tab S4 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 8.1.0; SM-T837A) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Safari/537.36",viewport:{width:1138,height:712},deviceScaleFactor:2.25,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"iPad (gen 5)":{userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:768,height:1024},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPad (gen 5) landscape":{userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:1024,height:768},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPad (gen 6)":{userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:768,height:1024},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPad (gen 6) landscape":{userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:1024,height:768},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPad (gen 7)":{userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:810,height:1080},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPad (gen 7) landscape":{userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:1080,height:810},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPad Mini":{userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:768,height:1024},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPad Mini landscape":{userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:1024,height:768},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPad Pro 11":{userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:834,height:1194},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPad Pro 11 landscape":{userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:1194,height:834},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 6":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:667},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 6 landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:667,height:375},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 6 Plus":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:414,height:736},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 6 Plus landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:736,height:414},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 7":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:667},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 7 landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:667,height:375},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 7 Plus":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:414,height:736},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 7 Plus landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:736,height:414},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 8":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:667},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 8 landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:667,height:375},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 8 Plus":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:414,height:736},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 8 Plus landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:736,height:414},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone SE":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/18.0 Mobile/14E304 Safari/602.1",viewport:{width:320,height:568},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone SE landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/18.0 Mobile/14E304 Safari/602.1",viewport:{width:568,height:320},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone X":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:812},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone X landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/18.0 Mobile/15A372 Safari/604.1",viewport:{width:812,height:375},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone XR":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:414,height:896},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone XR landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",viewport:{width:896,height:414},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 11":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:414,height:896},viewport:{width:414,height:715},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 11 landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:414,height:896},viewport:{width:800,height:364},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 11 Pro":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:375,height:812},viewport:{width:375,height:635},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 11 Pro landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:375,height:812},viewport:{width:724,height:325},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 11 Pro Max":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:414,height:896},viewport:{width:414,height:715},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 11 Pro Max landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:414,height:896},viewport:{width:808,height:364},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 12":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:390,height:844},viewport:{width:390,height:664},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 12 landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:390,height:844},viewport:{width:750,height:340},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 12 Pro":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:390,height:844},viewport:{width:390,height:664},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 12 Pro landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:390,height:844},viewport:{width:750,height:340},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 12 Pro Max":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:428,height:926},viewport:{width:428,height:746},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 12 Pro Max landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:428,height:926},viewport:{width:832,height:378},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 12 Mini":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:375,height:812},viewport:{width:375,height:629},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 12 Mini landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:375,height:812},viewport:{width:712,height:325},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 13":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:390,height:844},viewport:{width:390,height:664},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 13 landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:390,height:844},viewport:{width:750,height:342},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 13 Pro":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:390,height:844},viewport:{width:390,height:664},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 13 Pro landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:390,height:844},viewport:{width:750,height:342},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 13 Pro Max":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:428,height:926},viewport:{width:428,height:746},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 13 Pro Max landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:428,height:926},viewport:{width:832,height:380},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 13 Mini":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:375,height:812},viewport:{width:375,height:629},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 13 Mini landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:375,height:812},viewport:{width:712,height:327},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 14":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:390,height:844},viewport:{width:390,height:664},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 14 landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:390,height:844},viewport:{width:750,height:340},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 14 Plus":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:428,height:926},viewport:{width:428,height:746},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 14 Plus landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:428,height:926},viewport:{width:832,height:378},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 14 Pro":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:393,height:852},viewport:{width:393,height:660},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 14 Pro landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:393,height:852},viewport:{width:734,height:343},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 14 Pro Max":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:430,height:932},viewport:{width:430,height:740},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 14 Pro Max landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:430,height:932},viewport:{width:814,height:380},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 15":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:393,height:852},viewport:{width:393,height:659},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 15 landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:393,height:852},viewport:{width:734,height:343},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 15 Plus":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:430,height:932},viewport:{width:430,height:739},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 15 Plus landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:430,height:932},viewport:{width:814,height:380},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 15 Pro":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:393,height:852},viewport:{width:393,height:659},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 15 Pro landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:393,height:852},viewport:{width:734,height:343},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 15 Pro Max":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:430,height:932},viewport:{width:430,height:739},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"iPhone 15 Pro Max landscape":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Mobile/15E148 Safari/604.1",screen:{width:430,height:932},viewport:{width:814,height:380},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Kindle Fire HDX":{userAgent:"Mozilla/5.0 (Linux; U; en-us; KFAPWI Build/JDQ39) AppleWebKit/535.19 (KHTML, like Gecko) Silk/3.13 Safari/535.19 Silk-Accelerated=true",viewport:{width:800,height:1280},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Kindle Fire HDX landscape":{userAgent:"Mozilla/5.0 (Linux; U; en-us; KFAPWI Build/JDQ39) AppleWebKit/535.19 (KHTML, like Gecko) Silk/3.13 Safari/535.19 Silk-Accelerated=true",viewport:{width:1280,height:800},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"LG Optimus L70":{userAgent:"Mozilla/5.0 (Linux; U; Android 4.4.2; en-us; LGMS323 Build/KOT49I.MS32310c) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:384,height:640},deviceScaleFactor:1.25,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"LG Optimus L70 landscape":{userAgent:"Mozilla/5.0 (Linux; U; Android 4.4.2; en-us; LGMS323 Build/KOT49I.MS32310c) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:640,height:384},deviceScaleFactor:1.25,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Microsoft Lumia 550":{userAgent:"Mozilla/5.0 (Windows Phone 10.0; Android 4.2.1; Microsoft; Lumia 550) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36 Edge/14.14263",viewport:{width:640,height:360},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Microsoft Lumia 550 landscape":{userAgent:"Mozilla/5.0 (Windows Phone 10.0; Android 4.2.1; Microsoft; Lumia 550) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36 Edge/14.14263",viewport:{width:360,height:640},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Microsoft Lumia 950":{userAgent:"Mozilla/5.0 (Windows Phone 10.0; Android 4.2.1; Microsoft; Lumia 950) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36 Edge/14.14263",viewport:{width:360,height:640},deviceScaleFactor:4,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Microsoft Lumia 950 landscape":{userAgent:"Mozilla/5.0 (Windows Phone 10.0; Android 4.2.1; Microsoft; Lumia 950) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36 Edge/14.14263",viewport:{width:640,height:360},deviceScaleFactor:4,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 10":{userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 10 Build/MOB31T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Safari/537.36",viewport:{width:800,height:1280},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 10 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 10 Build/MOB31T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Safari/537.36",viewport:{width:1280,height:800},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 4":{userAgent:"Mozilla/5.0 (Linux; Android 4.4.2; Nexus 4 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:384,height:640},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 4 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 4.4.2; Nexus 4 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:640,height:384},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 5":{userAgent:"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:360,height:640},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 5 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:640,height:360},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 5X":{userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 5X Build/OPR4.170623.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:412,height:732},deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 5X landscape":{userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 5X Build/OPR4.170623.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:732,height:412},deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 6":{userAgent:"Mozilla/5.0 (Linux; Android 7.1.1; Nexus 6 Build/N6F26U) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:412,height:732},deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 6 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 7.1.1; Nexus 6 Build/N6F26U) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:732,height:412},deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 6P":{userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 6P Build/OPP3.170518.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:412,height:732},deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 6P landscape":{userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 6P Build/OPP3.170518.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:732,height:412},deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 7":{userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 7 Build/MOB30X) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Safari/537.36",viewport:{width:600,height:960},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nexus 7 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 7 Build/MOB30X) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Safari/537.36",viewport:{width:960,height:600},deviceScaleFactor:2,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nokia Lumia 520":{userAgent:"Mozilla/5.0 (compatible; MSIE 10.0; Windows Phone 8.0; Trident/6.0; IEMobile/10.0; ARM; Touch; NOKIA; Lumia 520)",viewport:{width:320,height:533},deviceScaleFactor:1.5,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nokia Lumia 520 landscape":{userAgent:"Mozilla/5.0 (compatible; MSIE 10.0; Windows Phone 8.0; Trident/6.0; IEMobile/10.0; ARM; Touch; NOKIA; Lumia 520)",viewport:{width:533,height:320},deviceScaleFactor:1.5,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Nokia N9":{userAgent:"Mozilla/5.0 (MeeGo; NokiaN9) AppleWebKit/534.13 (KHTML, like Gecko) NokiaBrowser/8.5.0 Mobile Safari/534.13",viewport:{width:480,height:854},deviceScaleFactor:1,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Nokia N9 landscape":{userAgent:"Mozilla/5.0 (MeeGo; NokiaN9) AppleWebKit/534.13 (KHTML, like Gecko) NokiaBrowser/8.5.0 Mobile Safari/534.13",viewport:{width:854,height:480},deviceScaleFactor:1,isMobile:!0,hasTouch:!0,defaultBrowserType:"webkit"},"Pixel 2":{userAgent:"Mozilla/5.0 (Linux; Android 8.0; Pixel 2 Build/OPD3.170816.012) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:411,height:731},deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 2 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 8.0; Pixel 2 Build/OPD3.170816.012) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:731,height:411},deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 2 XL":{userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Pixel 2 XL Build/OPD1.170816.004) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:411,height:823},deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 2 XL landscape":{userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Pixel 2 XL Build/OPD1.170816.004) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:823,height:411},deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 3":{userAgent:"Mozilla/5.0 (Linux; Android 9; Pixel 3 Build/PQ1A.181105.017.A1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:393,height:786},deviceScaleFactor:2.75,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 3 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 9; Pixel 3 Build/PQ1A.181105.017.A1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:786,height:393},deviceScaleFactor:2.75,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 4":{userAgent:"Mozilla/5.0 (Linux; Android 10; Pixel 4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:353,height:745},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 4 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 10; Pixel 4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:745,height:353},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 4a (5G)":{userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 4a (5G)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",screen:{width:412,height:892},viewport:{width:412,height:765},deviceScaleFactor:2.63,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 4a (5G) landscape":{userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 4a (5G)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",screen:{height:892,width:412},viewport:{width:840,height:312},deviceScaleFactor:2.63,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 5":{userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",screen:{width:393,height:851},viewport:{width:393,height:727},deviceScaleFactor:2.75,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 5 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",screen:{width:851,height:393},viewport:{width:802,height:293},deviceScaleFactor:2.75,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 7":{userAgent:"Mozilla/5.0 (Linux; Android 14; Pixel 7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",screen:{width:412,height:915},viewport:{width:412,height:839},deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Pixel 7 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 14; Pixel 7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",screen:{width:915,height:412},viewport:{width:863,height:360},deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Moto G4":{userAgent:"Mozilla/5.0 (Linux; Android 7.0; Moto G (4)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:360,height:640},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Moto G4 landscape":{userAgent:"Mozilla/5.0 (Linux; Android 7.0; Moto G (4)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Mobile Safari/537.36",viewport:{width:640,height:360},deviceScaleFactor:3,isMobile:!0,hasTouch:!0,defaultBrowserType:"chromium"},"Desktop Chrome HiDPI":{userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Safari/537.36",screen:{width:1792,height:1120},viewport:{width:1280,height:720},deviceScaleFactor:2,isMobile:!1,hasTouch:!1,defaultBrowserType:"chromium"},"Desktop Edge HiDPI":{userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Safari/537.36 Edg/129.0.6668.29",screen:{width:1792,height:1120},viewport:{width:1280,height:720},deviceScaleFactor:2,isMobile:!1,hasTouch:!1,defaultBrowserType:"chromium"},"Desktop Firefox HiDPI":{userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:130.0) Gecko/20100101 Firefox/130.0",screen:{width:1792,height:1120},viewport:{width:1280,height:720},deviceScaleFactor:2,isMobile:!1,hasTouch:!1,defaultBrowserType:"firefox"},"Desktop Safari":{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0 Safari/605.1.15",screen:{width:1792,height:1120},viewport:{width:1280,height:720},deviceScaleFactor:2,isMobile:!1,hasTouch:!1,defaultBrowserType:"webkit"},"Desktop Chrome":{userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Safari/537.36",screen:{width:1920,height:1080},viewport:{width:1280,height:720},deviceScaleFactor:1,isMobile:!1,hasTouch:!1,defaultBrowserType:"chromium"},"Desktop Edge":{userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.29 Safari/537.36 Edg/129.0.6668.29",screen:{width:1920,height:1080},viewport:{width:1280,height:720},deviceScaleFactor:1,isMobile:!1,hasTouch:!1,defaultBrowserType:"chromium"},"Desktop Firefox":{userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:130.0) Gecko/20100101 Firefox/130.0",screen:{width:1920,height:1080},viewport:{width:1280,height:720},deviceScaleFactor:1,isMobile:!1,hasTouch:!1,defaultBrowserType:"firefox"}}});var Xt,Qr=x(()=>{Yp();Xt=Zp});function cb(i,e){return Object.keys(i).length?(e?", ":"")+Yr(i):""}function Yr(i,e="  "){if(typeof i=="string")return xn(i);if(Array.isArray(i))return`[${i.map(t=>Yr(t)).join(", ")}]`;if(typeof i=="object"){let t=Object.keys(i).filter(r=>i[r]!==void 0).sort();if(!t.length)return"{}";let n=[];for(let r of t)n.push(`${r}: ${Yr(i[r])}`);return`{
${e}${n.join(`,
${e}`)}
}`}return String(i)}function ad(i,e="  "){let t=Yr(i,e);return t==="{}"?"":t}function em(i,e){let t=e&&Xt[e];if(!t)return ad(i);let n=ad(Xr(t,i));n||(n=`{
}`);let r=n.split(`
`);return r.splice(1,0,`...devices[${xn(e)}],`),r.join(`
`)}function xn(i){return ut(i,"'")}function db(i,e){return i?`await test.step(\`${i}\`, async () => {
${e}
});`:e}var ys,zn,ld=x(()=>{pr();Qr();O();ys=class{id;groupName="Node.js";name;highlighter="javascript";_isTest;constructor(e){this.id=e?"playwright-test":"javascript",this.name=e?"Test Runner":"Library",this._isTest=e}generateAction(e){let t=e.action;if(this._isTest&&(t.name==="openPage"||t.name==="closePage"))return"";let n=e.frame.pageAlias,r=new zn(2);if(t.name==="openPage")return r.add(`const ${n} = await context.newPage();`),t.url&&t.url!=="about:blank"&&t.url!=="chrome://newtab/"&&r.add(`await ${n}.goto(${xn(t.url)});`),r.format();let s=e.frame.framePath.map(c=>`.${this._asLocator(c)}.contentFrame()`),o=`${n}${s.join("")}`,l=Wn(t);return l.dialog&&r.add(`  ${n}.once('dialog', dialog => {
    console.log(\`Dialog message: \${dialog.message()}\`);
    dialog.dismiss().catch(() => {});
  });`),l.popup&&r.add(`const ${l.popup.popupAlias}Promise = ${n}.waitForEvent('popup');`),l.download&&r.add(`const download${l.download.downloadAlias}Promise = ${n}.waitForEvent('download');`),r.add(db(e.description,this._generateActionCall(o,e))),l.popup&&r.add(`const ${l.popup.popupAlias} = await ${l.popup.popupAlias}Promise;`),l.download&&r.add(`const download${l.download.downloadAlias} = await download${l.download.downloadAlias}Promise;`),r.format()}_generateActionCall(e,t){let n=t.action;switch(n.name){case"openPage":throw Error("Not reached");case"closePage":return`await ${e}.close();`;case"click":{let r="click";n.clickCount===2&&(r="dblclick");let s=Jt(n),o=cb(s,!1);return`await ${e}.${this._asLocator(n.selector)}.${r}(${o});`}case"check":return`await ${e}.${this._asLocator(n.selector)}.check();`;case"uncheck":return`await ${e}.${this._asLocator(n.selector)}.uncheck();`;case"fill":return`await ${e}.${this._asLocator(n.selector)}.fill(${xn(n.text)});`;case"setInputFiles":return`await ${e}.${this._asLocator(n.selector)}.setInputFiles(${Yr(n.files.length===1?n.files[0]:n.files)});`;case"press":{let s=[...Dt(n.modifiers),n.key].join("+");return`await ${e}.${this._asLocator(n.selector)}.press(${xn(s)});`}case"navigate":return`await ${e}.goto(${xn(n.url)});`;case"select":return`await ${e}.${this._asLocator(n.selector)}.selectOption(${Yr(n.options.length>1?n.options:n.options[0])});`;case"assertText":return`${this._isTest?"":"// "}await expect(${e}.${this._asLocator(n.selector)}).${n.substring?"toContainText":"toHaveText"}(${xn(n.text)});`;case"assertChecked":return`${this._isTest?"":"// "}await expect(${e}.${this._asLocator(n.selector)})${n.checked?"":".not"}.toBeChecked();`;case"assertVisible":return`${this._isTest?"":"// "}await expect(${e}.${this._asLocator(n.selector)}).toBeVisible();`;case"assertValue":{let r=n.value?`toHaveValue(${xn(n.value)})`:"toBeEmpty()";return`${this._isTest?"":"// "}await expect(${e}.${this._asLocator(n.selector)}).${r};`}}}_asLocator(e){return ke("javascript",e)}generateHeader(e){return this._isTest?this.generateTestHeader(e):this.generateStandaloneHeader(e)}generateFooter(e){return this._isTest?this.generateTestFooter(e):this.generateStandaloneFooter(e)}generateTestHeader(e){let t=new zn,n=em(e.contextOptions,e.deviceName);return t.add(`
      import { test, expect${e.deviceName?", devices":""} } from '@playwright/test';
${n?`
test.use(`+n+`);
`:""}
      test('test', async ({ page }) => {`),t.format()}generateTestFooter(e){return"});"}generateStandaloneHeader(e){let t=new zn;return t.add(`
      const { ${e.browserName}${e.deviceName?", devices":""} } = require('playwright');

      (async () => {
        const browser = await ${e.browserName}.launch(${ad(e.launchOptions)});
        const context = await browser.newContext(${em(e.contextOptions,e.deviceName)});`),t.format()}generateStandaloneFooter(e){return`
  // ---------------------${e?`
  await context.storageState({ path: ${xn(e)} });`:""}
  await context.close();
  await browser.close();
})();`}};zn=class{_baseIndent;_baseOffset;_lines=[];constructor(e=0){this._baseIndent=" ".repeat(2),this._baseOffset=" ".repeat(e)}prepend(e){this._lines=e.trim().split(`
`).map(t=>t.trim()).concat(this._lines)}add(e){this._lines.push(...e.trim().split(`
`).map(t=>t.trim()))}newLine(){this._lines.push("")}format(){let e="",t="";return this._lines.map(n=>{if(n==="")return n;(n.startsWith("}")||n.startsWith("]"))&&(e=e.substring(this._baseIndent.length));let r=/^(for|while|if|try).*\(.*\)$/.test(t)?this._baseIndent:"";t=n;let s=n.startsWith(".set");return n=e+r+(s?this._baseIndent:"")+n,(n.endsWith("{")||n.endsWith("["))&&(e+=this._baseIndent),this._baseOffset+n}).join(`
`)}}});function ub(i){return Array.isArray(i)?i.length===0?"new Path[0]":`new Path[] {${i.map(e=>"Paths.get("+Ne(e)+")").join(", ")}}`:`Paths.get(${Ne(i)})`}function hb(i){return Array.isArray(i)?i.length===0?"new String[0]":`new String[] {${i.map(e=>Ne(e)).join(", ")}}`:Ne(i)}function pb(i){let e=[];return Object.keys(i).filter(t=>i[t]!==void 0).length?(e.push("new BrowserType.LaunchOptions()"),i.channel&&e.push(`  .setChannel(${Ne(i.channel)})`),typeof i.headless=="boolean"&&e.push("  .setHeadless(false)"),e.join(`
`)):""}function mb(i,e){let t=[];if(!Object.keys(i).length&&!e)return"";let r={...e?Xt[e]:{},...i};return t.push("new Browser.NewContextOptions()"),r.acceptDownloads&&t.push("  .setAcceptDownloads(true)"),r.bypassCSP&&t.push("  .setBypassCSP(true)"),r.colorScheme&&t.push(`  .setColorScheme(ColorScheme.${r.colorScheme.toUpperCase()})`),r.deviceScaleFactor&&t.push(`  .setDeviceScaleFactor(${r.deviceScaleFactor})`),r.geolocation&&t.push(`  .setGeolocation(${r.geolocation.latitude}, ${r.geolocation.longitude})`),r.hasTouch&&t.push(`  .setHasTouch(${r.hasTouch})`),r.isMobile&&t.push(`  .setIsMobile(${r.isMobile})`),r.locale&&t.push(`  .setLocale(${Ne(r.locale)})`),r.proxy&&t.push(`  .setProxy(new Proxy(${Ne(r.proxy.server)}))`),r.recordHar?.content&&t.push(`  .setRecordHarContent(HarContentPolicy.${r.recordHar?.content.toUpperCase()})`),r.recordHar?.mode&&t.push(`  .setRecordHarMode(HarMode.${r.recordHar?.mode.toUpperCase()})`),r.recordHar?.omitContent&&t.push("  .setRecordHarOmitContent(true)"),r.recordHar?.path&&t.push(`  .setRecordHarPath(Paths.get(${Ne(r.recordHar.path)}))`),r.recordHar?.urlFilter&&t.push(`  .setRecordHarUrlFilter(${Ne(r.recordHar.urlFilter)})`),r.serviceWorkers&&t.push(`  .setServiceWorkers(ServiceWorkerPolicy.${r.serviceWorkers.toUpperCase()})`),r.storageState&&t.push(`  .setStorageStatePath(Paths.get(${Ne(r.storageState)}))`),r.timezoneId&&t.push(`  .setTimezoneId(${Ne(r.timezoneId)})`),r.userAgent&&t.push(`  .setUserAgent(${Ne(r.userAgent)})`),r.viewport&&t.push(`  .setViewportSize(${r.viewport.width}, ${r.viewport.height})`),t.join(`
`)}function fb(i){let e=[];return i.button&&e.push(`  .setButton(MouseButton.${i.button.toUpperCase()})`),i.modifiers&&e.push(`  .setModifiers(Arrays.asList(${i.modifiers.map(t=>`KeyboardModifier.${t.toUpperCase()}`).join(", ")}))`),i.clickCount&&e.push(`  .setClickCount(${i.clickCount})`),i.position&&e.push(`  .setPosition(${i.position.x}, ${i.position.y})`),e.length?(e.unshift("new Locator.ClickOptions()"),e.join(`
`)):""}function Ne(i){return ut(i,'"')}var _s,tm=x(()=>{pr();Qr();ld();O();_s=class{id;groupName="Java";name;highlighter="java";_mode;constructor(e){if(e==="library")this.name="Library",this.id="java";else if(e==="junit")this.name="JUnit",this.id="java-junit";else throw new Error(`Unknown Java language mode: ${e}`);this._mode=e}generateAction(e){let t=e.action,n=e.frame.pageAlias,r=this._mode==="junit"?4:6,s=new zn(r);if(this._mode!=="library"&&(t.name==="openPage"||t.name==="closePage"))return"";if(t.name==="openPage")return s.add(`Page ${n} = context.newPage();`),t.url&&t.url!=="about:blank"&&t.url!=="chrome://newtab/"&&s.add(`${n}.navigate(${Ne(t.url)});`),s.format();let o=e.frame.framePath.map(m=>`.${this._asLocator(m,!1)}.contentFrame()`),l=`${n}${o.join("")}`,c=Wn(t);c.dialog&&s.add(`  ${n}.onceDialog(dialog -> {
        System.out.println(String.format("Dialog message: %s", dialog.message()));
        dialog.dismiss();
      });`);let h=this._generateActionCall(l,e,!!e.frame.framePath.length);return c.popup&&(h=`Page ${c.popup.popupAlias} = ${n}.waitForPopup(() -> {
        ${h}
      });`),c.download&&(h=`Download download${c.download.downloadAlias} = ${n}.waitForDownload(() -> {
        ${h}
      });`),s.add(h),s.format()}_generateActionCall(e,t,n){let r=t.action;switch(r.name){case"openPage":throw Error("Not reached");case"closePage":return`${e}.close();`;case"click":{let s="click";r.clickCount===2&&(s="dblclick");let o=Jt(r),l=fb(o);return`${e}.${this._asLocator(r.selector,n)}.${s}(${l});`}case"check":return`${e}.${this._asLocator(r.selector,n)}.check();`;case"uncheck":return`${e}.${this._asLocator(r.selector,n)}.uncheck();`;case"fill":return`${e}.${this._asLocator(r.selector,n)}.fill(${Ne(r.text)});`;case"setInputFiles":return`${e}.${this._asLocator(r.selector,n)}.setInputFiles(${ub(r.files.length===1?r.files[0]:r.files)});`;case"press":{let o=[...Dt(r.modifiers),r.key].join("+");return`${e}.${this._asLocator(r.selector,n)}.press(${Ne(o)});`}case"navigate":return`${e}.navigate(${Ne(r.url)});`;case"select":return`${e}.${this._asLocator(r.selector,n)}.selectOption(${hb(r.options.length>1?r.options:r.options[0])});`;case"assertText":return`assertThat(${e}.${this._asLocator(r.selector,n)}).${r.substring?"containsText":"hasText"}(${Ne(r.text)});`;case"assertChecked":return`assertThat(${e}.${this._asLocator(r.selector,n)})${r.checked?"":".not()"}.isChecked();`;case"assertVisible":return`assertThat(${e}.${this._asLocator(r.selector,n)}).isVisible();`;case"assertValue":{let s=r.value?`hasValue(${Ne(r.value)})`:"isEmpty()";return`assertThat(${e}.${this._asLocator(r.selector,n)}).${s};`}}}_asLocator(e,t){return ke("java",e,t)}generateHeader(e){let t=new zn;return this._mode==="junit"?(t.add(`
      import com.microsoft.playwright.junit.UsePlaywright;
      import com.microsoft.playwright.Page;
      import com.microsoft.playwright.options.*;

      import org.junit.jupiter.api.*;
      import static com.microsoft.playwright.assertions.PlaywrightAssertions.*;

      @UsePlaywright
      public class TestExample {
        @Test
        void test(Page page) {`),t.format()):(t.add(`
    import com.microsoft.playwright.*;
    import com.microsoft.playwright.options.*;
    import static com.microsoft.playwright.assertions.PlaywrightAssertions.assertThat;
    import java.util.*;

    public class Example {
      public static void main(String[] args) {
        try (Playwright playwright = Playwright.create()) {
          Browser browser = playwright.${e.browserName}().launch(${pb(e.launchOptions)});
          BrowserContext context = browser.newContext(${mb(e.contextOptions,e.deviceName)});`),t.format())}generateFooter(e){let t=e?`
      context.storageState(new BrowserContext.StorageStateOptions().setPath(${Ne(e)}));
`:"";return this._mode==="junit"?`${t}  }
}`:`${t}    }
  }
}`}}});var ha,nm=x(()=>{O();ha=class{id="jsonl";groupName="";name="JSONL";highlighter="javascript";generateAction(e){let t=e.action.selector?JSON.parse(ke("jsonl",e.action.selector)):void 0,n={...e.action,pageAlias:e.frame.pageAlias,locator:t};return JSON.stringify(n)}generateHeader(e){return JSON.stringify(e)}generateFooter(e){return""}}});function Un(i,e="    ",t=""){if(typeof i=="string")return["permissions","colorScheme","modifiers","button","recordHarContent","recordHarMode","serviceWorkers"].includes(t)?`${cd(t)}.${pa(i)}`:Qt(i);if(Array.isArray(i))return`new[] { ${i.map(n=>Un(n,e,t)).join(", ")} }`;if(typeof i=="object"){let n=Object.keys(i).filter(s=>i[s]!==void 0).sort();if(!n.length)return t?`new ${cd(t)}`:"";let r=[];for(let s of n){let o=gb(s);r.push(`${o} = ${Un(i[s],e,s)},`)}return t?`new ${cd(t)}
{
${e}${r.join(`
${e}`)}
${e}}`:`{
${e}${r.join(`
${e}`)}
${e}}`}return t==="latitude"||t==="longitude"?String(i)+"m":String(i)}function cd(i){switch(i){case"viewport":return"ViewportSize";case"proxy":return"ProxySettings";case"permissions":return"ContextPermission";case"modifiers":return"KeyboardModifier";case"button":return"MouseButton";case"recordHarMode":return"HarMode";case"recordHarContent":return"HarContentPolicy";case"serviceWorkers":return"ServiceWorkerPolicy";default:return pa(i)}}function gb(i){switch(i){case"storageState":return"StorageStatePath";case"viewport":return"ViewportSize";default:return pa(i)}}function pa(i){return i[0].toUpperCase()+i.slice(1)}function rm(i){let e={...i};return i.recordHar&&(e.recordHarPath=i.recordHar.path,e.recordHarContent=i.recordHar.content,e.recordHarMode=i.recordHar.mode,e.recordHarOmitContent=i.recordHar.omitContent,e.recordHarUrlFilter=i.recordHar.urlFilter,delete e.recordHar),e}function im(i,e){let t=e&&Xt[e];return t?(i=Xr(t,i),Object.entries(i).length?Un(rm(i),"    ",`BrowserNewContextOptions(playwright.Devices[${Qt(e)}])`):`playwright.Devices[${Qt(e)}]`):Object.entries(i).length?Un(rm(i),"    ","BrowserNewContextOptions"):""}function Qt(i){return ut(i,'"')}var Zr,vs,sm=x(()=>{pr();O();Qr();Zr=class{id;groupName=".NET C#";name;highlighter="csharp";_mode;constructor(e){if(e==="library")this.name="Library",this.id="csharp";else if(e==="mstest")this.name="MSTest",this.id="csharp-mstest";else if(e==="nunit")this.name="NUnit",this.id="csharp-nunit";else throw new Error(`Unknown C# language mode: ${e}`);this._mode=e}generateAction(e){let t=this._generateActionInner(e);return t||""}_generateActionInner(e){let t=e.action;if(this._mode!=="library"&&(t.name==="openPage"||t.name==="closePage"))return"";let n=e.frame.pageAlias;this._mode!=="library"&&(n=n.replace("page","Page"));let r=new vs(this._mode==="library"?0:8);if(t.name==="openPage")return r.add(`var ${n} = await context.NewPageAsync();`),t.url&&t.url!=="about:blank"&&t.url!=="chrome://newtab/"&&r.add(`await ${n}.GotoAsync(${Qt(t.url)});`),r.format();let s=e.frame.framePath.map(h=>`.${this._asLocator(h)}.ContentFrame()`),o=`${n}${s.join("")}`,l=Wn(t);l.dialog&&r.add(`    void ${n}_Dialog${l.dialog.dialogAlias}_EventHandler(object sender, IDialog dialog)
      {
          Console.WriteLine($"Dialog message: {dialog.Message}");
          dialog.DismissAsync();
          ${n}.Dialog -= ${n}_Dialog${l.dialog.dialogAlias}_EventHandler;
      }
      ${n}.Dialog += ${n}_Dialog${l.dialog.dialogAlias}_EventHandler;`);let c=[];c.push(this._generateActionCall(o,e)),l.download&&(c.unshift(`var download${l.download.downloadAlias} = await ${n}.RunAndWaitForDownloadAsync(async () =>
{`),c.push("});")),l.popup&&(c.unshift(`var ${l.popup.popupAlias} = await ${n}.RunAndWaitForPopupAsync(async () =>
{`),c.push("});"));for(let h of c)r.add(h);return r.format()}_generateActionCall(e,t){let n=t.action;switch(n.name){case"openPage":throw Error("Not reached");case"closePage":return`await ${e}.CloseAsync();`;case"click":{let r="Click";n.clickCount===2&&(r="DblClick");let s=Jt(n);if(!Object.entries(s).length)return`await ${e}.${this._asLocator(n.selector)}.${r}Async();`;let o=Un(s,"    ","Locator"+r+"Options");return`await ${e}.${this._asLocator(n.selector)}.${r}Async(${o});`}case"check":return`await ${e}.${this._asLocator(n.selector)}.CheckAsync();`;case"uncheck":return`await ${e}.${this._asLocator(n.selector)}.UncheckAsync();`;case"fill":return`await ${e}.${this._asLocator(n.selector)}.FillAsync(${Qt(n.text)});`;case"setInputFiles":return`await ${e}.${this._asLocator(n.selector)}.SetInputFilesAsync(${Un(n.files)});`;case"press":{let s=[...Dt(n.modifiers),n.key].join("+");return`await ${e}.${this._asLocator(n.selector)}.PressAsync(${Qt(s)});`}case"navigate":return`await ${e}.GotoAsync(${Qt(n.url)});`;case"select":return`await ${e}.${this._asLocator(n.selector)}.SelectOptionAsync(${Un(n.options)});`;case"assertText":return`await Expect(${e}.${this._asLocator(n.selector)}).${n.substring?"ToContainTextAsync":"ToHaveTextAsync"}(${Qt(n.text)});`;case"assertChecked":return`await Expect(${e}.${this._asLocator(n.selector)})${n.checked?"":".Not"}.ToBeCheckedAsync();`;case"assertVisible":return`await Expect(${e}.${this._asLocator(n.selector)}).ToBeVisibleAsync();`;case"assertValue":{let r=n.value?`ToHaveValueAsync(${Qt(n.value)})`:"ToBeEmptyAsync()";return`await Expect(${e}.${this._asLocator(n.selector)}).${r};`}}}_asLocator(e){return ke("csharp",e)}generateHeader(e){return this._mode==="library"?this.generateStandaloneHeader(e):this.generateTestRunnerHeader(e)}generateStandaloneHeader(e){let t=new vs(0);return t.add(`
      using Microsoft.Playwright;
      using System;
      using System.Threading.Tasks;

      using var playwright = await Playwright.CreateAsync();
      await using var browser = await playwright.${pa(e.browserName)}.LaunchAsync(${Un(e.launchOptions,"    ","BrowserTypeLaunchOptions")});
      var context = await browser.NewContextAsync(${im(e.contextOptions,e.deviceName)});`),t.newLine(),t.format()}generateTestRunnerHeader(e){let t=new vs(0);t.add(`
      using Microsoft.Playwright.${this._mode==="nunit"?"NUnit":"MSTest"};
      using Microsoft.Playwright;

      ${this._mode==="nunit"?`[Parallelizable(ParallelScope.Self)]
      [TestFixture]`:"[TestClass]"}
      public class Tests : PageTest
      {`);let n=im(e.contextOptions,e.deviceName);return n&&(t.add(`public override BrowserNewContextOptions ContextOptions()
      {
          return ${n};
      }`),t.newLine()),t.add(`    [${this._mode==="nunit"?"Test":"TestMethod"}]
    public async Task MyTest()
    {`),t.format()}generateFooter(e){let t=this._mode==="library"?"":"        ",n=e?`
${t}await context.StorageStateAsync(new BrowserContextStorageStateOptions
${t}{
${t}    Path = ${Qt(e)}
${t}});
`:"";return this._mode!=="library"&&(n+=`    }
}
`),n}};vs=class{_baseIndent;_baseOffset;_lines=[];constructor(e=0){this._baseIndent=" ".repeat(4),this._baseOffset=" ".repeat(e)}prepend(e){this._lines=e.trim().split(`
`).map(t=>t.trim()).concat(this._lines)}add(e){this._lines.push(...e.trim().split(`
`).map(t=>t.trim()))}newLine(){this._lines.push("")}format(){let e="",t="";return this._lines.map(n=>{if(n==="")return n;(n.startsWith("}")||n.startsWith("]")||n.includes("});")||n===");")&&(e=e.substring(this._baseIndent.length));let r=/^(for|while|if).*\(.*\)$/.test(t)?this._baseIndent:"";return t=n,n=e+r+n,(n.endsWith("{")||n.endsWith("[")||n.endsWith("("))&&(e+=this._baseIndent),n.endsWith("));")&&(e=e.substring(this._baseIndent.length)),this._baseOffset+n}).join(`
`)}}});function Ss(i){return i===!1?"False":i===!0?"True":i===void 0?"None":Array.isArray(i)?`[${i.map(Ss).join(", ")}]`:typeof i=="string"?Yt(i):typeof i=="object"?JSON.stringify(i):String(i)}function xs(i,e,t){let n=Object.keys(i).filter(r=>i[r]!==void 0).sort();return n.length?(e?", ":"")+n.map(r=>t?`"${Ar(r)}": ${Ss(i[r])}`:`${Ar(r)}=${Ss(i[r])}`).join(", "):""}function om(i){let e={...i};return i.recordHar&&(e.record_har_path=i.recordHar.path,e.record_har_content=i.recordHar.content,e.record_har_mode=i.recordHar.mode,e.record_har_omit_content=i.recordHar.omitContent,e.record_har_url_filter=i.recordHar.urlFilter,delete e.recordHar),e}function dd(i,e,t){let n=e&&Xt[e];return n?`**playwright.devices[${Yt(e)}]`+xs(om(Xr(n,i)),!0,t):xs(om(i),!1,t)}function Yt(i){return ut(i,'"')}var ei,ma,am=x(()=>{pr();O();Qr();ei=class{id;groupName="Python";name;highlighter="python";_awaitPrefix;_asyncPrefix;_isAsync;_isPyTest;constructor(e,t){this.id=t?"python-pytest":e?"python-async":"python",this.name=t?"Pytest":e?"Library Async":"Library",this._isAsync=e,this._isPyTest=t,this._awaitPrefix=e?"await ":"",this._asyncPrefix=e?"async ":""}generateAction(e){let t=e.action;if(this._isPyTest&&(t.name==="openPage"||t.name==="closePage"))return"";let n=e.frame.pageAlias,r=new ma(4);if(t.name==="openPage")return r.add(`${n} = ${this._awaitPrefix}context.new_page()`),t.url&&t.url!=="about:blank"&&t.url!=="chrome://newtab/"&&r.add(`${this._awaitPrefix}${n}.goto(${Yt(t.url)})`),r.format();let s=e.frame.framePath.map(h=>`.${this._asLocator(h)}.content_frame()`),o=`${n}${s.join("")}`,l=Wn(t);l.dialog&&r.add(`  ${n}.once("dialog", lambda dialog: dialog.dismiss())`);let c=`${this._awaitPrefix}${this._generateActionCall(o,e)}`;return l.popup&&(c=`${this._asyncPrefix}with ${n}.expect_popup() as ${l.popup.popupAlias}_info {
        ${c}
      }
      ${l.popup.popupAlias} = ${this._awaitPrefix}${l.popup.popupAlias}_info.value`),l.download&&(c=`${this._asyncPrefix}with ${n}.expect_download() as download${l.download.downloadAlias}_info {
        ${c}
      }
      download${l.download.downloadAlias} = ${this._awaitPrefix}download${l.download.downloadAlias}_info.value`),r.add(c),r.format()}_generateActionCall(e,t){let n=t.action;switch(n.name){case"openPage":throw Error("Not reached");case"closePage":return`${e}.close()`;case"click":{let r="click";n.clickCount===2&&(r="dblclick");let s=Jt(n),o=xs(s,!1);return`${e}.${this._asLocator(n.selector)}.${r}(${o})`}case"check":return`${e}.${this._asLocator(n.selector)}.check()`;case"uncheck":return`${e}.${this._asLocator(n.selector)}.uncheck()`;case"fill":return`${e}.${this._asLocator(n.selector)}.fill(${Yt(n.text)})`;case"setInputFiles":return`${e}.${this._asLocator(n.selector)}.set_input_files(${Ss(n.files.length===1?n.files[0]:n.files)})`;case"press":{let s=[...Dt(n.modifiers),n.key].join("+");return`${e}.${this._asLocator(n.selector)}.press(${Yt(s)})`}case"navigate":return`${e}.goto(${Yt(n.url)})`;case"select":return`${e}.${this._asLocator(n.selector)}.select_option(${Ss(n.options.length===1?n.options[0]:n.options)})`;case"assertText":return`expect(${e}.${this._asLocator(n.selector)}).${n.substring?"to_contain_text":"to_have_text"}(${Yt(n.text)})`;case"assertChecked":return`expect(${e}.${this._asLocator(n.selector)}).${n.checked?"to_be_checked()":"not_to_be_checked()"}`;case"assertVisible":return`expect(${e}.${this._asLocator(n.selector)}).to_be_visible()`;case"assertValue":{let r=n.value?`to_have_value(${Yt(n.value)})`:"to_be_empty()";return`expect(${e}.${this._asLocator(n.selector)}).${r};`}}}_asLocator(e){return ke("python",e)}generateHeader(e){let t=new ma;if(this._isPyTest){let n=dd(e.contextOptions,e.deviceName,!0),r=n?`

@pytest.fixture(scope="session")
def browser_context_args(browser_context_args, playwright) {
    return {${n}}
}
`:"";t.add(`${e.deviceName?`import pytest
`:""}import re
from playwright.sync_api import Page, expect
${r}

def test_example(page: Page) -> None {`)}else this._isAsync?t.add(`
import asyncio
import re
from playwright.async_api import Playwright, async_playwright, expect


async def run(playwright: Playwright) -> None {
    browser = await playwright.${e.browserName}.launch(${xs(e.launchOptions,!1)})
    context = await browser.new_context(${dd(e.contextOptions,e.deviceName)})`):t.add(`
import re
from playwright.sync_api import Playwright, sync_playwright, expect


def run(playwright: Playwright) -> None {
    browser = playwright.${e.browserName}.launch(${xs(e.launchOptions,!1)})
    context = browser.new_context(${dd(e.contextOptions,e.deviceName)})`);return t.format()}generateFooter(e){return this._isPyTest?"":this._isAsync?`
    # ---------------------${e?`
    await context.storage_state(path=${Yt(e)})`:""}
    await context.close()
    await browser.close()


async def main() -> None:
    async with async_playwright() as playwright:
        await run(playwright)


asyncio.run(main())
`:`
    # ---------------------${e?`
    context.storage_state(path=${Yt(e)})`:""}
    context.close()
    browser.close()


with sync_playwright() as playwright:
    run(playwright)
`}};ma=class{_baseIndent;_baseOffset;_lines=[];constructor(e=0){this._baseIndent=" ".repeat(4),this._baseOffset=" ".repeat(e)}prepend(e){this._lines=e.trim().split(`
`).map(t=>t.trim()).concat(this._lines)}add(e){this._lines.push(...e.trim().split(`
`).map(t=>t.trim()))}newLine(){this._lines.push("")}format(){let e="",t=[];return this._lines.forEach(n=>{if(n==="")return t.push(n);if(n==="}"){e=e.substring(this._baseIndent.length);return}return n=e+n,n.endsWith("{")&&(e+=this._baseIndent,n=n.substring(0,n.length-1).trimEnd()+":"),t.push(this._baseOffset+n)}),t.join(`
`)}}});function lm(){return new Set([new _s("junit"),new _s("library"),new ys(!1),new ys(!0),new ei(!1,!0),new ei(!1,!1),new ei(!0,!1),new Zr("mstest"),new Zr("nunit"),new Zr("library"),new ha])}var cm=x(()=>{tm();ld();nm();sm();am()});function dm(i,e){let t=i.apiName||i.method;i.method==="waitForEventInfo"&&(t+=`(${i.params.info.event})`),t=t.replace("object.expect","expect"),i.error&&(e="error");let n={url:i.params?.url,selector:i.params?.selector},r=i.endTime?i.endTime-i.startTime:void 0;return typeof r=="number"&&i.pauseStartTime&&i.pauseEndTime&&(r-=i.pauseEndTime-i.pauseStartTime,r=Math.max(r,0)),{id:i.id,messages:i.log,title:t,status:e,error:i.error?.error?.message,params:n,duration:r}}function fa(i,e){return[...i,e].join(" >> internal:control=enter-frame >> ")}var ud=x(()=>{});async function ft(i,e,t,n){let r={id:`call@${Y()}`,apiName:"frame."+e,objectId:i.guid,pageId:i._page.guid,frameId:i.guid,startTime:X(),endTime:0,type:"Frame",method:e,params:t,log:[]};try{await i.instrumentation.onBeforeCall(i,r),await n(r)}catch{return r.endTime=X(),await i.instrumentation.onAfterCall(i,r),!1}return r.endTime=X(),await i.instrumentation.onAfterCall(i,r),!0}async function um(i,e){let t=e.frame.pageAlias,n=[...i.entries()].find(([,c])=>t===c)?.[0];if(!n)throw new Error("Internal error: page not found");let r=n.mainFrame(),{action:s}=e,o=5e3;if(s.name==="navigate")return await ft(r,"goto",{url:s.url},c=>r.goto(c,s.url,{timeout:o}));if(s.name==="openPage")throw Error("Not reached");if(s.name==="closePage")return await ft(r,"close",{},c=>r._page.close(c));let l=fa(e.frame.framePath,s.selector);if(s.name==="click"){let c=Jt(s);return await ft(r,"click",{selector:l},h=>r.click(h,l,{...c,timeout:o,strict:!0}))}if(s.name==="press"){let h=[...Dt(s.modifiers),s.key].join("+");return await ft(r,"press",{selector:l,key:h},m=>r.press(m,l,h,{timeout:o,strict:!0}))}if(s.name==="fill")return await ft(r,"fill",{selector:l,text:s.text},c=>r.fill(c,l,s.text,{timeout:o,strict:!0}));if(s.name==="setInputFiles")return await ft(r,"setInputFiles",{selector:l,files:s.files},c=>r.setInputFiles(c,l,{selector:l,payloads:[],timeout:o,strict:!0}));if(s.name==="check")return await ft(r,"check",{selector:l},c=>r.check(c,l,{timeout:o,strict:!0}));if(s.name==="uncheck")return await ft(r,"uncheck",{selector:l},c=>r.uncheck(c,l,{timeout:o,strict:!0}));if(s.name==="select"){let c=s.options.map(h=>({value:h}));return await ft(r,"selectOption",{selector:l,values:c},h=>r.selectOption(h,l,[],c,{timeout:o,strict:!0}))}if(s.name==="assertChecked")return await ft(r,"expect",{selector:l},c=>r.expect(c,l,{selector:l,expression:"to.be.checked",isNot:!s.checked,timeout:o}));if(s.name==="assertText")return await ft(r,"expect",{selector:l},c=>r.expect(c,l,{selector:l,expression:"to.have.text",expectedText:eh([s.text],{matchSubstring:!0,normalizeWhiteSpace:!0}),isNot:!1,timeout:o}));if(s.name==="assertValue")return await ft(r,"expect",{selector:l},c=>r.expect(c,l,{selector:l,expression:"to.have.value",expectedValue:s.value,isNot:!1,timeout:o}));if(s.name==="assertVisible")return await ft(r,"expect",{selector:l},c=>r.expect(c,l,{selector:l,expression:"to.be.visible",isNot:!1,timeout:o}));throw new Error("Internal error: unexpected action "+s.name)}var hm=x(()=>{O();pr();ud()});var ga,pm=x(()=>{ga=class{_file;_timer;_text;constructor(e){this._file=e}setContent(e){this._text=e,this._timer||(this._timer=setTimeout(()=>this.flush(),250))}flush(){this._timer&&(clearTimeout(this._timer),this._timer=void 0),this._text&&fs.writeFileSync(this._file,this._text),this._text=void 0}}});import{EventEmitter as wb}from"events";var wa,mm=x(()=>{wa=class extends wb{_currentAction=null;_lastAction=null;_actions=[];_enabled;constructor(e){super(),this._enabled=e,this.restart()}restart(){this._currentAction=null,this._lastAction=null,this._actions=[],this.emit("change")}actions(){return this._actions}setEnabled(e){this._enabled=e}addAction(e){this._enabled&&(this.willPerformAction(e),this.didPerformAction(e))}willPerformAction(e){this._enabled&&(this._currentAction=e)}performedActionFailed(e){this._enabled&&this._currentAction===e&&(this._currentAction=null)}didPerformAction(e){if(!this._enabled)return;let t=e.action,n=!1;if(this._lastAction&&this._lastAction.frame.pageAlias===e.frame.pageAlias){let r=this._lastAction.action;if(this._lastAction&&t.name==="fill"&&r.name==="fill"&&t.selector===r.selector&&(n=!0),r&&t.name==="click"&&r.name==="click"&&t.selector===r.selector&&t.clickCount>r.clickCount&&(n=!0),r&&t.name==="navigate"&&r.name==="navigate"&&t.url===r.url){this._currentAction=null;return}r&&(t.name==="check"||t.name==="uncheck")&&r.name==="click"&&t.selector===r.selector&&(n=!0)}this._lastAction=e,this._currentAction=null,n&&this._actions.pop(),this._actions.push(e),this.emit("change")}commitLastAction(){if(!this._enabled)return;let e=this._lastAction;e&&(e.committed=!0)}signal(e,t,n){if(this._enabled){if(this._currentAction){this._currentAction.action.signals.push(n);return}if(this._lastAction&&(!this._lastAction.committed||n.name!=="navigation")){let r=this._lastAction.action.signals;if(n.name==="navigation"&&r.length&&r[r.length-1].name==="download")return;n.name==="download"&&r.length&&r[r.length-1].name==="navigation"&&(r.length=r.length-1),this._lastAction.action.signals.push(n),this.emit("change");return}n.name==="navigation"&&t._page.mainFrame()===t&&this.addAction({frame:{pageAlias:e,framePath:[]},committed:!0,action:{name:"navigate",url:t.url(),signals:[]}})}}}});import{EventEmitter as bb}from"events";async function hd(i){let e=[];for(;i;){let n=i.parentFrame();if(!n)break;e.push(yb(n,i)),i=n}return(await Promise.all(e)).reverse()}async function yb(i,e){let t=await Fo(async()=>{try{let n=await e.frameElement();return!n||!i?void 0:await(await(await i._utilityContext()).injectedScript()).evaluate((l,c)=>l.generateSelectorSimple(c),n)}catch(n){return n.toString()}},X()+2e3);return!t.timedOut&&t.result?t.result:e.name()?`iframe[name=${Yl(e.name())}]`:`iframe[src=${Yl(e.url())}]`}var Ps,fm=x(()=>{Xp();O();Io();Oe();cm();ur();nt();hm();pm();mm();pr();Ps=class i extends bb{static Events={Change:"change"};_collection;_pageAliases=new Map;_lastPopupOrdinal=0;_lastDialogOrdinal=-1;_lastDownloadOrdinal=-1;_timers=new Set;_context;_params;_delegate;_recorderSources;_throttledOutputFile=null;_orderedLanguages=[];_listeners=[];constructor(e,t,n){super(),this._context=e,this._params=t,this._delegate=n,this._recorderSources=[];let r=t.language||e.attribution.playwright.options.sdkLanguage;this.setOutput(r,t.outputFile);let s={browserName:e._browser.options.name,launchOptions:{headless:!1,...t.launchOptions},contextOptions:{...t.contextOptions},deviceName:t.device,saveStorage:t.saveStorage},o=new wa(t.mode==="recording");o.on("change",()=>{this._recorderSources=[];for(let l of this._orderedLanguages){let{header:c,footer:h,actionTexts:m,text:f}=Qp(o.actions(),l,s),g={isRecorded:!0,label:l.name,group:l.groupName,id:l.id,text:f,header:c,footer:h,actions:m,language:l.highlighter,highlight:[]};g.revealLine=f.split(`
`).length-1,this._recorderSources.push(g),l===this._orderedLanguages[0]&&this._throttledOutputFile?.setContent(g.text)}this.emit(i.Events.Change,{sources:this._recorderSources,primaryFileName:this._orderedLanguages[0].id})}),e.on(j.Events.BeforeClose,()=>{this._throttledOutputFile?.flush()}),this._listeners.push(L.addEventListener(process,"exit",()=>{this._throttledOutputFile?.flush()})),this._collection=o}setOutput(e,t){let n=lm(),r=[...n].find(s=>s.id===e);if(!r)throw new Error(`
===============================
Unsupported language: '${e}'
===============================
`);n.delete(r),this._orderedLanguages=[r,...n],this._throttledOutputFile=t?new ga(t):null,this._collection?.restart()}languageName(e){for(let t of this._orderedLanguages)if(!e||t.id===e)return t.highlighter;return"javascript"}async install(){this._context.on(j.Events.Page,e=>this._onPage(e));for(let e of this._context.pages())this._onPage(e);this._context.on(j.Events.Dialog,e=>this._onDialog(e.page())),await this._context.exposeBinding("__pw_recorderPerformAction",!1,(e,t)=>this._performAction(e.frame,t)),await this._context.exposeBinding("__pw_recorderRecordAction",!1,(e,t)=>this._recordAction(e.frame,t)),await this._context.extendInjectedScript(Jp)}setEnabled(e){this._collection.setEnabled(e)}dispose(){for(let e of this._timers)clearTimeout(e);this._timers.clear(),L.removeEventListeners(this._listeners)}async _onPage(e){let t=e.mainFrame();e.on("close",()=>{this._collection.addAction({frame:this._describeMainFrame(e),committed:!0,action:{name:"closePage",signals:[]}}),this._pageAliases.delete(e)}),t.on(Qe.Events.InternalNavigation,s=>{s.isPublic&&this._onFrameNavigated(t,e)}),e.on(re.Events.Download,()=>this._onDownload(e));let r="page"+(this._pageAliases.size?String(++this._lastPopupOrdinal):"");this._pageAliases.set(e,r),e.opener()?this._onPopup(e.opener(),e):this._collection.addAction({frame:this._describeMainFrame(e),committed:!0,action:{name:"openPage",url:e.mainFrame().url(),signals:[]}})}clearScript(){if(this._collection.restart(),this._params.mode==="recording")for(let e of this._context.pages())this._onFrameNavigated(e.mainFrame(),e)}_describeMainFrame(e){return{pageAlias:this._pageAliases.get(e),framePath:[]}}async _describeFrame(e){return{pageAlias:this._pageAliases.get(e._page),framePath:await hd(e)}}testIdAttributeName(){return this._params.testIdAttributeName||this._context.selectors().testIdAttributeName()||"data-testid"}async _performAction(e,t){this._collection.commitLastAction();let r={frame:await this._describeFrame(e),action:t,description:void 0};await this._delegate.rewriteActionInContext?.(this._pageAliases,r),this._collection.willPerformAction(r),await um(this._pageAliases,r)?(this._collection.didPerformAction(r),this._setCommittedAfterTimeout(r)):this._collection.performedActionFailed(r)}async _recordAction(e,t){this._collection.commitLastAction();let r={frame:await this._describeFrame(e),action:t,description:void 0};await this._delegate.rewriteActionInContext?.(this._pageAliases,r),this._setCommittedAfterTimeout(r),this._collection.addAction(r)}_setCommittedAfterTimeout(e){let t=setTimeout(()=>{e.committed=!0,this._timers.delete(t)},ce()?500:5e3);this._timers.add(t)}_onFrameNavigated(e,t){let n=this._pageAliases.get(t);this._collection.signal(n,e,{name:"navigation",url:e.url()})}_onPopup(e,t){let n=this._pageAliases.get(e),r=this._pageAliases.get(t);this._collection.signal(n,e.mainFrame(),{name:"popup",popupAlias:r})}_onDownload(e){let t=this._pageAliases.get(e);++this._lastDownloadOrdinal,this._collection.signal(t,e.mainFrame(),{name:"download",downloadAlias:this._lastDownloadOrdinal?String(this._lastDownloadOrdinal):""})}_onDialog(e){let t=this._pageAliases.get(e);++this._lastDialogOrdinal,this._collection.signal(t,e.mainFrame(),{name:"dialog",dialogAlias:this._lastDialogOrdinal?String(this._lastDialogOrdinal):""})}}});function wm(i){return i.method.toLowerCase().includes("screenshot")}function _b(i){return i.endsWith(".py")?"python":i.endsWith(".java")?"java":i.endsWith(".cs")?"csharp":"javascript"}var gm,Zt,ba=x(()=>{od();O();Kp();Oe();td();fm();ud();gm=Symbol("recorderSymbol"),Zt=class i{_context;_mode;_highlightedSelector="";_overlayState={offsetX:0};_recorderApp=null;_currentCallsMetadata=new Map;_recorderSources=[];_userSources=new Map;_debugger;_contextRecorder;_omitCallTracking=!1;_currentLanguage;static showInspector(e,t){let n={};ce()&&(n.language=process.env.TEST_INSPECTOR_LANGUAGE),i.show(e,t,n).catch(()=>{})}static show(e,t,n={}){let r=e[gm];return r||(r=i._create(e,t,n),e[gm]=r),r}static async _create(e,t,n={}){let r=new i(e,n),s=await t(r);return await r._install(s),r}constructor(e,t){this._mode=t.mode||"none",this._contextRecorder=new Ps(e,t,{}),this._context=e,this._omitCallTracking=!!t.omitCallTracking,this._debugger=e.debugger(),e.instrumentation.addListener(this,e),this._currentLanguage=this._contextRecorder.languageName(),ce()&&(this._overlayState.offsetX=200)}async _install(e){this._recorderApp=e,e.once("close",()=>{this._debugger.resume(!1),this._recorderApp=null}),e.on("event",t=>{if(t.event==="setMode"){this.setMode(t.params.mode);return}if(t.event==="selectorUpdated"){this.setHighlightedSelector(this._currentLanguage,t.params.selector);return}if(t.event==="step"){this._debugger.resume(!0);return}if(t.event==="fileChanged"){this._currentLanguage=this._contextRecorder.languageName(t.params.file),this._refreshOverlay();return}if(t.event==="resume"){this._debugger.resume(!1);return}if(t.event==="pause"){this._debugger.pauseOnNextStatement();return}if(t.event==="clear"){this._contextRecorder.clearScript();return}}),await Promise.all([e.setMode(this._mode),e.setPaused(this._debugger.isPaused()),this._pushAllSources()]),this._context.once(j.Events.Close,()=>{this._contextRecorder.dispose(),this._context.instrumentation.removeListener(this),this._recorderApp?.close().catch(()=>{})}),this._contextRecorder.on(Ps.Events.Change,t=>{this._recorderSources=t.sources,this._pushAllSources(),this._recorderApp?.setFileIfNeeded(t.primaryFileName)}),await this._context.exposeBinding("__pw_recorderState",!1,t=>{let n="",r;if(![...this._currentCallsMetadata.keys()].some(wm)){n=this._highlightedSelector;for(let[l,c]of this._currentCallsMetadata)t.page===c.attribution.page&&(r=l.point||r,n=n||l.params.selector)}return{mode:this._mode,actionPoint:r,actionSelector:n,language:this._currentLanguage,testIdAttributeName:this._contextRecorder.testIdAttributeName(),overlay:this._overlayState}}),await this._context.exposeBinding("__pw_recorderSetSelector",!1,async({frame:t},n)=>{let r=await hd(t);await this._recorderApp?.setSelector(fa(r,n),!0)}),await this._context.exposeBinding("__pw_recorderSetMode",!1,async({frame:t},n)=>{t.parentFrame()||this.setMode(n)}),await this._context.exposeBinding("__pw_recorderSetOverlayState",!1,async({frame:t},n)=>{t.parentFrame()||(this._overlayState=n)}),await this._context.exposeBinding("__pw_resume",!1,()=>{this._debugger.resume(!1)}),await this._context.extendInjectedScript(ua),await this._contextRecorder.install(),this._debugger.isPaused()&&this._pausedStateChanged(),this._debugger.on(hr.Events.PausedStateChanged,()=>this._pausedStateChanged()),this._context.recorderAppForTest=this._recorderApp}_pausedStateChanged(){for(let{metadata:e,sdkObject:t}of this._debugger.pausedDetails())this._currentCallsMetadata.has(e)||this.onBeforeCall(t,e);this._recorderApp?.setPaused(this._debugger.isPaused()),this._updateUserSources(),this.updateCallLog([...this._currentCallsMetadata.keys()])}setMode(e){this._mode!==e&&(this._highlightedSelector="",this._mode=e,this._recorderApp?.setMode(this._mode),this._contextRecorder.setEnabled(this._mode==="recording"||this._mode==="assertingText"||this._mode==="assertingVisibility"||this._mode==="assertingValue"),this._debugger.setMuted(this._mode==="recording"||this._mode==="assertingText"||this._mode==="assertingVisibility"||this._mode==="assertingValue"),this._mode!=="none"&&this._mode!=="standby"&&this._context.pages().length===1&&this._context.pages()[0].bringToFront().catch(()=>{}),this._refreshOverlay())}resume(){this._debugger.resume(!1)}mode(){return this._mode}setHighlightedSelector(e,t){this._highlightedSelector=Gp(e,t,this._context.selectors().testIdAttributeName()),this._refreshOverlay()}hideHighlightedSelector(){this._highlightedSelector="",this._refreshOverlay()}setOutput(e,t){this._contextRecorder.setOutput(e,t)}_refreshOverlay(){for(let e of this._context.pages())e.mainFrame().evaluateExpression("window.__pw_refreshOverlay()").catch(()=>{})}async onBeforeCall(e,t){this._omitCallTracking||this._mode==="recording"||this._mode==="assertingText"||this._mode==="assertingVisibility"||this._mode==="assertingValue"||(this._currentCallsMetadata.set(t,e),this._updateUserSources(),this.updateCallLog([t]),wm(t)?this.hideHighlightedSelector():t.params&&t.params.selector&&(this._highlightedSelector=t.params.selector,this._recorderApp?.setSelector(this._highlightedSelector).catch(()=>{})))}async onAfterCall(e,t){this._omitCallTracking||this._mode==="recording"||this._mode==="assertingText"||this._mode==="assertingVisibility"||this._mode==="assertingValue"||(t.error||this._currentCallsMetadata.delete(t),this._updateUserSources(),this.updateCallLog([t]))}_updateUserSources(){for(let t of this._userSources.values())t.highlight=[],t.revealLine=void 0;let e;for(let t of this._currentCallsMetadata.keys()){if(!t.location)continue;let{file:n,line:r}=t.location,s=this._userSources.get(n);if(s||(s={isRecorded:!1,label:n,id:n,text:this._readSource(n),highlight:[],language:_b(n)},this._userSources.set(n,s)),r){let o=this._debugger.isPaused(t);s.highlight.push({line:r,type:t.error?"error":o?"paused":"running"}),s.revealLine=r,e=s.id}}this._pushAllSources(),e&&this._recorderApp?.setFileIfNeeded(e)}_pushAllSources(){this._recorderApp?.setSources([...this._recorderSources,...this._userSources.values()])}async onBeforeInputAction(e,t){}async onCallLog(e,t,n,r){this.updateCallLog([t])}updateCallLog(e){if(this._mode==="recording"||this._mode==="assertingText"||this._mode==="assertingVisibility"||this._mode==="assertingValue")return;let t=[];for(let n of e){if(!n.method||n.internal)continue;let r="done";this._currentCallsMetadata.has(n)&&(r="in-progress"),this._debugger.isPaused(n)&&(r="paused"),t.push(dm(n,r))}this._recorderApp?.updateCallLogs(t)}_readSource(e){try{return fs.readFileSync(e,"utf-8")}catch{return"// No source available"}}}});var bm,ym=x(()=>{bm=`
var __commonJS = obj => {
  let required = false;
  let result;
  return function __require() {
    if (!required) {
      required = true;
      let fn;
      for (const name in obj) { fn = obj[name]; break; }
      const module = { exports: {} };
      fn(module.exports, module);
      result = module.exports;
    }
    return result;
  }
};
var __export = (target, all) => {for (var name in all) target[name] = all[name];};
var __toESM = mod => ({ ...mod, 'default': mod });
var __toCommonJS = mod => ({ ...mod, __esModule: true });


// packages/playwright-core/src/server/injected/clock.ts
var clock_exports = {};
__export(clock_exports, {
  ClockController: () => ClockController,
  createClock: () => createClock,
  inject: () => inject,
  install: () => install
});
module.exports = __toCommonJS(clock_exports);
var ClockController = class {
  constructor(embedder) {
    this._duringTick = false;
    this._timers = /* @__PURE__ */ new Map();
    this._uniqueTimerId = idCounterStart;
    this.disposables = [];
    this._log = [];
    this._now = { time: asWallTime(0), isFixedTime: false, ticks: 0, origin: asWallTime(-1) };
    this._embedder = embedder;
  }
  uninstall() {
    this.disposables.forEach((dispose) => dispose());
    this.disposables.length = 0;
  }
  now() {
    this._replayLogOnce();
    return this._now.time;
  }
  install(time) {
    this._replayLogOnce();
    this._innerSetTime(asWallTime(time));
  }
  setSystemTime(time) {
    this._replayLogOnce();
    this._innerSetTime(asWallTime(time));
  }
  setFixedTime(time) {
    this._replayLogOnce();
    this._innerSetFixedTime(asWallTime(time));
  }
  performanceNow() {
    this._replayLogOnce();
    return this._now.ticks;
  }
  _innerSetTime(time) {
    this._now.time = time;
    this._now.isFixedTime = false;
    if (this._now.origin < 0)
      this._now.origin = this._now.time;
  }
  _innerSetFixedTime(time) {
    this._innerSetTime(time);
    this._now.isFixedTime = true;
  }
  _advanceNow(to) {
    if (!this._now.isFixedTime)
      this._now.time = asWallTime(this._now.time + to - this._now.ticks);
    this._now.ticks = to;
  }
  async log(type, time, param) {
    this._log.push({ type, time, param });
  }
  async runFor(ticks) {
    this._replayLogOnce();
    if (ticks < 0)
      throw new TypeError("Negative ticks are not supported");
    await this._runTo(shiftTicks(this._now.ticks, ticks));
  }
  async _runTo(to) {
    to = Math.ceil(to);
    if (this._now.ticks > to)
      return;
    let firstException;
    while (true) {
      const result = await this._callFirstTimer(to);
      if (!result.timerFound)
        break;
      firstException = firstException || result.error;
    }
    this._advanceNow(to);
    if (firstException)
      throw firstException;
  }
  async pauseAt(time) {
    this._replayLogOnce();
    this._innerPause();
    const toConsume = time - this._now.time;
    await this._innerFastForwardTo(shiftTicks(this._now.ticks, toConsume));
    return toConsume;
  }
  _innerPause() {
    this._realTime = void 0;
    this._updateRealTimeTimer();
  }
  resume() {
    this._replayLogOnce();
    this._innerResume();
  }
  _innerResume() {
    const now = this._embedder.performanceNow();
    this._realTime = { startTicks: now, lastSyncTicks: now };
    this._updateRealTimeTimer();
  }
  _updateRealTimeTimer() {
    var _a;
    if (!this._realTime) {
      (_a = this._currentRealTimeTimer) == null ? void 0 : _a.dispose();
      this._currentRealTimeTimer = void 0;
      return;
    }
    const firstTimer = this._firstTimer();
    const callAt = Math.min(firstTimer ? firstTimer.callAt : this._now.ticks + maxTimeout, this._now.ticks + 100);
    if (this._currentRealTimeTimer && this._currentRealTimeTimer.callAt < callAt)
      return;
    if (this._currentRealTimeTimer) {
      this._currentRealTimeTimer.dispose();
      this._currentRealTimeTimer = void 0;
    }
    this._currentRealTimeTimer = {
      callAt,
      dispose: this._embedder.setTimeout(() => {
        const now = this._embedder.performanceNow();
        this._currentRealTimeTimer = void 0;
        const sinceLastSync = now - this._realTime.lastSyncTicks;
        this._realTime.lastSyncTicks = now;
        void this._runTo(shiftTicks(this._now.ticks, sinceLastSync)).catch((e) => console.error(e)).then(() => this._updateRealTimeTimer());
      }, callAt - this._now.ticks)
    };
  }
  async fastForward(ticks) {
    this._replayLogOnce();
    await this._innerFastForwardTo(shiftTicks(this._now.ticks, ticks | 0));
  }
  async _innerFastForwardTo(to) {
    if (to < this._now.ticks)
      throw new Error("Cannot fast-forward to the past");
    for (const timer of this._timers.values()) {
      if (to > timer.callAt)
        timer.callAt = to;
    }
    await this._runTo(to);
  }
  addTimer(options) {
    this._replayLogOnce();
    if (options.type === "AnimationFrame" /* AnimationFrame */ && !options.func)
      throw new Error("Callback must be provided to requestAnimationFrame calls");
    if (options.type === "IdleCallback" /* IdleCallback */ && !options.func)
      throw new Error("Callback must be provided to requestIdleCallback calls");
    if (["Timeout" /* Timeout */, "Interval" /* Interval */].includes(options.type) && !options.func && options.delay === void 0)
      throw new Error("Callback must be provided to timer calls");
    let delay = options.delay ? +options.delay : 0;
    if (!Number.isFinite(delay))
      delay = 0;
    delay = delay > maxTimeout ? 1 : delay;
    delay = Math.max(0, delay);
    const timer = {
      type: options.type,
      func: options.func,
      args: options.args || [],
      delay,
      callAt: shiftTicks(this._now.ticks, delay || (this._duringTick ? 1 : 0)),
      createdAt: this._now.ticks,
      id: this._uniqueTimerId++,
      error: new Error()
    };
    this._timers.set(timer.id, timer);
    if (this._realTime)
      this._updateRealTimeTimer();
    return timer.id;
  }
  countTimers() {
    return this._timers.size;
  }
  _firstTimer(beforeTick) {
    let firstTimer = null;
    for (const timer of this._timers.values()) {
      const isInRange = beforeTick === void 0 || timer.callAt <= beforeTick;
      if (isInRange && (!firstTimer || compareTimers(firstTimer, timer) === 1))
        firstTimer = timer;
    }
    return firstTimer;
  }
  _takeFirstTimer(beforeTick) {
    const timer = this._firstTimer(beforeTick);
    if (!timer)
      return null;
    this._advanceNow(timer.callAt);
    if (timer.type === "Interval" /* Interval */)
      timer.callAt = shiftTicks(timer.callAt, timer.delay);
    else
      this._timers.delete(timer.id);
    return timer;
  }
  async _callFirstTimer(beforeTick) {
    const timer = this._takeFirstTimer(beforeTick);
    if (!timer)
      return { timerFound: false };
    this._duringTick = true;
    try {
      if (typeof timer.func !== "function") {
        let error2;
        try {
          (() => {
            globalThis.eval(timer.func);
          })();
        } catch (e) {
          error2 = e;
        }
        await new Promise((f) => this._embedder.setTimeout(f));
        return { timerFound: true, error: error2 };
      }
      let args = timer.args;
      if (timer.type === "AnimationFrame" /* AnimationFrame */)
        args = [this._now.ticks];
      else if (timer.type === "IdleCallback" /* IdleCallback */)
        args = [{ didTimeout: false, timeRemaining: () => 0 }];
      let error;
      try {
        timer.func.apply(null, args);
      } catch (e) {
        error = e;
      }
      await new Promise((f) => this._embedder.setTimeout(f));
      return { timerFound: true, error };
    } finally {
      this._duringTick = false;
    }
  }
  getTimeToNextFrame() {
    return 16 - this._now.ticks % 16;
  }
  clearTimer(timerId, type) {
    this._replayLogOnce();
    if (!timerId) {
      return;
    }
    const id = Number(timerId);
    if (Number.isNaN(id) || id < idCounterStart) {
      const handlerName = getClearHandler(type);
      new Error(\`Clock: \${handlerName} was invoked to clear a native timer instead of one created by the clock library.\`);
    }
    const timer = this._timers.get(id);
    if (timer) {
      if (timer.type === type || timer.type === "Timeout" && type === "Interval" || timer.type === "Interval" && type === "Timeout") {
        this._timers.delete(id);
      } else {
        const clear = getClearHandler(type);
        const schedule = getScheduleHandler(timer.type);
        throw new Error(
          \`Cannot clear timer: timer created with \${schedule}() but cleared with \${clear}()\`
        );
      }
    }
  }
  _replayLogOnce() {
    if (!this._log.length)
      return;
    let lastLogTime = -1;
    let isPaused = false;
    for (const { type, time, param } of this._log) {
      if (!isPaused && lastLogTime !== -1)
        this._advanceNow(shiftTicks(this._now.ticks, time - lastLogTime));
      lastLogTime = time;
      if (type === "install") {
        this._innerSetTime(asWallTime(param));
      } else if (type === "fastForward" || type === "runFor") {
        this._advanceNow(shiftTicks(this._now.ticks, param));
      } else if (type === "pauseAt") {
        isPaused = true;
        this._innerPause();
        this._innerSetTime(asWallTime(param));
      } else if (type === "resume") {
        this._innerResume();
        isPaused = false;
      } else if (type === "setFixedTime") {
        this._innerSetFixedTime(asWallTime(param));
      } else if (type === "setSystemTime") {
        this._innerSetTime(asWallTime(param));
      }
    }
    if (!isPaused && lastLogTime > 0)
      this._advanceNow(shiftTicks(this._now.ticks, this._embedder.dateNow() - lastLogTime));
    this._log.length = 0;
  }
};
function mirrorDateProperties(target, source) {
  for (const prop in source) {
    if (source.hasOwnProperty(prop))
      target[prop] = source[prop];
  }
  target.toString = () => source.toString();
  target.prototype = source.prototype;
  target.parse = source.parse;
  target.UTC = source.UTC;
  target.prototype.toUTCString = source.prototype.toUTCString;
  target.isFake = true;
  return target;
}
function createDate(clock, NativeDate) {
  function ClockDate(year, month, date, hour, minute, second, ms) {
    if (!(this instanceof ClockDate))
      return new NativeDate(clock.now()).toString();
    switch (arguments.length) {
      case 0:
        return new NativeDate(clock.now());
      case 1:
        return new NativeDate(year);
      case 2:
        return new NativeDate(year, month);
      case 3:
        return new NativeDate(year, month, date);
      case 4:
        return new NativeDate(year, month, date, hour);
      case 5:
        return new NativeDate(year, month, date, hour, minute);
      case 6:
        return new NativeDate(
          year,
          month,
          date,
          hour,
          minute,
          second
        );
      default:
        return new NativeDate(
          year,
          month,
          date,
          hour,
          minute,
          second,
          ms
        );
    }
  }
  ClockDate.now = () => clock.now();
  return mirrorDateProperties(ClockDate, NativeDate);
}
function createIntl(clock, NativeIntl) {
  const ClockIntl = {};
  for (const key of Object.getOwnPropertyNames(NativeIntl))
    ClockIntl[key] = NativeIntl[key];
  ClockIntl.DateTimeFormat = function(...args) {
    const realFormatter = new NativeIntl.DateTimeFormat(...args);
    const formatter = {
      formatRange: realFormatter.formatRange.bind(realFormatter),
      formatRangeToParts: realFormatter.formatRangeToParts.bind(realFormatter),
      resolvedOptions: realFormatter.resolvedOptions.bind(realFormatter),
      format: (date) => realFormatter.format(date || clock.now()),
      formatToParts: (date) => realFormatter.formatToParts(date || clock.now())
    };
    return formatter;
  };
  ClockIntl.DateTimeFormat.prototype = Object.create(
    NativeIntl.DateTimeFormat.prototype
  );
  ClockIntl.DateTimeFormat.supportedLocalesOf = NativeIntl.DateTimeFormat.supportedLocalesOf;
  return ClockIntl;
}
function compareTimers(a, b) {
  if (a.callAt < b.callAt)
    return -1;
  if (a.callAt > b.callAt)
    return 1;
  if (a.type === "Immediate" /* Immediate */ && b.type !== "Immediate" /* Immediate */)
    return -1;
  if (a.type !== "Immediate" /* Immediate */ && b.type === "Immediate" /* Immediate */)
    return 1;
  if (a.createdAt < b.createdAt)
    return -1;
  if (a.createdAt > b.createdAt)
    return 1;
  if (a.id < b.id)
    return -1;
  if (a.id > b.id)
    return 1;
}
var maxTimeout = Math.pow(2, 31) - 1;
var idCounterStart = 1e12;
function platformOriginals(globalObject) {
  const raw = {
    setTimeout: globalObject.setTimeout,
    clearTimeout: globalObject.clearTimeout,
    setInterval: globalObject.setInterval,
    clearInterval: globalObject.clearInterval,
    requestAnimationFrame: globalObject.requestAnimationFrame ? globalObject.requestAnimationFrame : void 0,
    cancelAnimationFrame: globalObject.cancelAnimationFrame ? globalObject.cancelAnimationFrame : void 0,
    requestIdleCallback: globalObject.requestIdleCallback ? globalObject.requestIdleCallback : void 0,
    cancelIdleCallback: globalObject.cancelIdleCallback ? globalObject.cancelIdleCallback : void 0,
    Date: globalObject.Date,
    performance: globalObject.performance,
    Intl: globalObject.Intl
  };
  const bound = { ...raw };
  for (const key of Object.keys(bound)) {
    if (key !== "Date" && typeof bound[key] === "function")
      bound[key] = bound[key].bind(globalObject);
  }
  return { raw, bound };
}
function getScheduleHandler(type) {
  if (type === "IdleCallback" || type === "AnimationFrame")
    return \`request\${type}\`;
  return \`set\${type}\`;
}
function createApi(clock, originals) {
  return {
    setTimeout: (func, timeout, ...args) => {
      const delay = timeout ? +timeout : timeout;
      return clock.addTimer({
        type: "Timeout" /* Timeout */,
        func,
        args,
        delay
      });
    },
    clearTimeout: (timerId) => {
      if (timerId)
        clock.clearTimer(timerId, "Timeout" /* Timeout */);
    },
    setInterval: (func, timeout, ...args) => {
      const delay = timeout ? +timeout : timeout;
      return clock.addTimer({
        type: "Interval" /* Interval */,
        func,
        args,
        delay
      });
    },
    clearInterval: (timerId) => {
      if (timerId)
        return clock.clearTimer(timerId, "Interval" /* Interval */);
    },
    requestAnimationFrame: (callback) => {
      return clock.addTimer({
        type: "AnimationFrame" /* AnimationFrame */,
        func: callback,
        delay: clock.getTimeToNextFrame()
      });
    },
    cancelAnimationFrame: (timerId) => {
      if (timerId)
        return clock.clearTimer(timerId, "AnimationFrame" /* AnimationFrame */);
    },
    requestIdleCallback: (callback, options) => {
      let timeToNextIdlePeriod = 0;
      if (clock.countTimers() > 0)
        timeToNextIdlePeriod = 50;
      return clock.addTimer({
        type: "IdleCallback" /* IdleCallback */,
        func: callback,
        delay: (options == null ? void 0 : options.timeout) ? Math.min(options == null ? void 0 : options.timeout, timeToNextIdlePeriod) : timeToNextIdlePeriod
      });
    },
    cancelIdleCallback: (timerId) => {
      if (timerId)
        return clock.clearTimer(timerId, "IdleCallback" /* IdleCallback */);
    },
    Intl: originals.Intl ? createIntl(clock, originals.Intl) : void 0,
    Date: createDate(clock, originals.Date),
    performance: originals.performance ? fakePerformance(clock, originals.performance) : void 0
  };
}
function getClearHandler(type) {
  if (type === "IdleCallback" || type === "AnimationFrame")
    return \`cancel\${type}\`;
  return \`clear\${type}\`;
}
function fakePerformance(clock, performance) {
  const result = {
    now: () => clock.performanceNow()
  };
  result.__defineGetter__("timeOrigin", () => clock._now.origin || 0);
  for (const key of Object.keys(performance.__proto__)) {
    if (key === "now" || key === "timeOrigin")
      continue;
    if (key === "getEntries" || key === "getEntriesByName" || key === "getEntriesByType")
      result[key] = () => [];
    else
      result[key] = () => {
      };
  }
  return result;
}
function createClock(globalObject) {
  const originals = platformOriginals(globalObject);
  const embedder = {
    dateNow: () => originals.raw.Date.now(),
    performanceNow: () => Math.ceil(originals.raw.performance.now()),
    setTimeout: (task, timeout) => {
      const timerId = originals.bound.setTimeout(task, timeout);
      return () => originals.bound.clearTimeout(timerId);
    },
    setInterval: (task, delay) => {
      const intervalId = originals.bound.setInterval(task, delay);
      return () => originals.bound.clearInterval(intervalId);
    }
  };
  const clock = new ClockController(embedder);
  const api = createApi(clock, originals.bound);
  return { clock, api, originals: originals.raw };
}
function install(globalObject, config = {}) {
  var _a, _b;
  if ((_a = globalObject.Date) == null ? void 0 : _a.isFake) {
    throw new TypeError(\`Can't install fake timers twice on the same global object.\`);
  }
  const { clock, api, originals } = createClock(globalObject);
  const toFake = ((_b = config.toFake) == null ? void 0 : _b.length) ? config.toFake : Object.keys(originals);
  for (const method of toFake) {
    if (method === "Date") {
      globalObject.Date = mirrorDateProperties(api.Date, globalObject.Date);
    } else if (method === "Intl") {
      globalObject.Intl = api[method];
    } else if (method === "performance") {
      globalObject.performance = api[method];
      const kEventTimeStamp = Symbol("playwrightEventTimeStamp");
      Object.defineProperty(Event.prototype, "timeStamp", {
        get() {
          var _a2;
          if (!this[kEventTimeStamp])
            this[kEventTimeStamp] = (_a2 = api.performance) == null ? void 0 : _a2.now();
          return this[kEventTimeStamp];
        }
      });
    } else {
      globalObject[method] = (...args) => {
        return api[method].apply(api, args);
      };
    }
    clock.disposables.push(() => {
      globalObject[method] = originals[method];
    });
  }
  return { clock, api, originals };
}
function inject(globalObject) {
  const builtin = platformOriginals(globalObject).bound;
  const { clock: controller } = install(globalObject);
  controller.resume();
  return {
    controller,
    builtin
  };
}
function asWallTime(n) {
  return n;
}
function shiftTicks(ticks, ms) {
  return ticks + ms;
}
`});function _m(i){if(typeof i=="number")return i;if(!i)return 0;let e=i,t=e.split(":"),n=t.length,r=n,s=0,o;if(n>3||!/^(\d\d:){0,2}\d\d?$/.test(e))throw new Error("Clock only understands numbers, 'mm:ss' and 'hh:mm:ss'");for(;r--;){if(o=parseInt(t[r],10),o>=60)throw new Error(`Invalid time ${e}`);s+=o*Math.pow(60,n-r-1)}return s*1e3}function ya(i){if(!i)return 0;if(typeof i=="number")return i;let e=new Date(i);if(!isFinite(e.getTime()))throw new Error(`Invalid date: ${i}`);return e.getTime()}var _a,vm=x(()=>{ym();_a=class{_browserContext;_scriptInstalled=!1;constructor(e){this._browserContext=e}markAsUninstalled(){this._scriptInstalled=!1}async fastForward(e){await this._installIfNeeded();let t=_m(e);await this._browserContext.addInitScript(`globalThis.__pwClock.controller.log('fastForward', ${Date.now()}, ${t})`),await this._evaluateInFrames(`globalThis.__pwClock.controller.fastForward(${t})`)}async install(e){await this._installIfNeeded();let t=e!==void 0?ya(e):Date.now();await this._browserContext.addInitScript(`globalThis.__pwClock.controller.log('install', ${Date.now()}, ${t})`),await this._evaluateInFrames(`globalThis.__pwClock.controller.install(${t})`)}async pauseAt(e){await this._installIfNeeded();let t=ya(e);await this._browserContext.addInitScript(`globalThis.__pwClock.controller.log('pauseAt', ${Date.now()}, ${t})`),await this._evaluateInFrames(`globalThis.__pwClock.controller.pauseAt(${t})`)}async resume(){await this._installIfNeeded(),await this._browserContext.addInitScript(`globalThis.__pwClock.controller.log('resume', ${Date.now()})`),await this._evaluateInFrames("globalThis.__pwClock.controller.resume()")}async setFixedTime(e){await this._installIfNeeded();let t=ya(e);await this._browserContext.addInitScript(`globalThis.__pwClock.controller.log('setFixedTime', ${Date.now()}, ${t})`),await this._evaluateInFrames(`globalThis.__pwClock.controller.setFixedTime(${t})`)}async setSystemTime(e){await this._installIfNeeded();let t=ya(e);await this._browserContext.addInitScript(`globalThis.__pwClock.controller.log('setSystemTime', ${Date.now()}, ${t})`),await this._evaluateInFrames(`globalThis.__pwClock.controller.setSystemTime(${t})`)}async runFor(e){await this._installIfNeeded();let t=_m(e);await this._browserContext.addInitScript(`globalThis.__pwClock.controller.log('runFor', ${Date.now()}, ${t})`),await this._evaluateInFrames(`globalThis.__pwClock.controller.runFor(${t})`)}async _installIfNeeded(){if(this._scriptInstalled)return;this._scriptInstalled=!0;let e=`(() => {
      const module = {};
      ${bm}
      globalThis.__pwClock = (module.exports.inject())(globalThis);
    })();`;await this._browserContext.addInitScript(e),await this._evaluateInFrames(e)}async _evaluateInFrames(e){await this._browserContext.safeNonStallingEvaluateInAllFrames(e,"main",{throwOnJSErrors:!0})}}});async function Cs(i,e){return new Promise((t,n)=>{if(net.isIP(i)){let r=net.createConnection({host:i,port:e});r.on("connect",()=>t(r)),r.on("error",s=>n(s))}else Sm({host:i,port:e},(r,s)=>{r&&n(r),s&&t(s)},!1).catch(r=>n(r))})}async function xm(i){return new Promise((e,t)=>{if(E(i.host,"host is required"),net.isIP(i.host)){let n=tls.connect(i);n.on("secureConnect",()=>e(n)),n.on("error",r=>t(r))}else Sm(i,(n,r)=>{n&&t(n),r&&(r.on("secureConnect",()=>e(r)),r.on("error",s=>t(s)))},!0).catch(n=>t(n))})}async function Sm(i,e,t){let n=i.__testHookLookup||Sb,r=Pb(i),s=await n(r),o=new Set,l,c=0,h=(f,g)=>{o.delete(f)&&(++c,l??=g,c===s.length&&e?.(l))},m=new U;for(let{address:f}of s){let g=t?tls.connect({...i,port:i.port,host:f,servername:r}):net.createConnection({...i,port:i.port,host:f});if(g.on("connect",()=>{m.resolve(),e?.(null,g),o.delete(g);for(let b of o)b.destroy();o.clear()}),g.on("timeout",()=>{g.destroy(),h(g,new Error("Connection timeout"))}),g.on("error",b=>h(g,b)),o.add(g),await Promise.race([m,new Promise(b=>setTimeout(b,xb))]),m.isDone())break}}async function Sb(i){let e=await dns.promises.lookup(i,{all:!0,family:0,verbatim:!0}),t=e.filter(({family:s})=>s===6),n=e.filter(({family:s})=>s===4);if(t.length&&t[0]!==e[0]){let s=t;t=n,n=s}let r=[];for(let s=0;s<Math.max(t.length,n.length);s++)t[s]&&r.push(t[s]),n[s]&&r.push(n[s]);return r}function Pb(i){if(i.hostname)return i.hostname;if(i.host)return i.host;throw new Error("Either options.hostname or options.host must be provided")}var xb,pd=x(()=>{qe();Li();xb=300});import Cm from"events";function Cb(i){return[...i].reduce((e,t)=>{let n=t.charCodeAt(0);if(n>=48&&n<=57)return e+n;if(n>=97&&n<=102)return e+(n-97)+10;if(n>=65&&n<=70)return e+(n-65)+10;throw new Error("Invalid IPv6 token "+i)},0)}function Pm(i){if(net.isIPv4(i))return[1,...i.split(".",4).map(e=>+e&255)];if(net.isIPv6(i)){let e=[4],t=i.split(":",8);for(;t.length<8;)t.unshift("");for(let n of t){let r=Cb(n);e.push(r>>8&255,r&255)}return e}throw new Error("Only IPv4 and IPv6 addresses are supported")}function kb(i){let e=i.split("*").map(t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join(".*");return new RegExp("^"+e+"$")}function km(i){if(!i)return()=>!1;let e=i.split(",").map(t=>{let n=t.match(/^(.*?)(?::(\d+))?$/);if(!n)throw new Error(`Unsupported token "${t}" in pattern "${i}"`);let r=n[2]?+n[2]:void 0,s=c=>r===void 0||r===c,o=n[1];if(o==="<loopback>")return(c,h)=>s(h)?c==="localhost"||c.endsWith(".localhost")||c==="127.0.0.1"||c==="[::1]":!1;if(o==="*")return(c,h)=>s(h);if(net.isIPv4(o)||net.isIPv6(o))return(c,h)=>c===o&&s(h);o[0]==="."&&(o="*"+o);let l=kb(o);return(c,h)=>!s(h)||net.isIPv4(c)||net.isIPv6(c)?!1:!!c.match(l)});return(t,n)=>e.some(r=>r(t,n))}var md,at,Sn,mr=x(()=>{Te();pd();O();md=class{_buffer=Buffer.from([]);_offset=0;_fence=0;_fenceCallback;_socket;_boundOnData;_uid;_client;constructor(e,t,n){this._uid=e,this._socket=t,this._client=n,this._boundOnData=this._onData.bind(this),t.on("data",this._boundOnData),t.on("close",()=>this._onClose()),t.on("end",()=>this._onClose()),t.on("error",()=>this._onClose()),this._run().catch(()=>this._socket.end())}async _run(){E(await this._authenticate());let{command:e,host:t,port:n}=await this._parseRequest();if(e!==1){this._writeBytes(Buffer.from([5,7,0,1,0,0,0,0,0,0]));return}this._socket.off("data",this._boundOnData),this._client.onSocketRequested({uid:this._uid,host:t,port:n})}async _authenticate(){let e=await this._readByte();E(e===5,"The VER field must be set to x05 for this version of the protocol, was "+e);let t=await this._readByte();E(t,"No authentication methods specified");let n=await this._readBytes(t);for(let r of n)if(r===0)return this._writeBytes(Buffer.from([e,r])),!0;return this._writeBytes(Buffer.from([e,255])),!1}async _parseRequest(){let e=await this._readByte();E(e===5,"The VER field must be set to x05 for this version of the protocol, was "+e);let t=await this._readByte();await this._readByte();let n=await this._readByte(),r="";switch(n){case 1:r=(await this._readBytes(4)).join(".");break;case 3:let o=await this._readByte();r=(await this._readBytes(o)).toString();break;case 4:let l=await this._readBytes(16),c=[];for(let h=0;h<8;++h)c.push(l.readUInt16BE(h*2).toString(16));r=c.join(":");break}let s=(await this._readBytes(2)).readUInt16BE(0);return this._buffer=Buffer.from([]),this._offset=0,this._fence=0,{command:t,host:r,port:s}}async _readByte(){return(await this._readBytes(1))[0]}async _readBytes(e){return this._fence=this._offset+e,(!this._buffer||this._buffer.length<this._fence)&&await new Promise(t=>this._fenceCallback=t),this._offset+=e,this._buffer.slice(this._offset-e,this._offset)}_writeBytes(e){this._socket.writable&&this._socket.write(e)}_onClose(){this._client.onSocketClosed({uid:this._uid})}_onData(e){if(this._buffer=Buffer.concat([this._buffer,e]),this._fenceCallback&&this._buffer.length>=this._fence){let t=this._fenceCallback;this._fenceCallback=void 0,t()}}socketConnected(e,t){this._writeBytes(Buffer.from([5,0,0,...Pm(e),t>>8,t&255])),this._socket.on("data",n=>this._client.onSocketData({uid:this._uid,data:n}))}socketFailed(e){let t=Buffer.from([5,0,0,...Pm("0.0.0.0"),0,0]);switch(e){case"ENOENT":case"ENOTFOUND":case"ETIMEDOUT":case"EHOSTUNREACH":t[1]=4;break;case"ENETUNREACH":t[1]=3;break;case"ECONNREFUSED":t[1]=5;break;case"ERULESET":t[1]=2;break}this._writeBytes(t),this._socket.end()}sendData(e){this._socket.write(e)}end(){this._socket.end()}error(e){this._socket.destroy(new Error(e))}};at=class i extends Cm{static Events={SocksRequested:"socksRequested",SocksData:"socksData",SocksClosed:"socksClosed"};_server;_connections=new Map;_sockets=new Set;_closed=!1;_port;_patternMatcher=()=>!1;_directSockets=new Map;constructor(){super(),this._server=new net.Server(e=>{let t=Y(),n=new md(t,e,this);this._connections.set(t,n)}),this._server.on("connection",e=>{if(this._closed){e.destroy();return}this._sockets.add(e),e.once("close",()=>this._sockets.delete(e))})}setPattern(e){try{this._patternMatcher=km(e)}catch{this._patternMatcher=()=>!1}}async _handleDirect(e){try{let t=await Cs(e.host,e.port);t.on("data",s=>this._connections.get(e.uid)?.sendData(s)),t.on("error",s=>{this._connections.get(e.uid)?.error(s.message),this._directSockets.delete(e.uid)}),t.on("end",()=>{this._connections.get(e.uid)?.end(),this._directSockets.delete(e.uid)});let n=t.localAddress,r=t.localPort;this._directSockets.set(e.uid,t),this._connections.get(e.uid)?.socketConnected(n,r)}catch(t){this._connections.get(e.uid)?.socketFailed(t.code)}}port(){return this._port}async listen(e,t){return new Promise(n=>{this._server.listen(e,t,()=>{let r=this._server.address().port;this._port=r,n(r)})})}async close(){if(!this._closed){this._closed=!0;for(let e of this._sockets)e.destroy();this._sockets.clear(),await new Promise(e=>this._server.close(e))}}onSocketRequested(e){if(!this._patternMatcher(e.host,e.port)){this._handleDirect(e);return}this.emit(i.Events.SocksRequested,e)}onSocketData(e){let t=this._directSockets.get(e.uid);if(t){t.write(e.data);return}this.emit(i.Events.SocksData,e)}onSocketClosed(e){let t=this._directSockets.get(e.uid);if(t){t.destroy(),this._directSockets.delete(e.uid);return}this.emit(i.Events.SocksClosed,e)}socketConnected({uid:e,host:t,port:n}){this._connections.get(e)?.socketConnected(t,n)}socketFailed({uid:e,errorCode:t}){this._connections.get(e)?.socketFailed(t)}sendSocketData({uid:e,data:t}){this._connections.get(e)?.sendData(t)}sendSocketEnd({uid:e}){this._connections.get(e)?.end()}sendSocketError({uid:e,error:t}){this._connections.get(e)?.error(t)}},Sn=class i extends Cm{static Events={SocksConnected:"socksConnected",SocksData:"socksData",SocksError:"socksError",SocksFailed:"socksFailed",SocksEnd:"socksEnd"};_sockets=new Map;_patternMatcher=()=>!1;_redirectPortForTest;constructor(e,t){super(),this._patternMatcher=km(e),this._redirectPortForTest=t}cleanup(){for(let e of this._sockets.keys())this.socketClosed({uid:e})}async socketRequested({uid:e,host:t,port:n}){if(N.log("socks",`[${e}] => request ${t}:${n}`),!this._patternMatcher(t,n)){let r={uid:e,errorCode:"ERULESET"};N.log("socks",`[${e}] <= pattern error ${r.errorCode}`),this.emit(i.Events.SocksFailed,r);return}t==="local.playwright"&&(t="localhost");try{this._redirectPortForTest&&(n=this._redirectPortForTest);let r=await Cs(t,n);r.on("data",c=>{let h={uid:e,data:c};this.emit(i.Events.SocksData,h)}),r.on("error",c=>{let h={uid:e,error:c.message};N.log("socks",`[${e}] <= network socket error ${h.error}`),this.emit(i.Events.SocksError,h),this._sockets.delete(e)}),r.on("end",()=>{let c={uid:e};N.log("socks",`[${e}] <= network socket closed`),this.emit(i.Events.SocksEnd,c),this._sockets.delete(e)});let s=r.localAddress,o=r.localPort;this._sockets.set(e,r);let l={uid:e,host:s,port:o};N.log("socks",`[${e}] <= connected to network ${l.host}:${l.port}`),this.emit(i.Events.SocksConnected,l)}catch(r){let s={uid:e,errorCode:r.code};N.log("socks",`[${e}] <= connect error ${s.errorCode}`),this.emit(i.Events.SocksFailed,s)}}sendSocketData({uid:e,data:t}){this._sockets.get(e)?.write(t)}socketClosed({uid:e}){N.log("socks",`[${e}] <= browser socket closed`),this._sockets.get(e)?.destroy(),this._sockets.delete(e)}}});function Tb(){if(fd)return;let{cert:i,key:e}=Xu();fd={key:e,cert:i}}function Tm(i){try{return new URL(i).origin}catch{return i}}function Rm(i){if(!i||!i.length)return;let e={pfx:[],key:[],cert:[]};for(let t of i)t.cert&&e.cert.push(t.cert),t.key&&e.key.push({pem:t.key,passphrase:t.passphrase}),t.pfx&&e.pfx.push({buf:t.pfx,passphrase:t.passphrase});return e}function bd(i,e){let t=i?.filter(n=>Tm(n.origin)===e);return Rm(t)}function Em(i){return i==="local.playwright"?"localhost":i}function yd(i){return i.message!=="unsupported"?i:ve(i,["Unsupported TLS certificate.","Most likely, the security algorithm of the given certificate was deprecated by OpenSSL.","For more details, see https://github.com/openssl/openssl/blob/master/README-PROVIDERS.md#the-legacy-provider","You could probably modernize the certificate by following the steps at https://github.com/nodejs/node/issues/40672#issuecomment-1243648223"].join(`
`))}var fd,gd,wd,va,_d=x(()=>{pd();O();mr();Te();gd=class{_cache=new Map;get(e,t,n){let r=`${e}:${t}`;{let o=this._cache.get(r);if(o){o.then(n);return}}let s=new U;this._cache.set(r,s),s.then(n),xm({host:e,port:t,servername:net.isIP(e)?void 0:e,ALPNProtocols:["h2","http/1.1"],rejectUnauthorized:!1}).then(o=>{s.resolve(o.alpnProtocol||"http/1.1"),o.end()}).catch(o=>{N.log("client-certificates",`ALPN error: ${o.message}`),s.resolve("http/1.1")})}},wd=class{socksProxy;uid;host;port;firstPackageReceived=!1;target;internal;internalTLS;_targetCloseEventListener;_dummyServer;_closed=!1;constructor(e,t,n,r){this.socksProxy=e,this.uid=t,this.host=n,this.port=r,this._targetCloseEventListener=()=>{this.socksProxy._socksProxy.sendSocketEnd({uid:this.uid}),this.internalTLS?.destroy(),this._dummyServer?.close()}}async connect(){if(this.target=await Cs(Em(this.host),this.port),this.target.once("close",this._targetCloseEventListener),this.target.once("error",e=>this.socksProxy._socksProxy.sendSocketError({uid:this.uid,error:e.message})),this._closed){this.target.destroy();return}this.socksProxy._socksProxy.socketConnected({uid:this.uid,host:this.target.localAddress,port:this.target.localPort})}onClose(){this.target.destroy(),this.internalTLS?.destroy(),this._dummyServer?.close(),this._closed=!0}onData(e){this.firstPackageReceived||(this.firstPackageReceived=!0,e[0]===22?this._attachTLSListeners():this.target.on("data",t=>this.socksProxy._socksProxy.sendSocketData({uid:this.uid,data:t}))),this.internal?this.internal.push(e):this.target.write(e)}_attachTLSListeners(){this.internal=new stream.Duplex({read:()=>{},write:(e,t,n)=>{this.socksProxy._socksProxy.sendSocketData({uid:this.uid,data:e}),n()}}),this.socksProxy.alpnCache.get(Em(this.host),this.port,e=>{N.log("client-certificates",`Proxy->Target ${this.host}:${this.port} chooses ALPN ${e}`),!this._closed&&(this._dummyServer=tls.createServer({...fd,ALPNProtocols:e==="h2"?["h2","http/1.1"]:["http/1.1"]}),this._dummyServer.emit("connection",this.internal),this._dummyServer.once("secureConnection",t=>{this.internalTLS=t,N.log("client-certificates",`Browser->Proxy ${this.host}:${this.port} chooses ALPN ${t.alpnProtocol}`);let n,r=s=>{N.log("client-certificates",`error when connecting to target: ${s.message.replaceAll(`
`," ")}`);let o=Yu("Playwright client-certificate error: "+s.message).replaceAll(`
`," <br>");if(t?.alpnProtocol==="h2")if("performServerHandshake"in http2){this.target.removeListener("close",this._targetCloseEventListener);let l=http2.performServerHandshake(t);l.on("error",()=>{this.target.destroy(),this._targetCloseEventListener()}),l.once("stream",c=>{c.respond({"content-type":"text/html",[http2.constants.HTTP2_HEADER_STATUS]:503});let h=()=>{l.close(),this.target.destroy(),this._targetCloseEventListener()};c.end(o,h),c.once("error",h)})}else this.target.destroy();else t.end(["HTTP/1.1 503 Internal Server Error","Content-Type: text/html; charset=utf-8","Content-Length: "+Buffer.byteLength(o),"",o].join(`\r
`)),this.target.destroy()};if(this._closed){t.destroy();return}n=tls.connect({socket:this.target,host:this.host,port:this.port,rejectUnauthorized:!this.socksProxy.ignoreHTTPSErrors,ALPNProtocols:[t.alpnProtocol||"http/1.1"],servername:net.isIP(this.host)?void 0:this.host,secureContext:this.socksProxy.secureContextMap.get(new URL(`https://${this.host}:${this.port}`).origin)}),n.once("secureConnect",()=>{t.pipe(n),n.pipe(t)}),t.once("error",()=>this.target.destroy()),n.once("error",r)}))})}},va=class{_socksProxy;_connections=new Map;ignoreHTTPSErrors;secureContextMap=new Map;alpnCache;constructor(e){this.alpnCache=new gd,this.ignoreHTTPSErrors=e.ignoreHTTPSErrors,this._initSecureContexts(e.clientCertificates),this._socksProxy=new at,this._socksProxy.setPattern("*"),this._socksProxy.addListener(at.Events.SocksRequested,async t=>{try{let n=new wd(this,t.uid,t.host,t.port);await n.connect(),this._connections.set(t.uid,n)}catch(n){this._socksProxy.socketFailed({uid:t.uid,errorCode:n.code})}}),this._socksProxy.addListener(at.Events.SocksData,async t=>{this._connections.get(t.uid)?.onData(t.data)}),this._socksProxy.addListener(at.Events.SocksClosed,t=>{this._connections.get(t.uid)?.onClose(),this._connections.delete(t.uid)}),Tb()}_initSecureContexts(e){let t=new Map;for(let n of e||[]){let r=Tm(n.origin),s=t.get(r)||[];s.push(n),t.set(r,s)}for(let[n,r]of t)try{this.secureContextMap.set(n,tls.createSecureContext(Rm(r)))}catch(s){throw s=yd(s),ve(s,`Failed to load client certificate: ${s.message}`)}}async listen(){return`socks5://127.0.0.1:${await this._socksProxy.listen(0,"127.0.0.1")}`}async close(){await this._socksProxy.close()}}});import Am from"path";async function vd(i,e){let t=[...e.persistentContextOptions?.args??[]];i.name()==="chromium"&&t.push("--app=data:text/html,",`--window-size=${e.windowSize.width},${e.windowSize.height}`,...e.windowPosition?[`--window-position=${e.windowPosition.x},${e.windowPosition.y}`]:[],"--test-type=");let n=await i.launchPersistentContext(ge(),"",{channel:e.persistentContextOptions?.executablePath?void 0:Kh(e.sdkLanguage),noDefaultViewport:!0,ignoreDefaultArgs:["--enable-automation"],colorScheme:"no-override",acceptDownloads:ce()?"accept":"internal-browser-default",...e?.persistentContextOptions,args:t}),[r]=n.pages();return i.name()==="chromium"&&process.platform==="darwin"&&n.on("page",async s=>{s.mainFrame().url()==="chrome://new-tab-page/"&&(await r.bringToFront(),await s.close(ge()))}),i.name()==="chromium"&&await Rb(r),{context:n,page:r}}async function Rb(i){let e=await fs.promises.readFile(ku.resolve("./chromium/appIcon.png"));await i._delegate._mainFrameSession._client.send("Browser.setDockTile",{image:e.toString("base64")})}async function xd(i,e){if(ce())return;let t=Am.join(vt,".settings",`${e}.json`);await i.exposeBinding("_saveSerializedSettings",!1,(r,s)=>{fs.mkdirSync(Am.dirname(t),{recursive:!0}),fs.writeFileSync(t,s)});let n=await fs.promises.readFile(t,"utf-8").catch(()=>"{}");await i.addInitScript(`(${String(r=>{location&&location.protocol==="data:"||window.top===window&&(Object.entries(r).map(([s,o])=>localStorage[s]=o),window.saveSettings=()=>{window._saveSerializedSettings(JSON.stringify({...localStorage}))})})})(${n});
  `)}var ks=x(()=>{fn();O();ye();fn()});import Ab from"path";var xa,Fm=x(()=>{nt();O();Gr();xa=class{artifact;url;_page;_suggestedFilename;constructor(e,t,n,r,s){let o=e._browserContext._options.acceptDownloads==="deny"?"Pass { acceptDownloads: true } when you are creating your browser context.":void 0;this.artifact=new St(e,Ab.join(t,n),o,()=>this._page._browserContext.cancelDownload(n)),this._page=e,this.url=r,this._suggestedFilename=s,e._browserContext._downloads.add(this),s!==void 0&&this._page.emit(re.Events.Download,this)}_filenameSuggested(e){E(this._suggestedFilename===void 0),this._suggestedFilename=e,this._page.emit(re.Events.Download,this)}suggestedFilename(){return this._suggestedFilename}}});var Pt,Es=x(()=>{Oe();nt();Fm();ye();Gr();Pt=class i extends se{static Events={Disconnected:"disconnected"};options;_downloads=new Map;_defaultContext=null;_startedClosing=!1;_idToVideo=new Map;_contextForReuse;_closeReason;_isCollocatedWithServer=!0;constructor(e,t){super(e,"browser"),this.attribution.browser=this,this.options=t,this.instrumentation.onBrowserOpen(this)}async newContext(e,t){ti(t,this.options);let n=await Sa(t,this.options),r;try{r=await this.doCreateNewContext(t)}catch(s){throw await n?.close(),s}return r._clientCertificatesProxy=n,t.storageState&&await r.setStorageState(e,t.storageState),r}async newContextForReuse(e,t){let n=j.reusableContextHash(e);return!this._contextForReuse||n!==this._contextForReuse.hash||!this._contextForReuse.context.canResetForReuse()?(this._contextForReuse&&await this._contextForReuse.context.close({reason:"Context reused"}),this._contextForReuse={context:await this.newContext(t,e),hash:n},{context:this._contextForReuse.context,needsReset:!1}):(await this._contextForReuse.context.stopPendingOperations("Context recreated"),{context:this._contextForReuse.context,needsReset:!0})}async stopPendingOperations(e){await this._contextForReuse?.context?.stopPendingOperations(e)}_downloadCreated(e,t,n,r){let s=new xa(e,this.options.downloadsPath||"",t,n,r);this._downloads.set(t,s)}_downloadFilenameSuggested(e,t){let n=this._downloads.get(e);n&&n._filenameSuggested(t)}_downloadFinished(e,t){let n=this._downloads.get(e);n&&(n.artifact.reportFinished(t?new Error(t):void 0),this._downloads.delete(e))}_videoStarted(e,t,n,r){let s=new St(e,n);this._idToVideo.set(t,{context:e,artifact:s}),r.then(o=>{o instanceof re&&(o._video=s,o.emitOnContext(j.Events.VideoStarted,s),o.emit(re.Events.Video,s))})}_takeVideo(e){let t=this._idToVideo.get(e);return this._idToVideo.delete(e),t?.artifact}_didClose(){for(let e of this.contexts())e._browserClosed();this._defaultContext&&this._defaultContext._browserClosed(),this.emit(i.Events.Disconnected),this.instrumentation.onBrowserClose(this)}async close(e){this._startedClosing||(e.reason&&(this._closeReason=e.reason),this._startedClosing=!0,await this.options.browserProcess.close()),this.isConnected()&&await new Promise(t=>this.once(i.Events.Disconnected,t))}async killForTests(){await this.options.browserProcess.kill()}}});import{EventEmitter as Pd}from"events";var Cd,kd,Pa,Sd,ni,Ca=x(()=>{O();Te();Ot();gn();Cd={Disconnected:Symbol("ConnectionEvents.Disconnected")},kd=-9999,Pa=class extends Pd{_lastId=0;_transport;_sessions=new Map;_protocolLogger;_browserLogsCollector;_browserDisconnectedLogs;rootSession;_closed=!1;constructor(e,t,n){super(),this.setMaxListeners(0),this._transport=e,this._protocolLogger=t,this._browserLogsCollector=n,this.rootSession=new Sd(this,null,""),this._sessions.set("",this.rootSession),this._transport.onmessage=this._onMessage.bind(this),this._transport.onclose=this._onClose.bind(this)}_rawSend(e,t,n){let r=++this._lastId,s={id:r,method:t,params:n};return e&&(s.sessionId=e),this._protocolLogger("send",s),this._transport.send(s),r}async _onMessage(e){if(this._protocolLogger("receive",e),e.id===kd)return;let t=this._sessions.get(e.sessionId||"");t&&t._onMessage(e)}_onClose(e){this._closed=!0,this._transport.onmessage=void 0,this._transport.onclose=void 0,this._browserDisconnectedLogs=le.formatBrowserLogs(this._browserLogsCollector.recentLogs(),e),this.rootSession.dispose(),Promise.resolve().then(()=>this.emit(Cd.Disconnected))}close(){this._closed||this._transport.close()}async createBrowserSession(){let{sessionId:e}=await this.rootSession.send("Target.attachToBrowserTarget");return new ni(this.rootSession,e)}},Sd=class i extends Pd{_connection;_eventListener;_callbacks=new Map;_sessionId;_parentSession;_crashed=!1;_closed=!1;on;addListener;off;removeListener;once;constructor(e,t,n,r){super(),this.setMaxListeners(0),this._connection=e,this._parentSession=t,this._sessionId=n,this._eventListener=r,this.on=super.on,this.addListener=super.addListener,this.off=super.removeListener,this.removeListener=super.removeListener,this.once=super.once}_markAsCrashed(){this._crashed=!0}createChildSession(e,t){let n=new i(this._connection,this,e,t);return this._connection._sessions.set(e,n),n}async send(e,t){if(this._crashed||this._closed||this._connection._closed||this._connection._browserDisconnectedLogs)throw new ar(this._crashed?"crashed":"closed",void 0,this._connection._browserDisconnectedLogs);let n=this._connection._rawSend(this._sessionId,e,t);return new Promise((r,s)=>{this._callbacks.set(n,{resolve:r,reject:s,error:new ar("error",e)})})}_sendMayFail(e,t){return this.send(e,t).catch(n=>N.log("error",n))}_onMessage(e){if(e.id&&this._callbacks.has(e.id)){let t=this._callbacks.get(e.id);this._callbacks.delete(e.id),e.error?(t.error.setMessage(e.error.message),t.reject(t.error)):t.resolve(e.result)}else e.id&&e.error?.code===-32001||(E(!e.id,e?.error?.message||void 0),Promise.resolve().then(()=>{this._eventListener&&this._eventListener(e.method,e.params),this.emit(e.method,e.params)}))}async detach(){if(this._closed)throw new Error("Session already detached. Most likely the page has been closed.");if(!this._parentSession)throw new Error("Root session cannot be closed");await this._sendMayFail("Runtime.runIfWaitingForDebugger"),await this._parentSession.send("Target.detachFromTarget",{sessionId:this._sessionId}),this.dispose()}dispose(){this._closed=!0,this._connection._sessions.delete(this._sessionId);for(let e of this._callbacks.values())e.error.setMessage("Internal server error, session closed."),e.error.type=this._crashed?"crashed":"closed",e.error.logs=this._connection._browserDisconnectedLogs,e.reject(e.error);this._callbacks.clear()}},ni=class i extends Pd{static Events={Event:"event",Closed:"close"};guid;_session;_listeners=[];constructor(e,t){super(),this.guid=`cdp-session@${t}`,this._session=e.createChildSession(t,(n,r)=>this.emit(i.Events.Event,{method:n,params:r})),this._listeners=[L.addEventListener(e,"Target.detachedFromTarget",n=>{n.sessionId===t&&this._onClose()})]}async send(e,t){return await this._session.send(e,t)}async detach(){return await this._session.detach()}async attachToTarget(e){let{sessionId:t}=await this.send("Target.attachToTarget",{targetId:e,flatten:!0});return new i(this._session,t)}_onClose(){L.removeEventListeners(this._listeners),this._session.dispose(),this.emit(i.Events.Closed)}}});var ka,Im=x(()=>{O();ye();ka=class extends se{_page;_type;_message;_onHandle;_handled=!1;_defaultValue;constructor(e,t,n,r,s){super(e,"dialog"),this._page=e,this._type=t,this._message=n,this._onHandle=r,this._defaultValue=s||"",this._page._frameManager.dialogDidOpen(this)}page(){return this._page}type(){return this._type}message(){return this._message}defaultValue(){return this._defaultValue}async accept(e){E(!this._handled,"Cannot accept dialog which is already handled!"),this._handled=!0,this._page._frameManager.dialogWillClose(this),await this._onHandle(!0,e)}async dismiss(){E(!this._handled,"Cannot dismiss dialog which is already handled!"),this._handled=!0,this._page._frameManager.dialogWillClose(this),await this._onHandle(!1)}async close(){this._type==="beforeunload"?await this.accept():await this.dismiss()}}});async function Lm(i,e){let{nodes:t}=await i.send("Accessibility.getFullAXTree"),n=Ed.createTree(i,t);return{tree:n,needle:e?await n._findElement(e):null}}var Ed,Om=x(()=>{Ed=class i{_payload;_children=[];_richlyEditable=!1;_editable=!1;_focusable=!1;_expanded=!1;_hidden=!1;_name;_role;_cachedHasFocusableChild;_client;constructor(e,t){this._client=e,this._payload=t,this._name=this._payload.name?this._payload.name.value:"",this._role=this._payload.role?this._payload.role.value:"Unknown";for(let n of this._payload.properties||[])n.name==="editable"&&(this._richlyEditable=n.value.value==="richtext",this._editable=!0),n.name==="focusable"&&(this._focusable=n.value.value),n.name==="expanded"&&(this._expanded=n.value.value),n.name==="hidden"&&(this._hidden=n.value.value)}_isPlainTextField(){return this._richlyEditable?!1:this._editable?!0:this._role==="textbox"||this._role==="ComboBox"||this._role==="searchbox"}_isTextOnlyObject(){let e=this._role;return e==="LineBreak"||e==="text"||e==="InlineTextBox"||e==="StaticText"}_hasFocusableChild(){if(this._cachedHasFocusableChild===void 0){this._cachedHasFocusableChild=!1;for(let e of this._children)if(e._focusable||e._hasFocusableChild()){this._cachedHasFocusableChild=!0;break}}return this._cachedHasFocusableChild}children(){return this._children}async _findElement(e){let t=e._objectId,{node:{backendNodeId:n}}=await this._client.send("DOM.describeNode",{objectId:t});return this.find(s=>s._payload.backendDOMNodeId===n)||null}find(e){if(e(this))return this;for(let t of this._children){let n=t.find(e);if(n)return n}return null}isLeafNode(){if(!this._children.length||this._isPlainTextField()||this._isTextOnlyObject())return!0;switch(this._role){case"doc-cover":case"graphics-symbol":case"img":case"Meter":case"scrollbar":case"slider":case"separator":case"progressbar":return!0;default:break}return this._hasFocusableChild()?!1:!!(this._focusable&&this._role!=="WebArea"&&this._role!=="RootWebArea"&&this._name||this._role==="heading"&&this._name)}isControl(){switch(this._role){case"button":case"checkbox":case"ColorWell":case"combobox":case"DisclosureTriangle":case"listbox":case"menu":case"menubar":case"menuitem":case"menuitemcheckbox":case"menuitemradio":case"radio":case"scrollbar":case"searchbox":case"slider":case"spinbutton":case"switch":case"tab":case"textbox":case"tree":return!0;default:return!1}}isInteresting(e){return this._role==="Ignored"||this._hidden?!1:this._focusable||this._richlyEditable||this.isControl()?!0:e?!1:this.isLeafNode()&&!!this._name}normalizedRole(){switch(this._role){case"RootWebArea":return"WebArea";case"StaticText":return"text";default:return this._role}}serialize(){let e=new Map;for(let c of this._payload.properties||[])e.set(c.name.toLowerCase(),c.value.value);this._payload.description&&e.set("description",this._payload.description.value);let t={role:this.normalizedRole(),name:this._payload.name&&this._payload.name.value||""},n=["description","keyshortcuts","roledescription","valuetext"];for(let c of n)e.has(c)&&(t[c]=e.get(c));let r=["disabled","expanded","focused","modal","multiline","multiselectable","readonly","required","selected"];for(let c of r){if(c==="focused"&&(this._role==="WebArea"||this._role==="RootWebArea"))continue;let h=e.get(c);h&&(t[c]=h)}let s=["level","valuemax","valuemin"];for(let c of s)e.has(c)&&(t[c]=e.get(c));let o=["autocomplete","haspopup","invalid","orientation"];for(let c of o){let h=e.get(c);!h||h==="false"||(t[c]=h)}let l=t;return this._payload.value&&(typeof this._payload.value.value=="string"&&(l.valueString=this._payload.value.value),typeof this._payload.value.value=="number"&&(l.valueNumber=this._payload.value.value)),e.has("checked")&&(l.checked=e.get("checked")==="true"?"checked":e.get("checked")==="false"?"unchecked":"mixed"),e.has("pressed")&&(l.pressed=e.get("pressed")==="true"?"pressed":e.get("pressed")==="false"?"released":"mixed"),l}static createTree(e,t){let n=new Map;for(let r of t)n.set(r.nodeId,new i(e,r));for(let r of n.values())for(let s of r._payload.childIds||[])r._children.push(n.get(s));return n.values().next().value}}});function Ib(i){let e=[];for(let s of i)e.push({offset:s.startOffset,type:0,range:s}),e.push({offset:s.endOffset,type:1,range:s});e.sort((s,o)=>{if(s.offset!==o.offset)return s.offset-o.offset;if(s.type!==o.type)return o.type-s.type;let l=s.range.endOffset-s.range.startOffset,c=o.range.endOffset-o.range.startOffset;return s.type===0?c-l:l-c});let t=[],n=[],r=0;for(let s of e){if(t.length&&r<s.offset&&t[t.length-1]>0){let o=n.length?n[n.length-1]:null;o&&o.end===r?o.end=s.offset:n.push({start:r,end:s.offset})}r=s.offset,s.type===0?t.push(s.range.count):t.pop()}return n.filter(s=>s.end-s.start>1)}var Ea,Td,Rd,Mm=x(()=>{It();O();Ea=class{_jsCoverage;_cssCoverage;constructor(e){this._jsCoverage=new Td(e),this._cssCoverage=new Rd(e)}async startJSCoverage(e){return await this._jsCoverage.start(e)}async stopJSCoverage(){return await this._jsCoverage.stop()}async startCSSCoverage(e){return await this._cssCoverage.start(e)}async stopCSSCoverage(){return await this._cssCoverage.stop()}},Td=class{_client;_enabled;_scriptIds;_scriptSources;_eventListeners;_resetOnNavigation;_reportAnonymousScripts=!1;constructor(e){this._client=e,this._enabled=!1,this._scriptIds=new Set,this._scriptSources=new Map,this._eventListeners=[],this._resetOnNavigation=!1}async start(e){E(!this._enabled,"JSCoverage is already enabled");let{resetOnNavigation:t=!0,reportAnonymousScripts:n=!1}=e;this._resetOnNavigation=t,this._reportAnonymousScripts=n,this._enabled=!0,this._scriptIds.clear(),this._scriptSources.clear(),this._eventListeners=[L.addEventListener(this._client,"Debugger.scriptParsed",this._onScriptParsed.bind(this)),L.addEventListener(this._client,"Runtime.executionContextsCleared",this._onExecutionContextsCleared.bind(this)),L.addEventListener(this._client,"Debugger.paused",this._onDebuggerPaused.bind(this))],await Promise.all([this._client.send("Profiler.enable"),this._client.send("Profiler.startPreciseCoverage",{callCount:!0,detailed:!0}),this._client.send("Debugger.enable"),this._client.send("Debugger.setSkipAllPauses",{skip:!0})])}_onDebuggerPaused(){this._client.send("Debugger.resume")}_onExecutionContextsCleared(){this._resetOnNavigation&&(this._scriptIds.clear(),this._scriptSources.clear())}async _onScriptParsed(e){if(this._scriptIds.add(e.scriptId),!e.url&&!this._reportAnonymousScripts)return;let t=await this._client._sendMayFail("Debugger.getScriptSource",{scriptId:e.scriptId});t&&this._scriptSources.set(e.scriptId,t.scriptSource)}async stop(){E(this._enabled,"JSCoverage is not enabled"),this._enabled=!1;let[e]=await Promise.all([this._client.send("Profiler.takePreciseCoverage"),this._client.send("Profiler.stopPreciseCoverage"),this._client.send("Profiler.disable"),this._client.send("Debugger.disable")]);L.removeEventListeners(this._eventListeners);let t={entries:[]};for(let n of e.result){if(!this._scriptIds.has(n.scriptId)||!n.url&&!this._reportAnonymousScripts)continue;let r=this._scriptSources.get(n.scriptId);r?t.entries.push({...n,source:r}):t.entries.push(n)}return t}},Rd=class{_client;_enabled;_stylesheetURLs;_stylesheetSources;_eventListeners;_resetOnNavigation;constructor(e){this._client=e,this._enabled=!1,this._stylesheetURLs=new Map,this._stylesheetSources=new Map,this._eventListeners=[],this._resetOnNavigation=!1}async start(e){E(!this._enabled,"CSSCoverage is already enabled");let{resetOnNavigation:t=!0}=e;this._resetOnNavigation=t,this._enabled=!0,this._stylesheetURLs.clear(),this._stylesheetSources.clear(),this._eventListeners=[L.addEventListener(this._client,"CSS.styleSheetAdded",this._onStyleSheet.bind(this)),L.addEventListener(this._client,"Runtime.executionContextsCleared",this._onExecutionContextsCleared.bind(this))],await Promise.all([this._client.send("DOM.enable"),this._client.send("CSS.enable"),this._client.send("CSS.startRuleUsageTracking")])}_onExecutionContextsCleared(){this._resetOnNavigation&&(this._stylesheetURLs.clear(),this._stylesheetSources.clear())}async _onStyleSheet(e){let t=e.header;if(!t.sourceURL)return;let n=await this._client._sendMayFail("CSS.getStyleSheetText",{styleSheetId:t.styleSheetId});n&&(this._stylesheetURLs.set(t.styleSheetId,t.sourceURL),this._stylesheetSources.set(t.styleSheetId,n.text))}async stop(){E(this._enabled,"CSSCoverage is not enabled"),this._enabled=!1;let e=await this._client.send("CSS.stopRuleUsageTracking");await Promise.all([this._client.send("CSS.disable"),this._client.send("DOM.disable")]),L.removeEventListeners(this._eventListeners);let t=new Map;for(let r of e.ruleUsage){let s=t.get(r.styleSheetId);s||(s=[],t.set(r.styleSheetId,s)),s.push({startOffset:r.startOffset,endOffset:r.endOffset,count:r.used?1:0})}let n={entries:[]};for(let r of this._stylesheetURLs.keys()){let s=this._stylesheetURLs.get(r),o=this._stylesheetSources.get(r),l=Ib(t.get(r)||[]);n.entries.push({url:s,ranges:l,text:o})}return n}}});function Ts(i){if(i.exception)return i.exception.description||String(i.exception.value);let e=i.text;if(i.stackTrace)for(let t of i.stackTrace.callFrames){let n=t.url+":"+t.lineNumber+":"+t.columnNumber,r=t.functionName||"<anonymous>";e+=`
    at ${r} (${n})`}return e}async function Ta(i,e){await i.send("Runtime.releaseObject",{objectId:e}).catch(t=>{})}async function Nm(i,e,t){let n=!1;await We(t);let r=await fs.promises.open(t,"w");for(;!n;){let s=await i.send("IO.read",{handle:e});n=s.eof;let o=Buffer.from(s.data,s.base64Encoded?"base64":void 0);await r.write(o)}await r.close(),await i.send("IO.close",{handle:e})}async function Hm(i,e){let t=!1,n=[];for(;!t;){let r=await i.send("IO.read",{handle:e});t=r.eof;let s=Buffer.from(r.data,r.base64Encoded?"base64":void 0);n.push(s)}return await i.send("IO.close",{handle:e}),Buffer.concat(n)}function Ad(i){return i&&i.callFrames.length?{url:i.callFrames[0].url,lineNumber:i.callFrames[0].lineNumber,columnNumber:i.callFrames[0].columnNumber}:{url:"",lineNumber:0,columnNumber:0}}function Fd(i){let e=Ts(i),t=e.split(`
`),n=t.findIndex(m=>m.startsWith("    at")),r="",s="";n===-1?r=e:(r=t.slice(0,n).join(`
`),s=e);let{name:o,message:l}=ah(r),c=new Error(l);c.stack=s;let h=i.exception?.preview?.properties.find(m=>m.name==="name");return c.name=h?h.value??"Error":o,c}function gt(i){let e=0;return i.has("Alt")&&(e|=1),i.has("Control")&&(e|=2),i.has("Meta")&&(e|=4),i.has("Shift")&&(e|=8),e}function Ra(i){let e=0;return i.has("left")&&(e|=1),i.has("right")&&(e|=2),i.has("middle")&&(e|=4),e}var fr=x(()=>{_t();Lt()});var Aa,Dm=x(()=>{O();fr();Aa=class{_crPage;_dragState=null;_lastPosition={x:0,y:0};constructor(e){this._crPage=e}async cancelDrag(){return this._dragState?(await this._crPage._mainFrameSession._client.send("Input.dispatchDragEvent",{type:"dragCancel",x:this._lastPosition.x,y:this._lastPosition.y,data:{items:[],dragOperationsMask:65535}}),this._dragState=null,!0):!1}async interceptDragCausedByMove(e,t,n,r,s,o){if(this._lastPosition={x:e,y:t},this._dragState){await this._crPage._mainFrameSession._client.send("Input.dispatchDragEvent",{type:"dragOver",x:e,y:t,data:this._dragState,modifiers:gt(s)});return}if(n!=="left")return o();let l=this._crPage._mainFrameSession._client,c,h=new Promise(g=>c=g);function m(){let g=Promise.resolve(!1),b=null,v=_=>b=_,S=()=>{g=new Promise(_=>{window.addEventListener("dragstart",v,{once:!0,capture:!0}),setTimeout(()=>_(b?!b.defaultPrevented:!1),0)})};window.addEventListener("mousemove",S,{once:!0,capture:!0}),window.__cleanupDrag=async()=>{let _=await g;return window.removeEventListener("mousemove",S,{capture:!0}),window.removeEventListener("dragstart",v,{capture:!0}),delete window.__cleanupDrag,_}}await this._crPage._page.safeNonStallingEvaluateInAllFrames(`(${m.toString()})()`,"utility"),l.on("Input.dragIntercepted",c);try{await l.send("Input.setInterceptDrags",{enabled:!0})}catch{return l.off("Input.dragIntercepted",c),o()}await o();let f=(await Promise.all(this._crPage._page.frames().map(async g=>g.nonStallingEvaluateInExistingContext("window.__cleanupDrag && window.__cleanupDrag()","utility").catch(()=>!1)))).some(g=>g);this._dragState=f?(await h).data:null,l.off("Input.dragIntercepted",c),await l.send("Input.setInterceptDrags",{enabled:!1}),this._dragState&&await this._crPage._mainFrameSession._client.send("Input.dispatchDragEvent",{type:"dragEnter",x:e,y:t,data:this._dragState,modifiers:gt(s)})}isDragging(){return!!this._dragState}async drop(e,t,n){E(this._dragState,"missing drag state"),await this._crPage._mainFrameSession._client.send("Input.dispatchDragEvent",{type:"drop",x:e,y:t,data:this._dragState,modifiers:gt(n)}),this._dragState=null}}});function Id(i){if(i.message.includes("Object reference chain is too long"))return{result:{type:"undefined"}};if(i.message.includes("Object couldn't be returned by value"))return{result:{type:"undefined"}};throw i instanceof TypeError&&i.message.startsWith("Converting circular structure to JSON")&&ve(i,i.message+" Are you passing a nested JSHandle?"),!ot(i)&&!mt(i)?new Error("Execution context was destroyed, most likely because of a navigation."):i}function Lb(i){let e=i.value,t=i.unserializableValue;return t?ap(t):e}function Ob(i){if(i.type==="undefined")return"undefined";if("value"in i)return String(i.value);if(i.unserializableValue)return String(i.unserializableValue);if(i.description==="Object"&&i.preview){let e=[];for(let{name:t,value:n}of i.preview.properties)e.push(`${t}: ${n}`);return`{${e.join(", ")}}`}return i.subtype==="array"&&i.preview?lp(i.preview.properties):i.description}var gr,Ld=x(()=>{fr();ms();Lt();Uo();gn();gr=class{_client;_contextId;constructor(e,t){this._client=e,this._contextId=t.id}async rawEvaluateJSON(e){let{exceptionDetails:t,result:n}=await this._client.send("Runtime.evaluate",{expression:e,contextId:this._contextId,returnByValue:!0}).catch(Id);if(t)throw new vn(Ts(t));return n.value}async rawEvaluateHandle(e){let{exceptionDetails:t,result:n}=await this._client.send("Runtime.evaluate",{expression:e,contextId:this._contextId}).catch(Id);if(t)throw new vn(Ts(t));return n.objectId}rawCallFunctionNoReply(e,...t){this._client.send("Runtime.callFunctionOn",{functionDeclaration:e.toString(),arguments:t.map(n=>n instanceof Kt?{objectId:n._objectId}:{value:n}),returnByValue:!0,executionContextId:this._contextId,userGesture:!0}).catch(()=>{})}async evaluateWithArguments(e,t,n,r,s){let{exceptionDetails:o,result:l}=await this._client.send("Runtime.callFunctionOn",{functionDeclaration:e,objectId:n._objectId,arguments:[{objectId:n._objectId},...r.map(c=>({value:c})),...s.map(c=>({objectId:c}))],returnByValue:t,awaitPromise:!0,userGesture:!0}).catch(Id);if(o)throw new vn(Ts(o));return t?zo(l.value):n._context.createHandle(l)}async getProperties(e,t){let n=await this._client.send("Runtime.getProperties",{objectId:t,ownProperties:!0}),r=new Map;for(let s of n.result)!s.enumerable||!s.value||r.set(s.name,e.createHandle(s.value));return r}createHandle(e,t){return new Kt(e,t.subtype||t.type,Ob(t),t.objectId,Lb(t))}async releaseHandle(e){await Ta(this._client,e)}async objectCount(e){return+(await this._client.send("Runtime.queryObjects",{prototypeObjectId:e})).objects.description.match(/Array\((\d+)\)/)[1]}}});var Bm,$m=x(()=>{Bm={Backspace:"deleteBackward:",Enter:"insertNewline:",NumpadEnter:"insertNewline:",Escape:"cancelOperation:",ArrowUp:"moveUp:",ArrowDown:"moveDown:",ArrowLeft:"moveLeft:",ArrowRight:"moveRight:",F5:"complete:",Delete:"deleteForward:",Home:"scrollToBeginningOfDocument:",End:"scrollToEndOfDocument:",PageUp:"scrollPageUp:",PageDown:"scrollPageDown:","Shift+Backspace":"deleteBackward:","Shift+Enter":"insertNewline:","Shift+NumpadEnter":"insertNewline:","Shift+Escape":"cancelOperation:","Shift+ArrowUp":"moveUpAndModifySelection:","Shift+ArrowDown":"moveDownAndModifySelection:","Shift+ArrowLeft":"moveLeftAndModifySelection:","Shift+ArrowRight":"moveRightAndModifySelection:","Shift+F5":"complete:","Shift+Delete":"deleteForward:","Shift+Home":"moveToBeginningOfDocumentAndModifySelection:","Shift+End":"moveToEndOfDocumentAndModifySelection:","Shift+PageUp":"pageUpAndModifySelection:","Shift+PageDown":"pageDownAndModifySelection:","Shift+Numpad5":"delete:","Control+Tab":"selectNextKeyView:","Control+Enter":"insertLineBreak:","Control+NumpadEnter":"insertLineBreak:","Control+Quote":"insertSingleQuoteIgnoringSubstitution:","Control+KeyA":"moveToBeginningOfParagraph:","Control+KeyB":"moveBackward:","Control+KeyD":"deleteForward:","Control+KeyE":"moveToEndOfParagraph:","Control+KeyF":"moveForward:","Control+KeyH":"deleteBackward:","Control+KeyK":"deleteToEndOfParagraph:","Control+KeyL":"centerSelectionInVisibleArea:","Control+KeyN":"moveDown:","Control+KeyO":["insertNewlineIgnoringFieldEditor:","moveBackward:"],"Control+KeyP":"moveUp:","Control+KeyT":"transpose:","Control+KeyV":"pageDown:","Control+KeyY":"yank:","Control+Backspace":"deleteBackwardByDecomposingPreviousCharacter:","Control+ArrowUp":"scrollPageUp:","Control+ArrowDown":"scrollPageDown:","Control+ArrowLeft":"moveToLeftEndOfLine:","Control+ArrowRight":"moveToRightEndOfLine:","Shift+Control+Enter":"insertLineBreak:","Shift+Control+NumpadEnter":"insertLineBreak:","Shift+Control+Tab":"selectPreviousKeyView:","Shift+Control+Quote":"insertDoubleQuoteIgnoringSubstitution:","Shift+Control+KeyA":"moveToBeginningOfParagraphAndModifySelection:","Shift+Control+KeyB":"moveBackwardAndModifySelection:","Shift+Control+KeyE":"moveToEndOfParagraphAndModifySelection:","Shift+Control+KeyF":"moveForwardAndModifySelection:","Shift+Control+KeyN":"moveDownAndModifySelection:","Shift+Control+KeyP":"moveUpAndModifySelection:","Shift+Control+KeyV":"pageDownAndModifySelection:","Shift+Control+Backspace":"deleteBackwardByDecomposingPreviousCharacter:","Shift+Control+ArrowUp":"scrollPageUp:","Shift+Control+ArrowDown":"scrollPageDown:","Shift+Control+ArrowLeft":"moveToLeftEndOfLineAndModifySelection:","Shift+Control+ArrowRight":"moveToRightEndOfLineAndModifySelection:","Alt+Backspace":"deleteWordBackward:","Alt+Enter":"insertNewlineIgnoringFieldEditor:","Alt+NumpadEnter":"insertNewlineIgnoringFieldEditor:","Alt+Escape":"complete:","Alt+ArrowUp":["moveBackward:","moveToBeginningOfParagraph:"],"Alt+ArrowDown":["moveForward:","moveToEndOfParagraph:"],"Alt+ArrowLeft":"moveWordLeft:","Alt+ArrowRight":"moveWordRight:","Alt+Delete":"deleteWordForward:","Alt+PageUp":"pageUp:","Alt+PageDown":"pageDown:","Shift+Alt+Backspace":"deleteWordBackward:","Shift+Alt+Enter":"insertNewlineIgnoringFieldEditor:","Shift+Alt+NumpadEnter":"insertNewlineIgnoringFieldEditor:","Shift+Alt+Escape":"complete:","Shift+Alt+ArrowUp":"moveParagraphBackwardAndModifySelection:","Shift+Alt+ArrowDown":"moveParagraphForwardAndModifySelection:","Shift+Alt+ArrowLeft":"moveWordLeftAndModifySelection:","Shift+Alt+ArrowRight":"moveWordRightAndModifySelection:","Shift+Alt+Delete":"deleteWordForward:","Shift+Alt+PageUp":"pageUp:","Shift+Alt+PageDown":"pageDown:","Control+Alt+KeyB":"moveWordBackward:","Control+Alt+KeyF":"moveWordForward:","Control+Alt+Backspace":"deleteWordBackward:","Shift+Control+Alt+KeyB":"moveWordBackwardAndModifySelection:","Shift+Control+Alt+KeyF":"moveWordForwardAndModifySelection:","Shift+Control+Alt+Backspace":"deleteWordBackward:","Meta+NumpadSubtract":"cancel:","Meta+Backspace":"deleteToBeginningOfLine:","Meta+ArrowUp":"moveToBeginningOfDocument:","Meta+ArrowDown":"moveToEndOfDocument:","Meta+ArrowLeft":"moveToLeftEndOfLine:","Meta+ArrowRight":"moveToRightEndOfLine:","Shift+Meta+NumpadSubtract":"cancel:","Shift+Meta+Backspace":"deleteToBeginningOfLine:","Shift+Meta+ArrowUp":"moveToBeginningOfDocumentAndModifySelection:","Shift+Meta+ArrowDown":"moveToEndOfDocumentAndModifySelection:","Shift+Meta+ArrowLeft":"moveToLeftEndOfLineAndModifySelection:","Shift+Meta+ArrowRight":"moveToRightEndOfLineAndModifySelection:","Meta+KeyA":"selectAll:","Meta+KeyC":"copy:","Meta+KeyX":"cut:","Meta+KeyV":"paste:","Meta+KeyZ":"undo:","Shift+Meta+KeyZ":"redo:"}});var Fa,Ia,La,jm=x(()=>{Yc();$m();O();fr();Fa=class{constructor(e,t,n){this._client=e;this._isMac=t;this._dragManger=n}_commandsForCode(e,t){if(!this._isMac)return[];let n=[];for(let o of["Shift","Control","Alt","Meta"])t.has(o)&&n.push(o);n.push(e);let r=n.join("+"),s=Bm[r]||[];return ae(s)&&(s=[s]),s=s.filter(o=>!o.startsWith("insert")),s.map(o=>o.substring(0,o.length-1))}async keydown(e,t,n,r,s,o,l,c){if(t==="Escape"&&await this._dragManger.cancelDrag())return;let h=this._commandsForCode(t,e);await this._client.send("Input.dispatchKeyEvent",{type:c?"keyDown":"rawKeyDown",modifiers:gt(e),windowsVirtualKeyCode:r,code:t,commands:h,key:s,text:c,unmodifiedText:c,autoRepeat:l,location:o,isKeypad:o===Sp})}async keyup(e,t,n,r,s,o){await this._client.send("Input.dispatchKeyEvent",{type:"keyUp",modifiers:gt(e),key:s,windowsVirtualKeyCode:r,code:t,location:o})}async sendText(e){await this._client.send("Input.insertText",{text:e})}},Ia=class{_client;_page;_dragManager;constructor(e,t,n){this._page=e,this._client=t,this._dragManager=n}async move(e,t,n,r,s,o){let l=async()=>{await this._client.send("Input.dispatchMouseEvent",{type:"mouseMoved",button:n,buttons:Ra(r),x:e,y:t,modifiers:gt(s)})};if(o)return l();await this._dragManager.interceptDragCausedByMove(e,t,n,r,s,l)}async down(e,t,n,r,s,o){this._dragManager.isDragging()||await this._client.send("Input.dispatchMouseEvent",{type:"mousePressed",button:n,buttons:Ra(r),x:e,y:t,modifiers:gt(s),clickCount:o})}async up(e,t,n,r,s,o){if(this._dragManager.isDragging()){await this._dragManager.drop(e,t,s);return}await this._client.send("Input.dispatchMouseEvent",{type:"mouseReleased",button:n,buttons:Ra(r),x:e,y:t,modifiers:gt(s),clickCount:o})}async wheel(e,t,n,r,s,o){await this._client.send("Input.dispatchMouseEvent",{type:"mouseWheel",x:e,y:t,modifiers:gt(r),deltaX:s,deltaY:o})}},La=class{_client;constructor(e){this._client=e}async tap(e,t,n){await Promise.all([this._client.send("Input.dispatchTouchEvent",{type:"touchStart",modifiers:gt(n),touchPoints:[{x:e,y:t}]}),this._client.send("Input.dispatchTouchEvent",{type:"touchEnd",modifiers:gt(n),touchPoints:[]})])}}});async function Od(i){try{return await i()}catch(e){if(Wr(e)&&e.message.includes("Invalid http status code or phrase"))throw e}}function Mb(i){let e=i.findIndex(({name:s})=>s.toLowerCase()==="set-cookie");if(e===-1)return i;let t=i[e],n=t.value.split(`
`);if(n.length===1)return i;let r=i.slice();return r.splice(e,1,...n.map(s=>({name:t.name,value:s}))),r}var ri,Md,Nd,Nb,Hd,Dd=x(()=>{Ot();It();Gt();O();gn();ri=class{_page;_serviceWorker;_requestIdToRequest=new Map;_requestIdToRequestWillBeSentEvent=new Map;_credentials=null;_attemptedAuthentications=new Set;_userRequestInterceptionEnabled=!1;_protocolRequestInterceptionEnabled=!1;_offline=!1;_extraHTTPHeaders=[];_requestIdToRequestPausedEvent=new Map;_responseExtraInfoTracker=new Hd;_sessions=new Map;constructor(e,t){this._page=e,this._serviceWorker=t}async addSession(e,t,n){let r={session:e,isMain:n,workerFrame:t,eventListeners:[]};r.eventListeners=[L.addEventListener(e,"Fetch.requestPaused",this._onRequestPaused.bind(this,r)),L.addEventListener(e,"Fetch.authRequired",this._onAuthRequired.bind(this,r)),L.addEventListener(e,"Network.requestWillBeSent",this._onRequestWillBeSent.bind(this,r)),L.addEventListener(e,"Network.requestWillBeSentExtraInfo",this._onRequestWillBeSentExtraInfo.bind(this)),L.addEventListener(e,"Network.requestServedFromCache",this._onRequestServedFromCache.bind(this)),L.addEventListener(e,"Network.responseReceived",this._onResponseReceived.bind(this,r)),L.addEventListener(e,"Network.responseReceivedExtraInfo",this._onResponseReceivedExtraInfo.bind(this)),L.addEventListener(e,"Network.loadingFinished",this._onLoadingFinished.bind(this,r)),L.addEventListener(e,"Network.loadingFailed",this._onLoadingFailed.bind(this,r))],this._page&&r.eventListeners.push(L.addEventListener(e,"Network.webSocketCreated",s=>this._page._frameManager.onWebSocketCreated(s.requestId,s.url)),L.addEventListener(e,"Network.webSocketWillSendHandshakeRequest",s=>this._page._frameManager.onWebSocketRequest(s.requestId)),L.addEventListener(e,"Network.webSocketHandshakeResponseReceived",s=>this._page._frameManager.onWebSocketResponse(s.requestId,s.response.status,s.response.statusText)),L.addEventListener(e,"Network.webSocketFrameSent",s=>s.response.payloadData&&this._page._frameManager.onWebSocketFrameSent(s.requestId,s.response.opcode,s.response.payloadData)),L.addEventListener(e,"Network.webSocketFrameReceived",s=>s.response.payloadData&&this._page._frameManager.webSocketFrameReceived(s.requestId,s.response.opcode,s.response.payloadData)),L.addEventListener(e,"Network.webSocketClosed",s=>this._page._frameManager.webSocketClosed(s.requestId)),L.addEventListener(e,"Network.webSocketFrameError",s=>this._page._frameManager.webSocketError(s.requestId,s.errorMessage))),this._sessions.set(e,r),await Promise.all([e.send("Network.enable"),this._updateProtocolRequestInterceptionForSession(r,!0),this._setOfflineForSession(r,!0),this._setExtraHTTPHeadersForSession(r,!0)])}removeSession(e){let t=this._sessions.get(e);t&&L.removeEventListeners(t.eventListeners),this._sessions.delete(e)}async _forEachSession(e){await Promise.all([...this._sessions.values()].map(t=>t.isMain?e(t):e(t).catch(n=>{if(!mt(n))throw n})))}async authenticate(e){this._credentials=e,await this._updateProtocolRequestInterception()}async setOffline(e){e!==this._offline&&(this._offline=e,await this._forEachSession(t=>this._setOfflineForSession(t)))}async _setOfflineForSession(e,t){t&&!this._offline||e.workerFrame||await e.session.send("Network.emulateNetworkConditions",{offline:this._offline,latency:0,downloadThroughput:-1,uploadThroughput:-1})}async setRequestInterception(e){this._userRequestInterceptionEnabled=e,await this._updateProtocolRequestInterception()}async _updateProtocolRequestInterception(){let e=this._userRequestInterceptionEnabled||!!this._credentials;e!==this._protocolRequestInterceptionEnabled&&(this._protocolRequestInterceptionEnabled=e,await this._forEachSession(t=>this._updateProtocolRequestInterceptionForSession(t)))}async _updateProtocolRequestInterceptionForSession(e,t){let n=this._protocolRequestInterceptionEnabled;if(t&&!n)return;let r=e.session.send("Network.setCacheDisabled",{cacheDisabled:n}),s=Promise.resolve(void 0);e.workerFrame||(n?s=e.session.send("Fetch.enable",{handleAuthRequests:!0,patterns:[{urlPattern:"*",requestStage:"Request"}]}):s=e.session.send("Fetch.disable")),await Promise.all([r,s])}async setExtraHTTPHeaders(e){!this._extraHTTPHeaders.length&&!e.length||(this._extraHTTPHeaders=e,await this._forEachSession(t=>this._setExtraHTTPHeadersForSession(t)))}async _setExtraHTTPHeadersForSession(e,t){t&&!this._extraHTTPHeaders.length||await e.session.send("Network.setExtraHTTPHeaders",{headers:go(this._extraHTTPHeaders,!1)})}async clearCache(){await this._forEachSession(async e=>{await e.session.send("Network.setCacheDisabled",{cacheDisabled:!0}),this._protocolRequestInterceptionEnabled||await e.session.send("Network.setCacheDisabled",{cacheDisabled:!1}),e.workerFrame||await e.session.send("Network.clearBrowserCache")})}_onRequestWillBeSent(e,t){if(this._protocolRequestInterceptionEnabled&&!t.request.url.startsWith("data:")){let n=t.requestId,r=this._requestIdToRequestPausedEvent.get(n);r?(this._onRequest(e,t,r.sessionInfo,r.event),this._requestIdToRequestPausedEvent.delete(n)):this._requestIdToRequestWillBeSentEvent.set(t.requestId,{sessionInfo:e,event:t})}else this._onRequest(e,t,void 0,void 0)}_onRequestServedFromCache(e){this._responseExtraInfoTracker.requestServedFromCache(e)}_onRequestWillBeSentExtraInfo(e){this._responseExtraInfoTracker.requestWillBeSentExtraInfo(e)}_onAuthRequired(e,t){let n="Default",r=this._shouldProvideCredentials(t.request.url);this._attemptedAuthentications.has(t.requestId)?n="CancelAuth":r&&(n="ProvideCredentials",this._attemptedAuthentications.add(t.requestId));let{username:s,password:o}=r&&this._credentials?this._credentials:{username:void 0,password:void 0};e.session._sendMayFail("Fetch.continueWithAuth",{requestId:t.requestId,authChallengeResponse:{response:n,username:s,password:o}})}_shouldProvideCredentials(e){return this._credentials?!this._credentials.origin||new URL(e).origin.toLowerCase()===this._credentials.origin.toLowerCase():!1}_onRequestPaused(e,t){if(!t.networkId){e.session._sendMayFail("Fetch.continueRequest",{requestId:t.requestId});return}if(t.request.url.startsWith("data:"))return;let n=t.networkId,r=this._requestIdToRequestWillBeSentEvent.get(n);if(r)this._onRequest(r.sessionInfo,r.event,e,t),this._requestIdToRequestWillBeSentEvent.delete(n);else{let o=this._requestIdToRequest.get(n)?._route?._alreadyContinuedParams;if(o&&!t.redirectedRequestId){e.session._sendMayFail("Fetch.continueRequest",{...o,requestId:t.requestId});return}this._requestIdToRequestPausedEvent.set(n,{sessionInfo:e,event:t})}}_onRequest(e,t,n,r){if(t.request.url.startsWith("data:"))return;let s=null;if(t.redirectResponse){let b=this._requestIdToRequest.get(t.requestId);b&&(this._handleRequestRedirect(b,t.redirectResponse,t.timestamp,t.redirectHasExtraInfo),s=b)}let o=t.frameId?this._page?._frameManager.frame(t.frameId):e.workerFrame;if(!o&&this._page&&r&&r.frameId&&(o=this._page._frameManager.frame(r.frameId)),!o&&this._page&&t.frameId===(this._page?._delegate)._targetId&&(o=this._page._frameManager.frameAttached(t.frameId,null)),!!r&&r.request.method==="OPTIONS"&&t.initiator.type==="preflight"&&(this._page||this._serviceWorker).needsRequestInterception()){let b=r.request.headers,v=[{name:"Access-Control-Allow-Origin",value:b.Origin||"*"},{name:"Access-Control-Allow-Methods",value:b["Access-Control-Request-Method"]||"GET, POST, OPTIONS, DELETE"},{name:"Access-Control-Allow-Credentials",value:"true"}];b["Access-Control-Request-Headers"]&&v.push({name:"Access-Control-Allow-Headers",value:b["Access-Control-Request-Headers"]}),n.session._sendMayFail("Fetch.fulfillRequest",{requestId:r.requestId,responseCode:204,responsePhrase:Wc(204),responseHeaders:v,body:""});return}if(!o&&!this._serviceWorker){r&&n.session._sendMayFail("Fetch.continueRequest",{requestId:r.requestId});return}let c=null,h;r&&(s||!this._userRequestInterceptionEnabled&&this._protocolRequestInterceptionEnabled?(h=s?._originalRequestRoute?._alreadyContinuedParams?.headers,n.session._sendMayFail("Fetch.continueRequest",{requestId:r.requestId,headers:h})):c=new Nd(n.session,r.requestId));let f=t.requestId===t.loaderId&&t.type==="Document"?t.loaderId:void 0,g=new Md({session:e.session,context:(this._page||this._serviceWorker)._browserContext,frame:o||null,serviceWorker:this._serviceWorker||null,documentId:f,route:c,requestWillBeSentEvent:t,requestPausedEvent:r,redirectedFrom:s,headersOverride:h||null});this._requestIdToRequest.set(t.requestId,g),c&&g.request.setRawRequestHeaders(Ce(r.request.headers,`
`)),(this._page?._frameManager||this._serviceWorker).requestStarted(g.request,c||void 0)}_createResponse(e,t,n){let r=async()=>{let c=Object.entries(t.headers).find(v=>v[0].toLowerCase()==="content-length"),h=c?+c[1]:void 0,m=e.session,f=await m.send("Network.getResponseBody",{requestId:e._requestId});if(f.body||!h)return Buffer.from(f.body,f.base64Encoded?"base64":"utf8");if(e._route?._fulfilled)return Buffer.from("");let g=await m.send("Network.loadNetworkResource",{url:e.request.url(),frameId:this._serviceWorker?void 0:e.request.frame()._id,options:{disableCache:!1,includeCredentials:!0}}),b=[];for(;g.resource.stream;){let v=await m.send("IO.read",{handle:g.resource.stream});if(b.push(Buffer.from(v.data,v.base64Encoded?"base64":"utf-8")),v.eof){await m.send("IO.close",{handle:g.resource.stream});break}}return Buffer.concat(b)},s=t.timing,o;s&&!this._responseExtraInfoTracker.servedFromCache(e._requestId)?o={startTime:(s.requestTime-e._timestamp+e._wallTime)*1e3,domainLookupStart:s.dnsStart,domainLookupEnd:s.dnsEnd,connectStart:s.connectStart,secureConnectionStart:s.sslStart,connectEnd:s.connectEnd,requestStart:s.sendStart,responseStart:s.receiveHeadersEnd}:o={startTime:e._wallTime*1e3,domainLookupStart:-1,domainLookupEnd:-1,connectStart:-1,secureConnectionStart:-1,connectEnd:-1,requestStart:-1,responseStart:-1};let l=new $o(e.request,t.status,t.statusText,Ce(t.headers),o,r,!!t.fromServiceWorker,t.protocol);return t?.remoteIPAddress&&typeof t?.remotePort=="number"?l._serverAddrFinished({ipAddress:t.remoteIPAddress,port:t.remotePort}):l._serverAddrFinished(),l._securityDetailsFinished({protocol:t?.securityDetails?.protocol,subjectName:t?.securityDetails?.subjectName,issuer:t?.securityDetails?.issuer,validFrom:t?.securityDetails?.validFrom,validTo:t?.securityDetails?.validTo}),this._responseExtraInfoTracker.processResponse(e._requestId,l,n),l}_deleteRequest(e){this._requestIdToRequest.delete(e._requestId),e._interceptionId&&this._attemptedAuthentications.delete(e._interceptionId)}_handleRequestRedirect(e,t,n,r){let s=this._createResponse(e,t,r);s.setTransferSize(null),s.setEncodedBodySize(null),s._requestFinished((n-e._timestamp)*1e3),this._deleteRequest(e),(this._page?._frameManager||this._serviceWorker).requestReceivedResponse(s),(this._page?._frameManager||this._serviceWorker).reportRequestFinished(e.request,s)}_onResponseReceivedExtraInfo(e){this._responseExtraInfoTracker.responseReceivedExtraInfo(e)}_onResponseReceived(e,t){let n=this._requestIdToRequest.get(t.requestId);if(!n&&t.response.fromServiceWorker){let s=this._requestIdToRequestWillBeSentEvent.get(t.requestId);s&&(this._requestIdToRequestWillBeSentEvent.delete(t.requestId),this._onRequest(e,s.event,void 0,void 0),n=this._requestIdToRequest.get(t.requestId))}if(!n)return;let r=this._createResponse(n,t.response,t.hasExtraInfo);(this._page?._frameManager||this._serviceWorker).requestReceivedResponse(r)}_onLoadingFinished(e,t){this._responseExtraInfoTracker.loadingFinished(t);let n=this._requestIdToRequest.get(t.requestId);if(!n)return;this._maybeUpdateOOPIFMainRequest(e,n);let r=n.request._existingResponse();r&&(r.setTransferSize(t.encodedDataLength),r.responseHeadersSize().then(s=>r.setEncodedBodySize(t.encodedDataLength-s)),r._requestFinished(le.secondsToRoundishMillis(t.timestamp-n._timestamp))),this._deleteRequest(n),(this._page?._frameManager||this._serviceWorker).reportRequestFinished(n.request,r)}_onLoadingFailed(e,t){this._responseExtraInfoTracker.loadingFailed(t);let n=this._requestIdToRequest.get(t.requestId);if(!n){let s=this._requestIdToRequestWillBeSentEvent.get(t.requestId);s&&(this._requestIdToRequestWillBeSentEvent.delete(t.requestId),this._onRequest(e,s.event,void 0,void 0),n=this._requestIdToRequest.get(t.requestId))}if(!n)return;this._maybeUpdateOOPIFMainRequest(e,n);let r=n.request._existingResponse();r?(r.setTransferSize(null),r.setEncodedBodySize(null),r._requestFinished(le.secondsToRoundishMillis(t.timestamp-n._timestamp))):n.request.setRawRequestHeaders(null),this._deleteRequest(n),n.request._setFailureText(t.errorText||t.blockedReason||""),(this._page?._frameManager||this._serviceWorker).requestFailed(n.request,!!t.canceled)}_maybeUpdateOOPIFMainRequest(e,t){t.session!==e.session&&!e.isMain&&t._documentId===t._requestId&&(t.session=e.session)}},Md=class{request;_requestId;_interceptionId;_documentId;_timestamp;_wallTime;_route;_originalRequestRoute;session;constructor(e){let{session:t,context:n,frame:r,documentId:s,route:o,requestWillBeSentEvent:l,requestPausedEvent:c,redirectedFrom:h,serviceWorker:m,headersOverride:f}=e;this.session=t,this._timestamp=l.timestamp,this._wallTime=l.wallTime,this._requestId=l.requestId,this._interceptionId=c&&c.requestId,this._documentId=s,this._route=o,this._originalRequestRoute=o??h?._originalRequestRoute;let{headers:g,method:b,url:v,postDataEntries:S=null}=c?c.request:l.request,_=(l.type||"").toLowerCase(),k=null,D=S?.filter(H=>H.bytes);D&&D.length&&(k=Buffer.concat(D.map(H=>Buffer.from(H.bytes,"base64")))),this.request=new Bo(n,r,m,h?.request||null,s,v,_,b,k,f||Ce(g))}},Nd=class{_session;_interceptionId;_alreadyContinuedParams;_fulfilled=!1;constructor(e,t){this._session=e,this._interceptionId=t}async continue(e){this._alreadyContinuedParams={requestId:this._interceptionId,url:e.url,headers:e.headers,method:e.method,postData:e.postData?e.postData.toString("base64"):void 0},await Od(async()=>{await this._session.send("Fetch.continueRequest",this._alreadyContinuedParams)})}async fulfill(e){this._fulfilled=!0;let t=e.isBase64?e.body:Buffer.from(e.body).toString("base64"),n=Mb(e.headers);await Od(async()=>{await this._session.send("Fetch.fulfillRequest",{requestId:this._interceptionId,responseCode:e.status,responsePhrase:Wc(e.status),responseHeaders:n,body:t})})}async abort(e="failed"){let t=Nb[e];E(t,"Unknown error code: "+e),await Od(async()=>{await this._session.send("Fetch.failRequest",{requestId:this._interceptionId,errorReason:t})})}};Nb={aborted:"Aborted",accessdenied:"AccessDenied",addressunreachable:"AddressUnreachable",blockedbyclient:"BlockedByClient",blockedbyresponse:"BlockedByResponse",connectionaborted:"ConnectionAborted",connectionclosed:"ConnectionClosed",connectionfailed:"ConnectionFailed",connectionrefused:"ConnectionRefused",connectionreset:"ConnectionReset",internetdisconnected:"InternetDisconnected",namenotresolved:"NameNotResolved",timedout:"TimedOut",failed:"Failed"},Hd=class{_requests=new Map;requestWillBeSentExtraInfo(e){let t=this._getOrCreateEntry(e.requestId);t.requestWillBeSentExtraInfo.push(e),this._patchHeaders(t,t.requestWillBeSentExtraInfo.length-1),this._checkFinished(t)}requestServedFromCache(e){let t=this._getOrCreateEntry(e.requestId);t.servedFromCache=!0}servedFromCache(e){return!!this._requests.get(e)?.servedFromCache}responseReceivedExtraInfo(e){let t=this._getOrCreateEntry(e.requestId);t.responseReceivedExtraInfo.push(e),this._patchHeaders(t,t.responseReceivedExtraInfo.length-1),this._checkFinished(t)}processResponse(e,t,n){let r=this._requests.get(e);if(!n||r?.servedFromCache){t.request().setRawRequestHeaders(null),t.setResponseHeadersSize(null),t.setRawResponseHeaders(null);return}r=this._getOrCreateEntry(e),r.responses.push(t),this._patchHeaders(r,r.responses.length-1)}loadingFinished(e){let t=this._requests.get(e.requestId);t&&(t.loadingFinished=e,this._checkFinished(t))}loadingFailed(e){let t=this._requests.get(e.requestId);t&&(t.loadingFailed=e,this._checkFinished(t))}_getOrCreateEntry(e){let t=this._requests.get(e);return t||(t={requestId:e,requestWillBeSentExtraInfo:[],responseReceivedExtraInfo:[],responses:[]},this._requests.set(e,t)),t}_patchHeaders(e,t){let n=e.responses[t],r=e.requestWillBeSentExtraInfo[t];n&&r&&(n.request().setRawRequestHeaders(Ce(r.headers,`
`)),e.requestWillBeSentExtraInfo[t]=void 0);let s=e.responseReceivedExtraInfo[t];n&&s&&(n.setResponseHeadersSize(s.headersText?.length||0),n.setRawResponseHeaders(Ce(s.headers,`
`)),e.responseReceivedExtraInfo[t]=void 0)}_checkFinished(e){if(!(!e.loadingFinished&&!e.loadingFailed)&&e.responses.length<=e.responseReceivedExtraInfo.length){this._stopTracking(e.requestId);return}}_stopTracking(e){this._requests.delete(e)}}});function ii(i){if(i===void 0)return;let e=i.substring(i.length-2).toLowerCase(),t="";qm.hasOwnProperty(e)?t=i.substring(0,i.length-2):(e="px",t=i);let n=Number(t);return E(!isNaN(n),"Failed to parse parameter value: "+i),n*qm[e]/96}var Hb,qm,Oa,Wm=x(()=>{O();fr();Hb={letter:{width:8.5,height:11},legal:{width:8.5,height:14},tabloid:{width:11,height:17},ledger:{width:17,height:11},a0:{width:33.1,height:46.8},a1:{width:23.4,height:33.1},a2:{width:16.54,height:23.4},a3:{width:11.7,height:16.54},a4:{width:8.27,height:11.7},a5:{width:5.83,height:8.27},a6:{width:4.13,height:5.83}},qm={px:1,in:96,cm:37.8,mm:3.78};Oa=class{_client;constructor(e){this._client=e}async generate(e){let{scale:t=1,displayHeaderFooter:n=!1,headerTemplate:r="",footerTemplate:s="",printBackground:o=!1,landscape:l=!1,pageRanges:c="",preferCSSPageSize:h=!1,margin:m={},tagged:f=!1,outline:g=!1}=e,b=8.5,v=11;if(e.format){let F=Hb[e.format.toLowerCase()];E(F,"Unknown paper format: "+e.format),b=F.width,v=F.height}else b=ii(e.width)||b,v=ii(e.height)||v;let S=ii(m.top)||0,_=ii(m.left)||0,k=ii(m.bottom)||0,D=ii(m.right)||0,H=g,A=f,I=await this._client.send("Page.printToPDF",{transferMode:"ReturnAsStream",landscape:l,displayHeaderFooter:n,headerTemplate:r,footerTemplate:s,printBackground:o,scale:t,paperWidth:b,paperHeight:v,marginTop:S,marginBottom:k,marginLeft:_,marginRight:D,pageRanges:c,preferCSSPageSize:h,generateTaggedPDF:A,generateDocumentOutline:H});return await Hm(this._client,I.stream)}}});var zm,Um=x(()=>{zm={linux:{fontFamilies:{standard:"Times New Roman",fixed:"Monospace",serif:"Times New Roman",sansSerif:"Arial",cursive:"Comic Sans MS",fantasy:"Impact"}},mac:{fontFamilies:{standard:"Times",fixed:"Courier",serif:"Times",sansSerif:"Helvetica",cursive:"Apple Chancery",fantasy:"Papyrus"},forScripts:[{script:"jpan",fontFamilies:{standard:"Hiragino Kaku Gothic ProN",fixed:"Osaka-Mono",serif:"Hiragino Mincho ProN",sansSerif:"Hiragino Kaku Gothic ProN"}},{script:"hang",fontFamilies:{standard:"Apple SD Gothic Neo",serif:"AppleMyungjo",sansSerif:"Apple SD Gothic Neo"}},{script:"hans",fontFamilies:{standard:",PingFang SC,STHeiti",serif:"Songti SC",sansSerif:",PingFang SC,STHeiti",cursive:"Kaiti SC"}},{script:"hant",fontFamilies:{standard:",PingFang TC,Heiti TC",serif:"Songti TC",sansSerif:",PingFang TC,Heiti TC",cursive:"Kaiti TC"}}]},win:{fontFamilies:{standard:"Times New Roman",fixed:"Consolas",serif:"Times New Roman",sansSerif:"Arial",cursive:"Comic Sans MS",fantasy:"Impact"},forScripts:[{script:"cyrl",fontFamilies:{standard:"Times New Roman",fixed:"Courier New",serif:"Times New Roman",sansSerif:"Arial"}},{script:"arab",fontFamilies:{fixed:"Courier New",sansSerif:"Segoe UI"}},{script:"grek",fontFamilies:{standard:"Times New Roman",fixed:"Courier New",serif:"Times New Roman",sansSerif:"Arial"}},{script:"jpan",fontFamilies:{standard:",Meiryo,Yu Gothic",fixed:"MS Gothic",serif:",Yu Mincho,MS PMincho",sansSerif:",Meiryo,Yu Gothic"}},{script:"hang",fontFamilies:{standard:"Malgun Gothic",fixed:"Gulimche",serif:"Batang",sansSerif:"Malgun Gothic",cursive:"Gungsuh"}},{script:"hans",fontFamilies:{standard:"Microsoft YaHei",fixed:"NSimsun",serif:"Simsun",sansSerif:"Microsoft YaHei",cursive:"KaiTi"}},{script:"hant",fontFamilies:{standard:"Microsoft JhengHei",fixed:"MingLiU",serif:"PMingLiU",sansSerif:"Microsoft JhengHei",cursive:"DFKai-SB"}}]}}});var Vm,Ma,Gm=x(()=>{O();nt();Hr();Nt();ye();Vm=25,Ma=class i{_process=null;_gracefullyClose=null;_lastWritePromise=Promise.resolve();_lastFrameTimestamp=0;_lastFrameBuffer=null;_lastWriteTimestamp=0;_progress;_frameQueue=[];_isStopped=!1;_ffmpegPath;static async launch(e,t,n){if(!n.outputFile.endsWith(".webm"))throw new Error("File must have .webm extension");let r=new z(ge(),e);return r.setLogName("browser"),await r.run(async s=>{let o=new i(e,t,s);return await o._launch(n),o})}constructor(e,t,n){this._progress=n,this._ffmpegPath=t,e.on(re.Events.ScreencastFrame,r=>this.writeFrame(r.buffer,r.timestamp))}async _launch(e){let t=e.width,n=e.height,r=`-loglevel error -f image2pipe -avioflags direct -fpsprobesize 0 -probesize 32 -analyzeduration 0 -c:v mjpeg -i pipe:0 -y -an -r ${Vm} -c:v vp8 -qmin 0 -qmax 50 -crf 8 -deadline realtime -speed 8 -b:v 1M -threads 1 -vf pad=${t}:${n}:0:0:gray,crop=${t}:${n}:0:0`.split(" ");r.push(e.outputFile);let s=this._progress,{launchedProcess:o,gracefullyClose:l}=await ko({command:this._ffmpegPath,args:r,stdio:"stdin",log:c=>s.log(c),tempDirectories:[],attemptToGracefullyClose:async()=>{s.log("Closing stdin..."),o.stdin.end()},onExit:(c,h)=>{s.log(`ffmpeg onkill exitCode=${c} signal=${h}`)}});o.stdin.on("finish",()=>{s.log("ffmpeg finished input.")}),o.stdin.on("error",()=>{s.log("ffmpeg error.")}),this._process=o,this._gracefullyClose=l}writeFrame(e,t){if(E(this._process),!this._isStopped){if(this._lastFrameBuffer){let n=t-this._lastFrameTimestamp,r=Math.max(1,Math.round(Vm*n));for(let s=0;s<r;++s)this._frameQueue.push(this._lastFrameBuffer);this._lastWritePromise=this._lastWritePromise.then(()=>this._sendFrames())}this._lastFrameBuffer=e,this._lastFrameTimestamp=t,this._lastWriteTimestamp=X()}}async _sendFrames(){for(;this._frameQueue.length;)await this._sendFrame(this._frameQueue.shift())}async _sendFrame(e){return new Promise(t=>this._process.stdin.write(e,t)).then(t=>{t&&this._progress.log(`ffmpeg failed to write: ${String(t)}`)})}async stop(){this._isStopped||(this.writeFrame(Buffer.from([]),this._lastFrameTimestamp+(X()-this._lastWriteTimestamp)/1e3),this._isStopped=!0,await this._lastWritePromise,await this._gracefullyClose())}}});import Db from"path";async function Bb(i,e){try{await i.send("Emulation.setLocaleOverride",{locale:e})}catch(t){if(t.message.includes("Another locale override is already in effect"))return;throw t}}async function $b(i,e){try{await i.send("Emulation.setTimezoneOverride",{timezoneId:e})}catch(t){if(t.message.includes("Timezone override is already in effect"))return;throw t.message.includes("Invalid timezone")?new Error(`Invalid timezone ID: ${e}`):t}}function jb(i){let e=i.userAgent;if(!e)return;let t={mobile:!!i.isMobile,model:"",architecture:"x64",platform:"Windows",platformVersion:""},n=e.match(/Android (\d+(\.\d+)?(\.\d+)?)/),r=e.match(/iPhone OS (\d+(_\d+)?)/),s=e.match(/iPad; CPU OS (\d+(_\d+)?)/),o=e.match(/Mac OS X (\d+(_\d+)?(_\d+)?)/),l=e.match(/Windows\D+(\d+(\.\d+)?(\.\d+)?)/);return n?(t.platform="Android",t.platformVersion=n[1],t.architecture="arm"):r?(t.platform="iOS",t.platformVersion=r[1],t.architecture="arm"):s?(t.platform="iOS",t.platformVersion=s[1],t.architecture="arm"):o?(t.platform="macOS",t.platformVersion=o[1],e.includes("Intel")||(t.architecture="arm")):l?(t.platform="Windows",t.platformVersion=l[1]):e.toLowerCase().includes("linux")&&(t.platform="Linux"),e.includes("ARM")&&(t.architecture="arm"),t}var Na,Rs,Bd,Km,Jm=x(()=>{It();fn();Lt();O();Im();Jc();ur();Ot();Gt();nt();nt();Om();Ha();Mm();Dm();Ld();jm();Dd();Wm();fr();Um();Gm();Oe();Vt();gn();Na="__playwright_utility_world__",Rs=class{_mainFrameSession;_sessions=new Map;_page;rawMouse;rawKeyboard;rawTouchscreen;_targetId;_opener;_networkManager;_pdf;_coverage;_browserContext;_pagePromise;_initializedPage=null;_isBackgroundPage;_nextWindowOpenPopupFeatures=[];static mainFrameSession(e){return e._delegate._mainFrameSession}constructor(e,t,n,r,s){this._targetId=t,this._opener=r,this._isBackgroundPage=s.isBackgroundPage;let o=new Aa(this);if(this.rawKeyboard=new Fa(e,n._browser._platform()==="mac",o),this.rawMouse=new Ia(this,e,o),this.rawTouchscreen=new La(e),this._pdf=new Oa(e),this._coverage=new Ea(e),this._browserContext=n,this._page=new re(this,n),this._networkManager=new ri(this._page,null),this.updateOffline(),this.updateExtraHTTPHeaders(),this.updateHttpCredentials(),this.updateRequestInterception(),this._mainFrameSession=new Bd(this,e,t,null),this._sessions.set(t,this._mainFrameSession),r&&!n._options.noDefaultViewport){let l=r._nextWindowOpenPopupFeatures.shift()||[],c=le.getViewportSizeFromWindowFeatures(l);c&&(this._page._emulatedSize={viewport:c,screen:c})}this._pagePromise=this._mainFrameSession._initialize(s.hasUIWindow).then(async l=>(await this._page.initOpener(this._opener),l)).catch(async l=>{throw await this._page.initOpener(this._opener),l}).then(()=>(this._initializedPage=this._page,this._reportAsNew(),this._page)).catch(l=>(this._reportAsNew(l),l))}potentiallyUninitializedPage(){return this._page}_reportAsNew(e){this._page.reportAsNew(e,this._isBackgroundPage?en.CREvents.BackgroundPage:j.Events.Page)}async _forAllFrameSessions(e){let t=Array.from(this._sessions.values());await Promise.all(t.map(n=>n._isMainFrame()?e(n):e(n).catch(r=>{if(!mt(r))throw r})))}_sessionForFrame(e){for(;!this._sessions.has(e._id);){let t=e.parentFrame();if(!t)throw new Error("Frame has been detached.");e=t}return this._sessions.get(e._id)}_sessionForHandle(e){let t=e._context.frame;return this._sessionForFrame(t)}willBeginDownload(){this._mainFrameSession._willBeginDownload()}async pageOrError(){return this._pagePromise}didClose(){for(let e of this._sessions.values())e.dispose();this._page._didClose()}async navigateFrame(e,t,n){return this._sessionForFrame(e)._navigate(e,t,n)}async updateExtraHTTPHeaders(){let e=Wo([this._browserContext._options.extraHTTPHeaders,this._page.extraHTTPHeaders()]);await this._networkManager.setExtraHTTPHeaders(e)}async updateGeolocation(){await this._forAllFrameSessions(e=>e._updateGeolocation(!1))}async updateOffline(){await this._networkManager.setOffline(!!this._browserContext._options.offline)}async updateHttpCredentials(){await this._networkManager.authenticate(this._browserContext._options.httpCredentials||null)}async updateEmulatedViewportSize(e){await this._mainFrameSession._updateViewport(e)}async bringToFront(){await this._mainFrameSession._client.send("Page.bringToFront")}async updateEmulateMedia(){await this._forAllFrameSessions(e=>e._updateEmulateMedia())}async updateUserAgent(){await this._forAllFrameSessions(e=>e._updateUserAgent())}async updateRequestInterception(){await this._networkManager.setRequestInterception(this._page.needsRequestInterception())}async updateFileChooserInterception(){await this._forAllFrameSessions(e=>e._updateFileChooserInterception(!1))}async reload(){await this._mainFrameSession._client.send("Page.reload")}async _go(e){let t=await this._mainFrameSession._client.send("Page.getNavigationHistory"),n=t.entries[t.currentIndex+e];return n?(await this._mainFrameSession._client.send("Page.navigateToHistoryEntry",{entryId:n.id}),!0):!1}goBack(){return this._go(-1)}goForward(){return this._go(1)}async addInitScript(e,t="main"){await this._forAllFrameSessions(n=>n._evaluateOnNewDocument(e,t))}async removeNonInternalInitScripts(){await this._forAllFrameSessions(e=>e._removeEvaluatesOnNewDocument())}async closePage(e){e?await this._mainFrameSession._client.send("Page.close"):await this._browserContext._browser._closePage(this)}async setBackgroundColor(e){await this._mainFrameSession._client.send("Emulation.setDefaultBackgroundColorOverride",{color:e})}async takeScreenshot(e,t,n,r,s,o,l){let{visualViewport:c}=await this._mainFrameSession._client.send("Page.getLayoutMetrics");n||(n={x:c.pageX+r.x,y:c.pageY+r.y,...le.enclosingIntSize({width:r.width/c.scale,height:r.height/c.scale})});let h={...n,scale:r?c.scale:1};if(l==="css"){let f=this._browserContext._options.deviceScaleFactor||1;h.scale/=f}e.throwIfAborted();let m=await this._mainFrameSession._client.send("Page.captureScreenshot",{format:t,quality:s,clip:h,captureBeyondViewport:!o});return Buffer.from(m.data,"base64")}async getContentFrame(e){return this._sessionForHandle(e)._getContentFrame(e)}async getOwnerFrame(e){return this._sessionForHandle(e)._getOwnerFrame(e)}isElementHandle(e){return e.subtype==="node"}async getBoundingBox(e){return this._sessionForHandle(e)._getBoundingBox(e)}async scrollRectIntoViewIfNeeded(e,t){return this._sessionForHandle(e)._scrollRectIntoViewIfNeeded(e,t)}async setScreencastOptions(e){e?await this._mainFrameSession._startScreencast(this,{format:"jpeg",quality:e.quality,maxWidth:e.width,maxHeight:e.height}):await this._mainFrameSession._stopScreencast(this)}rafCountForStablePosition(){return 1}async getContentQuads(e){return this._sessionForHandle(e)._getContentQuads(e)}async setInputFiles(e,t){await e.evaluateInUtility(([n,r,s])=>n.setInputFiles(r,s),t)}async setInputFilePaths(e,t){let n=await e.ownerFrame();if(!n)throw new Error("Cannot set input files to detached input element");await this._sessionForFrame(n)._client.send("DOM.setFileInputFiles",{objectId:e._objectId,files:t})}async adoptElementHandle(e,t){return this._sessionForHandle(e)._adoptElementHandle(e,t)}async getAccessibilityTree(e){return Lm(this._mainFrameSession._client,e)}async inputActionEpilogue(){await this._mainFrameSession._client.send("Page.enable").catch(e=>{})}async resetForReuse(){}async pdf(e){return this._pdf.generate(e)}coverage(){return this._coverage}async getFrameElement(e){let t=e.parentFrame();if(!t)throw new Error("Frame has been detached.");let n=this._sessionForFrame(t),{backendNodeId:r}=await n._client.send("DOM.getFrameOwner",{frameId:e._id}).catch(s=>{throw s instanceof Error&&s.message.includes("Frame with the given id was not found.")&&ve(s,"Frame has been detached."),s});if(t=e.parentFrame(),!t)throw new Error("Frame has been detached.");return n._adoptBackendNodeId(r,await t._mainContext())}shouldToggleStyleSheetToSyncAnimations(){return!1}},Bd=class i{_client;_crPage;_page;_parentSession;_childSessions=new Set;_contextIdToContext=new Map;_eventListeners=[];_targetId;_firstNonInitialNavigationCommittedPromise;_firstNonInitialNavigationCommittedFulfill=()=>{};_firstNonInitialNavigationCommittedReject=e=>{};_windowId;_swappedIn=!1;_videoRecorder=null;_screencastId=null;_screencastClients=new Set;_evaluateOnNewDocumentIdentifiers=[];_metricsOverride;_workerSessions=new Map;constructor(e,t,n,r){this._client=t,this._crPage=e,this._page=e._page,this._targetId=n,this._parentSession=r,r&&r._childSessions.add(this),this._firstNonInitialNavigationCommittedPromise=new Promise((s,o)=>{this._firstNonInitialNavigationCommittedFulfill=s,this._firstNonInitialNavigationCommittedReject=o})}_isMainFrame(){return this._targetId===this._crPage._targetId}_addRendererListeners(){this._eventListeners.push(L.addEventListener(this._client,"Log.entryAdded",e=>this._onLogEntryAdded(e)),L.addEventListener(this._client,"Page.fileChooserOpened",e=>this._onFileChooserOpened(e)),L.addEventListener(this._client,"Page.frameAttached",e=>this._onFrameAttached(e.frameId,e.parentFrameId)),L.addEventListener(this._client,"Page.frameDetached",e=>this._onFrameDetached(e.frameId,e.reason)),L.addEventListener(this._client,"Page.frameNavigated",e=>this._onFrameNavigated(e.frame,!1)),L.addEventListener(this._client,"Page.frameRequestedNavigation",e=>this._onFrameRequestedNavigation(e)),L.addEventListener(this._client,"Page.javascriptDialogOpening",e=>this._onDialog(e)),L.addEventListener(this._client,"Page.navigatedWithinDocument",e=>this._onFrameNavigatedWithinDocument(e.frameId,e.url)),L.addEventListener(this._client,"Runtime.bindingCalled",e=>this._onBindingCalled(e)),L.addEventListener(this._client,"Runtime.consoleAPICalled",e=>this._onConsoleAPI(e)),L.addEventListener(this._client,"Runtime.exceptionThrown",e=>this._handleException(e.exceptionDetails)),L.addEventListener(this._client,"Runtime.executionContextCreated",e=>this._onExecutionContextCreated(e.context)),L.addEventListener(this._client,"Runtime.executionContextDestroyed",e=>this._onExecutionContextDestroyed(e.executionContextId)),L.addEventListener(this._client,"Runtime.executionContextsCleared",e=>this._onExecutionContextsCleared()),L.addEventListener(this._client,"Target.attachedToTarget",e=>this._onAttachedToTarget(e)),L.addEventListener(this._client,"Target.detachedFromTarget",e=>this._onDetachedFromTarget(e)))}_addBrowserListeners(){this._eventListeners.push(L.addEventListener(this._client,"Inspector.targetCrashed",e=>this._onTargetCrashed()),L.addEventListener(this._client,"Page.screencastFrame",e=>this._onScreencastFrame(e)),L.addEventListener(this._client,"Page.windowOpen",e=>this._onWindowOpen(e)))}async _initialize(e){let t=this._page._browserContext.isSettingStorageState();if(!t&&e&&!this._crPage._browserContext._browser.isClank()&&!this._crPage._browserContext._options.noDefaultViewport){let{windowId:o}=await this._client.send("Browser.getWindowForTarget");this._windowId=o}let n;if(!t&&this._isMainFrame()&&this._crPage._browserContext._options.recordVideo&&e){let o=Y(),l=Db.join(this._crPage._browserContext._options.recordVideo.dir,o+".webm");n={...this._crPage._browserContext._options.recordVideo.size,outputFile:l},await this._crPage._browserContext._ensureVideosPath(),await this._createVideoRecorder(o,n),this._crPage.pageOrError().then(c=>{c instanceof Error&&this._stopVideoRecording().catch(()=>{})})}let r;this._isMainFrame()||this._addRendererListeners(),this._addBrowserListeners();let s=[this._client.send("Page.enable"),this._client.send("Page.getFrameTree").then(({frameTree:o})=>{this._isMainFrame()&&(this._handleFrameTree(o),this._addRendererListeners());let l=this._isMainFrame()?this._page.frames():[this._page._frameManager.frame(this._targetId)];for(let h of l){this._client._sendMayFail("Page.createIsolatedWorld",{frameId:h._id,grantUniveralAccess:!0,worldName:Na});for(let m of this._crPage._page.allInitScripts())h.evaluateExpression(m.source).catch(f=>{})}this._isMainFrame()&&this._page.mainFrame().url()===":"?r.catch(h=>{}).then(()=>{this._eventListeners.push(L.addEventListener(this._client,"Page.lifecycleEvent",h=>this._onLifecycleEvent(h)))}):(this._firstNonInitialNavigationCommittedFulfill(),this._eventListeners.push(L.addEventListener(this._client,"Page.lifecycleEvent",h=>this._onLifecycleEvent(h))))}),this._client.send("Log.enable",{}),r=this._client.send("Page.setLifecycleEventsEnabled",{enabled:!0}),this._client.send("Runtime.enable",{}),this._client.send("Runtime.addBinding",{name:qn.kPlaywrightBinding}),this._client.send("Page.addScriptToEvaluateOnNewDocument",{source:"",worldName:Na}),this._crPage._networkManager.addSession(this._client,void 0,this._isMainFrame()),this._client.send("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0})];if(!t){this._isMainFrame()&&s.push(this._client.send("Emulation.setFocusEmulationEnabled",{enabled:!0}));let o=this._crPage._browserContext._options;o.bypassCSP&&s.push(this._client.send("Page.setBypassCSP",{enabled:!0})),o.ignoreHTTPSErrors&&s.push(this._client.send("Security.setIgnoreCertificateErrors",{ignore:!0})),this._isMainFrame()&&s.push(this._updateViewport()),o.hasTouch&&s.push(this._client.send("Emulation.setTouchEmulationEnabled",{enabled:!0})),o.javaScriptEnabled===!1&&s.push(this._client.send("Emulation.setScriptExecutionDisabled",{value:!0})),(o.userAgent||o.locale)&&s.push(this._updateUserAgent()),o.locale&&s.push(Bb(this._client,o.locale)),o.timezoneId&&s.push($b(this._client,o.timezoneId)),this._crPage._browserContext._browser.options.headful||s.push(this._setDefaultFontFamilies(this._client)),s.push(this._updateGeolocation(!0)),s.push(this._updateEmulateMedia()),s.push(this._updateFileChooserInterception(!0));for(let l of this._crPage._page.allInitScripts())s.push(this._evaluateOnNewDocument(l,"main"));n&&s.push(this._startVideoRecording(n))}s.push(this._client.send("Runtime.runIfWaitingForDebugger")),s.push(this._firstNonInitialNavigationCommittedPromise),await Promise.all(s)}dispose(){this._firstNonInitialNavigationCommittedReject(new pt);for(let e of this._childSessions)e.dispose();this._parentSession&&this._parentSession._childSessions.delete(this),L.removeEventListeners(this._eventListeners),this._crPage._networkManager.removeSession(this._client),this._crPage._sessions.delete(this._targetId),this._client.dispose()}async _navigate(e,t,n){let r=await this._client.send("Page.navigate",{url:t,referrer:n,frameId:e._id,referrerPolicy:"unsafeUrl"});if(r.errorText)throw new dr(r.loaderId,`${r.errorText} at ${t}`);return{newDocumentId:r.loaderId}}_onLifecycleEvent(e){this._eventBelongsToStaleFrame(e.frameId)||(e.name==="load"?this._page._frameManager.frameLifecycleEvent(e.frameId,"load"):e.name==="DOMContentLoaded"&&this._page._frameManager.frameLifecycleEvent(e.frameId,"domcontentloaded"))}_handleFrameTree(e){if(this._onFrameAttached(e.frame.id,e.frame.parentId||null),this._onFrameNavigated(e.frame,!0),!!e.childFrames)for(let t of e.childFrames)this._handleFrameTree(t)}_eventBelongsToStaleFrame(e){let t=this._page._frameManager.frame(e);if(!t)return!0;let n=this._crPage._sessionForFrame(t);return n&&n!==this&&!n._swappedIn}_onFrameAttached(e,t){let n=this._crPage._sessions.get(e);if(n&&e!==this._targetId){n._swappedIn=!0;let r=this._page._frameManager.frame(e);r&&this._page._frameManager.removeChildFramesRecursively(r);return}t&&!this._page._frameManager.frame(t)||this._page._frameManager.frameAttached(e,t)}_onFrameNavigated(e,t){this._eventBelongsToStaleFrame(e.id)||(this._page._frameManager.frameCommittedNewDocumentNavigation(e.id,e.url+(e.urlFragment||""),e.name||"",e.loaderId,t),t||this._firstNonInitialNavigationCommittedFulfill())}_onFrameRequestedNavigation(e){this._eventBelongsToStaleFrame(e.frameId)||e.disposition==="currentTab"&&this._page._frameManager.frameRequestedNavigation(e.frameId)}_onFrameNavigatedWithinDocument(e,t){this._eventBelongsToStaleFrame(e)||this._page._frameManager.frameCommittedSameDocumentNavigation(e,t)}_onFrameDetached(e,t){if(!this._crPage._sessions.has(e)){if(t==="swap"){let n=this._page._frameManager.frame(e);n&&this._page._frameManager.removeChildFramesRecursively(n);return}this._page._frameManager.frameDetached(e)}}_onExecutionContextCreated(e){let t=e.auxData?this._page._frameManager.frame(e.auxData.frameId):null;if(!t||this._eventBelongsToStaleFrame(t._id))return;let n=new gr(this._client,e),r;if(e.auxData&&e.auxData.isDefault)r="main";else if(e.name===Na)r="utility";else return;let s=new Ko(n,t,r);s[Km]=n,t._contextCreated(r,s),this._contextIdToContext.set(e.id,s)}_onExecutionContextDestroyed(e){let t=this._contextIdToContext.get(e);t&&(this._contextIdToContext.delete(e),t.frame._contextDestroyed(t))}_onExecutionContextsCleared(){for(let e of Array.from(this._contextIdToContext.keys()))this._onExecutionContextDestroyed(e)}_onAttachedToTarget(e){let t=this._client.createChildSession(e.sessionId);if(e.targetInfo.type==="iframe"){let s=e.targetInfo.targetId,o=this._page._frameManager.frame(s);if(!o)return;this._page._frameManager.removeChildFramesRecursively(o);let l=new i(this._crPage,t,s,this);this._crPage._sessions.set(s,l),l._initialize(!1).catch(c=>c);return}if(e.targetInfo.type!=="worker"){t.detach().catch(()=>{});return}let n=e.targetInfo.url,r=new jn(this._page,n);this._page._addWorker(e.sessionId,r),this._workerSessions.set(e.sessionId,t),t.once("Runtime.executionContextCreated",async s=>{r._createExecutionContext(new gr(t,s.context))}),t._sendMayFail("Runtime.enable"),this._crPage._networkManager.addSession(t,this._page._frameManager.frame(this._targetId)??void 0).catch(()=>{}),t._sendMayFail("Runtime.runIfWaitingForDebugger"),t._sendMayFail("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}),t.on("Target.attachedToTarget",s=>this._onAttachedToTarget(s)),t.on("Target.detachedFromTarget",s=>this._onDetachedFromTarget(s)),t.on("Runtime.consoleAPICalled",s=>{let o=s.args.map(l=>r._existingExecutionContext.createHandle(l));this._page._addConsoleMessage(s.type,o,Ad(s.stackTrace))}),t.on("Runtime.exceptionThrown",s=>this._page.emitOnContextOnceInitialized(j.Events.PageError,Fd(s.exceptionDetails),this._page))}_onDetachedFromTarget(e){let t=this._workerSessions.get(e.sessionId);if(t){t.dispose(),this._page._removeWorker(e.sessionId);return}let n=this._crPage._sessions.get(e.targetId);if(n){if(n._swappedIn){n.dispose();return}this._client.send("Page.enable").catch(r=>null).then(()=>{n._swappedIn||this._page._frameManager.frameDetached(e.targetId),n.dispose()})}}_onWindowOpen(e){this._crPage._nextWindowOpenPopupFeatures.push(e.windowFeatures)}async _onConsoleAPI(e){if(e.executionContextId===0)return;let t=this._contextIdToContext.get(e.executionContextId);if(!t)return;let n=e.args.map(r=>t.createHandle(r));this._page._addConsoleMessage(e.type,n,Ad(e.stackTrace))}async _onBindingCalled(e){if(!(await this._crPage.pageOrError()instanceof Error)){let n=this._contextIdToContext.get(e.executionContextId);n&&await this._page._onBindingCalled(e.payload,n)}}_onDialog(e){this._page._frameManager.frame(this._targetId)&&this._page.emitOnContext(j.Events.Dialog,new ka(this._page,e.type,e.message,async(t,n)=>{await this._client.send("Page.handleJavaScriptDialog",{accept:t,promptText:n})},e.defaultPrompt))}_handleException(e){this._page.emitOnContextOnceInitialized(j.Events.PageError,Fd(e),this._page)}async _onTargetCrashed(){this._client._markAsCrashed(),this._page._didCrash()}_onLogEntryAdded(e){let{level:t,text:n,args:r,source:s,url:o,lineNumber:l}=e.entry;if(r&&r.map(c=>Ta(this._client,c.objectId)),s!=="worker"){let c={url:o||"",lineNumber:l||0,columnNumber:0};this._page._addConsoleMessage(t,[],c,n)}}async _onFileChooserOpened(e){if(!e.backendNodeId)return;let t=this._page._frameManager.frame(e.frameId);if(!t)return;let n;try{let r=await t._utilityContext();n=await this._adoptBackendNodeId(e.backendNodeId,r)}catch{return}await this._page._onFileChooserOpened(n)}_willBeginDownload(){this._crPage._initializedPage||this._firstNonInitialNavigationCommittedReject(new Error("Starting new page download"))}_onScreencastFrame(e){this._page.throttleScreencastFrameAck(()=>{this._client.send("Page.screencastFrameAck",{sessionId:e.sessionId}).catch(()=>{})});let t=Buffer.from(e.data,"base64");this._page.emit(re.Events.ScreencastFrame,{buffer:t,timestamp:e.metadata.timestamp,width:e.metadata.deviceWidth,height:e.metadata.deviceHeight})}async _createVideoRecorder(e,t){E(!this._screencastId);let n=Ut.findExecutable("ffmpeg").executablePathOrDie(this._page.attribution.playwright.options.sdkLanguage);this._videoRecorder=await Ma.launch(this._crPage._page,n,t),this._screencastId=e}async _startVideoRecording(e){let t=this._screencastId;E(t),this._page.once(re.Events.Close,()=>this._stopVideoRecording().catch(()=>{}));let n=new Promise(r=>this._client.once("Page.screencastFrame",r));await this._startScreencast(this._videoRecorder,{format:"jpeg",quality:90,maxWidth:e.width,maxHeight:e.height}),n.then(()=>{this._crPage._browserContext._browser._videoStarted(this._crPage._browserContext,t,e.outputFile,this._crPage.pageOrError())})}async _stopVideoRecording(){if(!this._screencastId)return;let e=this._screencastId;this._screencastId=null;let t=this._videoRecorder;this._videoRecorder=null,await this._stopScreencast(t),await t.stop().catch(()=>{}),this._crPage._browserContext._browser._takeVideo(e)?.reportFinished()}async _startScreencast(e,t={}){this._screencastClients.add(e),this._screencastClients.size===1&&await this._client.send("Page.startScreencast",t)}async _stopScreencast(e){this._screencastClients.delete(e),this._screencastClients.size||await this._client._sendMayFail("Page.stopScreencast")}async _updateGeolocation(e){let t=this._crPage._browserContext._options.geolocation;(!e||t)&&await this._client.send("Emulation.setGeolocationOverride",t||{})}async _updateViewport(e){if(this._crPage._browserContext._browser.isClank())return;E(this._isMainFrame());let t=this._crPage._browserContext._options,n=this._page.emulatedSize();if(n===null)return;let r=n.viewport,s=n.screen,o=s.width>s.height,l={mobile:!!t.isMobile,width:r.width,height:r.height,screenWidth:s.width,screenHeight:s.height,deviceScaleFactor:t.deviceScaleFactor||1,screenOrientation:t.isMobile?o?{angle:90,type:"landscapePrimary"}:{angle:0,type:"portraitPrimary"}:{angle:0,type:"landscapePrimary"},dontSetVisibleSize:e};if(JSON.stringify(this._metricsOverride)===JSON.stringify(l))return;let c=[this._client.send("Emulation.setDeviceMetricsOverride",l)];if(!e&&this._windowId){let h={width:0,height:0};this._crPage._browserContext._browser.options.headful&&(h={width:24,height:88},process.platform==="win32"?h={width:16,height:88}:process.platform==="linux"?h={width:8,height:85}:process.platform==="darwin"&&(h={width:2,height:80}),this._crPage._browserContext.isPersistentContext()&&(h.height+=46)),c.push(this.setWindowBounds({width:r.width+h.width,height:r.height+h.height}))}await Promise.all(c),this._metricsOverride=l}async windowBounds(){let{bounds:e}=await this._client.send("Browser.getWindowBounds",{windowId:this._windowId});return e}async setWindowBounds(e){return await this._client.send("Browser.setWindowBounds",{windowId:this._windowId,bounds:e})}async _updateEmulateMedia(){let e=this._page.emulatedMedia(),t=e.media==="no-override"?"":e.media,n=e.colorScheme==="no-override"?"":e.colorScheme,r=e.reducedMotion==="no-override"?"":e.reducedMotion,s=e.forcedColors==="no-override"?"":e.forcedColors,o=[{name:"prefers-color-scheme",value:n},{name:"prefers-reduced-motion",value:r},{name:"forced-colors",value:s}];await this._client.send("Emulation.setEmulatedMedia",{media:t,features:o})}async _updateUserAgent(){let e=this._crPage._browserContext._options;await this._client.send("Emulation.setUserAgentOverride",{userAgent:e.userAgent||"",acceptLanguage:e.locale,userAgentMetadata:jb(e)})}async _setDefaultFontFamilies(e){let t=zm[this._crPage._browserContext._browser._platform()];await e.send("Page.setFontFamilies",t)}async _updateFileChooserInterception(e){let t=this._page.fileChooserIntercepted();e&&!t||await this._client.send("Page.setInterceptFileChooserDialog",{enabled:t}).catch(()=>{})}async _evaluateOnNewDocument(e,t){let n=t==="utility"?Na:void 0,{identifier:r}=await this._client.send("Page.addScriptToEvaluateOnNewDocument",{source:e.source,worldName:n});e.internal||this._evaluateOnNewDocumentIdentifiers.push(r)}async _removeEvaluatesOnNewDocument(){let e=this._evaluateOnNewDocumentIdentifiers;this._evaluateOnNewDocumentIdentifiers=[],await Promise.all(e.map(t=>this._client.send("Page.removeScriptToEvaluateOnNewDocument",{identifier:t})))}async _getContentFrame(e){let t=await this._client.send("DOM.describeNode",{objectId:e._objectId});return!t||typeof t.node.frameId!="string"?null:this._page._frameManager.frame(t.node.frameId)}async _getOwnerFrame(e){let t=await e.evaluateHandle(s=>{let o=s;return o.documentElement&&o.documentElement.ownerDocument===o?o.documentElement:s.ownerDocument?s.ownerDocument.documentElement:null});if(!t||!t._objectId)return null;let n=await this._client.send("DOM.describeNode",{objectId:t._objectId}),r=n&&typeof n.node.frameId=="string"?n.node.frameId:null;return t.dispose(),r}async _getBoundingBox(e){let t=await this._client._sendMayFail("DOM.getBoxModel",{objectId:e._objectId});if(!t)return null;let n=t.model.border,r=Math.min(n[0],n[2],n[4],n[6]),s=Math.min(n[1],n[3],n[5],n[7]),o=Math.max(n[0],n[2],n[4],n[6])-r,l=Math.max(n[1],n[3],n[5],n[7])-s,c=await this._framePosition();return c?{x:r+c.x,y:s+c.y,width:o,height:l}:null}async _framePosition(){let e=this._page._frameManager.frame(this._targetId);return e?e===this._page.mainFrame()?{x:0,y:0}:await(await e.frameElement()).boundingBox():null}async _scrollRectIntoViewIfNeeded(e,t){return await this._client.send("DOM.scrollIntoViewIfNeeded",{objectId:e._objectId,rect:t}).then(()=>"done").catch(n=>{if(n instanceof Error&&n.message.includes("Node does not have a layout object"))return"error:notvisible";if(n instanceof Error&&n.message.includes("Node is detached from document"))return"error:notconnected";throw n})}async _getContentQuads(e){let t=await this._client._sendMayFail("DOM.getContentQuads",{objectId:e._objectId});if(!t)return null;let n=await this._framePosition();return n?t.quads.map(r=>[{x:r[0]+n.x,y:r[1]+n.y},{x:r[2]+n.x,y:r[3]+n.y},{x:r[4]+n.x,y:r[5]+n.y},{x:r[6]+n.x,y:r[7]+n.y}]):null}async _adoptElementHandle(e,t){let n=await this._client.send("DOM.describeNode",{objectId:e._objectId});return this._adoptBackendNodeId(n.node.backendNodeId,t)}async _adoptBackendNodeId(e,t){let n=await this._client._sendMayFail("DOM.resolveNode",{backendNodeId:e,executionContextId:t[Km]._contextId});if(!n||n.object.subtype==="null")throw new Error(up);return t.createHandle(n.object).asElement()}};Km=Symbol("delegate")});var Da,Xm=x(()=>{nt();Ld();Dd();Gt();Oe();Da=class extends jn{_browserContext;_networkManager;_session;constructor(e,t,n){super(e,n),this._session=t,this._browserContext=e,process.env.PW_EXPERIMENTAL_SERVICE_WORKER_NETWORK_EVENTS&&(this._networkManager=new ri(null,this)),t.once("Runtime.executionContextCreated",r=>{this._createExecutionContext(new gr(t,r.context))}),this._networkManager&&this._isNetworkInspectionEnabled()&&(this.updateRequestInterception(),this.updateExtraHTTPHeaders(),this.updateHttpCredentials(),this.updateOffline(),this._networkManager.addSession(t,void 0,!0).catch(()=>{})),t.send("Runtime.enable",{}).catch(r=>{}),t.send("Runtime.runIfWaitingForDebugger").catch(r=>{}),t.on("Inspector.targetReloadedAfterCrash",()=>{t._sendMayFail("Runtime.runIfWaitingForDebugger",{})})}didClose(){this._networkManager?.removeSession(this._session),this._session.dispose(),super.didClose()}async updateOffline(){this._isNetworkInspectionEnabled()&&await this._networkManager?.setOffline(!!this._browserContext._options.offline).catch(()=>{})}async updateHttpCredentials(){this._isNetworkInspectionEnabled()&&await this._networkManager?.authenticate(this._browserContext._options.httpCredentials||null).catch(()=>{})}async updateExtraHTTPHeaders(){this._isNetworkInspectionEnabled()&&await this._networkManager?.setExtraHTTPHeaders(this._browserContext._options.extraHTTPHeaders||[]).catch(()=>{})}async updateRequestInterception(){this._isNetworkInspectionEnabled()&&await this._networkManager?.setRequestInterception(this.needsRequestInterception()).catch(()=>{})}needsRequestInterception(){return this._isNetworkInspectionEnabled()&&!!this._browserContext._requestInterceptor}reportRequestFinished(e,t){this._browserContext.emit(j.Events.RequestFinished,{request:e,response:t})}requestFailed(e,t){this._browserContext.emit(j.Events.RequestFailed,e)}requestReceivedResponse(e){this._browserContext.emit(j.Events.Response,e)}requestStarted(e,t){if(this._browserContext.emit(j.Events.Request,e),t){let n=new zr(e,t);if(this._browserContext._requestInterceptor?.(n,e))return;n.continue({isFallback:!0}).catch(()=>{})}}_isNetworkInspectionEnabled(){return this._browserContext._options.serviceWorkers!=="block"}}});import qb from"path";var As,en,Ha=x(()=>{Es();Oe();O();Gt();nt();ur();Ca();Jm();fr();Xm();Gr();As=class i extends Pt{_connection;_session;_clientRootSessionPromise=null;_contexts=new Map;_crPages=new Map;_backgroundPages=new Map;_serviceWorkers=new Map;_devtools;_version="";_tracingRecording=!1;_tracingClient;_userAgent="";static async connect(e,t,n,r){n={...n};let s=new Pa(t,n.protocolLogger,n.browserLogsCollector),o=new i(e,s,n);o._devtools=r,o.isClank()&&(o._isCollocatedWithServer=!1);let l=s.rootSession;n.__testHookOnConnectToBrowser&&await n.__testHookOnConnectToBrowser();let c=await l.send("Browser.getVersion");return o._version=c.product.substring(c.product.indexOf("/")+1),o._userAgent=c.userAgent,o.options.headful=!c.userAgent.includes("Headless"),n.persistent?(o._defaultContext=new en(o,void 0,n.persistent),await Promise.all([l.send("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}).then(async()=>{await l.send("Target.getTargetInfo")}),o._defaultContext._initialize()]),await o._waitForAllPagesToBeInitialized(),o):(await l.send("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}),o)}constructor(e,t,n){super(e,n),this._connection=t,this._session=this._connection.rootSession,this._connection.on(Cd.Disconnected,()=>this._didDisconnect()),this._session.on("Target.attachedToTarget",this._onAttachedToTarget.bind(this)),this._session.on("Target.detachedFromTarget",this._onDetachedFromTarget.bind(this)),this._session.on("Browser.downloadWillBegin",this._onDownloadWillBegin.bind(this)),this._session.on("Browser.downloadProgress",this._onDownloadProgress.bind(this))}async doCreateNewContext(e){let t;e.proxy&&(process.env.PLAYWRIGHT_DISABLE_FORCED_CHROMIUM_PROXIED_LOOPBACK?t=e.proxy.bypass:t="<-loopback>"+(e.proxy.bypass?`,${e.proxy.bypass}`:""));let{browserContextId:n}=await this._session.send("Target.createBrowserContext",{disposeOnDetach:!0,proxyServer:e.proxy?e.proxy.server:void 0,proxyBypassList:t}),r=new en(this,n,e);return await r._initialize(),this._contexts.set(n,r),r}contexts(){return Array.from(this._contexts.values())}version(){return this._version}userAgent(){return this._userAgent}_platform(){return this._userAgent.includes("Windows")?"win":this._userAgent.includes("Macintosh")?"mac":"linux"}isClank(){return this.options.name==="clank"}async _waitForAllPagesToBeInitialized(){await Promise.all([...this._crPages.values()].map(e=>e.pageOrError()))}_onAttachedToTarget({targetInfo:e,sessionId:t,waitingForDebugger:n}){if(e.type==="browser")return;let r=this._session.createChildSession(t);E(e.browserContextId,"targetInfo: "+JSON.stringify(e,null,2));let s=this._contexts.get(e.browserContextId)||null;if(s||(s=this._defaultContext),e.type==="other"&&e.url.startsWith("devtools://devtools")&&this._devtools){this._devtools.install(r);return}let o=e.type==="other"&&process.env.PW_CHROMIUM_ATTACH_TO_OTHER;if(!s||e.type==="other"&&!o){r.detach().catch(()=>{});return}if(E(!this._crPages.has(e.targetId),"Duplicate target "+e.targetId),E(!this._backgroundPages.has(e.targetId),"Duplicate target "+e.targetId),E(!this._serviceWorkers.has(e.targetId),"Duplicate target "+e.targetId),e.type==="background_page"){let l=new Rs(r,e.targetId,s,null,{hasUIWindow:!1,isBackgroundPage:!0});this._backgroundPages.set(e.targetId,l);return}if(e.type==="page"||o){let l=e.openerId&&this._crPages.get(e.openerId)||null,c=new Rs(r,e.targetId,s,l,{hasUIWindow:e.type==="page",isBackgroundPage:!1});this._crPages.set(e.targetId,c);return}if(e.type==="service_worker"){let l=new Da(s,r,e.url);this._serviceWorkers.set(e.targetId,l),s.emit(en.CREvents.ServiceWorker,l);return}r.detach().catch(()=>{})}_onDetachedFromTarget(e){let t=e.targetId,n=this._crPages.get(t);if(n){this._crPages.delete(t),n.didClose();return}let r=this._backgroundPages.get(t);if(r){this._backgroundPages.delete(t),r.didClose();return}let s=this._serviceWorkers.get(t);if(s){this._serviceWorkers.delete(t),s.didClose();return}}_didDisconnect(){for(let e of this._crPages.values())e.didClose();this._crPages.clear();for(let e of this._backgroundPages.values())e.didClose();this._backgroundPages.clear();for(let e of this._serviceWorkers.values())e.didClose();this._serviceWorkers.clear(),this._didClose()}_findOwningPage(e){for(let t of this._crPages.values())if(t._page._frameManager.frame(e))return t;return null}_onDownloadWillBegin(e){let t=this._findOwningPage(e.frameId);if(!t)return;t.willBeginDownload();let n=t._initializedPage;!n&&t._opener&&(n=t._opener._initializedPage),n&&this._downloadCreated(n,e.guid,e.url,e.suggestedFilename)}_onDownloadProgress(e){e.state==="completed"&&this._downloadFinished(e.guid,""),e.state==="canceled"&&this._downloadFinished(e.guid,this._closeReason||"canceled")}async _closePage(e){await this._session.send("Target.closeTarget",{targetId:e._targetId})}async newBrowserCDPSession(){return await this._connection.createBrowserSession()}async startTracing(e,t={}){E(!this._tracingRecording,"Cannot start recording trace while already recording trace."),this._tracingClient=e?e._delegate._mainFrameSession._client:this._session;let n=["-*","devtools.timeline","v8.execute","disabled-by-default-devtools.timeline","disabled-by-default-devtools.timeline.frame","toplevel","blink.console","blink.user_timing","latencyInfo","disabled-by-default-devtools.timeline.stack","disabled-by-default-v8.cpu_profiler","disabled-by-default-v8.cpu_profiler.hires"],{screenshots:r=!1,categories:s=n}=t;r&&s.push("disabled-by-default-devtools.screenshot"),this._tracingRecording=!0,await this._tracingClient.send("Tracing.start",{transferMode:"ReturnAsStream",categories:s.join(",")})}async stopTracing(){E(this._tracingClient,"Tracing was not started.");let[e]=await Promise.all([new Promise(r=>this._tracingClient.once("Tracing.tracingComplete",r)),this._tracingClient.send("Tracing.end")]),t=qb.join(this.options.artifactsDir,Y()+".crtrace");await Nm(this._tracingClient,e.stream,t),this._tracingRecording=!1;let n=new St(this,t);return n.reportFinished(),n}isConnected(){return!this._connection._closed}async _clientRootSession(){return this._clientRootSessionPromise||(this._clientRootSessionPromise=this._connection.createBrowserSession()),this._clientRootSessionPromise}},en=class extends j{static CREvents={BackgroundPage:"backgroundpage",ServiceWorker:"serviceworker"};constructor(e,t,n){super(e,n,t),this._authenticateProxyViaCredentials()}async _initialize(){E(!Array.from(this._browser._crPages.values()).some(t=>t._browserContext===this));let e=[super._initialize()];this._browser.options.name!=="clank"&&this._options.acceptDownloads!=="internal-browser-default"&&e.push(this._browser._session.send("Browser.setDownloadBehavior",{behavior:this._options.acceptDownloads==="accept"?"allowAndName":"deny",browserContextId:this._browserContextId,downloadPath:this._browser.options.downloadsPath,eventsEnabled:!0})),await Promise.all(e)}_crPages(){return[...this._browser._crPages.values()].filter(e=>e._browserContext===this)}pages(){return this._crPages().map(e=>e._initializedPage).filter(Boolean)}async newPageDelegate(){Qm(this);let e=this._browser.isClank()?new Set(this._browser._crPages.keys()):void 0,{targetId:t}=await this._browser._session.send("Target.createTarget",{url:"about:blank",browserContextId:this._browserContextId});if(e){let n=new Set(this._browser._crPages.keys());for(let r of e)n.delete(r);for(let r of n)this._browser._crPages.get(r)._opener&&n.delete(r);E(n.size===1),[t]=[...n]}return this._browser._crPages.get(t)}async doGetCookies(e){let{cookies:t}=await this._browser._session.send("Storage.getCookies",{browserContextId:this._browserContextId});return Yh(t.map(n=>{let r={sameSite:"Lax",...n};return delete r.size,delete r.priority,delete r.session,delete r.sameParty,delete r.sourceScheme,delete r.sourcePort,r}),e)}async addCookies(e){await this._browser._session.send("Storage.setCookies",{cookies:Zh(e),browserContextId:this._browserContextId})}async doClearCookies(){await this._browser._session.send("Storage.clearCookies",{browserContextId:this._browserContextId})}async doGrantPermissions(e,t){let n=new Map([["geolocation","geolocation"],["midi","midi"],["notifications","notifications"],["camera","videoCapture"],["microphone","audioCapture"],["background-sync","backgroundSync"],["ambient-light-sensor","sensors"],["accelerometer","sensors"],["gyroscope","sensors"],["magnetometer","sensors"],["accessibility-events","accessibilityEvents"],["clipboard-read","clipboardReadWrite"],["clipboard-write","clipboardSanitizedWrite"],["payment-handler","paymentHandler"],["midi-sysex","midiSysex"],["storage-access","storageAccess"]]),r=t.map(s=>{let o=n.get(s);if(!o)throw new Error("Unknown permission: "+s);return o});await this._browser._session.send("Browser.grantPermissions",{origin:e==="*"?void 0:e,browserContextId:this._browserContextId,permissions:r})}async doClearPermissions(){await this._browser._session.send("Browser.resetPermissions",{browserContextId:this._browserContextId})}async setGeolocation(e){$d(e),this._options.geolocation=e;for(let t of this.pages())await t._delegate.updateGeolocation()}async setExtraHTTPHeaders(e){this._options.extraHTTPHeaders=e;for(let t of this.pages())await t._delegate.updateExtraHTTPHeaders();for(let t of this.serviceWorkers())await t.updateExtraHTTPHeaders()}async setUserAgent(e){this._options.userAgent=e;for(let t of this.pages())await t._delegate.updateUserAgent()}async setOffline(e){this._options.offline=e;for(let t of this.pages())await t._delegate.updateOffline();for(let t of this.serviceWorkers())await t.updateOffline()}async doSetHTTPCredentials(e){this._options.httpCredentials=e;for(let t of this.pages())await t._delegate.updateHttpCredentials();for(let t of this.serviceWorkers())await t.updateHttpCredentials()}async doAddInitScript(e){for(let t of this.pages())await t._delegate.addInitScript(e)}async doRemoveNonInternalInitScripts(){for(let e of this.pages())await e._delegate.removeNonInternalInitScripts()}async doUpdateRequestInterception(){for(let e of this.pages())await e._delegate.updateRequestInterception();for(let e of this.serviceWorkers())await e.updateRequestInterception()}async doClose(e){let t=[];for(let n of this._crPages()){let r=[...n._page._frameManager._openedDialogs].filter(s=>s.type()==="beforeunload");t.push(...r)}if(await Promise.all(t.map(n=>n.dismiss())),!this._browserContextId){await this.stopVideoRecording(),await this._browser.close({reason:e});return}await this._browser._session.send("Target.disposeBrowserContext",{browserContextId:this._browserContextId}),this._browser._contexts.delete(this._browserContextId);for(let[n,r]of this._browser._serviceWorkers)r._browserContext===this&&(r.didClose(),this._browser._serviceWorkers.delete(n))}async stopVideoRecording(){await Promise.all(this._crPages().map(e=>e._mainFrameSession._stopVideoRecording()))}onClosePersistent(){for(let[e,t]of this._browser._backgroundPages.entries())t._browserContext===this&&t._initializedPage&&(t.didClose(),this._browser._backgroundPages.delete(e))}async clearCache(){for(let e of this._crPages())await e._networkManager.clearCache()}async cancelDownload(e){await this._browser._session.send("Browser.cancelDownload",{guid:e,browserContextId:this._browserContextId})}backgroundPages(){let e=[];for(let t of this._browser._backgroundPages.values())t._browserContext===this&&t._initializedPage&&e.push(t._initializedPage);return e}serviceWorkers(){return Array.from(this._browser._serviceWorkers.values()).filter(e=>e._browserContext===this)}async newCDPSession(e){let t=null;if(e instanceof re)t=e._delegate._targetId;else if(e instanceof Qe){let r=e._page._delegate._sessions.get(e._id);if(!r)throw new Error("This frame does not have a separate CDP session, it is a part of the parent frame's session");t=r._targetId}else throw new Error("page: expected Page or Frame");return(await this._browser._clientRootSession()).attachToTarget(t)}}});function Wb(i){try{let e=new URL(i);return e.search="",e.hash="",e.toString()}catch{return i}}var eT,Vn,Ba=x(()=>{O();eT={zlibDeflateOptions:{level:3},zlibInflateOptions:{chunkSize:10*1024},threshold:10*1024},Vn=class i{_ws;_progress;_logUrl;onmessage;onclose;wsEndpoint;headers=[];static async connect(e,t,n,r,s){return await i._connect(e,t,n||{},{follow:!!r,hadRedirects:!1},s)}static async _connect(e,t,n,r,s){let o=Wb(t);e?.log(`<ws connecting> ${o}`);let l=new i(e,t,o,n,r.follow&&r.hadRedirects,s),c=!1;e?.cleanupWhenAborted(async()=>{c||await l.closeAndWait().catch(m=>null)});let h=await new Promise((m,f)=>{l._ws.on("open",async()=>{e?.log(`<ws connected> ${o}`),m({transport:l})}),l._ws.on("error",g=>{e?.log(`<ws connect error> ${o} ${g.message}`),f(new Error("WebSocket error: "+g.message)),l._ws.close()}),l._ws.on("unexpected-response",(g,b)=>{if(r.follow&&!r.hadRedirects&&(b.statusCode===301||b.statusCode===302||b.statusCode===307||b.statusCode===308)){m({redirect:b}),l._ws.close();return}for(let _=0;_<b.rawHeaders.length;_+=2)s&&b.rawHeaders[_]===s&&e?.log(b.rawHeaders[_+1]);let v=[],S=`${o} ${b.statusCode} ${b.statusMessage}`;b.on("data",_=>v.push(_)),b.on("close",()=>{let _=v.length?`${S}
${Buffer.concat(v)}`:S;e?.log(`<ws unexpected response> ${_}`),f(new Error("WebSocket error: "+_)),l._ws.close()})})});if(h.redirect){let m=Object.fromEntries(Object.entries(n||{}).filter(([f])=>!f.includes("access-key")&&f.toLowerCase()!=="authorization"));return i._connect(e,h.redirect.headers.location,m,{follow:!0,hadRedirects:!0},s)}return c=!0,l}constructor(e,t,n,r,s,o){this.wsEndpoint=t,this._logUrl=n,this._ws=new WebSocket(t),this._ws.on=this._ws.addEventListener.bind(this._ws),this._ws.once=(c,h)=>{this._ws.addEventListener(c,h,{once:!0})},this._ws.removeListener=this._ws.removeEventListener.bind(this._ws),this._ws.on("upgrade",c=>{for(let h=0;h<c.rawHeaders.length;h+=2)this.headers.push({name:c.rawHeaders[h],value:c.rawHeaders[h+1]}),o&&c.rawHeaders[h]===o&&e?.log(c.rawHeaders[h+1])}),this._progress=e;let l=Br();this._ws.addEventListener("message",c=>{l(()=>{let h=c.data,m;try{m=JSON.parse(h)}catch(f){this._progress?.log(`<closing ws> Closing websocket due to malformed JSON. eventData=${h} e=${f?.message}`),this._ws.close();return}try{this.onmessage&&this.onmessage.call(null,m)}catch(f){this._progress?.log(`<closing ws> Closing websocket due to failed onmessage callback. eventData=${h} e=${f?.message}`),this._ws.close()}})}),this._ws.addEventListener("close",c=>{this._progress?.log(`<ws disconnected> ${n} code=${c.code} reason=${c.reason}`),this.onclose&&this.onclose.call(null,c.reason)}),this._ws.addEventListener("error",c=>this._progress?.log(`<ws error> ${n} ${c.type} ${c.message}`))}send(e){this._ws.send(JSON.stringify(e))}close(){this._progress?.log(`<ws disconnecting> ${this._logUrl}`),this._ws.close()}async closeAndWait(){if(this._ws.readyState===WebSocket.CLOSED)return;let e=new Promise(t=>this._ws.once("close",t));this.close(),await e}}});var $a,Ym=x(()=>{O();Te();$a=class{_pipeRead;_pipeWrite;_pendingBuffers=[];_waitForNextTask=Br();_closed=!1;_onclose;onmessage;constructor(e,t){this._pipeRead=t,this._pipeWrite=e,t.on("data",n=>this._dispatch(n)),t.on("close",()=>{this._closed=!0,this._onclose&&this._onclose.call(null)}),t.on("error",n=>N.log("error",n)),e.on("error",n=>N.log("error",n)),this.onmessage=void 0}get onclose(){return this._onclose}set onclose(e){this._onclose=e,e&&!this._pipeRead.readable&&e()}send(e){if(this._closed)throw new Error("Pipe has been closed");this._pipeWrite.write(JSON.stringify(e)),this._pipeWrite.write("\0")}close(){throw new Error("unimplemented")}_dispatch(e){let t=e.indexOf("\0");if(t===-1){this._pendingBuffers.push(e);return}this._pendingBuffers.push(e.slice(0,t));let n=Buffer.concat(this._pendingBuffers).toString();this._waitForNextTask(()=>{this.onmessage&&this.onmessage.call(null,JSON.parse(n))});let r=t+1;for(t=e.indexOf("\0",r);t!==-1;){let s=e.toString(void 0,r,t);this._waitForNextTask(()=>{this.onmessage&&this.onmessage.call(null,JSON.parse(s))}),r=t+1,t=e.indexOf("\0",r)}this._pendingBuffers=[e.slice(r)]}}});import*as jd from"os";import ja from"path";function zb(i,e){for(let[t,n]of Object.entries(i))t.startsWith("__testHook")&&(e[t]=n)}var Zm,qa,Wa,qd=x(()=>{Oe();fn();Ba();Hr();Ym();Nt();bn();O();_t();Ot();Te();ye();gn();Zm=`Looks like you launched a headed browser without having a XServer running.
Set either 'headless: true' or use 'xvfb-run <your-playwright-app>' before running Playwright.

<3 Playwright Team`,qa=class{_wsEndpoint=new U;onBrowserExit(){this._wsEndpoint.resolve(void 0)}async waitUntilReady(){return{wsEndpoint:await this._wsEndpoint}}},Wa=class extends se{_name;_useBidi=!1;constructor(e,t){super(e,"browser-type"),this.attribution.browserType=this,this._name=t}executablePath(){return Ut.findExecutable(this._name).executablePath(this.attribution.playwright.options.sdkLanguage)||""}name(){return this._name}async launch(e,t,n){t=this._validateLaunchOptions(t),this._useBidi&&(t.useWebSocket=!0);let r=new z(e,this);return r.setLogName("browser"),await r.run(o=>{let l=t.__testHookSeleniumRemoteURL||process.env.SELENIUM_REMOTE_URL;return l?this._launchWithSeleniumHub(o,l,t):this._innerLaunchWithRetries(o,t,void 0,le.debugProtocolLogger(n)).catch(c=>{throw this._rewriteStartupLog(c)})},Le.launchTimeout(t))}async launchPersistentContext(e,t,n){n=this._validateLaunchOptions(n),this._useBidi&&(n.useWebSocket=!0);let r=new z(e,this),s={...n};return r.setLogName("browser"),(await r.run(async l=>{let c=await Sa(s);c&&(n.proxy=s.proxy),l.cleanupWhenAborted(()=>c?.close());let h=await this._innerLaunchWithRetries(l,n,s,le.debugProtocolLogger(),t).catch(m=>{throw this._rewriteStartupLog(m)});return h._defaultContext._clientCertificatesProxy=c,h},Le.launchTimeout(n)))._defaultContext}async _innerLaunchWithRetries(e,t,n,r,s){try{return await this._innerLaunch(e,t,n,r,s)}catch(o){if((typeof o=="object"&&typeof o.message=="string"?o.message:"").includes("Inconsistency detected by ld.so"))return e.log("<restarting browser due to hitting race condition in glibc>"),this._innerLaunch(e,t,n,r,s);throw o}}async _innerLaunch(e,t,n,r,s){t.proxy=t.proxy?Wd(t.proxy):void 0;let o=new Rr,{browserProcess:l,userDataDir:c,artifactsDir:h,transport:m}=await this._launchProcess(e,t,!!n,o,s);t.__testHookBeforeCreateBrowser&&await t.__testHookBeforeCreateBrowser();let f={name:this._name,isChromium:this._name==="chromium",channel:t.channel,slowMo:t.slowMo,persistent:n,headful:!t.headless,artifactsDir:h,downloadsPath:t.downloadsPath||h,tracesDir:t.tracesDir||h,browserProcess:l,customExecutablePath:t.executablePath,proxy:t.proxy,protocolLogger:r,browserLogsCollector:o,wsEndpoint:t.useWebSocket?m.wsEndpoint:void 0,originalLaunchOptions:t};n&&ti(n,f),zb(t,f);let g=await this.connectToTransport(m,f);return g._userDataDirForTest=c,n&&!t.ignoreAllDefaultArgs&&await g._defaultContext._loadDefaultContext(e),g}async _launchProcess(e,t,n,r,s){let{ignoreDefaultArgs:o,ignoreAllDefaultArgs:l,args:c=[],executablePath:h=null,handleSIGINT:m=!0,handleSIGTERM:f=!0,handleSIGHUP:g=!0}=t,b=t.env?kh(t.env):process.env;await this._createArtifactDirs(t);let v=[],S=await fs.promises.mkdtemp(ja.join(jd.tmpdir(),"playwright-artifacts-"));v.push(S),s?await zt(s)||await fs.promises.mkdir(s,{recursive:!0,mode:448}):(s=await fs.promises.mkdtemp(ja.join(jd.tmpdir(),`playwright_${this._name}dev_profile-`)),v.push(s));let _=[];l?_.push(...c):o?_.push(...this.defaultArgs(t,n,s).filter(J=>o.indexOf(J)===-1)):_.push(...this.defaultArgs(t,n,s));let k;if(h){if(!await zt(h))throw new Error(`Failed to launch ${this._name} because executable doesn't exist at ${h}`);k=h}else{let J=Ut.findExecutable(t.channel||this._name);if(!J||J.browserName!==this._name)throw new Error(`Unsupported ${this._name} channel "${t.channel}"`);k=J.executablePathOrDie(this.attribution.playwright.options.sdkLanguage),await Ut.validateHostRequirementsForExecutablesIfNeeded([J],this.attribution.playwright.options.sdkLanguage)}let D=this.readyState(t),H,A,{launchedProcess:I,gracefullyClose:F,kill:q}=await ko({command:k,args:_,env:this.amendEnvironment(b,s,k,_),handleSIGINT:m,handleSIGTERM:f,handleSIGHUP:g,log:J=>{D?.onBrowserOutput(J),e.log(J),r.log(J)},stdio:"pipe",tempDirectories:v,attemptToGracefullyClose:async()=>{t.__testHookGracefullyClose&&await t.__testHookGracefullyClose(),this.attemptToGracefullyCloseBrowser(H)},onExit:(J,oe)=>{D?.onBrowserExit(),A&&A.onclose&&A.onclose(J,oe)}});async function W(J){let oe;try{await Promise.race([F(),new Promise((Ze,$e)=>oe=setTimeout($e,J))])}catch{await q().catch($e=>{})}finally{clearTimeout(oe)}}A={onclose:void 0,process:I,close:()=>W(t.__testHookBrowserCloseTimeout||us),kill:q},e.cleanupWhenAborted(()=>W(e.timeUntilDeadline()));let C=(await D?.waitUntilReady())?.wsEndpoint;if(t.useWebSocket)H=await Vn.connect(e,C);else{let J=I.stdio;H=new $a(J[3],J[4])}return{browserProcess:A,artifactsDir:S,userDataDir:s,transport:H}}async _createArtifactDirs(e){e.downloadsPath&&await fs.promises.mkdir(e.downloadsPath,{recursive:!0}),e.tracesDir&&await fs.promises.mkdir(e.tracesDir,{recursive:!0})}async connectOverCDP(e,t,n,r){throw new Error("CDP connections are only supported by Chromium")}async _launchWithSeleniumHub(e,t,n){throw new Error("Connecting to SELENIUM_REMOTE_URL is only supported by Chromium")}_validateLaunchOptions(e){let{devtools:t=!1}=e,{headless:n=!t,downloadsPath:r,proxy:s}=e;return it()&&(n=!1),r&&!ja.isAbsolute(r)&&(r=ja.join(process.cwd(),r)),this.attribution.playwright.options.socksProxyPort&&(s={server:`socks5://127.0.0.1:${this.attribution.playwright.options.socksProxyPort}`}),{...e,devtools:t,headless:n,downloadsPath:r,proxy:s}}_createUserDataDirArgMisuseError(e){switch(this.attribution.playwright.options.sdkLanguage){case"java":return new Error(`Pass userDataDir parameter to 'BrowserType.launchPersistentContext(userDataDir, options)' instead of specifying '${e}' argument`);case"python":return new Error(`Pass user_data_dir parameter to 'browser_type.launch_persistent_context(user_data_dir, **kwargs)' instead of specifying '${e}' argument`);case"csharp":return new Error(`Pass userDataDir parameter to 'BrowserType.LaunchPersistentContextAsync(userDataDir, options)' instead of specifying '${e}' argument`);default:return new Error(`Pass userDataDir parameter to 'browserType.launchPersistentContext(userDataDir, options)' instead of specifying '${e}' argument`)}}_rewriteStartupLog(e){return Wr(e)?this.doRewriteStartupLog(e):e}readyState(e){}}});var zd,za,ef=x(()=>{zd="__pw_devtools__",za=class{_preferencesPath;_prefs;_savePromise;__testHookOnBinding;constructor(e){this._preferencesPath=e,this._savePromise=Promise.resolve()}install(e){e.on("Runtime.bindingCalled",async t=>{if(t.name!==zd)return;let n=JSON.parse(t.payload),r;if(this.__testHookOnBinding&&this.__testHookOnBinding(n),n.method==="getPreferences"){if(this._prefs===void 0)try{let s=await fs.promises.readFile(this._preferencesPath,"utf8");this._prefs=JSON.parse(s)}catch{this._prefs={}}r=this._prefs}else n.method==="setPreference"?(this._prefs[n.params[0]]=n.params[1],this._save()):n.method==="removePreference"?(delete this._prefs[n.params[0]],this._save()):n.method==="clearPreferences"&&(this._prefs={},this._save());e.send("Runtime.evaluate",{expression:`window.DevToolsAPI.embedderMessageAck(${n.id}, ${JSON.stringify(r)})`,contextId:t.executionContextId}).catch(s=>null)}),Promise.all([e.send("Runtime.enable"),e.send("Runtime.addBinding",{name:zd}),e.send("Page.enable"),e.send("Page.addScriptToEvaluateOnNewDocument",{source:`
        (() => {
          const init = () => {
            // Lazy init happens when InspectorFrontendHost is initialized.
            // At this point DevToolsHost is ready to be used.
            const host = window.DevToolsHost;
            const old = host.sendMessageToEmbedder.bind(host);
            host.sendMessageToEmbedder = message => {
              if (['getPreferences', 'setPreference', 'removePreference', 'clearPreferences'].includes(JSON.parse(message).method))
                window.${zd}(message);
              else
                old(message);
            };
          };
          let value;
          Object.defineProperty(window, 'InspectorFrontendHost', {
            configurable: true,
            enumerable: true,
            get() { return value; },
            set(v) { value = v; init(); },
          });
        })()
      `}),e.send("Runtime.runIfWaitingForDebugger")]).catch(t=>null)}_save(){this._savePromise=this._savePromise.then(async()=>{await fs.promises.writeFile(this._preferencesPath,JSON.stringify(this._prefs)).catch(e=>null)})}}});var tf,nf=x(()=>{tf=["--disable-field-trial-config","--disable-background-networking","--disable-background-timer-throttling","--disable-backgrounding-occluded-windows","--disable-back-forward-cache","--disable-breakpad","--disable-client-side-phishing-detection","--disable-component-extensions-with-background-pages","--disable-component-update","--no-default-browser-check","--disable-default-apps","--disable-dev-shm-usage","--disable-extensions","--disable-features=ImprovedCookieControls,LazyFrameLoading,GlobalMediaControls,DestroyProfileOnBrowserClose,MediaRouter,DialMediaRouteProvider,AcceptCHFrame,AutoExpandDetailsElement,CertificateTransparencyComponentUpdater,AvoidUnnecessaryBeforeUnloadCheckSync,Translate,HttpsUpgrades,PaintHolding,PlzDedicatedWorker","--allow-pre-commit-input","--disable-hang-monitor","--disable-ipc-flooding-protection","--disable-popup-blocking","--disable-prompt-on-repost","--disable-renderer-backgrounding","--force-color-profile=srgb","--metrics-recording-only","--no-first-run","--enable-automation","--password-store=basic","--use-mock-keychain","--no-service-autorun","--export-tagged-pdf","--disable-search-engine-choice-screen","--unsafely-disable-devtools-self-xss-warnings"]});import Ub from"path";async function Vb(i,e,t){if(e.startsWith("ws"))return e;i.log(`<ws preparing> retrieving websocket url from ${e}`);let n=e.endsWith("/")?`${e}json/version/`:`${e}/json/version/`,r=await ln({url:n,headers:t},async(s,o)=>new Error(`Unexpected status ${o.statusCode} when connecting to ${n}.
This does not look like a DevTools server, try connecting via ws://.`));return JSON.parse(r).webSocketDebuggerUrl}async function rf(i,e){let t=await Gb(e),n=t;try{let r=JSON.parse(t);n=r.value.localizedMessage||r.value.message}catch{}return new Error(`Error connecting to Selenium at ${i.url}: ${n}`)}function sf(i){return["ws://","wss://","http://","https://"].some(e=>i.startsWith(e))?i:"http://"+i}function Gb(i){return new Promise((e,t)=>{let n=[];i.on("data",r=>n.push(Buffer.from(r))),i.on("error",t),i.on("end",()=>e(Buffer.concat(n).toString("utf8")))})}function of(i,e){try{let t=JSON.parse(i.value);return e.log(`<selenium> using additional ${i.name} "${i.value}"`),t}catch(t){e.log(`<selenium> ignoring additional ${i.name} "${i.value}": ${t}`)}}var Ua,Ud,af=x(()=>{Ha();Hr();Ca();qd();qd();Ba();ef();Es();kr();Rn();oo();O();Te();Nt();bn();Ot();fn();qe();Oe();nf();Ua=class extends Wa{_devtools;constructor(e){super(e,"chromium"),it()&&(this._devtools=this._createDevTools())}async connectOverCDP(e,t,n,r){let s=new z(e,this);return s.setLogName("browser"),s.run(async o=>await this._connectOverCDPInternal(o,t,n),Le.timeout({timeout:r}))}async _connectOverCDPInternal(e,t,n,r){let s;n.headers&&(s=go(n.headers,!1)),s?s&&!Object.keys(s).some(_=>_.toLowerCase()==="user-agent")&&(s["User-Agent"]=qt()):s={"User-Agent":qt()};let o="/tmp",l=await Vb(e,t,s);e.throwIfAborted();let c=await Vn.connect(e,l,s),h=new U,m=async()=>{await r?.(),h.resolve()},f=async()=>{await c.closeAndWait(),await h},g={close:f,kill:f},b={noDefaultViewport:!0},v={slowMo:n.slowMo,name:"chromium",isChromium:!0,persistent:b,browserProcess:g,protocolLogger:le.debugProtocolLogger(),browserLogsCollector:new Rr,artifactsDir:o,downloadsPath:n.downloadsPath||o,tracesDir:n.tracesDir||o,originalLaunchOptions:{}};ti(b,v),e.throwIfAborted();let S=await As.connect(this.attribution.playwright,c,v);return S._isCollocatedWithServer=!1,S.on(Pt.Events.Disconnected,m),S}_createDevTools(){let e=Ut.findExecutable("chromium").directory;return e?new za(Ub.join(e,"devtools-preferences.json")):void 0}async connectToTransport(e,t){let n=this._devtools;return t.__testHookForDevTools&&(n=this._createDevTools(),await t.__testHookForDevTools(n)),As.connect(this.attribution.playwright,e,t,n)}doRewriteStartupLog(e){return!e.logs||(e.logs.includes("Missing X server")&&(e.logs=`
`+cn(Zm,1)),!e.logs.includes("crbug.com/357670")&&!e.logs.includes("No usable sandbox!")&&!e.logs.includes("crbug.com/638180"))||(e.logs=["Chromium sandboxing failed!","================================","To avoid the sandboxing issue, do either of the following:","  - (preferred): Configure your environment to support sandboxing","  - (alternative): Launch Chromium without sandbox using 'chromiumSandbox: false' option","================================",""].join(`
`)),e}amendEnvironment(e,t,n,r){return e}attemptToGracefullyCloseBrowser(e){let t={method:"Browser.close",id:kd,params:{}};e.send(t)}async _launchWithSeleniumHub(e,t,n){await this._createArtifactDirs(n),t.endsWith("/")||(t=t+"/");let r=this._innerDefaultArgs(n);r.push("--remote-debugging-port=0");let s=n.channel&&n.channel.startsWith("msedge"),o={browserName:s?"MicrosoftEdge":"chrome",[s?"ms:edgeOptions":"goog:chromeOptions"]:{args:r}};if(process.env.SELENIUM_REMOTE_CAPABILITIES){let g=of({name:"capabilities",value:process.env.SELENIUM_REMOTE_CAPABILITIES},e);g&&(o={...o,...g})}let l={};if(process.env.SELENIUM_REMOTE_HEADERS){let g=of({name:"headers",value:process.env.SELENIUM_REMOTE_HEADERS},e);g&&(l=g)}e.log(`<selenium> connecting to ${t}`);let c=await ln({url:t+"session",method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",...l},data:JSON.stringify({capabilities:{alwaysMatch:o}}),timeout:e.timeUntilDeadline()},rf),h=JSON.parse(c).value,m=h.sessionId;e.log(`<selenium> connected to sessionId=${m}`);let f=async()=>{e.log(`<selenium> disconnecting from sessionId=${m}`),await ln({url:t+"session/"+m,method:"DELETE",headers:l}).catch(g=>e.log(`<error disconnecting from selenium>: ${g}`)),e.log(`<selenium> disconnected from sessionId=${m}`),sr.delete(f)};sr.add(f);try{let g=h.capabilities,b;if(g["se:cdp"]){e.log("<selenium> using selenium v4");let v=sf(g["se:cdp"]);b=new URL(v),(b.hostname==="localhost"||b.hostname==="127.0.0.1")&&(b.hostname=new URL(t).hostname),e.log(`<selenium> retrieved endpoint ${b.toString()} for sessionId=${m}`)}else{e.log("<selenium> using selenium v3");let v=g["goog:chromeOptions"],S=v&&typeof v=="object"?v:void 0,_=S&&typeof S.debuggerAddress=="string"?S.debuggerAddress:void 0,D=sf(_||(typeof v=="string"?v:void 0)).replace("localhost","127.0.0.1");if(e.log(`<selenium> retrieved endpoint ${D} for sessionId=${m}`),b=new URL(D),b.hostname==="localhost"||b.hostname==="127.0.0.1"){let H=new URL(t).origin+"/grid/api/testsession?session="+m;try{let A=await ln({url:H,method:"GET",timeout:e.timeUntilDeadline(),headers:l},rf),I=JSON.parse(A).proxyId;b.hostname=new URL(I).hostname,e.log(`<selenium> resolved endpoint ip ${b.toString()} for sessionId=${m}`)}catch{e.log(`<selenium> unable to resolve endpoint ip for sessionId=${m}, running in standalone?`)}}}return await this._connectOverCDPInternal(e,b.toString(),{...n,headers:Ce(l)},f)}catch(g){throw await f(),g}}defaultArgs(e,t,n){let r=this._innerDefaultArgs(e);return r.push(`--user-data-dir=${n}`),e.useWebSocket?r.push("--remote-debugging-port=0"):r.push("--remote-debugging-pipe"),t?r.push("about:blank"):r.push("--no-startup-window"),r}_innerDefaultArgs(e){let{args:t=[],proxy:n}=e;if(t.find(o=>o.startsWith("--user-data-dir")))throw this._createUserDataDirArgMisuseError("--user-data-dir");if(t.find(o=>o.startsWith("--remote-debugging-pipe")))throw new Error("Playwright manages remote debugging connection itself.");if(t.find(o=>!o.startsWith("-")))throw new Error("Arguments can not specify page to be opened");let s=[...tf];if(e.devtools&&s.push("--auto-open-devtools-for-tabs"),e.headless&&(process.env.PLAYWRIGHT_CHROMIUM_USE_HEADLESS_NEW?s.push("--headless=new"):s.push("--headless=old"),s.push("--hide-scrollbars","--mute-audio","--blink-settings=primaryHoverType=2,availableHoverTypes=2,primaryPointerType=4,availablePointerTypes=4")),e.chromiumSandbox!==!0&&s.push("--no-sandbox"),n){let o=new URL(n.server);o.protocol==="socks5:"&&!this.attribution.playwright.options.socksProxyPort&&s.push(`--host-resolver-rules="MAP * ~NOTFOUND , EXCLUDE ${o.hostname}"`),s.push(`--proxy-server=${n.server}`);let c=[];this.attribution.playwright.options.socksProxyPort&&c.push("<-loopback>"),n.bypass&&c.push(...n.bypass.split(",").map(h=>h.trim()).map(h=>h.startsWith(".")?"*"+h:h)),!process.env.PLAYWRIGHT_DISABLE_FORCED_CHROMIUM_PROXIED_LOOPBACK&&!c.includes("<-loopback>")&&c.push("<-loopback>"),c.length>0&&s.push(`--proxy-bypass-list=${c.join(";")}`)}return s.push(...t),s}readyState(e){if(e.useWebSocket||e.args?.some(t=>t.startsWith("--remote-debugging-port")))return new Ud}},Ud=class extends qa{onBrowserOutput(e){let t=e.match(/DevTools listening on (.*)/);t&&this._wsEndpoint.resolve(t[1])}}});var si,Vd=x(()=>{ir();O();si=class{_builtinEngines;_builtinEnginesInMainWorld;_engines;guid=`selectors@${Y()}`;_testIdAttributeName="data-testid";constructor(){this._builtinEngines=new Set(["css","css:light","xpath","xpath:light","_react","_vue","text","text:light","id","id:light","data-testid","data-testid:light","data-test-id","data-test-id:light","data-test","data-test:light","nth","visible","internal:control","internal:has","internal:has-not","internal:has-text","internal:has-not-text","internal:and","internal:or","internal:chain","role","internal:attr","internal:label","internal:text","internal:role","internal:testid"]),this._builtinEnginesInMainWorld=new Set(["_react","_vue"]),this._engines=new Map}async register(e,t,n=!1){if(!e.match(/^[a-zA-Z_0-9-]+$/))throw new Error("Selector engine name may only contain [a-zA-Z0-9_] characters");if(this._builtinEngines.has(e)||e==="zs"||e==="zs:light")throw new Error(`"${e}" is a predefined selector engine`);if(this._engines.has(e))throw new Error(`"${e}" selector engine has been already registered`);this._engines.set(e,{source:t,contentScript:n})}testIdAttributeName(){return this._testIdAttributeName}setTestIdAttributeName(e){this._testIdAttributeName=e}unregisterAll(){this._engines.clear()}parseSelector(e,t){let n=typeof e=="string"?Nn(e):e,r=!1;return yo(n,s=>{let o=s.name,l=this._engines.get(o);if(!l&&!this._builtinEngines.has(o))throw new me(`Unknown engine "${o}" while parsing selector ${mn(n)}`);l&&!l.contentScript&&(r=!0),this._builtinEnginesInMainWorld.has(o)&&(r=!0)}),{parsed:n,world:r?"main":"utility",strict:t}}}});var lf={};Sg(lf,{Playwright:()=>Va,createPlaywright:()=>Bt});function Bt(i){return new Va(i)}var Va,oi=x(()=>{af();Vd();ye();O();Va=class extends se{selectors;chromium;options;_allPages=new Set;_allBrowsers=new Set;constructor(e){super({attribution:{},instrumentation:Do()},void 0,"Playwright"),this.options=e,this.attribution.playwright=this,this.instrumentation.addListener({onBrowserOpen:t=>this._allBrowsers.add(t),onBrowserClose:t=>this._allBrowsers.delete(t),onPageOpen:t=>this._allPages.add(t),onPageClose:t=>this._allPages.delete(t),onCallLog:(t,n,r,s)=>{N.log(r,s)}},null),this.chromium=new Ua(this),this.selectors=new si}async hideHighlight(){await Promise.all([...this._allPages].map(e=>e.hideHighlight().catch(()=>{})))}allBrowsers(){return[...this._allBrowsers]}allPages(){return[...this._allPages]}}});import Kb from"path";import{EventEmitter as cf}from"events";var Fs,Gn,Ga=x(()=>{Nt();ye();O();ks();ks();Fs=class extends cf{async close(){}async setPaused(e){}async setMode(e){}async setFileIfNeeded(e){}async setSelector(e,t){}async updateCallLogs(e){}async setSources(e){}},Gn=class i extends cf{_page;wsEndpoint;_recorder;constructor(e,t,n){super(),this.setMaxListeners(0),this._recorder=e,this._page=t,this.wsEndpoint=n}async close(){await this._page.context().close({reason:"Recorder window closed"})}async _init(){await xd(this._page,"recorder"),await this._page._setServerRequestInterceptor(t=>{if(!t.request().url().startsWith("https://playwright/"))return!1;let n=t.request().url().substring(19);debugger;throw new Error("Not implemented")}),await this._page.exposeBinding("dispatch",!1,(t,n)=>this.emit("event",n)),this._page.once("close",()=>{this.emit("close"),this._page.context().close({reason:"Recorder window closed"}).catch(()=>{})}),await this._page.mainFrame().goto(ge(),"https://playwright/index.html")}static factory(e){return async t=>process.env.PW_CODEGEN_NO_INSPECTOR?new Fs:await i._open(t,e)}static async _open(e,t){let n=t.attribution.playwright.options.sdkLanguage,r=!!t._browser.options.headful,s=(oi(),Cg(lf)).createPlaywright({sdkLanguage:"javascript",isInternalPlaywright:!0}),{context:o,page:l}=await vd(s.chromium,{sdkLanguage:n,windowSize:{width:600,height:600},windowPosition:{x:1020,y:10},persistentContextOptions:{noDefaultViewport:!0,headless:!!process.env.PWTEST_CLI_HEADLESS||ce()&&!r,useWebSocket:!!process.env.PWTEST_RECORDER_PORT,handleSIGINT:!1,args:process.env.PWTEST_RECORDER_PORT?[`--remote-debugging-port=${process.env.PWTEST_RECORDER_PORT}`]:[],executablePath:t._browser.options.isChromium?t._browser.options.customExecutablePath:void 0}});await new z(ge(),o._browser).run(async m=>{await o._browser._defaultContext._loadDefaultContextAsIs(m)});let h=new i(e,l,o._browser.options.wsEndpoint);return await h._init(),h}async setMode(e){await this._page.mainFrame().evaluateExpression((t=>{window.playwrightSetMode(t)}).toString(),{isFunction:!0},e).catch(()=>{})}async setFileIfNeeded(e){await this._page.mainFrame().evaluateExpression((t=>{window.playwrightSetFileIfNeeded(t)}).toString(),{isFunction:!0},e).catch(()=>{})}async setPaused(e){await this._page.mainFrame().evaluateExpression((t=>{window.playwrightSetPaused(t)}).toString(),{isFunction:!0},e).catch(()=>{})}async setSources(e){await this._page.mainFrame().evaluateExpression((t=>{window.playwrightSetSources(t)}).toString(),{isFunction:!0},e).catch(()=>{}),process.env.PWTEST_CLI_IS_UNDER_TEST&&e.length&&process._didSetSourcesForTest(e[0].text)}async setSelector(e,t){t&&(this._recorder?.mode()==="inspecting"?(this._recorder.setMode("standby"),this._page.bringToFront()):this._recorder?.setMode("recording")),await this._page.mainFrame().evaluateExpression((n=>{window.playwrightSetSelector(n.selector,n.userGesture)}).toString(),{isFunction:!0},{selector:e,userGesture:t}).catch(()=>{})}async updateCallLogs(e){await this._page.mainFrame().evaluateExpression((t=>{window.playwrightUpdateLogs(t)}).toString(),{isFunction:!0},e).catch(()=>{})}}});import Jb from"path";function Qm(i){for(let e of i.pages())if(e._ownedContext)throw new Error("Please use browser.newContext() for multi-page scripts that share the context.")}async function Sa(i,e){if(!i.clientCertificates?.length)return;if(i.proxy?.server&&i.proxy?.server!=="per-context"||e?.proxy?.server&&e?.proxy?.server!=="http://per-context")throw new Error("Cannot specify both proxy and clientCertificates");Gd(i.clientCertificates);let t=new va(i);return i.proxy={server:await t.listen()},i.ignoreHTTPSErrors=!0,t}function ti(i,e){if(i.noDefaultViewport&&i.deviceScaleFactor!==void 0)throw new Error('"deviceScaleFactor" option is not supported with null "viewport"');if(i.noDefaultViewport&&i.isMobile)throw new Error('"isMobile" option is not supported with null "viewport"');if(i.acceptDownloads===void 0&&e.name!=="electron"?i.acceptDownloads="accept":i.acceptDownloads===void 0&&e.name==="electron"&&(i.acceptDownloads="internal-browser-default"),!i.viewport&&!i.noDefaultViewport&&(i.viewport={width:1280,height:720}),i.recordVideo){if(!i.recordVideo.size)if(i.noDefaultViewport)i.recordVideo.size={width:800,height:600};else{let t=i.viewport,n=Math.min(1,800/Math.max(t.width,t.height));i.recordVideo.size={width:Math.floor(t.width*n),height:Math.floor(t.height*n)}}i.recordVideo.size.width&=-2,i.recordVideo.size.height&=-2}i.proxy&&(i.proxy=Wd(i.proxy)),$d(i.geolocation)}function $d(i){if(!i)return;i.accuracy=i.accuracy||0;let{longitude:e,latitude:t,accuracy:n}=i;if(e<-180||e>180)throw new Error("geolocation.longitude: precondition -180 <= LONGITUDE <= 180 failed.");if(t<-90||t>90)throw new Error("geolocation.latitude: precondition -90 <= LATITUDE <= 90 failed.");if(n<0)throw new Error("geolocation.accuracy: precondition 0 <= ACCURACY failed.")}function Gd(i){if(i)for(let e of i){if(!e.origin)throw new Error("clientCertificates.origin is required");if(!e.cert&&!e.key&&!e.passphrase&&!e.pfx)throw new Error("None of cert, key, passphrase or pfx is specified");if(e.cert&&!e.key)throw new Error("cert is specified without key");if(!e.cert&&e.key)throw new Error("key is specified without cert");if(e.pfx&&(e.cert||e.key))throw new Error("pfx is specified together with cert, key or passphrase")}}function Wd(i){let{server:e,bypass:t}=i,n;try{n=new URL(e),(!n.host||!n.protocol)&&(n=new URL("http://"+e))}catch{n=new URL("http://"+e)}if(n.protocol==="socks4:"&&(i.username||i.password))throw new Error("Socks4 proxy protocol does not support authentication");if(n.protocol==="socks5:"&&(i.username||i.password))throw new Error("Browser does not support socks5 proxy authentication");return e=n.protocol+"//"+n.host,t&&(t=t.split(",").map(r=>r.trim()).join(",")),{...i,server:e,bypass:t}}var j,df,Xb,Oe=x(()=>{bn();O();_t();Ot();Gt();nt();nt();ye();td();sd();jp();ba();od();hs();vm();_d();Ga();j=class i extends se{static Events={Console:"console",Close:"close",Dialog:"dialog",Page:"page",PageError:"pageerror",Request:"request",Response:"response",RequestFailed:"requestfailed",RequestFinished:"requestfinished",RequestAborted:"requestaborted",RequestFulfilled:"requestfulfilled",RequestContinued:"requestcontinued",BeforeClose:"beforeclose",VideoStarted:"videostarted"};_timeoutSettings=new Le;_pageBindings=new Map;_activeProgressControllers=new Set;_options;_requestInterceptor;_isPersistentContext;_closedStatus="open";_closePromise;_closePromiseFulfill;_permissions=new Map;_downloads=new Set;_browser;_browserContextId;_selectors;_origins=new Set;_harRecorders=new Map;tracing;fetchRequest;_customCloseHandler;_tempDirs=[];_settingStorageState=!1;initScripts=[];_routesInFlight=new Set;_debugger;_closeReason;clock;_clientCertificatesProxy;constructor(e,t,n){super(e,"browser-context"),this.attribution.context=this,this._browser=e,this._options=t,this._browserContextId=n,this._isPersistentContext=!n,this._closePromise=new Promise(r=>this._closePromiseFulfill=r),this.fetchRequest=new Ka(this),this._options.recordHar&&this._harRecorders.set("",new bs(this,null,this._options.recordHar)),this.tracing=new Jr(this,e.options.tracesDir),this.clock=new _a(this)}isPersistentContext(){return this._isPersistentContext}setSelectors(e){this._selectors=e}selectors(){return this._selectors||this.attribution.playwright.selectors}async _initialize(){this.attribution.playwright.options.isInternalPlaywright||(this._debugger=new hr(this),it()==="inspector"&&await Zt.show(this,Gn.factory(this),{pauseOnNextStatement:!0}),this._debugger.isPaused()&&Zt.showInspector(this,Gn.factory(this)),this._debugger.on(hr.Events.PausedStateChanged,()=>{this._debugger.isPaused()&&Zt.showInspector(this,Gn.factory(this))}),it()==="console"&&await this.extendInjectedScript(ua),this._options.serviceWorkers==="block"&&await this.addInitScript(`
if (navigator.serviceWorker) navigator.serviceWorker.register = async () => { console.warn('Service Worker registration blocked by Playwright'); };
`),this._options.permissions&&await this.grantPermissions(this._options.permissions))}debugger(){return this._debugger}async _ensureVideosPath(){this._options.recordVideo&&await We(Jb.join(this._options.recordVideo.dir,"dummy"))}canResetForReuse(){return this._closedStatus==="open"}async stopPendingOperations(e){for(let t of this._activeProgressControllers)t.abort(new Error(e));await new Promise(t=>setTimeout(t,0))}static reusableContextHash(e){let t={...e};for(let n of Object.keys(t)){let r=n;t[r]===Xb[r]&&delete t[r]}for(let n of df)delete t[n];return JSON.stringify(t)}async resetForReuse(e,t){if(this.setDefaultNavigationTimeout(void 0),this.setDefaultTimeout(void 0),this.tracing.resetForReuse(),t)for(let s of df)this._options[s]=t[s];await this._cancelAllRoutesInFlight();let n=this.pages()[0],[,...r]=this.pages();for(let s of r)await s.close(e);n&&n.hasCrashed()&&(await n.close(e),n=void 0),n?._frameManager.setCloseAllOpeningDialogs(!0),await n?._frameManager.closeOpenDialogs(),await n?.mainFrame().goto(e,"about:blank",{timeout:0}),n?._frameManager.setCloseAllOpeningDialogs(!1),await this._resetStorage(),await this._removeExposedBindings(),await this._removeInitScripts(),this.clock.markAsUninstalled(),this._options.permissions?await this.grantPermissions(this._options.permissions):await this.clearPermissions(),await this.setExtraHTTPHeaders(this._options.extraHTTPHeaders||[]),await this.setGeolocation(this._options.geolocation),await this.setOffline(!!this._options.offline),await this.setUserAgent(this._options.userAgent),await this.clearCache(),await this._resetCookies(),await n?.resetForReuse(e)}_browserClosed(){for(let e of this.pages())e._didClose();this._didCloseInternal()}_didCloseInternal(){this._closedStatus!=="closed"&&(this._clientCertificatesProxy?.close().catch(()=>{}),this.tracing.abort(),this._isPersistentContext&&this.onClosePersistent(),this._closePromiseFulfill(new Error("Context closed")),this.emit(i.Events.Close))}async cookies(e=[]){return e&&!Array.isArray(e)&&(e=[e]),await this.doGetCookies(e)}async clearCookies(e){let t=await this.cookies();await this.doClearCookies();let n=(s,o,l)=>l?l instanceof RegExp?(l.lastIndex=0,l.test(s[o])):s[o]===l:!0,r=t.filter(s=>!n(s,"name",e.name)||!n(s,"domain",e.domain)||!n(s,"path",e.path));await this.addCookies(r)}setHTTPCredentials(e){return this.doSetHTTPCredentials(e)}async exposeBinding(e,t,n){if(this._pageBindings.has(e))throw new Error(`Function "${e}" has been already registered`);for(let o of this.pages())if(o.getBinding(e))throw new Error(`Function "${e}" has been already registered in one of the pages`);let r=new qn(e,n,t);this._pageBindings.set(e,r),await this.doAddInitScript(r.initScript);let s=this.pages().map(o=>o.frames()).flat();await Promise.all(s.map(o=>o.evaluateExpression(r.initScript.source).catch(l=>{})))}async _removeExposedBindings(){for(let[e,t]of this._pageBindings)t.internal||this._pageBindings.delete(e)}async grantPermissions(e,t){let n="*";t&&(n=new URL(t).origin);let r=new Set(this._permissions.get(n)||[]);e.forEach(o=>r.add(o));let s=[...r.values()];this._permissions.set(n,s),await this.doGrantPermissions(n,s)}async clearPermissions(){this._permissions.clear(),await this.doClearPermissions()}setDefaultNavigationTimeout(e){this._timeoutSettings.setDefaultNavigationTimeout(e)}setDefaultTimeout(e){this._timeoutSettings.setDefaultTimeout(e)}async _loadDefaultContextAsIs(e){if(!this.pages().length){let n=le.waitForEvent(e,this,i.Events.Page);e.cleanupWhenAborted(()=>n.dispose);let r=await n.promise;if(r._pageIsError)throw r._pageIsError}let t=this.pages();if(t[0]._pageIsError)throw t[0]._pageIsError;return await t[0].mainFrame()._waitForLoadState(e,"load"),t}async _loadDefaultContext(e){let t=await this._loadDefaultContextAsIs(e),n=this._browser.options.name;if(this._options.isMobile&&n==="chromium"||this._options.locale&&n==="webkit"){let r=t[0];await this.newPage(e.metadata),await r.close(e.metadata)}}_authenticateProxyViaHeader(){let e=this._options.proxy||this._browser.options.proxy||{username:void 0,password:void 0},{username:t,password:n}=e;if(t){this._options.httpCredentials={username:t,password:n};let r=Buffer.from(`${t}:${n}`).toString("base64");this._options.extraHTTPHeaders=Wo([this._options.extraHTTPHeaders,ep("Proxy-Authorization",`Basic ${r}`)])}}_authenticateProxyViaCredentials(){let e=this._options.proxy||this._browser.options.proxy;if(!e)return;let{username:t,password:n}=e;t&&(this._options.httpCredentials={username:t,password:n||""})}async addInitScript(e){let t=new Vr(e);this.initScripts.push(t),await this.doAddInitScript(t)}async _removeInitScripts(){this.initScripts=this.initScripts.filter(e=>e.internal),await this.doRemoveNonInternalInitScripts()}async setRequestInterceptor(e){this._requestInterceptor=e,await this.doUpdateRequestInterception()}isClosingOrClosed(){return this._closedStatus!=="open"}async _deleteAllDownloads(){await Promise.all(Array.from(this._downloads).map(e=>e.artifact.deleteOnContextClose()))}async _deleteAllTempDirs(){await Promise.all(this._tempDirs.map(async e=>await fs.promises.unlink(e).catch(t=>{})))}setCustomCloseHandler(e){this._customCloseHandler=e}async close(e){if(this._closedStatus==="open"){e.reason&&(this._closeReason=e.reason),this.emit(i.Events.BeforeClose),this._closedStatus="closing";for(let n of this._harRecorders.values())await n.flush();await this.tracing.flush();let t=[];for(let{context:n,artifact:r}of this._browser._idToVideo.values())n===this&&t.push(r.finishedPromise());this._customCloseHandler?await this._customCloseHandler():await this.doClose(e.reason),t.push(this._deleteAllDownloads()),t.push(this._deleteAllTempDirs()),await Promise.all(t),this._customCloseHandler||this._didCloseInternal()}await this._closePromise}async newPage(e){let t=await this.newPageDelegate();e.isServerSide&&t.potentiallyUninitializedPage().markAsServerSideOnly();let n=await t.pageOrError();if(n instanceof re){if(n.isClosed())throw new Error("Page has been closed.");return n}throw n}addVisitedOrigin(e){this._origins.add(e)}async storageState(){let e={cookies:await this.cookies(),origins:[]},t=new Set(this._origins);for(let n of this.pages()){let r=n.mainFrame().origin();if(!(!r||!t.has(r)))try{let s=await n.mainFrame().nonStallingEvaluateInExistingContext(`({
          localStorage: Object.keys(localStorage).map(name => ({ name, value: localStorage.getItem(name) })),
        })`,"utility");s.localStorage.length&&e.origins.push({origin:r,localStorage:s.localStorage}),t.delete(r)}catch{}}if(t.size){let n=ge(),r=await this.newPage(n);await r._setServerRequestInterceptor(s=>(s.fulfill({body:"<html></html>",requestUrl:s.request().url()}).catch(()=>{}),!0));for(let s of t){let o={origin:s,localStorage:[]},l=r.mainFrame();await l.goto(n,s);let c=await l.evaluateExpression(`({
          localStorage: Object.keys(localStorage).map(name => ({ name, value: localStorage.getItem(name) })),
        })`,{world:"utility"});o.localStorage=c.localStorage,c.localStorage.length&&e.origins.push(o)}await r.close(n)}return e}async _resetStorage(){let e=this._origins,t=new Map(this._options.storageState?.origins?.map(s=>[s.origin,s])||[]);if(!e.size&&!t.size)return;let n=this.pages()[0],r=ge();n=n||await this.newPage({...r,isServerSide:!1}),await n._setServerRequestInterceptor(s=>(s.fulfill({body:"<html></html>",requestUrl:s.request().url()}).catch(()=>{}),!0));for(let s of new Set([...e,...t.keys()])){let o=n.mainFrame();await o.goto(r,s),await o.resetStorageForCurrentOriginBestEffort(t.get(s))}await n._setServerRequestInterceptor(void 0),this._origins=new Set([...t.keys()])}async _resetCookies(){await this.doClearCookies(),this._options.storageState?.cookies&&await this.addCookies(this._options.storageState?.cookies)}isSettingStorageState(){return this._settingStorageState}async setStorageState(e,t){this._settingStorageState=!0;try{if(t.cookies&&await this.addCookies(t.cookies),t.origins&&t.origins.length){let n=ge(),r=await this.newPage(n);await r._setServerRequestInterceptor(s=>(s.fulfill({body:"<html></html>",requestUrl:s.request().url()}).catch(()=>{}),!0));for(let s of t.origins){let o=r.mainFrame();await o.goto(e,s.origin),await o.evaluateExpression(`
            originState => {
              for (const { name, value } of (originState.localStorage || []))
                localStorage.setItem(name, value);
            }`,{isFunction:!0,world:"utility"},s)}await r.close(n)}}finally{this._settingStorageState=!1}}async extendInjectedScript(e,t){let n=s=>s.extendInjectedScript(e,t).catch(()=>{}),r=s=>(s.on(re.Events.InternalFrameNavigatedToNewDocument,n),Promise.all(s.frames().map(n)));return this.on(i.Events.Page,r),Promise.all(this.pages().map(r))}async safeNonStallingEvaluateInAllFrames(e,t,n={}){await Promise.all(this.pages().map(r=>r.safeNonStallingEvaluateInAllFrames(e,t,n)))}async _harStart(e,t){let n=Y();return this._harRecorders.set(n,new bs(this,e,t)),n}async _harExport(e){return this._harRecorders.get(e||"").export()}addRouteInFlight(e){this._routesInFlight.add(e)}removeRouteInFlight(e){this._routesInFlight.delete(e)}async _cancelAllRoutesInFlight(){await Promise.all([...this._routesInFlight].map(e=>e.abort())).catch(()=>{}),this._routesInFlight.clear()}};df=["colorScheme","forcedColors","reducedMotion","screen","userAgent","viewport"],Xb={noDefaultViewport:!1,ignoreHTTPSErrors:!1,javaScriptEnabled:!0,bypassCSP:!1,offline:!1,isMobile:!1,hasTouch:!1,acceptDownloads:"accept",strictSelectors:!1,serviceWorkers:"allow",locale:"en-US"}});function Jd(i,e){return i===e?!0:e.startsWith(".")?(i="."+i,i.endsWith(e)):!1}function Qb(i,e){return i===e?!0:(i.endsWith("/")||(i=i+"/"),e.endsWith("/")||(e=e+"/"),i.startsWith(e))}var Kd,Ja,uf=x(()=>{Kd=class{_raw;constructor(e){this._raw=e}name(){return this._raw.name}matches(e){return!(this._raw.secure&&e.protocol!=="https:"&&e.hostname!=="localhost"||!Jd(e.hostname,this._raw.domain)||!Qb(e.pathname,this._raw.path))}equals(e){return this._raw.name===e._raw.name&&this._raw.domain===e._raw.domain&&this._raw.path===e._raw.path}networkCookie(){return this._raw}updateExpiresFrom(e){this._raw.expires=e._raw.expires}expired(){return this._raw.expires===-1?!1:this._raw.expires*1e3<Date.now()}},Ja=class i{_nameToCookies=new Map;addCookies(e){for(let t of e)this._addCookie(new Kd(t))}cookies(e){let t=[];for(let n of this._cookiesIterator())n.matches(e)&&t.push(n.networkCookie());return t}allCookies(){let e=[];for(let t of this._cookiesIterator())e.push(t.networkCookie());return e}_addCookie(e){let t=this._nameToCookies.get(e.name());t||(t=new Set,this._nameToCookies.set(e.name(),t));for(let n of t)n.equals(e)&&t.delete(n);t.add(e),i.pruneExpired(t)}*_cookiesIterator(){for(let[e,t]of this._nameToCookies){i.pruneExpired(t);for(let n of t)yield n;t.size===0&&this._nameToCookies.delete(e)}}static pruneExpired(e){for(let t of e)t.expired()&&e.delete(t)}}});function Yb(){let i=[];for(let e=0;e<16;e++)i.push(hf[Math.floor(Math.random()*hf.length)]);return"----WebKitFormBoundary"+String.fromCharCode(...i)}var Xa,hf,pf=x(()=>{Xa=class{_boundary;_chunks=[];constructor(){this._boundary=Yb()}contentTypeHeader(){return`multipart/form-data; boundary=${this._boundary}`}addField(e,t){this._beginMultiPartHeader(e),this._finishMultiPartHeader(),this._chunks.push(Buffer.from(t)),this._finishMultiPartField()}addFileField(e,t){this._beginMultiPartHeader(e),this._chunks.push(Buffer.from(`; filename="${t.name}"`)),this._chunks.push(Buffer.from(`\r
content-type: ${t.mimeType||mime.getType(t.name)||"application/octet-stream"}`)),this._finishMultiPartHeader(),this._chunks.push(t.buffer),this._finishMultiPartField()}finish(){return this._addBoundary(!0),Buffer.concat(this._chunks)}_beginMultiPartHeader(e){this._addBoundary(),this._chunks.push(Buffer.from(`content-disposition: form-data; name="${e}"`))}_finishMultiPartHeader(){this._chunks.push(Buffer.from(`\r
\r
`))}_finishMultiPartField(){this._chunks.push(Buffer.from(`\r
`))}_addBoundary(e){this._chunks.push(Buffer.from("--"+this._boundary)),e&&this._chunks.push(Buffer.from("--")),this._chunks.push(Buffer.from(`\r
`))}},hf=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,65,66]});import{Transform as Zb}from"stream";function ey(i){let e=[];for(let t=0;t<i.length;t+=2)e.push({name:i[t],value:i[t+1]});return e}function ny(i){let e=i.split(";").filter(s=>s.trim().length>0).map(s=>{let o="",l="",c=s.indexOf("=");return c===-1?o=s.trim():(o=s.slice(0,c).trim(),l=s.slice(c+1).trim()),[o,l]});if(!e.length)return null;let[t,n]=e[0],r={name:t,value:n,domain:"",path:"",expires:-1,httpOnly:!1,secure:!1,sameSite:"Lax"};for(let s=1;s<e.length;s++){let[o,l]=e[s];switch(o.toLowerCase()){case"expires":let c=+new Date(l);isFinite(c)&&(c<=0?r.expires=0:r.expires=Math.min(c/1e3,jo));break;case"max-age":let h=parseInt(l,10);isFinite(h)&&(h<=0?r.expires=0:r.expires=Math.min(Date.now()/1e3+h,jo));break;case"domain":r.domain=l.toLocaleLowerCase()||"",r.domain&&!r.domain.startsWith(".")&&r.domain.includes(".")&&(r.domain="."+r.domain);break;case"path":r.path=l||"";break;case"secure":r.secure=!0;break;case"httponly":r.httpOnly=!0;break;case"samesite":switch(l.toLowerCase()){case"none":r.sameSite="None";break;case"lax":r.sameSite="Lax";break;case"strict":r.sameSite="Strict";break}break}}return r}function ry(i,e){if(E((i.postData?1:0)+(i.jsonData?1:0)+(i.formData?1:0)+(i.multipartData?1:0)<=1,"Only one of 'data', 'form' or 'multipart' can be specified"),i.jsonData!==void 0)return Pn(e,"content-type","application/json",!0),Buffer.from(i.jsonData,"utf8");if(i.formData){let t=new URLSearchParams;for(let{name:n,value:r}of i.formData)t.append(n,r);return Pn(e,"content-type","application/x-www-form-urlencoded",!0),Buffer.from(t.toString(),"utf8")}else if(i.multipartData){let t=new Xa;for(let n of i.multipartData)n.file?t.addFileField(n.name,n.file):n.value&&t.addField(n.name,n.value);return Pn(e,"content-type",t.contentTypeHeader(),!0),t.finish()}else if(i.postData!==void 0)return Pn(e,"content-type","application/octet-stream",!0),i.postData}function Pn(i,e,t,n=!1){let r=Object.entries(i).find(s=>s[0].toLowerCase()===e.toLowerCase());r?n||(i[r[0]]=t):i[e]=t}function Xd(i,e){let t=Object.entries(i).find(n=>n[0].toLowerCase()===e.toLowerCase());return t?t[1]:void 0}function ai(i,e){delete i[e]}function iy(i,e){if(!e)return!1;let t=e.split(",").map(r=>(r=r.trim(),r.startsWith(".")||(r="."+r),r)),n="."+i.hostname;return t.some(r=>n.endsWith(r))}function mf(i,e){let{username:t,password:n}=e,r=Buffer.from(`${t||""}:${n||""}`).toString("base64");Pn(i,"authorization",`Basic ${r}`)}var Mt,Qd,Ka,Qa,ty,hs=x(()=>{bn();Rn();O();Oe();uf();pf();ye();Nt();sd();Gt();_d();Mt=class i extends se{static Events={Dispose:"dispose",Request:"request",RequestFinished:"requestfinished"};fetchResponses=new Map;fetchLog=new Map;static allInstances=new Set;_activeProgressControllers=new Set;_closeReason;static findResponseBody(e){for(let t of i.allInstances){let n=t.fetchResponses.get(e);if(n)return n}}constructor(e){super(e,"request-context"),i.allInstances.add(this)}_disposeImpl(){i.allInstances.delete(this),this.fetchResponses.clear(),this.fetchLog.clear(),this.emit(i.Events.Dispose)}disposeResponse(e){this.fetchResponses.delete(e),this.fetchLog.delete(e)}_storeResponseBody(e){let t=Y();return this.fetchResponses.set(t,e),t}async fetch(e,t){let n=this._defaultOptions(),r={"user-agent":n.userAgent,accept:"*/*","accept-encoding":"gzip,deflate,br"};if(n.extraHTTPHeaders)for(let{name:k,value:D}of n.extraHTTPHeaders)Pn(r,k,D);if(e.headers)for(let{name:k,value:D}of e.headers)Pn(r,k,D);let s=new URL(e.url,n.baseURL);if(e.encodedParams)s.search=e.encodedParams;else if(e.params)for(let{name:k,value:D}of e.params)s.searchParams.append(k,D);let o=this._getHttpCredentials(s);o?.send==="always"&&mf(r,o);let l=e.method?.toUpperCase()||"GET",c=n.proxy,h;if(c&&!n.clientCertificates?.length&&c.server!=="per-context"&&!iy(s,c.bypass)){let k=url.parse(c.server);k.protocol?.startsWith("socks")?h=new SocksProxyAgent({host:k.hostname,port:k.port||void 0}):(c.username&&(k.auth=`${c.username}:${c.password||""}`),h=new HttpsProxyAgent(k))}let m=n.timeoutSettings.timeout(e),f=m&&X()+m,g={method:l,headers:r,agent:h,maxRedirects:e.maxRedirects===0?-1:e.maxRedirects===void 0?20:e.maxRedirects,timeout:m,deadline:f,...bd(this._defaultOptions().clientCertificates,s.origin),__testHookLookup:e.__testHookLookup};(e.ignoreHTTPSErrors||n.ignoreHTTPSErrors)&&(g.rejectUnauthorized=!1);let b=ry(e,r);b&&Pn(r,"content-length",String(b.byteLength));let v=new z(t,this),S=await v.run(k=>this._sendRequestWithRetries(k,s,g,b,e.maxRetries)),_=this._storeResponseBody(S.body);if(this.fetchLog.set(_,v.metadata.log),e.failOnStatusCode&&(S.status<200||S.status>=400)){let k="";if(S.body.byteLength){let D=S.body.toString("utf8");D.length>1e3&&(D=D.substring(0,997)+"..."),k=`
Response text:
${D}`}throw new Error(`${S.status} ${S.statusText}${k}`)}return{...S,fetchUid:_}}_parseSetCookieHeader(e,t){if(!t)return[];let n=new URL(e),r="/"+n.pathname.substr(1).split("/").slice(0,-1).join("/"),s=[];for(let o of t){let l=ny(o);l&&(l.domain?E(l.domain.startsWith(".")||!l.domain.includes(".")):l.domain=n.hostname,Jd(n.hostname,l.domain)&&((!l.path||!l.path.startsWith("/"))&&(l.path=r),s.push(l)))}return s}async _updateRequestCookieHeader(e,t){if(Xd(t,"cookie")!==void 0)return;let n=await this._cookies(e);if(n.length){let r=n.map(s=>`${s.name}=${s.value}`);Pn(t,"cookie",r.join("; "))}}async _sendRequestWithRetries(e,t,n,r,s){s??=0;let o=250;for(let l=0;l<=s;l++)try{return await this._sendRequest(e,t,n,r)}catch(c){if(s===0)throw c;if(l===s||n.deadline&&X()+o>n.deadline)throw new Error(`Failed after ${l+1} attempt(s): ${c}`);if(c.code!=="ECONNRESET")throw c;e.log(`  Received ECONNRESET, will retry after ${o}ms.`),await new Promise(h=>setTimeout(h,o)),o*=2}throw new Error("Unreachable")}async _sendRequest(e,t,n,r){await this._updateRequestCookieHeader(t,n.headers);let s=Xd(n.headers,"cookie")?.split(";").map(l=>{let[c,h]=l.split("=").map(m=>m.trim());return{name:c,value:h}})||[],o={url:t,method:n.method,headers:n.headers,cookies:s,postData:r};return this.emit(i.Events.Request,o),new Promise((l,c)=>{let h=(t.protocol==="https:"?https:http).request,m=n.agent||(t.protocol==="https:"?httpsHappyEyeballsAgent:httpHappyEyeballsAgent),f={...n,agent:m},g=h(t,f,async v=>{let S=F=>{let q={requestEvent:o,httpVersion:v.httpVersion,statusCode:v.statusCode||0,statusMessage:v.statusMessage||"",headers:v.headers,rawHeaders:v.rawHeaders,cookies:_,body:F};this.emit(i.Events.RequestFinished,q)};e.log(`\u2190 ${v.statusCode} ${v.statusMessage}`);for(let[F,q]of Object.entries(v.headers))e.log(`  ${F}: ${q}`);let _=this._parseSetCookieHeader(v.url||t.toString(),v.headers["set-cookie"]);if(_.length)try{await this._addCookies(_)}catch{await Promise.all(_.map(q=>this._addCookies([q]).catch(()=>{})))}if(ty.includes(v.statusCode)&&n.maxRedirects>=0){if(!n.maxRedirects){c(new Error("Max redirect count exceeded")),g.destroy();return}let F={...n.headers};ai(F,"cookie");let q=v.statusCode,W=n.method;((q===301||q===302)&&W==="POST"||q===303&&!["GET","HEAD"].includes(W))&&(W="GET",r=void 0,ai(F,"content-encoding"),ai(F,"content-language"),ai(F,"content-length"),ai(F,"content-location"),ai(F,"content-type"));let C={method:W,headers:F,agent:n.agent,maxRedirects:n.maxRedirects-1,timeout:n.timeout,deadline:n.deadline,...bd(this._defaultOptions().clientCertificates,t.origin),__testHookLookup:n.__testHookLookup};n.rejectUnauthorized===!1&&(C.rejectUnauthorized=!1);let J=Buffer.from(v.headers.location??"","latin1").toString("utf8");if(J){let oe;try{oe=new URL(J,t)}catch{c(new Error(`uri requested responds with an invalid redirect URL: ${J}`)),g.destroy();return}F.host&&(F.host=oe.host),S(),l(this._sendRequest(e,oe,C,r)),g.destroy();return}}if(v.statusCode===401&&!Xd(n.headers,"authorization")){let F=v.headers["www-authenticate"],q=this._getHttpCredentials(t);if(F?.trim().startsWith("Basic")&&q){mf(n.headers,q),S(),l(this._sendRequest(e,t,n,r)),g.destroy();return}}v.on("aborted",()=>c(new Error("aborted")));let k=[],D=()=>{let F=Buffer.concat(k);S(F),l({url:v.url||t.toString(),status:v.statusCode||0,statusText:v.statusMessage||"",headers:ey(v.rawHeaders),body:F})},H=v,A,I=v.headers["content-encoding"];if(I==="gzip"||I==="x-gzip"?A=zlib.createGunzip({flush:zlib.constants.Z_SYNC_FLUSH,finishFlush:zlib.constants.Z_SYNC_FLUSH}):I==="br"?A=zlib.createBrotliDecompress({flush:zlib.constants.BROTLI_OPERATION_FLUSH,finishFlush:zlib.constants.BROTLI_OPERATION_FLUSH}):I==="deflate"&&(A=zlib.createInflate()),A){let F=new Qd(D);H=pipeline(v,F,A,q=>{q&&c(new Error(`failed to decompress '${I}' encoding: ${q.message}`))}),H.on("error",q=>c(new Error(`failed to decompress '${I}' encoding: ${q}`)))}else H.on("error",c);H.on("data",F=>k.push(F)),H.on("end",D)});g.on("error",v=>c(yd(v)));let b=()=>{c(new Error("Request context disposed.")),g.destroy()};if(this.on(i.Events.Dispose,b),g.on("close",()=>this.off(i.Events.Dispose,b)),e.log(`\u2192 ${n.method} ${t.toString()}`),n.headers)for(let[v,S]of Object.entries(n.headers))e.log(`  ${v}: ${S}`);if(n.deadline){let v=()=>{c(new Error(`Request timed out after ${n.timeout}ms`)),g.destroy()},S=n.deadline-X();if(S<=0){v();return}g.setTimeout(S,v)}r&&g.write(r),g.end()})}_getHttpCredentials(e){if(!this._defaultOptions().httpCredentials?.origin||e.origin.toLowerCase()===this._defaultOptions().httpCredentials?.origin?.toLowerCase())return this._defaultOptions().httpCredentials}},Qd=class extends Zb{_receivedSomeData=!1;_onEmptyStreamCallback;constructor(e){super(),this._onEmptyStreamCallback=e}_transform(e,t,n){this._receivedSomeData=!0,n(null,e)}_flush(e){this._receivedSomeData?e(null):this._onEmptyStreamCallback()}},Ka=class extends Mt{_context;constructor(e){super(e),this._context=e,e.once(j.Events.Close,()=>this._disposeImpl())}tracing(){return this._context.tracing}async dispose(e){this._closeReason=e.reason,this.fetchResponses.clear()}_defaultOptions(){return{userAgent:this._context._options.userAgent||this._context._browser.userAgent(),extraHTTPHeaders:this._context._options.extraHTTPHeaders,httpCredentials:this._context._options.httpCredentials,proxy:this._context._options.proxy||this._context._browser.options.proxy,timeoutSettings:this._context._timeoutSettings,ignoreHTTPSErrors:this._context._options.ignoreHTTPSErrors,baseURL:this._context._options.baseURL,clientCertificates:this._context._options.clientCertificates}}async _addCookies(e){await this._context.addCookies(e)}async _cookies(e){return await this._context.cookies(e.toString())}async storageState(){return this._context.storageState()}},Qa=class extends Mt{_cookieStore=new Ja;_options;_origins;_tracing;constructor(e,t){super(e),this.attribution.context=this;let n=new Le;t.timeout!==void 0&&n.setDefaultTimeout(t.timeout);let r=t.proxy;if(r?.server){let s=r?.server.trim();if(/^\w+:\/\//.test(s)||(s="http://"+s),r.server=s,t.clientCertificates)throw new Error("Cannot specify both proxy and clientCertificates")}t.storageState&&(this._origins=t.storageState.origins,this._cookieStore.addCookies(t.storageState.cookies||[])),Gd(t.clientCertificates),this._options={baseURL:t.baseURL,userAgent:t.userAgent||qt(),extraHTTPHeaders:t.extraHTTPHeaders,ignoreHTTPSErrors:!!t.ignoreHTTPSErrors,httpCredentials:t.httpCredentials,clientCertificates:t.clientCertificates,proxy:r,timeoutSettings:n},this._tracing=new Jr(this,t.tracesDir)}tracing(){return this._tracing}async dispose(e){this._closeReason=e.reason,await this._tracing.flush(),await this._tracing.deleteTmpTracesDir(),this._disposeImpl()}_defaultOptions(){return this._options}async _addCookies(e){this._cookieStore.addCookies(e)}async _cookies(e){return this._cookieStore.cookies(e)}async storageState(){return{cookies:this._cookieStore.allCookies(),origins:this._origins||[]}}};ty=[301,302,303,307,308]});function ze(i){return Hn(i.value,i.handles.map(e=>e._object))}function wt(i){return Dn(i,e=>({fallThrough:e}))}var Is,Ya=x(()=>{_e();Ls();ds();Is=class extends K{_type_JSHandle=!0;constructor(e,t){super(e,t,t.asElement()?"ElementHandle":"JSHandle",{preview:t.toString()}),t._setPreviewCallback(n=>this._dispatchEvent("previewUpdated",{preview:n}))}async evaluateExpression(e){return{value:wt(await this._object.evaluateExpression(e.expression,{isFunction:e.isFunction},ze(e.arg)))}}async evaluateExpressionHandle(e){let t=await this._object.evaluateExpressionHandle(e.expression,{isFunction:e.isFunction},ze(e.arg));return{handle:Ee.fromJSHandle(this.parentScope(),t)}}async getProperty(e){let t=await this._object.getProperty(e.name);return{handle:Ee.fromJSHandle(this.parentScope(),t)}}async getPropertyList(){let e=await this._object.getProperties(),t=[];for(let[n,r]of e)t.push({name:n,value:Ee.fromJSHandle(this.parentScope(),r)});return{properties:t}}async jsonValue(){return{value:wt(await this._object.jsonValue())}}async objectCount(e){return{count:await this._object.objectCount()}}async dispose(e,t){t.potentiallyClosesScope=!0,this._object.dispose(),this._dispose()}}});var Ee,Ls=x(()=>{_e();Ya();Za();el();Os();Ee=class i extends Is{_type_ElementHandle=!0;_elementHandle;static from(e,t){return pe(t)||new i(e,t)}static fromNullable(e,t){if(t)return pe(t)||new i(e,t)}static fromJSHandle(e,t){let n=pe(t);return n||(t.asElement()?new i(e,t.asElement()):new Is(e,t))}constructor(e,t){super(e,t),this._elementHandle=t}async ownerFrame(e,t){let n=await this._elementHandle.ownerFrame();return{frame:n?lt.from(this._browserContextDispatcher(),n):void 0}}async contentFrame(e,t){let n=await this._elementHandle.contentFrame();return{frame:n?lt.from(this._browserContextDispatcher(),n):void 0}}async getAttribute(e,t){let n=await this._elementHandle.getAttribute(t,e.name);return{value:n===null?void 0:n}}async inputValue(e,t){return{value:await this._elementHandle.inputValue(t)}}async textContent(e,t){let n=await this._elementHandle.textContent(t);return{value:n===null?void 0:n}}async innerText(e,t){return{value:await this._elementHandle.innerText(t)}}async innerHTML(e,t){return{value:await this._elementHandle.innerHTML(t)}}async isChecked(e,t){return{value:await this._elementHandle.isChecked(t)}}async isDisabled(e,t){return{value:await this._elementHandle.isDisabled(t)}}async isEditable(e,t){return{value:await this._elementHandle.isEditable(t)}}async isEnabled(e,t){return{value:await this._elementHandle.isEnabled(t)}}async isHidden(e,t){return{value:await this._elementHandle.isHidden(t)}}async isVisible(e,t){return{value:await this._elementHandle.isVisible(t)}}async dispatchEvent(e,t){await this._elementHandle.dispatchEvent(t,e.type,ze(e.eventInit))}async scrollIntoViewIfNeeded(e,t){await this._elementHandle.scrollIntoViewIfNeeded(t,e)}async hover(e,t){return await this._elementHandle.hover(t,e)}async click(e,t){return await this._elementHandle.click(t,e)}async dblclick(e,t){return await this._elementHandle.dblclick(t,e)}async tap(e,t){return await this._elementHandle.tap(t,e)}async selectOption(e,t){let n=(e.elements||[]).map(r=>r._elementHandle);return{values:await this._elementHandle.selectOption(t,n,e.options||[],e)}}async fill(e,t){return await this._elementHandle.fill(t,e.value,e)}async selectText(e,t){await this._elementHandle.selectText(t,e)}async setInputFiles(e,t){return await this._elementHandle.setInputFiles(t,e)}async focus(e,t){await this._elementHandle.focus(t)}async type(e,t){return await this._elementHandle.type(t,e.text,e)}async press(e,t){return await this._elementHandle.press(t,e.key,e)}async check(e,t){return await this._elementHandle.check(t,e)}async uncheck(e,t){return await this._elementHandle.uncheck(t,e)}async boundingBox(e,t){return{value:await this._elementHandle.boundingBox()||void 0}}async screenshot(e,t){let n=(e.mask||[]).map(({frame:r,selector:s})=>({frame:r._object,selector:s}));return{binary:await this._elementHandle.screenshot(t,{...e,mask:n})}}async querySelector(e,t){let n=await this._elementHandle.querySelector(e.selector,e);return{element:i.fromNullable(this.parentScope(),n)}}async querySelectorAll(e,t){return{elements:(await this._elementHandle.querySelectorAll(e.selector)).map(r=>i.from(this.parentScope(),r))}}async evalOnSelector(e,t){return{value:wt(await this._elementHandle.evalOnSelector(e.selector,!!e.strict,e.expression,e.isFunction,ze(e.arg)))}}async evalOnSelectorAll(e,t){return{value:wt(await this._elementHandle.evalOnSelectorAll(e.selector,e.expression,e.isFunction,ze(e.arg)))}}async waitForElementState(e,t){await this._elementHandle.waitForElementState(t,e.state,e)}async waitForSelector(e,t){return{element:i.fromNullable(this.parentScope(),await this._elementHandle.waitForSelector(t,e.selector,e))}}_browserContextDispatcher(){let e=this.parentScope();if(e instanceof Ct)return e;if(e instanceof He)return e.parentScope();if(e instanceof tn||e instanceof lt){let t=e.parentScope();return t instanceof Ct?t:t.parentScope()}throw new Error("ElementHandle belongs to unexpected scope")}}});var Ms,ff=x(()=>{_e();O();Ms=class extends K{_type_Stream=!0;_ended=!1;constructor(e,t){super(e,{guid:"stream@"+Y(),stream:t},"Stream",{}),t.once("end",()=>this._ended=!0),t.once("error",()=>this._ended=!0)}async read(e){let t=this._object.stream;if(this._ended)return{binary:Buffer.from("")};if(!t.readableLength){let r=new U,s=()=>r.resolve();t.on("readable",s),t.on("end",s),t.on("error",s),await r,t.off("readable",s),t.off("end",s),t.off("error",s)}return{binary:t.read(Math.min(t.readableLength,e.size||t.readableLength))||Buffer.from("")}}async close(){this._object.stream.destroy()}}});var ct,Ns=x(()=>{_e();ff();_t();ct=class i extends K{_type_Artifact=!0;static from(e,t){return i.fromNullable(e,t)}static fromNullable(e,t){return t?pe(t)||new i(e,t):void 0}constructor(e,t){super(e,t,"Artifact",{absolutePath:t.localPath()})}async pathAfterFinished(){return{value:await this._object.localPathAfterFinished()}}async saveAs(e){return await new Promise((t,n)=>{this._object.saveAs(async(r,s)=>{if(s){n(s);return}try{await We(e.path),await fs.promises.copyFile(r,e.path),t()}catch(o){n(o)}})})}async saveAsStream(){return await new Promise((e,t)=>{this._object.saveAs(async(n,r)=>{if(r){t(r);return}try{let s=fs.createReadStream(n,{highWaterMark:1048576}),o=new Ms(this,s);e({stream:o}),await new Promise(l=>{s.on("close",l),s.on("end",l),s.on("error",l)})}catch(s){t(s)}})})}async stream(){let e=await this._object.localPathAfterFinished(),t=fs.createReadStream(e,{highWaterMark:1024*1024});return{stream:new Ms(this,t)}}async failure(){return{error:await this._object.failureError()||void 0}}async cancel(){await this._object.cancel()}async delete(e,t){t.potentiallyClosesScope=!0,await this._object.delete(),this._dispose()}}});var li,Yd=x(()=>{Ns();_e();li=class i extends K{_type_Tracing=!0;static from(e,t){return pe(t)||new i(e,t)}constructor(e,t){super(e,t,"Tracing",{})}async tracingStart(e){await this._object.start(e)}async tracingStartChunk(e){return await this._object.startChunk(e)}async tracingStopChunk(e){let{artifact:t,entries:n}=await this._object.stopChunk(e);return{artifact:t?ct.from(this,t):void 0,entries:n}}async tracingStop(e){await this._object.stop()}}});var kt,Et,ci,tl,di,Kn=x(()=>{Gt();_e();Yd();Za();Os();kt=class i extends K{_type_Request;_browserContextDispatcher;static from(e,t){return pe(t)||new i(e,t)}static fromNullable(e,t){return t?i.from(e,t):void 0}constructor(e,t){let n=t.postDataBuffer(),r=t.frame(),s=t.frame()?._page,o=s?pe(s):null,l=r?lt.from(e,r):null;super(o||l||e,t,"Request",{frame:lt.fromNullable(e,t.frame()),serviceWorker:tn.fromNullable(e,t.serviceWorker()),url:t.url(),resourceType:t.resourceType(),method:t.method(),postData:n===null?void 0:n,headers:t.headers(),isNavigationRequest:t.isNavigationRequest(),redirectedFrom:i.fromNullable(e,t.redirectedFrom())}),this._type_Request=!0,this._browserContextDispatcher=e}async rawRequestHeaders(e){return{headers:await this._object.rawRequestHeaders()}}async response(){return{response:Et.fromNullable(this._browserContextDispatcher,await this._object.response())}}},Et=class i extends K{_type_Response=!0;static from(e,t){let n=pe(t),r=kt.from(e,t.request());return n||new i(r,t)}static fromNullable(e,t){return t?i.from(e,t):void 0}constructor(e,t){super(e,t,"Response",{request:e,url:t.url(),status:t.status(),statusText:t.statusText(),headers:t.headers(),timing:t.timing(),fromServiceWorker:t.fromServiceWorker()})}async body(){return{binary:await this._object.body()}}async securityDetails(){return{value:await this._object.securityDetails()||void 0}}async serverAddr(){return{value:await this._object.serverAddr()||void 0}}async rawResponseHeaders(e){return{headers:await this._object.rawResponseHeaders()}}async sizes(e){return{sizes:await this._object.sizes()}}},ci=class i extends K{_type_Route=!0;static from(e,t){return pe(t)||new i(e,t)}constructor(e,t){super(e,t,"Route",{request:e})}async continue(e,t){await this._object.continue({url:e.url,method:e.method,headers:e.headers,postData:e.postData,isFallback:e.isFallback})}async fulfill(e,t){await this._object.fulfill(e)}async abort(e,t){await this._object.abort(e.errorCode||"failed")}async redirectNavigationRequest(e){await this._object.redirectNavigationRequest(e.url)}},tl=class extends K{_type_EventTarget=!0;_type_WebSocket=!0;constructor(e,t){super(e,t,"WebSocket",{url:t.url()}),this.addObjectListener(yn.Events.FrameSent,n=>this._dispatchEvent("frameSent",n)),this.addObjectListener(yn.Events.FrameReceived,n=>this._dispatchEvent("frameReceived",n)),this.addObjectListener(yn.Events.SocketError,n=>this._dispatchEvent("socketError",{error:n})),this.addObjectListener(yn.Events.Close,()=>this._dispatchEvent("close",{}))}},di=class i extends K{_type_APIRequestContext=!0;static from(e,t){return pe(t)||new i(e,t)}static fromNullable(e,t){return t?i.from(e,t):void 0}constructor(e,t){let n=li.from(e,t.tracing());super(e,t,"APIRequestContext",{tracing:n}),this.adopt(n)}async storageState(){return this._object.storageState()}async dispose(e,t){t.potentiallyClosesScope=!0,await this._object.dispose(e),this._dispose()}async fetch(e,t){let n=await this._object.fetch(e,t);return{response:{url:n.url,status:n.status,statusText:n.statusText,headers:n.headers,fetchUid:n.fetchUid}}}async fetchResponseBody(e){return{binary:this._object.fetchResponses.get(e.fetchUid)}}async fetchLog(e){return{log:this._object.fetchLog.get(e.fetchUid)||[]}}async disposeAPIResponse(e){this._object.disposeResponse(e.fetchUid)}}});var lt,Za=x(()=>{ur();_e();Ls();Ya();Kn();Kn();O();lt=class i extends K{_type_Frame=!0;_frame;_browserContextDispatcher;static from(e,t){return pe(t)||new i(e,t)}static fromNullable(e,t){if(t)return i.from(e,t)}constructor(e,t){Ku(t._page.mainFrame(),"Cannot determine whether the frame is a main frame");let n=t._page.mainFrame()===t?"MainFrame":"Frame",r=pe(t._page);super(r||e,t,"Frame",{url:t.url(),name:t.name(),parentFrame:i.fromNullable(e,t.parentFrame()),loadStates:Array.from(t._firedLifecycleEvents)},n),this._browserContextDispatcher=e,this._frame=t,this.addObjectListener(Qe.Events.AddLifecycle,s=>{this._dispatchEvent("loadstate",{add:s})}),this.addObjectListener(Qe.Events.RemoveLifecycle,s=>{this._dispatchEvent("loadstate",{remove:s})}),this.addObjectListener(Qe.Events.InternalNavigation,s=>{if(!s.isPublic)return;let o={url:s.url,name:s.name,error:s.error?s.error.message:void 0};s.newDocument&&(o.newDocument={request:kt.fromNullable(this._browserContextDispatcher,s.newDocument.request||null)}),this._dispatchEvent("navigated",o)})}async goto(e,t){return{response:Et.fromNullable(this._browserContextDispatcher,await this._frame.goto(t,e.url,e))}}async frameElement(){return{element:Ee.from(this,await this._frame.frameElement())}}async evaluateExpression(e,t){return{value:wt(await this._frame.evaluateExpression(e.expression,{isFunction:e.isFunction},ze(e.arg)))}}async evaluateExpressionHandle(e,t){return{handle:Ee.fromJSHandle(this,await this._frame.evaluateExpressionHandle(e.expression,{isFunction:e.isFunction},ze(e.arg)))}}async waitForSelector(e,t){return{element:Ee.fromNullable(this,await this._frame.waitForSelector(t,e.selector,e))}}async dispatchEvent(e,t){return this._frame.dispatchEvent(t,e.selector,e.type,ze(e.eventInit),e)}async evalOnSelector(e,t){return{value:wt(await this._frame.evalOnSelector(e.selector,!!e.strict,e.expression,e.isFunction,ze(e.arg)))}}async evalOnSelectorAll(e,t){return{value:wt(await this._frame.evalOnSelectorAll(e.selector,e.expression,e.isFunction,ze(e.arg)))}}async querySelector(e,t){return{element:Ee.fromNullable(this,await this._frame.querySelector(e.selector,e))}}async querySelectorAll(e,t){return{elements:(await this._frame.querySelectorAll(e.selector)).map(r=>Ee.from(this,r))}}async queryCount(e){return{value:await this._frame.queryCount(e.selector)}}async content(){return{value:await this._frame.content()}}async setContent(e,t){return await this._frame.setContent(t,e.html,e)}async addScriptTag(e,t){return{element:Ee.from(this,await this._frame.addScriptTag(e))}}async addStyleTag(e,t){return{element:Ee.from(this,await this._frame.addStyleTag(e))}}async click(e,t){return t.potentiallyClosesScope=!0,await this._frame.click(t,e.selector,e)}async dblclick(e,t){return await this._frame.dblclick(t,e.selector,e)}async dragAndDrop(e,t){return await this._frame.dragAndDrop(t,e.source,e.target,e)}async tap(e,t){return await this._frame.tap(t,e.selector,e)}async fill(e,t){return await this._frame.fill(t,e.selector,e.value,e)}async focus(e,t){await this._frame.focus(t,e.selector,e)}async blur(e,t){await this._frame.blur(t,e.selector,e)}async textContent(e,t){let n=await this._frame.textContent(t,e.selector,e);return{value:n===null?void 0:n}}async innerText(e,t){return{value:await this._frame.innerText(t,e.selector,e)}}async innerHTML(e,t){return{value:await this._frame.innerHTML(t,e.selector,e)}}async getAttribute(e,t){let n=await this._frame.getAttribute(t,e.selector,e.name,e);return{value:n===null?void 0:n}}async inputValue(e,t){return{value:await this._frame.inputValue(t,e.selector,e)}}async isChecked(e,t){return{value:await this._frame.isChecked(t,e.selector,e)}}async isDisabled(e,t){return{value:await this._frame.isDisabled(t,e.selector,e)}}async isEditable(e,t){return{value:await this._frame.isEditable(t,e.selector,e)}}async isEnabled(e,t){return{value:await this._frame.isEnabled(t,e.selector,e)}}async isHidden(e,t){return{value:await this._frame.isHidden(t,e.selector,e)}}async isVisible(e,t){return{value:await this._frame.isVisible(t,e.selector,e)}}async hover(e,t){return await this._frame.hover(t,e.selector,e)}async selectOption(e,t){let n=(e.elements||[]).map(r=>r._elementHandle);return{values:await this._frame.selectOption(t,e.selector,n,e.options||[],e)}}async setInputFiles(e,t){return await this._frame.setInputFiles(t,e.selector,e)}async type(e,t){return await this._frame.type(t,e.selector,e.text,e)}async press(e,t){return await this._frame.press(t,e.selector,e.key,e)}async check(e,t){return await this._frame.check(t,e.selector,e)}async uncheck(e,t){return await this._frame.uncheck(t,e.selector,e)}async waitForTimeout(e,t){return await this._frame.waitForTimeout(t,e.timeout)}async waitForFunction(e,t){return{handle:Ee.fromJSHandle(this,await this._frame._waitForFunctionExpression(t,e.expression,e.isFunction,ze(e.arg),e))}}async title(e,t){return{value:await this._frame.title()}}async highlight(e,t){return await this._frame.highlight(e.selector)}async expect(e,t){t.potentiallyClosesScope=!0;let n=e.expectedValue?ze(e.expectedValue):void 0,r=await this._frame.expect(t,e.selector,{...e,expectedValue:n});return r.received!==void 0&&(r.received=wt(r.received)),r}}});var He,tn,Hs,Os=x(()=>{nt();_e();Vt();Za();Kn();Kn();Kn();Ya();Ls();Ns();O();He=class i extends K{_type_EventTarget=!0;_type_Page=!0;_page;_subscriptions=new Set;static from(e,t){return i.fromNullable(e,t)}static fromNullable(e,t){return t?pe(t)||new i(e,t):void 0}constructor(e,t){let n=lt.from(e,t.mainFrame());super(e,t,"Page",{mainFrame:n,viewportSize:t.viewportSize()||void 0,isClosed:t.isClosed(),opener:i.fromNullable(e,t.opener())}),this.adopt(n),this._page=t,this.addObjectListener(re.Events.Close,()=>{this._dispatchEvent("close"),this._dispose()}),this.addObjectListener(re.Events.Crash,()=>this._dispatchEvent("crash")),this.addObjectListener(re.Events.Download,s=>{this._dispatchEvent("download",{url:s.url,suggestedFilename:s.suggestedFilename(),artifact:ct.from(e,s.artifact)})}),this.addObjectListener(re.Events.FileChooser,s=>this._dispatchEvent("fileChooser",{element:Ee.from(n,s.element()),isMultiple:s.isMultiple()})),this.addObjectListener(re.Events.FrameAttached,s=>this._onFrameAttached(s)),this.addObjectListener(re.Events.FrameDetached,s=>this._onFrameDetached(s)),this.addObjectListener(re.Events.LocatorHandlerTriggered,s=>this._dispatchEvent("locatorHandlerTriggered",{uid:s})),this.addObjectListener(re.Events.WebSocket,s=>this._dispatchEvent("webSocket",{webSocket:new tl(this,s)})),this.addObjectListener(re.Events.Worker,s=>this._dispatchEvent("worker",{worker:new tn(this,s)})),this.addObjectListener(re.Events.Video,s=>this._dispatchEvent("video",{artifact:ct.from(e,s)})),t._video&&this._dispatchEvent("video",{artifact:ct.from(this.parentScope(),t._video)});let r=t._frameManager.frames();for(let s=1;s<r.length;s++)this._onFrameAttached(r[s])}page(){return this._page}async setDefaultNavigationTimeoutNoReply(e,t){this._page.setDefaultNavigationTimeout(e.timeout)}async setDefaultTimeoutNoReply(e,t){this._page.setDefaultTimeout(e.timeout)}async exposeBinding(e,t){await this._page.exposeBinding(e.name,!!e.needsHandle,(n,...r)=>{if(this._disposed)return;let s=new Hs(this,e.name,!!e.needsHandle,n,r);return this._dispatchEvent("bindingCall",{binding:s}),s.promise()})}async setExtraHTTPHeaders(e,t){await this._page.setExtraHTTPHeaders(e.headers)}async reload(e,t){return{response:Et.fromNullable(this.parentScope(),await this._page.reload(t,e))}}async goBack(e,t){return{response:Et.fromNullable(this.parentScope(),await this._page.goBack(t,e))}}async goForward(e,t){return{response:Et.fromNullable(this.parentScope(),await this._page.goForward(t,e))}}async registerLocatorHandler(e,t){return{uid:this._page.registerLocatorHandler(e.selector,e.noWaitAfter)}}async resolveLocatorHandlerNoReply(e,t){this._page.resolveLocatorHandler(e.uid,e.remove)}async unregisterLocatorHandler(e,t){this._page.unregisterLocatorHandler(e.uid)}async emulateMedia(e,t){await this._page.emulateMedia({media:e.media,colorScheme:e.colorScheme,reducedMotion:e.reducedMotion,forcedColors:e.forcedColors})}async setViewportSize(e,t){await this._page.setViewportSize(e.viewportSize)}async addInitScript(e,t){await this._page.addInitScript(e.source)}async setNetworkInterceptionPatterns(e,t){if(!e.patterns.length){await this._page.setClientRequestInterceptor(void 0);return}let n=e.patterns.map(r=>r.regexSource?new RegExp(r.regexSource,r.regexFlags):r.glob);await this._page.setClientRequestInterceptor((r,s)=>n.some(l=>tt(this._page._browserContext._options.baseURL,s.url(),l))?(this._dispatchEvent("route",{route:ci.from(kt.from(this.parentScope(),s),r)}),!0):!1)}async expectScreenshot(e,t){let n=(e.mask||[]).map(({frame:s,selector:o})=>({frame:s._object,selector:o})),r=e.locator?{frame:e.locator.frame._object,selector:e.locator.selector}:void 0;return await this._page.expectScreenshot(t,{...e,locator:r,mask:n})}async screenshot(e,t){let n=(e.mask||[]).map(({frame:r,selector:s})=>({frame:r._object,selector:s}));return{binary:await this._page.screenshot(t,{...e,mask:n})}}async close(e,t){e.runBeforeUnload||(t.potentiallyClosesScope=!0),await this._page.close(t,e)}async updateSubscription(e){e.event==="fileChooser"&&await this._page.setFileChooserIntercepted(e.enabled),e.enabled?this._subscriptions.add(e.event):this._subscriptions.delete(e.event)}async keyboardDown(e,t){await this._page.keyboard.down(e.key)}async keyboardUp(e,t){await this._page.keyboard.up(e.key)}async keyboardInsertText(e,t){await this._page.keyboard.insertText(e.text)}async keyboardType(e,t){await this._page.keyboard.type(e.text,e)}async keyboardPress(e,t){await this._page.keyboard.press(e.key,e)}async mouseMove(e,t){await this._page.mouse.move(e.x,e.y,e,t)}async mouseDown(e,t){await this._page.mouse.down(e,t)}async mouseUp(e,t){await this._page.mouse.up(e,t)}async mouseClick(e,t){await this._page.mouse.click(e.x,e.y,e,t)}async mouseWheel(e,t){await this._page.mouse.wheel(e.deltaX,e.deltaY)}async touchscreenTap(e,t){await this._page.touchscreen.tap(e.x,e.y,t)}async accessibilitySnapshot(e,t){return{rootAXNode:await this._page.accessibility.snapshot({interestingOnly:e.interestingOnly,root:e.root?e.root._elementHandle:void 0})||void 0}}async pdf(e,t){if(!this._page.pdf)throw new Error("PDF generation is only supported for Headless Chromium");return{pdf:await this._page.pdf(e)}}async bringToFront(e,t){await this._page.bringToFront()}async startJSCoverage(e,t){await this._page.coverage.startJSCoverage(e)}async stopJSCoverage(e,t){return await this._page.coverage.stopJSCoverage()}async startCSSCoverage(e,t){await this._page.coverage.startCSSCoverage(e)}async stopCSSCoverage(e,t){return await this._page.coverage.stopCSSCoverage()}_onFrameAttached(e){this._dispatchEvent("frameAttached",{frame:lt.from(this.parentScope(),e)})}_onFrameDetached(e){this._dispatchEvent("frameDetached",{frame:lt.from(this.parentScope(),e)})}_onDispose(){this._page.isClosedOrClosingOrCrashed()||this._page.setClientRequestInterceptor(void 0).catch(()=>{})}},tn=class i extends K{_type_Worker=!0;static fromNullable(e,t){return t?pe(t)||new i(e,t):void 0}constructor(e,t){super(e,t,"Worker",{url:t.url()}),this.addObjectListener(jn.Events.Close,()=>this._dispatchEvent("close"))}async evaluateExpression(e,t){return{value:wt(await this._object.evaluateExpression(e.expression,e.isFunction,ze(e.arg)))}}async evaluateExpressionHandle(e,t){return{handle:Ee.fromJSHandle(this,await this._object.evaluateExpressionHandle(e.expression,e.isFunction,ze(e.arg)))}}},Hs=class extends K{_type_BindingCall=!0;_resolve;_reject;_promise;constructor(e,t,n,r,s){super(e,{guid:"bindingCall@"+Y()},"BindingCall",{frame:lt.from(e.parentScope(),r.frame),name:t,args:n?void 0:s.map(wt),handle:n?Ee.fromJSHandle(e,s[0]):void 0}),this._promise=new Promise((o,l)=>{this._resolve=o,this._reject=l})}promise(){return this._promise}async resolve(e,t){this._resolve(ze(e.result)),this._dispose()}async reject(e,t){this._reject(Xh(e.error)),this._dispose()}}});var wr,Zd=x(()=>{Ca();_e();wr=class extends K{_type_CDPSession=!0;constructor(e,t){super(e,t,"CDPSession",{}),this.addObjectListener(ni.Events.Event,({method:n,params:r})=>this._dispatchEvent("event",{method:n,params:r})),this.addObjectListener(ni.Events.Closed,()=>this._dispose())}async send(e){return{result:await this._object.send(e.method,e.params)}}async detach(e,t){t.potentiallyClosesScope=!0,await this._object.detach()}}});var Ds,gf=x(()=>{_e();O();Ds=class extends K{_type_WritableStream=!0;_lastModifiedMs;constructor(e,t,n){super(e,{guid:"writableStream@"+Y(),streamOrDirectory:t},"WritableStream",{}),this._lastModifiedMs=n}async write(e){if(typeof this._object.streamOrDirectory=="string")throw new Error("Cannot write to a directory");let t=this._object.streamOrDirectory;await new Promise((n,r)=>{t.write(e.binary,s=>{s?r(s):n()})})}async close(){if(typeof this._object.streamOrDirectory=="string")throw new Error("Cannot close a directory");let e=this._object.streamOrDirectory;await new Promise(t=>e.end(t)),this._lastModifiedMs&&await fs.promises.utimes(this.path(),new Date(this._lastModifiedMs),new Date(this._lastModifiedMs))}path(){return typeof this._object.streamOrDirectory=="string"?this._object.streamOrDirectory:this._object.streamOrDirectory.path}}});var nl,wf=x(()=>{_e();Os();nl=class extends K{_type_Dialog=!0;constructor(e,t){let n=He.fromNullable(e,t.page().initializedOrUndefined());super(n||e,t,"Dialog",{page:n,type:t.type(),message:t.message(),defaultValue:t.defaultValue()})}async accept(e){await this._object.accept(e.promptText)}async dismiss(){await this._object.dismiss()}}});import*as Cn from"path";var Ct,el=x(()=>{Oe();_e();Os();Kn();Ha();Zd();ba();Ns();Yd();O();gf();wf();Vt();Ls();Ga();Ct=class extends K{_type_EventTarget=!0;_type_BrowserContext=!0;_context;_subscriptions=new Set;constructor(e,t){let n=di.from(e,t.fetchRequest),r=li.from(e,t.tracing);super(e,t,"BrowserContext",{isChromium:t._browser.options.isChromium,isLocalBrowserOnServer:t._browser._isCollocatedWithServer,requestContext:n,tracing:r}),this.adopt(n),this.adopt(r),this._context=t;let s=o=>{let l=ct.from(e,o);this._dispatchEvent("video",{artifact:l})};this.addObjectListener(j.Events.VideoStarted,s);for(let o of t._browser._idToVideo.values())o.context===t&&s(o.artifact);for(let o of t.pages())this._dispatchEvent("page",{page:He.from(this,o)});if(this.addObjectListener(j.Events.Page,o=>{this._dispatchEvent("page",{page:He.from(this,o)})}),this.addObjectListener(j.Events.Close,()=>{this._dispatchEvent("close"),this._dispose()}),this.addObjectListener(j.Events.PageError,(o,l)=>{this._dispatchEvent("pageError",{error:Bn(o),page:He.from(this,l)})}),this.addObjectListener(j.Events.Console,o=>{let l=o.page();if(this._shouldDispatchEvent(l,"console")){let c=He.from(this,l);this._dispatchEvent("console",{page:c,type:o.type(),text:o.text(),args:o.args().map(h=>Ee.fromJSHandle(c,h)),location:o.location()})}}),this.addObjectListener(j.Events.Dialog,o=>{this._shouldDispatchEvent(o.page(),"dialog")?this._dispatchEvent("dialog",{dialog:new nl(this,o)}):o.close().catch(()=>{})}),t._browser.options.name==="chromium"){for(let o of t.backgroundPages())this._dispatchEvent("backgroundPage",{page:He.from(this,o)});this.addObjectListener(en.CREvents.BackgroundPage,o=>this._dispatchEvent("backgroundPage",{page:He.from(this,o)}));for(let o of t.serviceWorkers())this._dispatchEvent("serviceWorker",{worker:new tn(this,o)});this.addObjectListener(en.CREvents.ServiceWorker,o=>this._dispatchEvent("serviceWorker",{worker:new tn(this,o)}))}this.addObjectListener(j.Events.Request,o=>{if(!(o.redirectedFrom()&&pe(o.redirectedFrom()))&&!this._shouldDispatchNetworkEvent(o,"request")&&!o.isNavigationRequest())return;let c=kt.from(this,o);this._dispatchEvent("request",{request:c,page:He.fromNullable(this,o.frame()?._page.initializedOrUndefined())})}),this.addObjectListener(j.Events.Response,o=>{!pe(o.request())&&!this._shouldDispatchNetworkEvent(o.request(),"response")||this._dispatchEvent("response",{response:Et.from(this,o),page:He.fromNullable(this,o.frame()?._page.initializedOrUndefined())})}),this.addObjectListener(j.Events.RequestFailed,o=>{!pe(o)&&!this._shouldDispatchNetworkEvent(o,"requestFailed")||this._dispatchEvent("requestFailed",{request:kt.from(this,o),failureText:o._failureText||void 0,responseEndTiming:o._responseEndTiming,page:He.fromNullable(this,o.frame()?._page.initializedOrUndefined())})}),this.addObjectListener(j.Events.RequestFinished,({request:o,response:l})=>{!pe(o)&&!this._shouldDispatchNetworkEvent(o,"requestFinished")||this._dispatchEvent("requestFinished",{request:kt.from(this,o),response:Et.fromNullable(this,l),responseEndTiming:o._responseEndTiming,page:He.fromNullable(this,o.frame()?._page.initializedOrUndefined())})})}_shouldDispatchNetworkEvent(e,t){return this._shouldDispatchEvent(e.frame()?._page?.initializedOrUndefined(),t)}_shouldDispatchEvent(e,t){return!!(this._subscriptions.has(t)||(e?pe(e):void 0)?._subscriptions.has(t))}async createTempFiles(e){let t=this._context._browser.options.artifactsDir,n=Cn.join(t,"upload-"+Y()),r=e.rootDirName?Cn.join(n,Cn.basename(e.rootDirName)):n;return await fs.promises.mkdir(r,{recursive:!0}),this._context._tempDirs.push(n),{rootDir:e.rootDirName?new Ds(this,r):void 0,writableStreams:await Promise.all(e.items.map(async s=>{await fs.promises.mkdir(Cn.dirname(Cn.join(r,s.name)),{recursive:!0});let o=fs.createWriteStream(Cn.join(r,s.name));return new Ds(this,o,s.lastModifiedMs)}))}}async setDefaultNavigationTimeoutNoReply(e){this._context.setDefaultNavigationTimeout(e.timeout)}async setDefaultTimeoutNoReply(e){this._context.setDefaultTimeout(e.timeout)}async exposeBinding(e){await this._context.exposeBinding(e.name,!!e.needsHandle,(t,...n)=>{if(this._disposed)return;let r=He.from(this,t.page),s=new Hs(r,e.name,!!e.needsHandle,t,n);return this._dispatchEvent("bindingCall",{binding:s}),s.promise()})}async newPage(e,t){return{page:He.from(this,await this._context.newPage(t))}}async cookies(e){return{cookies:await this._context.cookies(e.urls)}}async addCookies(e){await this._context.addCookies(e.cookies)}async clearCookies(e){let t=e.nameRegexSource!==void 0&&e.nameRegexFlags!==void 0?new RegExp(e.nameRegexSource,e.nameRegexFlags):void 0,n=e.domainRegexSource!==void 0&&e.domainRegexFlags!==void 0?new RegExp(e.domainRegexSource,e.domainRegexFlags):void 0,r=e.pathRegexSource!==void 0&&e.pathRegexFlags!==void 0?new RegExp(e.pathRegexSource,e.pathRegexFlags):void 0;await this._context.clearCookies({name:t||e.name,domain:n||e.domain,path:r||e.path})}async grantPermissions(e){await this._context.grantPermissions(e.permissions,e.origin)}async clearPermissions(){await this._context.clearPermissions()}async setGeolocation(e){await this._context.setGeolocation(e.geolocation)}async setExtraHTTPHeaders(e){await this._context.setExtraHTTPHeaders(e.headers)}async setOffline(e){await this._context.setOffline(e.offline)}async setHTTPCredentials(e){await this._context.setHTTPCredentials(e.httpCredentials)}async addInitScript(e){await this._context.addInitScript(e.source)}async setNetworkInterceptionPatterns(e){if(!e.patterns.length){await this._context.setRequestInterceptor(void 0);return}let t=e.patterns.map(n=>n.regexSource?new RegExp(n.regexSource,n.regexFlags):n.glob);await this._context.setRequestInterceptor((n,r)=>t.some(o=>tt(this._context._options.baseURL,r.url(),o))?(this._dispatchEvent("route",{route:ci.from(kt.from(this,r),n)}),!0):!1)}async storageState(e,t){return await this._context.storageState()}async close(e,t){t.potentiallyClosesScope=!0,await this._context.close(e)}async recorderSupplementEnable(e){await Zt.show(this._context,Gn.factory(this._context),e)}async pause(e,t){}async newCDPSession(e){if(!this._object._browser.options.isChromium)throw new Error("CDP session is only available in Chromium");if(!e.page&&!e.frame||e.page&&e.frame)throw new Error("CDP session must be initiated with either Page or Frame, not none or both");let t=this._object;return{session:new wr(this,await t.newCDPSession((e.page?e.page:e.frame)._object))}}async harStart(e){return{harId:await this._context._harStart(e.page?e.page._object:null,e.options)}}async harExport(e){let t=await this._context._harExport(e.harId);if(!t)throw new Error("No HAR artifact. Ensure record.harPath is set.");return{artifact:ct.from(this,t)}}async clockFastForward(e,t){await this._context.clock.fastForward(e.ticksString??e.ticksNumber??0)}async clockInstall(e,t){await this._context.clock.install(e.timeString??e.timeNumber??void 0)}async clockPauseAt(e,t){await this._context.clock.pauseAt(e.timeString??e.timeNumber??0)}async clockResume(e,t){await this._context.clock.resume()}async clockRunFor(e,t){await this._context.clock.runFor(e.ticksString??e.ticksNumber??0)}async clockSetFixedTime(e,t){await this._context.clock.setFixedTime(e.timeString??e.timeNumber??0)}async clockSetSystemTime(e,t){await this._context.clock.setSystemTime(e.timeString??e.timeNumber??0)}async updateSubscription(e){e.enabled?this._subscriptions.add(e.event):this._subscriptions.delete(e.event)}_onDispose(){this._context.isClosingOrClosed()||this._context.setRequestInterceptor(void 0).catch(()=>{})}}});async function bf(i,e,t,n,r){let{context:s,needsReset:o}=await i.newContextForReuse(t,r);if(o){let c=pe(s);c&&c._dispose(),await s.resetForReuse(r,t)}return n&&s.setSelectors(n),{context:new Ct(e,s)}}var Bs,rl,eu=x(()=>{Es();el();Zd();_e();_e();Oe();Vd();Ns();Bs=class extends K{_type_Browser=!0;constructor(e,t){super(e,t,"Browser",{version:t.version(),name:t.options.name}),this.addObjectListener(Pt.Events.Disconnected,()=>this._didClose())}_didClose(){this._dispatchEvent("close"),this._dispose()}async newContext(e,t){let n=await this._object.newContext(t,e);return{context:new Ct(this,n)}}async newContextForReuse(e,t){return await bf(this._object,this,e,null,t)}async stopPendingOperations(e,t){await this._object.stopPendingOperations(e.reason)}async close(e,t){t.potentiallyClosesScope=!0,await this._object.close(e)}async killForTests(e,t){t.potentiallyClosesScope=!0,await this._object.killForTests()}async defaultUserAgentForTest(){return{userAgent:this._object.userAgent()}}async newBrowserCDPSession(){if(!this._object.options.isChromium)throw new Error("CDP session is only available in Chromium");let e=this._object;return{session:new wr(this,await e.newBrowserCDPSession())}}async startTracing(e){if(!this._object.options.isChromium)throw new Error("Tracing is only available in Chromium");await this._object.startTracing(e.page?e.page._object:void 0,e)}async stopTracing(){if(!this._object.options.isChromium)throw new Error("Tracing is only available in Chromium");let e=this._object;return{artifact:ct.from(this,await e.stopTracing())}}},rl=class extends K{_type_Browser=!0;_contexts=new Set;selectors;constructor(e,t){super(e,t,"Browser",{version:t.version(),name:t.options.name}),this.selectors=new si}async newContext(e,t){e.recordVideo&&(e.recordVideo.dir=this._object.options.artifactsDir);let n=await this._object.newContext(t,e);return this._contexts.add(n),n.setSelectors(this.selectors),n.on(j.Events.Close,()=>this._contexts.delete(n)),{context:new Ct(this,n)}}async newContextForReuse(e,t){return await bf(this._object,this,e,this.selectors,t)}async stopPendingOperations(e,t){await this._object.stopPendingOperations(e.reason)}async close(){}async killForTests(){}async defaultUserAgentForTest(){throw new Error("Client should not send us Browser.defaultUserAgentForTest")}async newBrowserCDPSession(){if(!this._object.options.isChromium)throw new Error("CDP session is only available in Chromium");let e=this._object;return{session:new wr(this,await e.newBrowserCDPSession())}}async startTracing(e){if(!this._object.options.isChromium)throw new Error("Tracing is only available in Chromium");await this._object.startTracing(e.page?e.page._object:void 0,e)}async stopTracing(){if(!this._object.options.isChromium)throw new Error("Tracing is only available in Chromium");let e=this._object;return{artifact:ct.from(this,await e.stopTracing())}}async cleanupContexts(){await Promise.all(Array.from(this._contexts).map(e=>e.close({reason:"Global context cleanup (connection terminated)"})))}}});var il,yf=x(()=>{eu();_e();el();il=class extends K{_type_BrowserType=!0;constructor(e,t){super(e,t,"BrowserType",{executablePath:t.executablePath(),name:t.name()})}async launch(e,t){let n=await this._object.launch(t,e);return{browser:new Bs(this,n)}}async launchPersistentContext(e,t){let n=await this._object.launchPersistentContext(t,e.userDataDir,e);return{context:new Ct(this,n)}}async connectOverCDP(e,t){let n=await this._object.connectOverCDP(t,e.endpointURL,e,e.timeout),r=new Bs(this,n);return{browser:r,defaultContext:n._defaultContext?new Ct(r,n._defaultContext):void 0}}}});var sl,_f=x(()=>{_e();O();sl=class extends K{_type_JsonPipe=!0;constructor(e){super(e,{guid:"jsonPipe@"+Y()},"JsonPipe",{})}async send(e){this.emit("message",e.message)}async close(){this.emit("close"),this._disposed||(this._dispatchEvent("closed",{}),this._dispose())}dispatch(e){this._disposed||this._dispatchEvent("message",{message:e})}wasClosed(e){this._disposed||(this._dispatchEvent("closed",{reason:e}),this._dispose())}dispose(){this._dispose()}}});import sy from"events";function vf(i,e,t,n){throw new he(`${t}: channels are not expected in SocksSupport`)}var ol,xf=x(()=>{mr();cs();ol=class{_handler;_channel;_socksSupportObjectGuid;_ids=new Set;constructor(e,t,n){this._handler=new Sn(t,n);let r=-1;this._channel=new Proxy(new sy,{get:(s,o)=>o in s||s[o]!==void 0||typeof o!="string"?s[o]:l=>{try{let c=--r;this._ids.add(c),l=ht("SocksSupport",o,"Params")(l,"",{tChannelImpl:vf,binary:"toBase64"}),e.send({id:c,guid:this._socksSupportObjectGuid,method:o,params:l,metadata:{stack:[],apiName:"",internal:!0}})}catch{}}}),this._handler.on(Sn.Events.SocksConnected,s=>this._channel.socksConnected(s)),this._handler.on(Sn.Events.SocksData,s=>this._channel.socksData(s)),this._handler.on(Sn.Events.SocksError,s=>this._channel.socksError(s)),this._handler.on(Sn.Events.SocksFailed,s=>this._channel.socksFailed(s)),this._handler.on(Sn.Events.SocksEnd,s=>this._channel.socksEnd(s)),this._channel.on("socksRequested",s=>this._handler.socketRequested(s)),this._channel.on("socksClosed",s=>this._handler.socketClosed(s)),this._channel.on("socksData",s=>this._handler.sendSocketData(s))}cleanup(){this._handler.cleanup()}interceptMessage(e){if(this._ids.has(e.id))return this._ids.delete(e.id),!0;if(e.method==="__create__"&&e.params.type==="SocksSupport")return this._socksSupportObjectGuid=e.params.guid,!1;if(this._socksSupportObjectGuid&&e.guid===this._socksSupportObjectGuid){let n=ht("SocksSupport",e.method,"Event")(e.params,"",{tChannelImpl:vf,binary:"fromBase64"});return this._channel.emit(e.method,n),!0}return!1}}});import br from"path";import oy from"os";function ly(i,e){let t=new Set(e.map(r=>r.name.toLowerCase()+":"+r.value)),n=0;for(let r of i)t.has(r.name.toLowerCase()+":"+r.value)&&++n;return n}async function cy(i,e){if(e.startsWith("ws"))return e;i?.log(`<ws preparing> retrieving websocket url from ${e}`);let t=new URL(e);t.pathname.endsWith("/")||(t.pathname+="/"),t.pathname+="json";let n=await ln({url:t.toString(),method:"GET",timeout:i?.timeUntilDeadline()??3e4,headers:{"User-Agent":qt()}},async(o,l)=>new Error(`Unexpected status ${l.statusCode} when connecting to ${t.toString()}.
This does not look like a Playwright server, try connecting via ws://.`));i?.throwIfAborted();let r=new URL(e),s=JSON.parse(n).wsEndpointPath;return s.startsWith("/")&&(s=s.substring(1)),r.pathname.endsWith("/")||(r.pathname+="/"),r.pathname+=s,r.protocol=r.protocol==="https:"?"wss:":"ws:",r.toString()}function Sf(i){let e=i.find(n=>n.name.toLowerCase()==="content-type");if(!e?.value.includes("multipart/form-data"))return;let t=e.value.match(/boundary=(\S+)/);if(t)return t[1]}var al,ay,ll,Pf=x(()=>{qe();O();_e();Cc();_f();Ba();xf();Rn();Nt();kr();ye();O();Qr();al=class extends K{_type_LocalUtils;_harBackends=new Map;_stackSessions=new Map;constructor(e,t){let n=new se(t,"localUtils","localUtils"),r=Object.entries(Xt).map(([s,o])=>({name:s,descriptor:o}));super(e,n,"LocalUtils",{deviceDescriptors:r}),this._type_LocalUtils=!0}async zip(e){let t=new U,n=new yazl.ZipFile;n.on("error",l=>t.reject(l));let r=(l,c)=>{try{fs.statSync(l).isFile()&&n.addFile(l,c)}catch{}};for(let l of e.entries)r(l.value,l.name);let s=e.stacksId?this._stackSessions.get(e.stacksId):void 0;if(s?.callStacks.length)if(await s.writer,process.env.PW_LIVE_TRACE_STACKS)n.addFile(s.file,"trace.stacks");else{let l=Buffer.from(JSON.stringify(Sc(s.callStacks)));n.addBuffer(l,"trace.stacks")}if(e.includeSources){let l=new Set;for(let{stack:c}of s?.callStacks||[])if(c)for(let{file:h}of c)l.add(h);for(let c of l)r(c,"resources/src@"+Wt(c)+".txt")}if(e.mode==="write"){await fs.promises.mkdir(br.dirname(e.zipFile),{recursive:!0}),n.end(void 0,()=>{n.outputStream.pipe(fs.createWriteStream(e.zipFile)).on("close",()=>t.resolve()).on("error",l=>t.reject(l))}),await t,await this._deleteStackSession(e.stacksId);return}let o=e.zipFile+".tmp";await fs.promises.rename(e.zipFile,o),yauzl.open(o,(l,c)=>{if(l){t.reject(l);return}E(c);let h=c.entryCount;c.on("entry",m=>{c.openReadStream(m,(f,g)=>{if(f){t.reject(f);return}n.addReadStream(g,m.fileName),--h===0&&n.end(void 0,()=>{n.outputStream.pipe(fs.createWriteStream(e.zipFile)).on("close",()=>{fs.promises.unlink(o).then(()=>{t.resolve()}).catch(b=>t.reject(b))})})})})}),await t,await this._deleteStackSession(e.stacksId)}async harOpen(e,t){let n;if(e.file.endsWith(".zip")){let r=new ss(e.file),o=(await r.entries()).find(h=>h.endsWith(".har"));if(!o)return{error:"Specified archive does not have a .har file"};let l=await r.read(o),c=JSON.parse(l.toString());n=new ll(c,null,r)}else{let r=JSON.parse(await fs.promises.readFile(e.file,"utf-8"));n=new ll(r,br.dirname(e.file),null)}return this._harBackends.set(n.id,n),{harId:n.id}}async harLookup(e,t){let n=this._harBackends.get(e.harId);return n?await n.lookup(e.url,e.method,e.headers,e.postData,e.isNavigationRequest):{action:"error",message:"Internal error: har was not opened"}}async harClose(e,t){let n=this._harBackends.get(e.harId);n&&(this._harBackends.delete(n.id),n.dispose())}async harUnzip(e,t){let n=br.dirname(e.zipFile),r=new ss(e.zipFile);for(let s of await r.entries()){let o=await r.read(s);s==="har.har"?await fs.promises.writeFile(e.harFile,o):await fs.promises.writeFile(br.join(n,s),o)}r.close(),await fs.promises.unlink(e.zipFile)}async connect(e,t){let n=new z(t,this._object);return n.setLogName("browser"),await n.run(async r=>{let s={"User-Agent":qt(),"x-playwright-proxy":e.exposeNetwork??"",...e.headers},o=await cy(r,e.wsEndpoint),l=await Vn.connect(r,o,s,!0,"x-playwright-debug-log"),c=new ol(l,e.exposeNetwork,e.socksProxyRedirectPortForTest),h=new sl(this);return l.onmessage=m=>{if(c.interceptMessage(m))return;let f=()=>{try{h.dispatch(m)}catch{l.close()}};e.slowMo?setTimeout(f,e.slowMo):f()},h.on("message",m=>{l.send(m)}),l.onclose=m=>{c?.cleanup(),h.wasClosed(m)},h.on("close",()=>l.close()),{pipe:h,headers:l.headers}},e.timeout||0)}async tracingStarted(e,t){let n;e.tracesDir||(n=await fs.promises.mkdtemp(br.join(oy.tmpdir(),"playwright-tracing-")));let r=br.join(e.tracesDir||n,e.traceName+".stacks");return this._stackSessions.set(r,{callStacks:[],file:r,writer:Promise.resolve(),tmpDir:n}),{stacksId:r}}async traceDiscarded(e,t){await this._deleteStackSession(e.stacksId)}async addStackToTracingNoReply(e,t){for(let n of this._stackSessions.values())n.callStacks.push(e.callData),process.env.PW_LIVE_TRACE_STACKS&&(n.writer=n.writer.then(()=>{let r=Buffer.from(JSON.stringify(Sc(n.callStacks)));return fs.promises.writeFile(n.file,r)}))}async _deleteStackSession(e){let t=e?this._stackSessions.get(e):void 0;t&&(await t.writer,t.tmpDir&&await In([t.tmpDir]),this._stackSessions.delete(e))}},ay=[301,302,303,307,308],ll=class{id=Y();_harFile;_zipFile;_baseDir;constructor(e,t,n){this._harFile=e,this._baseDir=t,this._zipFile=n}async lookup(e,t,n,r,s){let o;try{o=await this._harFindResponse(e,t,n,r)}catch(c){return{action:"error",message:"HAR error: "+c.message}}if(!o)return{action:"noentry"};if(o.request.url!==e&&s)return{action:"redirect",redirectURL:o.request.url};let l=o.response;try{let c=await this._loadContent(l.content);return{action:"fulfill",status:l.status,headers:l.headers,body:c}}catch(c){return{action:"error",message:c.message}}}async _loadContent(e){let t=e._file,n;return t?this._zipFile?n=await this._zipFile.read(t):n=await fs.promises.readFile(br.resolve(this._baseDir,t)):n=Buffer.from(e.text||"",e.encoding==="base64"?"base64":"utf-8"),n}async _harFindResponse(e,t,n,r){let s=this._harFile.log,o=new Set;for(;;){let l=[];for(let m of s.entries)if(!(m.request.url!==e||m.request.method!==t)){if(t==="POST"&&r&&m.request.postData){let f=await this._loadContent(m.request.postData);if(!f.equals(r)){let g=Sf(n);if(!g)continue;let b=Sf(m.request.headers);if(!b||r.toString().replaceAll(g,"")!==f.toString().replaceAll(b,""))continue}}l.push(m)}if(!l.length)return;let c=l[0];if(l.length>1){let m=[];for(let f of l){let g=ly(f.request.headers,n);m.push({candidate:f,matchingHeaders:g})}m.sort((f,g)=>g.matchingHeaders-f.matchingHeaders),c=m[0].candidate}if(o.has(c))throw new Error(`Found redirect cycle for ${e}`);o.add(c);let h=c.response.headers.find(m=>m.name.toLowerCase()==="location");if(ay.includes(c.response.status)&&h){e=new URL(h.value,e).toString(),((c.response.status===301||c.response.status===302)&&t==="POST"||c.response.status===303&&!["GET","HEAD"].includes(t))&&(t="GET");continue}return c}}dispose(){this._zipFile?.close()}}});var cl,Cf=x(()=>{_e();cl=class extends K{_type_Selectors=!0;constructor(e,t){super(e,t,"Selectors",{})}async register(e){await this._object.register(e.name,e.source,e.contentScript)}async setTestIdAttributeName(e){this._object.setTestIdAttributeName(e.testIdAttributeName)}}});var nn,tu,kf=x(()=>{hs();mr();yf();_e();Pf();Kn();Cf();eu();O();It();nn=class extends K{_type_Playwright;_browserDispatcher;constructor(e,t,n,r,s){let o=r?new rl(e,r):void 0;super(e,t,"Playwright",{chromium:new il(e,t.chromium),utils:t.options.isServer?void 0:new al(e,t),selectors:new cl(e,o?.selectors||t.selectors),preLaunchedBrowser:o,socksSupport:n?new tu(e,n):void 0}),this._type_Playwright=!0,this._browserDispatcher=o}async newRequest(e){let t=new Qa(this._object,e);return{request:di.from(this.parentScope(),t)}}async cleanup(){await this._browserDispatcher?.cleanupContexts()}},tu=class extends K{_type_SocksSupport;_socksProxy;_socksListeners;constructor(e,t){super(e,{guid:"socksSupport@"+Y()},"SocksSupport",{}),this._type_SocksSupport=!0,this._socksProxy=t,this._socksListeners=[L.addEventListener(t,at.Events.SocksRequested,n=>this._dispatchEvent("socksRequested",n)),L.addEventListener(t,at.Events.SocksData,n=>this._dispatchEvent("socksData",n)),L.addEventListener(t,at.Events.SocksClosed,n=>this._dispatchEvent("socksClosed",n))]}async socksConnected(e){this._socksProxy?.socketConnected(e)}async socksFailed(e){this._socksProxy?.socketFailed(e)}async socksData(e){this._socksProxy?.sendSocketData(e)}async socksError(e){this._socksProxy?.sendSocketError(e)}async socksEnd(e){this._socksProxy?.sendSocketEnd(e)}_onDispose(){L.removeEventListeners(this._socksListeners)}}});var Ef=x(()=>{rc();O();ks();ye();oi();Nt();ks()});var nu=x(()=>{fn();_e();kf();oi();Ef();ye();mr()});function bt(i){return i instanceof Ge}function Tf(i){return ho(i)?{error:{message:i.message,stack:i.stack,name:i.name}}:{value:Dn(i,e=>({fallThrough:e}))}}function dl(i){if(!i.error){if(i.value===void 0)throw new Error("Serialized error must have either an error or a value");return Hn(i.value,void 0)}if(i.error.name==="TimeoutError"){let t=new yr(i.error.message);return t.stack=i.error.stack||"",t}if(i.error.name==="TargetClosedError"){let t=new Ge(i.error.message);return t.stack=i.error.stack||"",t}let e=new Error(i.error.message);return e.stack=i.error.stack||"",e.name=i.error.name,e}var yr,Ge,Tt=x(()=>{O();ds();yr=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Ge=class extends Error{constructor(e){super(e||"Target page, context or browser has been closed")}}});function Rf(i){let e={...i,value:i.valueNumber!==void 0?i.valueNumber:i.valueString,checked:i.checked==="checked"?!0:i.checked==="unchecked"?!1:i.checked,pressed:i.pressed==="pressed"?!0:i.pressed==="released"?!1:i.pressed,children:i.children?i.children.map(Rf):void 0};return delete e.valueNumber,delete e.valueString,e}var ul,Af=x(()=>{ul=class{_channel;constructor(e){this._channel=e}async snapshot(e={}){let t=e.root?e.root._elementChannel:void 0,n=await this._channel.accessibilitySnapshot({interestingOnly:e.interestingOnly,root:t});return n.rootAXNode?Rf(n.rootAXNode):null}}});import{EventEmitter as dy}from"events";function hl(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}function Ff(i){return ml(i)??i}function uy(i){return i.map(e=>ml(e)??e)}function ml(i){return i.listener}var $s,pl,If=x(()=>{O();$s=class{_events=void 0;_eventsCount=0;_maxListeners=void 0;_pendingHandlers=new Map;_rejectionHandler;constructor(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0,this.on=this.addListener,this.off=this.removeListener}setMaxListeners(e){if(typeof e!="number"||e<0||Number.isNaN(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this}getMaxListeners(){return this._maxListeners===void 0?dy.defaultMaxListeners:this._maxListeners}emit(e,...t){let n=this._events;if(n===void 0)return!1;let r=n?.[e];if(r===void 0)return!1;if(typeof r=="function")this._callHandler(e,r,t);else{let s=r.length,o=r.slice();for(let l=0;l<s;++l)this._callHandler(e,o[l],t)}return!0}_callHandler(e,t,n){let r=Reflect.apply(t,this,n);if(!(r instanceof Promise))return;let s=this._pendingHandlers.get(e);s||(s=new Set,this._pendingHandlers.set(e,s)),s.add(r),r.catch(o=>{if(this._rejectionHandler)this._rejectionHandler(o);else throw o}).finally(()=>s.delete(r))}addListener(e,t){return this._addListener(e,t,!1)}on(e,t){return this._addListener(e,t,!1)}_addListener(e,t,n){hl(t);let r=this._events,s;if(r===void 0?(r=this._events=Object.create(null),this._eventsCount=0):(r.newListener!==void 0&&(this.emit("newListener",e,Ff(t)),r=this._events),s=r[e]),s===void 0)s=r[e]=t,++this._eventsCount;else{typeof s=="function"?s=r[e]=n?[t,s]:[s,t]:n?s.unshift(t):s.push(t);let o=this.getMaxListeners();if(o>0&&s.length>o&&!s.warned){s.warned=!0;let l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=this,l.type=e,l.count=s.length,ce()||console.warn(l)}}return this}prependListener(e,t){return this._addListener(e,t,!0)}once(e,t){return hl(t),this.on(e,new pl(this,e,t).wrapperFunction),this}prependOnceListener(e,t){return hl(t),this.prependListener(e,new pl(this,e,t).wrapperFunction),this}removeListener(e,t){hl(t);let n=this._events;if(n===void 0)return this;let r=n[e];if(r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener??t));else if(typeof r!="function"){let s=-1,o;for(let l=r.length-1;l>=0;l--)if(r[l]===t||ml(r[l])===t){o=ml(r[l]),s=l;break}if(s<0)return this;s===0?r.shift():r.splice(s,1),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,o||t)}return this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e,t){if(this._removeAllListeners(e),!t)return this;if(t.behavior==="wait"){let n=[];return this._rejectionHandler=r=>n.push(r),this._waitFor(e).then(()=>{if(n.length)throw n[0]})}return t.behavior==="ignoreErrors"&&(this._rejectionHandler=()=>{}),Promise.resolve()}_removeAllListeners(e){let t=this._events;if(!t)return;if(!t.removeListener){e===void 0?(this._events=Object.create(null),this._eventsCount=0):t[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[e]);return}if(e===void 0){let r=Object.keys(t),s;for(let o=0;o<r.length;++o)s=r[o],s!=="removeListener"&&this._removeAllListeners(s);this._removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0;return}let n=t[e];if(typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(let r=n.length-1;r>=0;r--)this.removeListener(e,n[r])}listeners(e){return this._listeners(this,e,!0)}rawListeners(e){return this._listeners(this,e,!1)}listenerCount(e){let t=this._events;if(t!==void 0){let n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}eventNames(){return this._eventsCount>0&&this._events?Reflect.ownKeys(this._events):[]}async _waitFor(e){let t=[];if(e)t=[...this._pendingHandlers.get(e)||[]];else{t=[];for(let[,n]of this._pendingHandlers)t.push(...n)}await Promise.all(t)}_listeners(e,t,n){let r=e._events;if(r===void 0)return[];let s=r[t];return s===void 0?[]:typeof s=="function"?n?[Ff(s)]:[s]:n?uy(s):s.slice()}};pl=class{_fired=!1;wrapperFunction;_listener;_eventEmitter;_eventType;constructor(e,t,n){this._eventEmitter=e,this._eventType=t,this._listener=n,this.wrapperFunction=this._handle.bind(this),this.wrapperFunction.listener=n}_handle(...e){if(!this._fired)return this._fired=!0,this._eventEmitter.removeListener(this._eventType,this.wrapperFunction),this._listener.apply(this._eventEmitter,e)}}});function ru(i,e,t){t||(i&&i.isEnabled("api","info")&&i.log("api","info",e,[],{color:"cyan"}),N.log("api",e))}function hy(i,e,t,n){if(e._object instanceof G&&(i==="*"||i.includes(e._object._type)))return{guid:e._object._guid};throw new he(`${t}: expected channel ${i.toString()}`)}var G,xe=x(()=>{If();cs();Te();Lt();O();Rc();G=class i extends $s{_connection;_parent;_objects=new Map;_type;_guid;_channel;_initializer;_logger;_instrumentation;_eventToSubscriptionMapping=new Map;_wasCollected=!1;constructor(e,t,n,r){super(),this.setMaxListeners(0),this._connection=e instanceof i?e._connection:e,this._type=t,this._guid=n,this._parent=e instanceof i?e:void 0,this._instrumentation=this._connection._instrumentation,this._connection._objects.set(n,this),this._parent&&(this._parent._objects.set(n,this),this._logger=this._parent._logger),this._channel=this._createChannel(new $s),this._initializer=r}_setEventToSubscriptionMapping(e){this._eventToSubscriptionMapping=e}_updateSubscription(e,t){let n=this._eventToSubscriptionMapping.get(String(e));n&&this._wrapApiCall(async()=>{await this._channel.updateSubscription({event:n,enabled:t})},!0).catch(()=>{})}on(e,t){return this.listenerCount(e)||this._updateSubscription(e,!0),super.on(e,t),this}addListener(e,t){return this.listenerCount(e)||this._updateSubscription(e,!0),super.addListener(e,t),this}prependListener(e,t){return this.listenerCount(e)||this._updateSubscription(e,!0),super.prependListener(e,t),this}off(e,t){return super.off(e,t),this.listenerCount(e)||this._updateSubscription(e,!1),this}removeListener(e,t){return super.removeListener(e,t),this.listenerCount(e)||this._updateSubscription(e,!1),this}_adopt(e){e._parent._objects.delete(e._guid),this._objects.set(e._guid,e),e._parent=this}_dispose(e){this._parent&&this._parent._objects.delete(this._guid),this._connection._objects.delete(this._guid),this._wasCollected=e==="gc";for(let t of[...this._objects.values()])t._dispose(e);this._objects.clear()}_debugScopeState(){return{_guid:this._guid,objects:Array.from(this._objects.values()).map(e=>e._debugScopeState())}}_createChannel(e){let t=new Proxy(e,{get:(n,r)=>{if(typeof r=="string"){let s=No(this._type,r,"Params");if(s)return async o=>await this._wrapApiCall(async l=>{let{apiName:c,frames:h,csi:m,callCookie:f,stepId:g}=l.reported?{apiName:void 0,csi:void 0,callCookie:void 0,frames:[],stepId:void 0}:l;l.reported=!0;let b=g;if(m&&c){let v={};m.onApiCallBegin(c,o,h,f,v),b=v.stepId}return await this._connection.sendMessageToServer(this,r,s(o,"",{tChannelImpl:hy,binary:this._connection.rawBuffers()?"buffer":"toBase64"}),c,h,b)})}return n[r]}});return t._object=this,t}async _wrapApiCall(e,t=!1){let n=this._logger,r=$r.zoneData("apiZone");if(r)return await e(r);let s=sh(),o=s.apiName,l=s.frames;t=t||this._type==="LocalUtils",t&&(o=void 0);let c=$r.zoneData("expectZone"),h=c?.stepId;!t&&c&&(o=c.title);let m=t||c?void 0:this._instrumentation,f={};try{ru(n,`=> ${o} started`,t);let g={apiName:o,frames:l,isInternal:t,reported:!1,csi:m,callCookie:f,stepId:h},b=await $r.run("apiZone",g,async()=>await e(g));return m?.onApiCallEnd(f),ru(n,`<= ${o} succeeded`,t),b}catch(g){let b=(process.env.PWDEBUGIMPL||ce())&&g.stack?`
<inner error>
`+g.stack:"";o&&!o.includes("<anonymous>")&&(g.message=o+": "+g.message);let v=`
`+oh(s.frames).join(`
`)+b;throw v.trim()?g.stack=g.message+v:g.stack="",m?.onApiCallEnd(f,g),ru(n,`<= ${o} failed`,t),g}}_toImpl(){return this._connection.toImpl?.(this)}toJSON(){return{_type:this._type,_guid:this._guid}}}});import{Readable as py}from"stream";var _r,iu,su=x(()=>{xe();_r=class extends G{static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r)}stream(){return new iu(this._channel)}},iu=class extends py{_channel;constructor(e){super(),this._channel=e}async _read(){let e=await this._channel.read({size:1048576});e.binary.byteLength?this.push(e.binary):this.push(null)}_destroy(e,t){this._channel.close().catch(n=>null),super._destroy(e,t)}}});var yt,ui=x(()=>{su();_t();xe();yt=class extends G{static from(e){return e._object}async pathAfterFinished(){if(this._connection.isRemote())throw new Error("Path is not available when connecting remotely. Use saveAs() to save a local copy.");return(await this._channel.pathAfterFinished()).value}async saveAs(e){if(!this._connection.isRemote()){await this._channel.saveAs({path:e});return}let t=await this._channel.saveAsStream(),n=_r.from(t.stream);await We(e),await new Promise((r,s)=>{n.stream().pipe(fs.createWriteStream(e)).on("finish",r).on("error",s)})}async failure(){return(await this._channel.failure()).error||null}async createReadStream(){let e=await this._channel.stream();return _r.from(e.stream).stream()}async readIntoBuffer(){let e=await this.createReadStream();return await new Promise((t,n)=>{let r=[];e.on("data",s=>{r.push(s)}),e.on("end",()=>{t(Buffer.concat(r))}),e.on("error",n)})}async cancel(){return await this._channel.cancel()}async delete(){return await this._channel.delete()}}});function vr(i){let e=[];for(let t in i)Object.is(i[t],void 0)||e.push({name:t,value:String(i[t])});return e}async function hi(i,e,t=!0){if(typeof i=="function"){let n=i.toString(),r=Object.is(e,void 0)?"undefined":JSON.stringify(e);return`(${n})(${r})`}if(e!==void 0)throw new Error("Cannot evaluate a string with arguments");if(ae(i))return i;if(i.content!==void 0)return i.content;if(i.path!==void 0){let n=await fs.promises.readFile(i.path,"utf8");return t&&(n=ou(n,i.path)),n}throw new Error("Either path or content property must be present")}function ou(i,e){return`${i}
//# sourceURL=${e.replace(/\n/g,"")}`}var Jn=x(()=>{O()});var fl,Lf=x(()=>{fl=class{_channel;constructor(e){this._channel=e}async startJSCoverage(e={}){await this._channel.startJSCoverage(e)}async stopJSCoverage(){return(await this._channel.stopJSCoverage()).entries}async startCSSCoverage(e={}){await this._channel.startCSSCoverage(e)}async stopCSSCoverage(){return(await this._channel.stopCSSCoverage()).entries}}});var gl,Of=x(()=>{gl=class{_page;_url;_suggestedFilename;_artifact;constructor(e,t,n,r){this._page=e,this._url=t,this._suggestedFilename=n,this._artifact=r}page(){return this._page}url(){return this._url}suggestedFilename(){return this._suggestedFilename}async path(){return await this._artifact.pathAfterFinished()}async saveAs(e){return await this._artifact.saveAs(e)}async failure(){return await this._artifact.failure()}async createReadStream(){return await this._artifact.createReadStream()}async cancel(){return await this._artifact.cancel()}async delete(){return await this._artifact.delete()}}});function we(i){let e=[],t=r=>(e.push(r),e.length-1);return{value:Dn(i,r=>r instanceof De?{h:t(r._channel)}:{fallThrough:r}),handles:e}}function Ue(i){return Hn(i,void 0)}function dt(i,e){if(i>e)throw new Error("Too many arguments. If you need to pass more than 1 argument to the function wrap them in an object.")}var De,kn=x(()=>{xe();ds();Tt();De=class i extends G{_preview;static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r),this._preview=this._initializer.preview,this._channel.on("previewUpdated",({preview:s})=>this._preview=s)}async evaluate(e,t){let n=await this._channel.evaluateExpression({expression:String(e),isFunction:typeof e=="function",arg:we(t)});return Ue(n.value)}async evaluateHandle(e,t){let n=await this._channel.evaluateExpressionHandle({expression:String(e),isFunction:typeof e=="function",arg:we(t)});return i.from(n.handle)}async getProperty(e){let t=await this._channel.getProperty({name:e});return i.from(t.handle)}async getProperties(){let e=new Map;for(let{name:t,value:n}of(await this._channel.getPropertyList()).properties)e.set(t,i.from(n));return e}async jsonValue(){return Ue((await this._channel.jsonValue()).value)}asElement(){return null}async[Symbol.asyncDispose](){await this.dispose()}async dispose(){try{await this._channel.dispose()}catch(e){if(bt(e))return;throw e}}async _objectCount(){return await this._wrapApiCall(async()=>{let{count:e}=await this._channel.objectCount();return e})}toString(){return this._preview}}});function au(i,e,t){return`internal:attr=[${i}=${An(e,t?.exact||!1)}]`}function js(i,e){return`internal:testid=[${i}=${An(e,!0)}]`}function qs(i,e){return"internal:label="+un(i,!!e?.exact)}function Ws(i,e){return au("alt",i,e)}function zs(i,e){return au("title",i,e)}function Us(i,e){return au("placeholder",i,e)}function Vs(i,e){return"internal:text="+un(i,!!e?.exact)}function Gs(i,e={}){let t=[];return e.checked!==void 0&&t.push(["checked",String(e.checked)]),e.disabled!==void 0&&t.push(["disabled",String(e.disabled)]),e.selected!==void 0&&t.push(["selected",String(e.selected)]),e.expanded!==void 0&&t.push(["expanded",String(e.expanded)]),e.includeHidden!==void 0&&t.push(["include-hidden",String(e.includeHidden)]),e.level!==void 0&&t.push(["level",String(e.level)]),e.name!==void 0&&t.push(["name",An(e.name,!!e.exact)]),e.pressed!==void 0&&t.push(["pressed",String(e.pressed)]),`internal:role=${i}${t.map(([n,r])=>`[${n}=${r}]`).join("")}`}var lu=x(()=>{Fn()});import*as Mf from"util";function mi(){return Nf}function Hf(i){Nf=i}var xr,pi,Nf,cu=x(()=>{O();Ks();kn();Fn();lu();xr=class i{_frame;_selector;constructor(e,t,n){if(this._frame=e,this._selector=t,n?.hasText&&(this._selector+=` >> internal:has-text=${un(n.hasText,!1)}`),n?.hasNotText&&(this._selector+=` >> internal:has-not-text=${un(n.hasNotText,!1)}`),n?.has){let r=n.has;if(r._frame!==e)throw new Error('Inner "has" locator must belong to the same frame.');this._selector+=" >> internal:has="+JSON.stringify(r._selector)}if(n?.hasNot){let r=n.hasNot;if(r._frame!==e)throw new Error('Inner "hasNot" locator must belong to the same frame.');this._selector+=" >> internal:has-not="+JSON.stringify(r._selector)}}async _withElement(e,t){t=this._frame.page()._timeoutSettings.timeout({timeout:t});let n=t?X()+t:0;return await this._frame._wrapApiCall(async()=>{let r=await this._frame._channel.waitForSelector({selector:this._selector,strict:!0,state:"attached",timeout:t}),s=Ye.fromNullable(r.element);if(!s)throw new Error(`Could not resolve ${this._selector} to DOM Element`);try{return await e(s,n?n-X():0)}finally{await s.dispose()}})}_equals(e){return this._frame===e._frame&&this._selector===e._selector}page(){return this._frame.page()}async boundingBox(e){return await this._withElement(t=>t.boundingBox(),e?.timeout)}async check(e={}){return await this._frame.check(this._selector,{strict:!0,...e})}async click(e={}){return await this._frame.click(this._selector,{strict:!0,...e})}async dblclick(e={}){return await this._frame.dblclick(this._selector,{strict:!0,...e})}async dispatchEvent(e,t={},n){return await this._frame.dispatchEvent(this._selector,e,t,{strict:!0,...n})}async dragTo(e,t={}){return await this._frame.dragAndDrop(this._selector,e._selector,{strict:!0,...t})}async evaluate(e,t,n){return await this._withElement(r=>r.evaluate(e,t),n?.timeout)}async evaluateAll(e,t){return await this._frame.$$eval(this._selector,e,t)}async evaluateHandle(e,t,n){return await this._withElement(r=>r.evaluateHandle(e,t),n?.timeout)}async fill(e,t={}){return await this._frame.fill(this._selector,e,{strict:!0,...t})}async clear(e={}){return await this.fill("",e)}async _highlight(){return await this._frame._highlight(this._selector)}async highlight(){return await this._frame._highlight(this._selector)}locator(e,t){if(ae(e))return new i(this._frame,this._selector+" >> "+e,t);if(e._frame!==this._frame)throw new Error("Locators must belong to the same frame.");return new i(this._frame,this._selector+" >> internal:chain="+JSON.stringify(e._selector),t)}getByTestId(e){return this.locator(js(mi(),e))}getByAltText(e,t){return this.locator(Ws(e,t))}getByLabel(e,t){return this.locator(qs(e,t))}getByPlaceholder(e,t){return this.locator(Us(e,t))}getByText(e,t){return this.locator(Vs(e,t))}getByTitle(e,t){return this.locator(zs(e,t))}getByRole(e,t={}){return this.locator(Gs(e,t))}frameLocator(e){return new pi(this._frame,this._selector+" >> "+e)}filter(e){return new i(this._frame,this._selector,e)}async elementHandle(e){return await this._frame.waitForSelector(this._selector,{strict:!0,state:"attached",...e})}async elementHandles(){return await this._frame.$$(this._selector)}contentFrame(){return new pi(this._frame,this._selector)}first(){return new i(this._frame,this._selector+" >> nth=0")}last(){return new i(this._frame,this._selector+" >> nth=-1")}nth(e){return new i(this._frame,this._selector+` >> nth=${e}`)}and(e){if(e._frame!==this._frame)throw new Error("Locators must belong to the same frame.");return new i(this._frame,this._selector+" >> internal:and="+JSON.stringify(e._selector))}or(e){if(e._frame!==this._frame)throw new Error("Locators must belong to the same frame.");return new i(this._frame,this._selector+" >> internal:or="+JSON.stringify(e._selector))}async focus(e){return await this._frame.focus(this._selector,{strict:!0,...e})}async blur(e){await this._frame._channel.blur({selector:this._selector,strict:!0,...e})}async count(){return await this._frame._queryCount(this._selector)}async getAttribute(e,t){return await this._frame.getAttribute(this._selector,e,{strict:!0,...t})}async hover(e={}){return await this._frame.hover(this._selector,{strict:!0,...e})}async innerHTML(e){return await this._frame.innerHTML(this._selector,{strict:!0,...e})}async innerText(e){return await this._frame.innerText(this._selector,{strict:!0,...e})}async inputValue(e){return await this._frame.inputValue(this._selector,{strict:!0,...e})}async isChecked(e){return await this._frame.isChecked(this._selector,{strict:!0,...e})}async isDisabled(e){return await this._frame.isDisabled(this._selector,{strict:!0,...e})}async isEditable(e){return await this._frame.isEditable(this._selector,{strict:!0,...e})}async isEnabled(e){return await this._frame.isEnabled(this._selector,{strict:!0,...e})}async isHidden(e){return await this._frame.isHidden(this._selector,{strict:!0,...e})}async isVisible(e){return await this._frame.isVisible(this._selector,{strict:!0,...e})}async press(e,t={}){return await this._frame.press(this._selector,e,{strict:!0,...t})}async screenshot(e={}){return await this._withElement((t,n)=>t.screenshot({...e,timeout:n}),e.timeout)}async scrollIntoViewIfNeeded(e={}){return await this._withElement((t,n)=>t.scrollIntoViewIfNeeded({...e,timeout:n}),e.timeout)}async selectOption(e,t={}){return await this._frame.selectOption(this._selector,e,{strict:!0,...t})}async selectText(e={}){return await this._withElement((t,n)=>t.selectText({...e,timeout:n}),e.timeout)}async setChecked(e,t){e?await this.check(t):await this.uncheck(t)}async setInputFiles(e,t={}){return await this._frame.setInputFiles(this._selector,e,{strict:!0,...t})}async tap(e={}){return await this._frame.tap(this._selector,{strict:!0,...e})}async textContent(e){return await this._frame.textContent(this._selector,{strict:!0,...e})}async type(e,t={}){return await this._frame.type(this._selector,e,{strict:!0,...t})}async pressSequentially(e,t={}){return await this.type(e,t)}async uncheck(e={}){return await this._frame.uncheck(this._selector,{strict:!0,...e})}async all(){return new Array(await this.count()).fill(0).map((e,t)=>this.nth(t))}async allInnerTexts(){return await this._frame.$$eval(this._selector,e=>e.map(t=>t.innerText))}async allTextContents(){return await this._frame.$$eval(this._selector,e=>e.map(t=>t.textContent||""))}async waitFor(e){await this._frame._channel.waitForSelector({selector:this._selector,strict:!0,omitReturnValue:!0,...e})}async _expect(e,t){let n={selector:this._selector,expression:e,...t,isNot:!!t.isNot};n.expectedValue=we(t.expectedValue);let r=await this._frame._channel.expect(n);return r.received!==void 0&&(r.received=Ue(r.received)),r}[Mf.inspect.custom](){return this.toString()}toString(){return ke("javascript",this._selector)}},pi=class i{_frame;_frameSelector;constructor(e,t){this._frame=e,this._frameSelector=t}locator(e,t){if(ae(e))return new xr(this._frame,this._frameSelector+" >> internal:control=enter-frame >> "+e,t);if(e._frame!==this._frame)throw new Error("Locators must belong to the same frame.");return new xr(this._frame,this._frameSelector+" >> internal:control=enter-frame >> "+e._selector,t)}getByTestId(e){return this.locator(js(mi(),e))}getByAltText(e,t){return this.locator(Ws(e,t))}getByLabel(e,t){return this.locator(qs(e,t))}getByPlaceholder(e,t){return this.locator(Us(e,t))}getByText(e,t){return this.locator(Vs(e,t))}getByTitle(e,t){return this.locator(zs(e,t))}getByRole(e,t={}){return this.locator(Gs(e,t))}owner(){return new xr(this._frame,this._frameSelector)}frameLocator(e){return new i(this._frame,this._frameSelector+" >> internal:control=enter-frame >> "+e)}first(){return new i(this._frame,this._frameSelector+" >> nth=0")}last(){return new i(this._frame,this._frameSelector+" >> nth=-1")}nth(e){return new i(this._frame,this._frameSelector+` >> nth=${e}`)}},Nf="data-testid"});var B,En=x(()=>{B={AndroidDevice:{WebView:"webview",Close:"close"},AndroidSocket:{Data:"data",Close:"close"},AndroidWebView:{Close:"close"},Browser:{Disconnected:"disconnected"},BrowserContext:{Console:"console",Close:"close",Dialog:"dialog",Page:"page",WebError:"weberror",BackgroundPage:"backgroundpage",ServiceWorker:"serviceworker",Request:"request",Response:"response",RequestFailed:"requestfailed",RequestFinished:"requestfinished"},BrowserServer:{Close:"close"},Page:{Close:"close",Crash:"crash",Console:"console",Dialog:"dialog",Download:"download",FileChooser:"filechooser",DOMContentLoaded:"domcontentloaded",PageError:"pageerror",Request:"request",Response:"response",RequestFailed:"requestfailed",RequestFinished:"requestfinished",FrameAttached:"frameattached",FrameDetached:"framedetached",FrameNavigated:"framenavigated",Load:"load",Popup:"popup",WebSocket:"websocket",Worker:"worker"},WebSocket:{Close:"close",Error:"socketerror",FrameReceived:"framereceived",FrameSent:"framesent"},Worker:{Close:"close"},ElectronApplication:{Close:"close",Console:"console",Window:"window"}}});var rn,Js=x(()=>{En();xe();kn();O();Tt();rn=class extends G{_page;_context;_closedScope=new Re;static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r),this._channel.on("close",()=>{this._page&&this._page._workers.delete(this),this._context&&this._context._serviceWorkers.delete(this),this.emit(B.Worker.Close,this)}),this.once(B.Worker.Close,()=>this._closedScope.close(this._page?._closeErrorWithReason()||new Ge))}url(){return this._initializer.url}async evaluate(e,t){dt(arguments.length,2);let n=await this._channel.evaluateExpression({expression:String(e),isFunction:typeof e=="function",arg:we(t)});return Ue(n.value)}async evaluateHandle(e,t){dt(arguments.length,2);let n=await this._channel.evaluateExpressionHandle({expression:String(e),isFunction:typeof e=="function",arg:we(t)});return De.from(n.handle)}}});function Df(i,e,t){let n;return{promise:new Promise((o,l)=>{n=async c=>{try{if(t&&!await t(c))return;i.removeListener(e,n),o(c)}catch(h){i.removeListener(e,n),l(h)}},i.addListener(e,n)}),dispose:()=>i.removeListener(e,n)}}function my(i){let e;return{promise:new Promise(r=>e=setTimeout(r,i)),dispose:()=>clearTimeout(e)}}function fy(i){if(!i.length)return"";let e=" logs ",t=60,n=(t-e.length)/2,r=t-e.length-n;return`
${"=".repeat(n)}${e}${"=".repeat(r)}
${i.join(`
`)}
${"=".repeat(t)}`}var Rt,fi=x(()=>{Lt();Tt();O();Rt=class i{_dispose;_failures=[];_immediateError;_logs=[];_channelOwner;_waitId;_error;constructor(e,t){this._waitId=Y(),this._channelOwner=e,this._channelOwner._channel.waitForEventInfo({info:{waitId:this._waitId,phase:"before",event:t}}).catch(()=>{}),this._dispose=[()=>this._channelOwner._wrapApiCall(async()=>{await this._channelOwner._channel.waitForEventInfo({info:{waitId:this._waitId,phase:"after",error:this._error}})},!0).catch(()=>{})]}static createForEvent(e,t){return new i(e,t)}async waitForEvent(e,t,n){let{promise:r,dispose:s}=Df(e,t,n);return await this.waitForPromise(r,s)}rejectOnEvent(e,t,n,r){let{promise:s,dispose:o}=Df(e,t,r);this._rejectOn(s.then(()=>{throw typeof n=="function"?n():n}),o)}rejectOnTimeout(e,t){if(!e)return;let{promise:n,dispose:r}=my(e);this._rejectOn(n.then(()=>{throw new yr(t)}),r)}rejectImmediately(e){this._immediateError=e}dispose(){for(let e of this._dispose)e()}async waitForPromise(e,t){try{if(this._immediateError)throw this._immediateError;let n=await Promise.race([e,...this._failures]);return t&&t(),n}catch(n){throw t&&t(),this._error=n.message,this.dispose(),ve(n,n.message+fy(this._logs)),n}}log(e){this._logs.push(e),this._channelOwner._wrapApiCall(async()=>{await this._channelOwner._channel.waitForEventInfo({info:{waitId:this._waitId,phase:"log",message:e}}).catch(()=>{})},!0)}_rejectOn(e,t){this._failures.push(e),t&&this._dispose.push(t)}}});var Xn,wl=x(()=>{ui();xe();Xn=class extends G{_includeSources=!1;_tracesDir;_stacksId;_isTracing=!1;static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r)}async start(e={}){this._includeSources=!!e.sources;let t=await this._wrapApiCall(async()=>(await this._channel.tracingStart({name:e.name,snapshots:e.snapshots,screenshots:e.screenshots,live:e._live}),(await this._channel.tracingStartChunk({name:e.name,title:e.title})).traceName),!0);await this._startCollectingStacks(t)}async startChunk(e={}){let{traceName:t}=await this._channel.tracingStartChunk(e);await this._startCollectingStacks(t)}async _startCollectingStacks(e){this._isTracing||(this._isTracing=!0,this._connection.setIsTracing(!0));let t=await this._connection.localUtils()._channel.tracingStarted({tracesDir:this._tracesDir,traceName:e});this._stacksId=t.stacksId}async stopChunk(e={}){await this._wrapApiCall(async()=>{await this._doStopChunk(e.path)},!0)}async stop(e={}){await this._wrapApiCall(async()=>{await this._doStopChunk(e.path),await this._channel.tracingStop()},!0)}async _doStopChunk(e){if(this._resetStackCounter(),!e){await this._channel.tracingStopChunk({mode:"discard"}),this._stacksId&&await this._connection.localUtils()._channel.traceDiscarded({stacksId:this._stacksId});return}if(!this._connection.isRemote()){let s=await this._channel.tracingStopChunk({mode:"entries"});await this._connection.localUtils()._channel.zip({zipFile:e,entries:s.entries,mode:"write",stacksId:this._stacksId,includeSources:this._includeSources});return}let n=await this._channel.tracingStopChunk({mode:"archive"});if(!n.artifact){this._stacksId&&await this._connection.localUtils()._channel.traceDiscarded({stacksId:this._stacksId});return}let r=yt.from(n.artifact);await r.saveAs(e),await r.delete(),await this._connection.localUtils()._channel.zip({zipFile:e,entries:[],mode:"append",stacksId:this._stacksId,includeSources:this._includeSources})}_resetStackCounter(){this._isTracing&&(this._isTracing=!1,this._connection.setIsTracing(!1))}}});import gy from"path";import*as $f from"util";async function wy(i,e){if(xy(e)){let t=e;if(!Buffer.isBuffer(t.buffer))throw new Error(`Unexpected buffer type of 'data.${i}'`);return{name:i,file:yy(t)}}else return e instanceof fs.ReadStream?{name:i,file:await _y(e)}:{name:i,value:String(e)}}function by(i){if(typeof i!="string")return!1;try{return JSON.parse(i),!0}catch(e){if(e instanceof SyntaxError)return!1;throw e}}function yy(i){return{name:i.name,mimeType:i.mimeType,buffer:i.buffer}}async function _y(i){let e=await new Promise((n,r)=>{let s=[];i.on("data",o=>s.push(o)),i.on("end",()=>n(Buffer.concat(s))),i.on("error",o=>r(o))}),t=Buffer.isBuffer(i.path)?i.path.toString("utf8"):i.path;return{name:gy.basename(t),buffer:e}}function vy(i){if(!i)return!1;for(let{name:e,value:t}of i)if(e.toLocaleLowerCase()==="content-type")return t==="application/json";return!1}function Bf(i){if(!i)return;let e=[];for(let[t,n]of Object.entries(i))e.push({name:t,value:String(n)});return e}function xy(i){return typeof i=="object"&&i.name&&i.mimeType&&i.buffer}var bl,Sr,Xs,Qs=x(()=>{O();_t();xe();gi();wl();Tt();wi();bl=class{_playwright;_contexts=new Set;_defaultContextOptions;constructor(e){this._playwright=e}async newContext(e={}){e={...this._defaultContextOptions,...e};let t=typeof e.storageState=="string"?JSON.parse(await fs.promises.readFile(e.storageState,"utf8")):e.storageState,n=this._defaultContextOptions?.tracesDir,r=Sr.from((await this._playwright._channel.newRequest({...e,extraHTTPHeaders:e.extraHTTPHeaders?Ce(e.extraHTTPHeaders):void 0,storageState:t,tracesDir:n,clientCertificates:await du(e.clientCertificates)})).request);return this._contexts.add(r),r._request=this,r._tracing._tracesDir=n,await r._instrumentation.runAfterCreateRequestContext(r),r}},Sr=class extends G{_request;_tracing;_closeReason;static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r),this._tracing=Xn.from(r.tracing)}async[Symbol.asyncDispose](){await this.dispose()}async dispose(e={}){this._closeReason=e.reason,await this._instrumentation.runBeforeCloseRequestContext(this);try{await this._channel.dispose(e)}catch(t){if(bt(t))return;throw t}this._tracing._resetStackCounter(),this._request?._contexts.delete(this)}async delete(e,t){return await this.fetch(e,{...t,method:"DELETE"})}async head(e,t){return await this.fetch(e,{...t,method:"HEAD"})}async get(e,t){return await this.fetch(e,{...t,method:"GET"})}async patch(e,t){return await this.fetch(e,{...t,method:"PATCH"})}async post(e,t){return await this.fetch(e,{...t,method:"POST"})}async put(e,t){return await this.fetch(e,{...t,method:"PUT"})}async fetch(e,t={}){let n=ae(e)?e:void 0,r=ae(e)?void 0:e;return await this._innerFetch({url:n,request:r,...t})}async _innerFetch(e={}){return await this._wrapApiCall(async()=>{if(this._closeReason)throw new Ge(this._closeReason);E(e.request||typeof e.url=="string","First argument must be either URL string or Request"),E((e.data===void 0?0:1)+(e.form===void 0?0:1)+(e.multipart===void 0?0:1)<=1,"Only one of 'data', 'form' or 'multipart' can be specified"),E(e.maxRedirects===void 0||e.maxRedirects>=0,"'maxRedirects' must be greater than or equal to '0'"),E(e.maxRetries===void 0||e.maxRetries>=0,"'maxRetries' must be greater than or equal to '0'");let t=e.url!==void 0?e.url:e.request.url(),n=e.method||e.request?.method(),r;typeof e.params=="string"?r=e.params:e.params instanceof URLSearchParams&&(r=e.params.toString());let s=e.headers||e.request?.headers(),o=s?Ce(s):void 0,l,c,h,m;if(e.data!==void 0)if(ae(e.data))vy(o)?l=by(e.data)?e.data:JSON.stringify(e.data):m=Buffer.from(e.data,"utf8");else if(Buffer.isBuffer(e.data))m=e.data;else if(typeof e.data=="object"||typeof e.data=="number"||typeof e.data=="boolean")l=JSON.stringify(e.data);else throw new Error("Unexpected 'data' type");else if(e.form)c=Bf(e.form);else if(e.multipart)if(h=[],globalThis.FormData&&e.multipart instanceof FormData){let b=e.multipart;for(let[v,S]of b.entries())if(ae(S))h.push({name:v,value:S});else{let _={name:S.name,mimeType:S.type,buffer:Buffer.from(await S.arrayBuffer())};h.push({name:v,file:_})}}else for(let[b,v]of Object.entries(e.multipart))h.push(await wy(b,v));m===void 0&&l===void 0&&c===void 0&&h===void 0&&(m=e.request?.postDataBuffer()||void 0);let f={__testHookLookup:e.__testHookLookup},g=await this._channel.fetch({url:t,params:typeof e.params=="object"?Bf(e.params):void 0,encodedParams:r,method:n,headers:o,postData:m,jsonData:l,formData:c,multipartData:h,timeout:e.timeout,failOnStatusCode:e.failOnStatusCode,ignoreHTTPSErrors:e.ignoreHTTPSErrors,maxRedirects:e.maxRedirects,maxRetries:e.maxRetries,...f});return new Xs(this,g.response)})}async storageState(e={}){let t=await this._channel.storageState();return e.path&&(await We(e.path),await fs.promises.writeFile(e.path,JSON.stringify(t,void 0,2),"utf8")),t}};Xs=class{_initializer;_headers;_request;constructor(e,t){this._request=e,this._initializer=t,this._headers=new sn(this._initializer.headers)}ok(){return this._initializer.status>=200&&this._initializer.status<=299}url(){return this._initializer.url}status(){return this._initializer.status}statusText(){return this._initializer.statusText}headers(){return this._headers.headers()}headersArray(){return this._headers.headersArray()}async body(){try{let e=await this._request._channel.fetchResponseBody({fetchUid:this._fetchUid()});if(e.binary===void 0)throw new Error("Response has been disposed");return e.binary}catch(e){throw bt(e)?new Error("Response has been disposed"):e}}async text(){return(await this.body()).toString("utf8")}async json(){let e=await this.text();return JSON.parse(e)}async[Symbol.asyncDispose](){await this.dispose()}async dispose(){await this._request._channel.disposeAPIResponse({fetchUid:this._fetchUid()})}[$f.inspect.custom](){let e=this.headersArray().map(({name:t,value:n})=>`  ${t}: ${n}`);return`APIResponse: ${this.status()} ${this.statusText()}
${e.join(`
`)}`}_fetchUid(){return this._initializer.fetchUid}async _fetchLog(){let{log:e}=await this._request._channel.fetchLog({fetchUid:this._fetchUid()});return e}}});function Ys(i){for(let e of Object.keys(i)){let t=i[e];if(!Object.is(t,void 0)&&!ae(t))throw new Error(`Expected value of header "${e}" to be String, but "${typeof t}" is found.`)}}var At,Qn,rt,bi,Yn,sn,gi=x(()=>{xe();yi();Js();O();qe();En();fi();O();Qs();Tt();At=class i extends G{_redirectedFrom=null;_redirectedTo=null;_failureText=null;_provisionalHeaders;_actualHeadersPromise;_timing;_fallbackOverrides={};static from(e){return e._object}static fromNullable(e){return e?i.from(e):null}constructor(e,t,n,r){super(e,t,n,r),this._redirectedFrom=i.fromNullable(r.redirectedFrom),this._redirectedFrom&&(this._redirectedFrom._redirectedTo=this),this._provisionalHeaders=new sn(r.headers),this._timing={startTime:0,domainLookupStart:-1,domainLookupEnd:-1,connectStart:-1,secureConnectionStart:-1,connectEnd:-1,requestStart:-1,responseStart:-1,responseEnd:-1}}url(){return this._fallbackOverrides.url||this._initializer.url}resourceType(){return this._initializer.resourceType}method(){return this._fallbackOverrides.method||this._initializer.method}postData(){return(this._fallbackOverrides.postDataBuffer||this._initializer.postData)?.toString("utf-8")||null}postDataBuffer(){return this._fallbackOverrides.postDataBuffer||this._initializer.postData||null}postDataJSON(){let e=this.postData();if(!e)return null;if(this.headers()["content-type"]?.includes("application/x-www-form-urlencoded")){let n={},r=new URLSearchParams(e);for(let[s,o]of r.entries())n[s]=o;return n}try{return JSON.parse(e)}catch{throw new Error("POST data is not a valid JSON object: "+e)}}headers(){return this._fallbackOverrides.headers?sn._fromHeadersObjectLossy(this._fallbackOverrides.headers).headers():this._provisionalHeaders.headers()}async _actualHeaders(){return this._fallbackOverrides.headers?sn._fromHeadersObjectLossy(this._fallbackOverrides.headers):(this._actualHeadersPromise||(this._actualHeadersPromise=this._wrapApiCall(async()=>new sn((await this._channel.rawRequestHeaders()).headers))),await this._actualHeadersPromise)}async allHeaders(){return(await this._actualHeaders()).headers()}async headersArray(){return(await this._actualHeaders()).headersArray()}async headerValue(e){return(await this._actualHeaders()).get(e)}async response(){return rt.fromNullable((await this._channel.response()).response)}async _internalResponse(){return await this._wrapApiCall(async()=>rt.fromNullable((await this._channel.response()).response),!0)}frame(){if(!this._initializer.frame)throw E(this.serviceWorker()),new Error("Service Worker requests do not have an associated frame.");let e=Ke.from(this._initializer.frame);if(!e._page)throw new Error(["Frame for this navigation request is not available, because the request","was issued before the frame is created. You can check whether the request","is a navigation request by calling isNavigationRequest() method."].join(`
`));return e}_safePage(){return Ke.fromNullable(this._initializer.frame)?._page||null}serviceWorker(){return this._initializer.serviceWorker?rn.from(this._initializer.serviceWorker):null}isNavigationRequest(){return this._initializer.isNavigationRequest}redirectedFrom(){return this._redirectedFrom}redirectedTo(){return this._redirectedTo}failure(){return this._failureText===null?null:{errorText:this._failureText}}timing(){return this._timing}async sizes(){let e=await this.response();if(!e)throw new Error("Unable to fetch sizes for failed request");return(await e._channel.sizes()).sizes}_setResponseEndTiming(e){this._timing.responseEnd=e,this._timing.responseStart===-1&&(this._timing.responseStart=e)}_finalRequest(){return this._redirectedTo?this._redirectedTo._finalRequest():this}_applyFallbackOverrides(e){e.url&&(this._fallbackOverrides.url=e.url),e.method&&(this._fallbackOverrides.method=e.method),e.headers&&(this._fallbackOverrides.headers=e.headers),ae(e.postData)?this._fallbackOverrides.postDataBuffer=Buffer.from(e.postData,"utf-8"):e.postData instanceof Buffer?this._fallbackOverrides.postDataBuffer=e.postData:e.postData&&(this._fallbackOverrides.postDataBuffer=Buffer.from(JSON.stringify(e.postData),"utf-8"))}_fallbackOverridesForContinue(){return this._fallbackOverrides}_targetClosedScope(){return this.serviceWorker()?._closedScope||this._safePage()?._closedOrCrashedScope||new Re}},Qn=class extends G{_handlingPromise=null;_context;_didThrow=!1;static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r)}request(){return At.from(this._initializer.request)}async _raceWithTargetClose(e){return await this.request()._targetClosedScope().safeRace(e)}async _startHandling(){return this._handlingPromise=new U,await this._handlingPromise}async fallback(e={}){this._checkNotHandled(),this.request()._applyFallbackOverrides(e),this._reportHandled(!1)}async abort(e){await this._handleRoute(async()=>{await this._raceWithTargetClose(this._channel.abort({requestUrl:this.request()._initializer.url,errorCode:e}))})}async _redirectNavigationRequest(e){await this._handleRoute(async()=>{await this._raceWithTargetClose(this._channel.redirectNavigationRequest({url:e}))})}async fetch(e={}){return await this._wrapApiCall(async()=>await this._context.request._innerFetch({request:this.request(),data:e.postData,...e}))}async fulfill(e={}){await this._handleRoute(async()=>{await this._wrapApiCall(async()=>{await this._innerFulfill(e)})})}async _handleRoute(e){this._checkNotHandled();try{await e(),this._reportHandled(!0)}catch(t){throw this._didThrow=!0,t}}async _innerFulfill(e={}){let t,{status:n,headers:r,body:s}=e;e.json!==void 0&&(E(e.body===void 0,"Can specify either body or json parameters"),s=JSON.stringify(e.json)),e.response instanceof Xs&&(n??=e.response.status(),r??=e.response.headers(),s===void 0&&e.path===void 0&&(e.response._request._connection===this._connection?t=e.response._fetchUid():s=await e.response.body()));let o=!1,l=0;if(e.path){let h=await fs.promises.readFile(e.path);s=h.toString("base64"),o=!0,l=h.length}else ae(s)?(o=!1,l=Buffer.byteLength(s)):s&&(l=s.length,s=s.toString("base64"),o=!0);let c={};for(let h of Object.keys(r||{}))c[h.toLowerCase()]=String(r[h]);e.contentType?c["content-type"]=String(e.contentType):e.json?c["content-type"]="application/json":e.path&&(c["content-type"]=mime.getType(e.path)||"application/octet-stream"),l&&!("content-length"in c)&&(c["content-length"]=String(l)),await this._raceWithTargetClose(this._channel.fulfill({requestUrl:this.request()._initializer.url,status:n||200,headers:Ce(c),body:s,isBase64:o,fetchResponseUid:t}))}async continue(e={}){await this._handleRoute(async()=>{this.request()._applyFallbackOverrides(e),await this._innerContinue()})}_checkNotHandled(){if(!this._handlingPromise)throw new Error("Route is already handled!")}_reportHandled(e){let t=this._handlingPromise;this._handlingPromise=null,t.resolve(e)}async _innerContinue(e=!1){let t=this.request()._fallbackOverridesForContinue();return await this._wrapApiCall(async()=>{await this._raceWithTargetClose(this._channel.continue({requestUrl:this.request()._initializer.url,url:t.url,method:t.method,headers:t.headers?Ce(t.headers):void 0,postData:t.postDataBuffer,isFallback:e}))},!!e)}},rt=class i extends G{_provisionalHeaders;_actualHeadersPromise;_request;_finishedPromise=new U;static from(e){return e._object}static fromNullable(e){return e?i.from(e):null}constructor(e,t,n,r){super(e,t,n,r),this._provisionalHeaders=new sn(r.headers),this._request=At.from(this._initializer.request),Object.assign(this._request._timing,this._initializer.timing)}url(){return this._initializer.url}ok(){return this._initializer.status===0||this._initializer.status>=200&&this._initializer.status<=299}status(){return this._initializer.status}statusText(){return this._initializer.statusText}fromServiceWorker(){return this._initializer.fromServiceWorker}headers(){return this._provisionalHeaders.headers()}async _actualHeaders(){return this._actualHeadersPromise||(this._actualHeadersPromise=(async()=>new sn((await this._channel.rawResponseHeaders()).headers))()),await this._actualHeadersPromise}async allHeaders(){return(await this._actualHeaders()).headers()}async headersArray(){return(await this._actualHeaders()).headersArray().slice()}async headerValue(e){return(await this._actualHeaders()).get(e)}async headerValues(e){return(await this._actualHeaders()).getAll(e)}async finished(){return await this.request()._targetClosedScope().race(this._finishedPromise)}async body(){return(await this._channel.body()).binary}async text(){return(await this.body()).toString("utf8")}async json(){let e=await this.text();return JSON.parse(e)}request(){return this._request}frame(){return this._request.frame()}async serverAddr(){return(await this._channel.serverAddr()).value||null}async securityDetails(){return(await this._channel.securityDetails()).value||null}},bi=class extends G{_page;_isClosed;static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r),this._isClosed=!1,this._page=e,this._channel.on("frameSent",s=>{s.opcode===1?this.emit(B.WebSocket.FrameSent,{payload:s.data}):s.opcode===2&&this.emit(B.WebSocket.FrameSent,{payload:Buffer.from(s.data,"base64")})}),this._channel.on("frameReceived",s=>{s.opcode===1?this.emit(B.WebSocket.FrameReceived,{payload:s.data}):s.opcode===2&&this.emit(B.WebSocket.FrameReceived,{payload:Buffer.from(s.data,"base64")})}),this._channel.on("socketError",({error:s})=>this.emit(B.WebSocket.Error,s)),this._channel.on("close",()=>{this._isClosed=!0,this.emit(B.WebSocket.Close,this)})}url(){return this._initializer.url}isClosed(){return this._isClosed}async waitForEvent(e,t={}){return await this._wrapApiCall(async()=>{let n=this._page._timeoutSettings.timeout(typeof t=="function"?{}:t),r=typeof t=="function"?t:t.predicate,s=Rt.createForEvent(this,e);s.rejectOnTimeout(n,`Timeout ${n}ms exceeded while waiting for event "${e}"`),e!==B.WebSocket.Error&&s.rejectOnEvent(this,B.WebSocket.Error,new Error("Socket error")),e!==B.WebSocket.Close&&s.rejectOnEvent(this,B.WebSocket.Close,new Error("Socket closed")),s.rejectOnEvent(this._page,B.Page.Close,()=>this._page._closeErrorWithReason());let o=await s.waitForEvent(this,e,r);return s.dispose(),o})}};Yn=class{handledCount=0;_baseURL;_times;url;handler;_ignoreException=!1;_activeInvocations=new Set;constructor(e,t,n,r=Number.MAX_SAFE_INTEGER){this._baseURL=e,this._times=r,this.url=t,this.handler=n}static prepareInterceptionPatterns(e){let t=[],n=!1;for(let r of e)ae(r.url)?t.push({glob:r.url}):je(r.url)?t.push({regexSource:r.url.source,regexFlags:r.url.flags}):n=!0;return n?[{glob:"**/*"}]:t}matches(e){return tt(this._baseURL,e,this.url)}async handle(e){let t={complete:new U,route:e};this._activeInvocations.add(t);try{return await this._handleInternal(e)}catch(n){if(this._ignoreException)return!1;throw bt(n)&&ve(n,`"${n.message}" while running route callback.
Consider awaiting \`await page.unrouteAll({ behavior: 'ignoreErrors' })\`
before the end of the test to ignore remaining routes in flight.`),n}finally{t.complete.resolve(),this._activeInvocations.delete(t)}}async stop(e){if(e==="ignoreErrors")this._ignoreException=!0;else{let t=[];for(let n of this._activeInvocations)n.route._didThrow||t.push(n.complete);await Promise.all(t)}}async _handleInternal(e){++this.handledCount;let t=e._startHandling(),n=this.handler,[r]=await Promise.all([t,n(e,e.request())]);return r}willExpire(){return this.handledCount+1>=this._times}},sn=class i{_headersArray;_headersMap=new Mr;static _fromHeadersObjectLossy(e){let t=Object.entries(e).map(([n,r])=>({name:n,value:r})).filter(n=>n.value!==void 0);return new i(t)}constructor(e){this._headersArray=e;for(let t of e)this._headersMap.set(t.name.toLowerCase(),t.value)}get(e){let t=this.getAll(e);return!t||!t.length?null:t.join(e.toLowerCase()==="set-cookie"?`
`:", ")}getAll(e){return[...this._headersMap.get(e.toLowerCase())]}headers(){let e={};for(let t of this._headersMap.keys())e[t]=this.get(t);return e}headersArray(){return this._headersArray}}});var qf,Wf=x(()=>{qf=new Set(["load","domcontentloaded","networkidle","commit"])});import{EventEmitter as Sy}from"events";function Zn(i,e){if(e==="networkidle0"&&(e="networkidle"),!qf.has(e))throw new Error(`${i}: expected one of (load|domcontentloaded|networkidle|commit)`);return e}var Ke,yi=x(()=>{O();xe();cu();lu();Ks();kn();gi();fi();En();Wf();O();Jn();Ke=class i extends G{_eventEmitter;_loadStates;_parentFrame=null;_url="";_name="";_detached=!1;_childFrames=new Set;_page;static from(e){return e._object}static fromNullable(e){return e?i.from(e):null}constructor(e,t,n,r){super(e,t,n,r),this._eventEmitter=new Sy,this._eventEmitter.setMaxListeners(0),this._parentFrame=i.fromNullable(r.parentFrame),this._parentFrame&&this._parentFrame._childFrames.add(this),this._name=r.name,this._url=r.url,this._loadStates=new Set(r.loadStates),this._channel.on("loadstate",s=>{s.add&&(this._loadStates.add(s.add),this._eventEmitter.emit("loadstate",s.add)),s.remove&&this._loadStates.delete(s.remove),!this._parentFrame&&s.add==="load"&&this._page&&this._page.emit(B.Page.Load,this._page),!this._parentFrame&&s.add==="domcontentloaded"&&this._page&&this._page.emit(B.Page.DOMContentLoaded,this._page)}),this._channel.on("navigated",s=>{this._url=s.url,this._name=s.name,this._eventEmitter.emit("navigated",s),!s.error&&this._page&&this._page.emit(B.Page.FrameNavigated,this)})}page(){return this._page}async goto(e,t={}){let n=Zn("waitUntil",t.waitUntil===void 0?"load":t.waitUntil);return rt.fromNullable((await this._channel.goto({url:e,...t,waitUntil:n})).response)}_setupNavigationWaiter(e){let t=new Rt(this._page,"");this._page.isClosed()&&t.rejectImmediately(this._page._closeErrorWithReason()),t.rejectOnEvent(this._page,B.Page.Close,()=>this._page._closeErrorWithReason()),t.rejectOnEvent(this._page,B.Page.Crash,new Error("Navigation failed because page crashed!")),t.rejectOnEvent(this._page,B.Page.FrameDetached,new Error("Navigating frame was detached!"),r=>r===this);let n=this._page._timeoutSettings.navigationTimeout(e);return t.rejectOnTimeout(n,`Timeout ${n}ms exceeded.`),t}async waitForNavigation(e={}){return await this._page._wrapApiCall(async()=>{let t=Zn("waitUntil",e.waitUntil===void 0?"load":e.waitUntil),n=this._setupNavigationWaiter(e),r=typeof e.url=="string"?` to "${e.url}"`:"";n.log(`waiting for navigation${r} until "${t}"`);let s=await n.waitForEvent(this._eventEmitter,"navigated",c=>c.error?!0:(n.log(`  navigated to "${c.url}"`),tt(this._page?.context()._options.baseURL,c.url,e.url)));if(s.error){let c=new Error(s.error);c.stack="",await n.waitForPromise(Promise.reject(c))}this._loadStates.has(t)||await n.waitForEvent(this._eventEmitter,"loadstate",c=>(n.log(`  "${c}" event fired`),c===t));let o=s.newDocument?At.fromNullable(s.newDocument.request):null,l=o?await n.waitForPromise(o._finalRequest()._internalResponse()):null;return n.dispose(),l})}async waitForLoadState(e="load",t={}){return e=Zn("state",e),await this._page._wrapApiCall(async()=>{let n=this._setupNavigationWaiter(t);this._loadStates.has(e)?n.log(`  not waiting, "${e}" event already fired`):await n.waitForEvent(this._eventEmitter,"loadstate",r=>(n.log(`  "${r}" event fired`),r===e)),n.dispose()})}async waitForURL(e,t={}){if(tt(this._page?.context()._options.baseURL,this.url(),e))return await this.waitForLoadState(t.waitUntil,t);await this.waitForNavigation({url:e,...t})}async frameElement(){return Ye.from((await this._channel.frameElement()).element)}async evaluateHandle(e,t){dt(arguments.length,2);let n=await this._channel.evaluateExpressionHandle({expression:String(e),isFunction:typeof e=="function",arg:we(t)});return De.from(n.handle)}async evaluate(e,t){dt(arguments.length,2);let n=await this._channel.evaluateExpression({expression:String(e),isFunction:typeof e=="function",arg:we(t)});return Ue(n.value)}async _evaluateExposeUtilityScript(e,t){dt(arguments.length,2);let n=await this._channel.evaluateExpression({expression:String(e),isFunction:typeof e=="function",arg:we(t)});return Ue(n.value)}async $(e,t){let n=await this._channel.querySelector({selector:e,...t});return Ye.fromNullable(n.element)}async waitForSelector(e,t={}){if(t.visibility)throw new Error("options.visibility is not supported, did you mean options.state?");if(t.waitFor&&t.waitFor!=="visible")throw new Error("options.waitFor is not supported, did you mean options.state?");let n=await this._channel.waitForSelector({selector:e,...t});return Ye.fromNullable(n.element)}async dispatchEvent(e,t,n,r={}){await this._channel.dispatchEvent({selector:e,type:t,eventInit:we(n),...r})}async $eval(e,t,n){dt(arguments.length,3);let r=await this._channel.evalOnSelector({selector:e,expression:String(t),isFunction:typeof t=="function",arg:we(n)});return Ue(r.value)}async $$eval(e,t,n){dt(arguments.length,3);let r=await this._channel.evalOnSelectorAll({selector:e,expression:String(t),isFunction:typeof t=="function",arg:we(n)});return Ue(r.value)}async $$(e){return(await this._channel.querySelectorAll({selector:e})).elements.map(n=>Ye.from(n))}async _queryCount(e){return(await this._channel.queryCount({selector:e})).value}async content(){return(await this._channel.content()).value}async setContent(e,t={}){let n=Zn("waitUntil",t.waitUntil===void 0?"load":t.waitUntil);await this._channel.setContent({html:e,...t,waitUntil:n})}name(){return this._name||""}url(){return this._url}parentFrame(){return this._parentFrame}childFrames(){return Array.from(this._childFrames)}isDetached(){return this._detached}async addScriptTag(e={}){let t={...e};return t.path&&(t.content=(await fs.promises.readFile(t.path)).toString(),t.content=ou(t.content,t.path)),Ye.from((await this._channel.addScriptTag({...t})).element)}async addStyleTag(e={}){let t={...e};return t.path&&(t.content=(await fs.promises.readFile(t.path)).toString(),t.content+="/*# sourceURL="+t.path.replace(/\n/g,"")+"*/"),Ye.from((await this._channel.addStyleTag({...t})).element)}async click(e,t={}){return await this._channel.click({selector:e,...t})}async dblclick(e,t={}){return await this._channel.dblclick({selector:e,...t})}async dragAndDrop(e,t,n={}){return await this._channel.dragAndDrop({source:e,target:t,...n})}async tap(e,t={}){return await this._channel.tap({selector:e,...t})}async fill(e,t,n={}){return await this._channel.fill({selector:e,value:t,...n})}async _highlight(e){return await this._channel.highlight({selector:e})}locator(e,t){return new xr(this,e,t)}getByTestId(e){return this.locator(js(mi(),e))}getByAltText(e,t){return this.locator(Ws(e,t))}getByLabel(e,t){return this.locator(qs(e,t))}getByPlaceholder(e,t){return this.locator(Us(e,t))}getByText(e,t){return this.locator(Vs(e,t))}getByTitle(e,t){return this.locator(zs(e,t))}getByRole(e,t={}){return this.locator(Gs(e,t))}frameLocator(e){return new pi(this,e)}async focus(e,t={}){await this._channel.focus({selector:e,...t})}async textContent(e,t={}){let n=(await this._channel.textContent({selector:e,...t})).value;return n===void 0?null:n}async innerText(e,t={}){return(await this._channel.innerText({selector:e,...t})).value}async innerHTML(e,t={}){return(await this._channel.innerHTML({selector:e,...t})).value}async getAttribute(e,t,n={}){let r=(await this._channel.getAttribute({selector:e,name:t,...n})).value;return r===void 0?null:r}async inputValue(e,t={}){return(await this._channel.inputValue({selector:e,...t})).value}async isChecked(e,t={}){return(await this._channel.isChecked({selector:e,...t})).value}async isDisabled(e,t={}){return(await this._channel.isDisabled({selector:e,...t})).value}async isEditable(e,t={}){return(await this._channel.isEditable({selector:e,...t})).value}async isEnabled(e,t={}){return(await this._channel.isEnabled({selector:e,...t})).value}async isHidden(e,t={}){return(await this._channel.isHidden({selector:e,...t})).value}async isVisible(e,t={}){return(await this._channel.isVisible({selector:e,...t})).value}async hover(e,t={}){await this._channel.hover({selector:e,...t})}async selectOption(e,t,n={}){return(await this._channel.selectOption({selector:e,...uu(t),...n})).values}async setInputFiles(e,t,n={}){let r=await hu(t,this.page().context());await this._channel.setInputFiles({selector:e,...r,...n})}async type(e,t,n={}){await this._channel.type({selector:e,text:t,...n})}async press(e,t,n={}){await this._channel.press({selector:e,key:t,...n})}async check(e,t={}){await this._channel.check({selector:e,...t})}async uncheck(e,t={}){await this._channel.uncheck({selector:e,...t})}async setChecked(e,t,n){t?await this.check(e,n):await this.uncheck(e,n)}async waitForTimeout(e){await this._channel.waitForTimeout({timeout:e})}async waitForFunction(e,t,n={}){typeof n.polling=="string"&&E(n.polling==="raf","Unknown polling option: "+n.polling);let r=await this._channel.waitForFunction({...n,pollingInterval:n.polling==="raf"?void 0:n.polling,expression:String(e),isFunction:typeof e=="function",arg:we(t)});return De.from(r.handle)}async title(){return(await this._channel.title()).value}}});import{Writable as Py}from"stream";var _i,pu,mu=x(()=>{xe();_i=class extends G{static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r)}stream(){return new pu(this._channel)}},pu=class extends Py{_channel;constructor(e){super(),this._channel=e}async _write(e,t,n){let r=await this._channel.write({binary:typeof e=="string"?Buffer.from(e):e}).catch(s=>s);n(r||null)}async _final(e){let t=await this._channel.close().catch(n=>n);e(t||null)}}});import vi from"path";function uu(i){if(i===null)return{};if(Array.isArray(i)||(i=[i]),!i.length)return{};for(let e=0;e<i.length;e++)E(i[e]!==null,`options[${e}]: expected object, got null`);return i[0]instanceof Ye?{elements:i.map(e=>e._elementChannel)}:ae(i[0])?{options:i.map(e=>({valueOrLabel:e}))}:{options:i}}function Cy(i){return i.reduce((e,t)=>e+(t.buffer?t.buffer.byteLength:0),0)>=mo}async function ky(i){let e,t;for(let n of i)if((await fs.promises.stat(n)).isDirectory()){if(t)throw new Error("Multiple directories are not supported");t=vi.resolve(n)}else e??=[],e.push(vi.resolve(n));if(e?.length&&t)throw new Error("File paths must be all files or a single directory");return[e,t]}async function hu(i,e){let t=Array.isArray(i)?i.slice():[i];if(t.some(r=>typeof r=="string")){if(!t.every(o=>typeof o=="string"))throw new Error("File paths cannot be mixed with buffers");let[r,s]=await ky(t);if(e._connection.isRemote()){let o=s?(await fs.promises.readdir(s,{withFileTypes:!0,recursive:!0})).filter(h=>h.isFile()).map(h=>vi.join(h.path,h.name)):r,{writableStreams:l,rootDir:c}=await e._wrapApiCall(async()=>e._channel.createTempFiles({rootDirName:s?vi.basename(s):void 0,items:await Promise.all(o.map(async h=>{let m=(await fs.promises.stat(h)).mtimeMs;return{name:s?vi.relative(s,h):vi.basename(h),lastModifiedMs:m}}))}),!0);for(let h=0;h<o.length;h++){let m=_i.from(l[h]);await pipelineAsync(fs.createReadStream(o[h]),m.stream())}return{directoryStream:c,streams:s?void 0:l}}return{localPaths:r,localDirectory:s}}let n=t;if(Cy(n))throw new Error("Cannot set buffer larger than 50Mb, please write it to a file and pass its path instead.");return{payloads:n}}function fu(i){if(i.path){let e=mime.getType(i.path);if(e==="image/png")return"png";if(e==="image/jpeg")return"jpeg";throw new Error(`path: unsupported mime type "${e}"`)}return i.type}var Ye,Ks=x(()=>{yi();kn();O();_t();mu();Ye=class i extends De{_elementChannel;static from(e){return e._object}static fromNullable(e){return e?i.from(e):null}constructor(e,t,n,r){super(e,t,n,r),this._elementChannel=this._channel}asElement(){return this}async ownerFrame(){return Ke.fromNullable((await this._elementChannel.ownerFrame()).frame)}async contentFrame(){return Ke.fromNullable((await this._elementChannel.contentFrame()).frame)}async getAttribute(e){let t=(await this._elementChannel.getAttribute({name:e})).value;return t===void 0?null:t}async inputValue(){return(await this._elementChannel.inputValue()).value}async textContent(){let e=(await this._elementChannel.textContent()).value;return e===void 0?null:e}async innerText(){return(await this._elementChannel.innerText()).value}async innerHTML(){return(await this._elementChannel.innerHTML()).value}async isChecked(){return(await this._elementChannel.isChecked()).value}async isDisabled(){return(await this._elementChannel.isDisabled()).value}async isEditable(){return(await this._elementChannel.isEditable()).value}async isEnabled(){return(await this._elementChannel.isEnabled()).value}async isHidden(){return(await this._elementChannel.isHidden()).value}async isVisible(){return(await this._elementChannel.isVisible()).value}async dispatchEvent(e,t={}){await this._elementChannel.dispatchEvent({type:e,eventInit:we(t)})}async scrollIntoViewIfNeeded(e={}){await this._elementChannel.scrollIntoViewIfNeeded(e)}async hover(e={}){await this._elementChannel.hover(e)}async click(e={}){return await this._elementChannel.click(e)}async dblclick(e={}){return await this._elementChannel.dblclick(e)}async tap(e={}){return await this._elementChannel.tap(e)}async selectOption(e,t={}){return(await this._elementChannel.selectOption({...uu(e),...t})).values}async fill(e,t={}){return await this._elementChannel.fill({value:e,...t})}async selectText(e={}){await this._elementChannel.selectText(e)}async setInputFiles(e,t={}){let n=await this.ownerFrame();if(!n)throw new Error("Cannot set input files to detached element");let r=await hu(e,n.page().context());await this._elementChannel.setInputFiles({...r,...t})}async focus(){await this._elementChannel.focus()}async type(e,t={}){await this._elementChannel.type({text:e,...t})}async press(e,t={}){await this._elementChannel.press({key:e,...t})}async check(e={}){return await this._elementChannel.check(e)}async uncheck(e={}){return await this._elementChannel.uncheck(e)}async setChecked(e,t){e?await this.check(t):await this.uncheck(t)}async boundingBox(){let e=(await this._elementChannel.boundingBox()).value;return e===void 0?null:e}async screenshot(e={}){let t={...e,mask:void 0};t.type||(t.type=fu(e)),e.mask&&(t.mask=e.mask.map(r=>({frame:r._frame._channel,selector:r._selector})));let n=await this._elementChannel.screenshot(t);return e.path&&(await We(e.path),await fs.promises.writeFile(e.path,n.binary)),n.binary}async $(e){return i.fromNullable((await this._elementChannel.querySelector({selector:e})).element)}async $$(e){return(await this._elementChannel.querySelectorAll({selector:e})).elements.map(n=>i.from(n))}async $eval(e,t,n){let r=await this._elementChannel.evalOnSelector({selector:e,expression:String(t),isFunction:typeof t=="function",arg:we(n)});return Ue(r.value)}async $$eval(e,t,n){let r=await this._elementChannel.evalOnSelectorAll({selector:e,expression:String(t),isFunction:typeof t=="function",arg:we(n)});return Ue(r.value)}async waitForElementState(e,t={}){return await this._elementChannel.waitForElementState({state:e,...t})}async waitForSelector(e,t={}){let n=await this._elementChannel.waitForSelector({selector:e,...t});return i.fromNullable(n.element)}}});var yl,zf=x(()=>{yl=class{_page;_elementHandle;_isMultiple;constructor(e,t,n){this._page=e,this._elementHandle=t,this._isMultiple=n}element(){return this._elementHandle}isMultiple(){return this._isMultiple}page(){return this._page}async setFiles(e,t){return await this._elementHandle.setInputFiles(e,t)}}});var _l,vl,xl,Uf=x(()=>{_l=class{_page;constructor(e){this._page=e}async down(e){await this._page._channel.keyboardDown({key:e})}async up(e){await this._page._channel.keyboardUp({key:e})}async insertText(e){await this._page._channel.keyboardInsertText({text:e})}async type(e,t={}){await this._page._channel.keyboardType({text:e,...t})}async press(e,t={}){await this._page._channel.keyboardPress({key:e,...t})}},vl=class{_page;constructor(e){this._page=e}async move(e,t,n={}){await this._page._channel.mouseMove({x:e,y:t,...n})}async down(e={}){await this._page._channel.mouseDown({...e})}async up(e={}){await this._page._channel.mouseUp(e)}async click(e,t,n={}){await this._page._channel.mouseClick({x:e,y:t,...n})}async dblclick(e,t,n={}){await this.click(e,t,{...n,clickCount:2})}async wheel(e,t){await this._page._channel.mouseWheel({deltaX:e,deltaY:t})}},xl=class{_page;constructor(e){this._page=e}async tap(e,t){await this._page._channel.touchscreenTap({x:e,y:t})}}});var Sl,Vf=x(()=>{O();Sl=class{_artifact=null;_artifactReadyPromise=new U;_isRemote=!1;constructor(e,t){this._isRemote=t.isRemote(),this._artifact=e._closedOrCrashedScope.safeRace(this._artifactReadyPromise)}_artifactReady(e){this._artifactReadyPromise.resolve(e)}async path(){if(this._isRemote)throw new Error("Path is not available when connecting remotely. Use saveAs() to save a local copy.");let e=await this._artifact;if(!e)throw new Error("Page did not produce any video frames");return e._initializer.absolutePath}async saveAs(e){let t=await this._artifact;if(!t)throw new Error("Page did not produce any video frames");return await t.saveAs(e)}async delete(){let e=await this._artifact;e&&await e.delete()}}});var xi,gu=x(()=>{Te();xi=class i{_localUtils;_harId;_notFoundAction;_options;static async create(e,t,n,r){let{harId:s,error:o}=await e._channel.harOpen({file:t});if(o)throw new Error(o);return new i(e,s,n,r)}constructor(e,t,n,r){this._localUtils=e,this._harId=t,this._options=r,this._notFoundAction=n}async _handle(e){let t=e.request(),n=await this._localUtils._channel.harLookup({harId:this._harId,url:t.url(),method:t.method(),headers:await t.headersArray(),postData:t.postDataBuffer()||void 0,isNavigationRequest:t.isNavigationRequest()});if(n.action==="redirect"){N.log("api",`HAR: ${e.request().url()} redirected to ${n.redirectURL}`),await e._redirectNavigationRequest(n.redirectURL);return}if(n.action==="fulfill"){if(n.status===-1)return;await e.fulfill({status:n.status,headers:Object.fromEntries(n.headers.map(r=>[r.name,r.value])),body:n.body});return}if(n.action==="error"&&N.log("api","HAR: "+n.message),this._notFoundAction==="abort"){await e.abort();return}await e.fallback()}async addContextRoute(e){await e.route(this._options.urlMatch||"**/*",t=>this._handle(t))}async addPageRoute(e){await e.route(this._options.urlMatch||"**/*",t=>this._handle(t))}async[Symbol.asyncDispose](){await this.dispose()}dispose(){this._localUtils._channel.harClose({harId:this._harId}).catch(()=>{})}}});import Ey from"path";function Gf(i){if(je(i))return`/${Zl(i.source,50)}/${i.flags}`;if(ae(i))return`"${Zl(i,50)}"`}var Be,Pr,Zs=x(()=>{Tt();bn();O();Af();ui();xe();Jn();Lf();Of();Ks();En();zf();yi();Uf();kn();gi();Vf();fi();Js();gu();Be=class i extends G{_browserContext;_ownedContext;_mainFrame;_frames=new Set;_workers=new Set;_closed=!1;_closedOrCrashedScope=new Re;_viewportSize;_routes=[];accessibility;coverage;keyboard;mouse;request;touchscreen;clock;_bindings=new Map;_timeoutSettings;_video=null;_opener;_closeReason;_closeWasCalled=!1;_harRouters=[];_locatorHandlers=new Map;static from(e){return e._object}static fromNullable(e){return e?i.from(e):null}constructor(e,t,n,r){super(e,t,n,r),this._browserContext=e,this._timeoutSettings=new Le(this._browserContext._timeoutSettings),this.accessibility=new ul(this._channel),this.keyboard=new _l(this),this.mouse=new vl(this),this.request=this._browserContext.request,this.touchscreen=new xl(this),this.clock=this._browserContext.clock,this._mainFrame=Ke.from(r.mainFrame),this._mainFrame._page=this,this._frames.add(this._mainFrame),this._viewportSize=r.viewportSize||null,this._closed=r.isClosed,this._opener=i.fromNullable(r.opener),this._channel.on("bindingCall",({binding:s})=>this._onBinding(Pr.from(s))),this._channel.on("close",()=>this._onClose()),this._channel.on("crash",()=>this._onCrash()),this._channel.on("download",({url:s,suggestedFilename:o,artifact:l})=>{let c=yt.from(l);this.emit(B.Page.Download,new gl(this,s,o,c))}),this._channel.on("fileChooser",({element:s,isMultiple:o})=>this.emit(B.Page.FileChooser,new yl(this,Ye.from(s),o))),this._channel.on("frameAttached",({frame:s})=>this._onFrameAttached(Ke.from(s))),this._channel.on("frameDetached",({frame:s})=>this._onFrameDetached(Ke.from(s))),this._channel.on("locatorHandlerTriggered",({uid:s})=>this._onLocatorHandlerTriggered(s)),this._channel.on("route",({route:s})=>this._onRoute(Qn.from(s))),this._channel.on("video",({artifact:s})=>{let o=yt.from(s);this._forceVideo()._artifactReady(o)}),this._channel.on("webSocket",({webSocket:s})=>this.emit(B.Page.WebSocket,bi.from(s))),this._channel.on("worker",({worker:s})=>this._onWorker(rn.from(s))),this.coverage=new fl(this._channel),this.once(B.Page.Close,()=>this._closedOrCrashedScope.close(this._closeErrorWithReason())),this.once(B.Page.Crash,()=>this._closedOrCrashedScope.close(new Ge)),this._setEventToSubscriptionMapping(new Map([[B.Page.Console,"console"],[B.Page.Dialog,"dialog"],[B.Page.Request,"request"],[B.Page.Response,"response"],[B.Page.RequestFinished,"requestFinished"],[B.Page.RequestFailed,"requestFailed"],[B.Page.FileChooser,"fileChooser"]]))}_onFrameAttached(e){e._page=this,this._frames.add(e),e._parentFrame&&e._parentFrame._childFrames.add(e),this.emit(B.Page.FrameAttached,e)}_onFrameDetached(e){this._frames.delete(e),e._detached=!0,e._parentFrame&&e._parentFrame._childFrames.delete(e),this.emit(B.Page.FrameDetached,e)}async _onRoute(e){e._context=this.context();let t=this._routes.slice();for(let n of t){if(this._closeWasCalled||this._browserContext._closeWasCalled)return;if(!n.matches(e.request().url()))continue;let r=this._routes.indexOf(n);if(r===-1)continue;n.willExpire()&&this._routes.splice(r,1);let s=await n.handle(e);if(this._routes.length||this._wrapApiCall(()=>this._updateInterceptionPatterns(),!0).catch(()=>{}),s)return}await this._browserContext._onRoute(e)}async _onBinding(e){let t=this._bindings.get(e._initializer.name);if(t){await e.call(t);return}await this._browserContext._onBinding(e)}_onWorker(e){this._workers.add(e),e._page=this,this.emit(B.Page.Worker,e)}_onClose(){this._closed=!0,this._browserContext._pages.delete(this),this._browserContext._backgroundPages.delete(this),this._disposeHarRouters(),this.emit(B.Page.Close,this)}_onCrash(){this.emit(B.Page.Crash,this)}context(){return this._browserContext}async opener(){return!this._opener||this._opener.isClosed()?null:this._opener}mainFrame(){return this._mainFrame}frame(e){let t=ae(e)?e:e.name,n=Zu(e)?e.url:void 0;return E(t||n,"Either name or url matcher should be specified"),this.frames().find(r=>t?r.name()===t:tt(this._browserContext._options.baseURL,r.url(),n))||null}frames(){return[...this._frames]}setDefaultNavigationTimeout(e){this._timeoutSettings.setDefaultNavigationTimeout(e),this._wrapApiCall(async()=>{this._channel.setDefaultNavigationTimeoutNoReply({timeout:e}).catch(()=>{})},!0)}setDefaultTimeout(e){this._timeoutSettings.setDefaultTimeout(e),this._wrapApiCall(async()=>{this._channel.setDefaultTimeoutNoReply({timeout:e}).catch(()=>{})},!0)}_forceVideo(){return this._video||(this._video=new Sl(this,this._connection)),this._video}video(){return this._browserContext._options.recordVideo?this._forceVideo():null}async $(e,t){return await this._mainFrame.$(e,t)}async waitForSelector(e,t){return await this._mainFrame.waitForSelector(e,t)}async dispatchEvent(e,t,n,r){return await this._mainFrame.dispatchEvent(e,t,n,r)}async evaluateHandle(e,t){return dt(arguments.length,2),await this._mainFrame.evaluateHandle(e,t)}async $eval(e,t,n){return dt(arguments.length,3),await this._mainFrame.$eval(e,t,n)}async $$eval(e,t,n){return dt(arguments.length,3),await this._mainFrame.$$eval(e,t,n)}async $$(e){return await this._mainFrame.$$(e)}async addScriptTag(e={}){return await this._mainFrame.addScriptTag(e)}async addStyleTag(e={}){return await this._mainFrame.addStyleTag(e)}async exposeFunction(e,t){await this._channel.exposeBinding({name:e});let n=(r,...s)=>t(...s);this._bindings.set(e,n)}async exposeBinding(e,t,n={}){await this._channel.exposeBinding({name:e,needsHandle:n.handle}),this._bindings.set(e,t)}async setExtraHTTPHeaders(e){Ys(e),await this._channel.setExtraHTTPHeaders({headers:Ce(e)})}url(){return this._mainFrame.url()}async content(){return await this._mainFrame.content()}async setContent(e,t){return await this._mainFrame.setContent(e,t)}async goto(e,t){return await this._mainFrame.goto(e,t)}async reload(e={}){let t=Zn("waitUntil",e.waitUntil===void 0?"load":e.waitUntil);return rt.fromNullable((await this._channel.reload({...e,waitUntil:t})).response)}async addLocatorHandler(e,t,n={}){if(e._frame!==this._mainFrame)throw new Error("Locator must belong to the main frame of this page");if(n.times===0)return;let{uid:r}=await this._channel.registerLocatorHandler({selector:e._selector,noWaitAfter:n.noWaitAfter});this._locatorHandlers.set(r,{locator:e,handler:t,times:n.times})}async _onLocatorHandlerTriggered(e){let t=!1;try{let n=this._locatorHandlers.get(e);n&&n.times!==0&&(n.times!==void 0&&n.times--,await n.handler(n.locator)),t=n?.times===0}finally{t&&this._locatorHandlers.delete(e),this._wrapApiCall(()=>this._channel.resolveLocatorHandlerNoReply({uid:e,remove:t}),!0).catch(()=>{})}}async removeLocatorHandler(e){for(let[t,n]of this._locatorHandlers)n.locator._equals(e)&&(this._locatorHandlers.delete(t),await this._channel.unregisterLocatorHandler({uid:t}).catch(()=>{}))}async waitForLoadState(e,t){return await this._mainFrame.waitForLoadState(e,t)}async waitForNavigation(e){return await this._mainFrame.waitForNavigation(e)}async waitForURL(e,t){return await this._mainFrame.waitForURL(e,t)}async waitForRequest(e,t={}){let n=async o=>ae(e)||je(e)?tt(this._browserContext._options.baseURL,o.url(),e):await e(o),r=Gf(e),s=r?`waiting for request ${r}`:void 0;return await this._waitForEvent(B.Page.Request,{predicate:n,timeout:t.timeout},s)}async waitForResponse(e,t={}){let n=async o=>ae(e)||je(e)?tt(this._browserContext._options.baseURL,o.url(),e):await e(o),r=Gf(e),s=r?`waiting for response ${r}`:void 0;return await this._waitForEvent(B.Page.Response,{predicate:n,timeout:t.timeout},s)}async waitForEvent(e,t={}){return await this._waitForEvent(e,t,`waiting for event "${e}"`)}_closeErrorWithReason(){return new Ge(this._closeReason||this._browserContext._effectiveCloseReason())}async _waitForEvent(e,t,n){return await this._wrapApiCall(async()=>{let r=this._timeoutSettings.timeout(typeof t=="function"?{}:t),s=typeof t=="function"?t:t.predicate,o=Rt.createForEvent(this,e);n&&o.log(n),o.rejectOnTimeout(r,`Timeout ${r}ms exceeded while waiting for event "${e}"`),e!==B.Page.Crash&&o.rejectOnEvent(this,B.Page.Crash,new Error("Page crashed")),e!==B.Page.Close&&o.rejectOnEvent(this,B.Page.Close,()=>this._closeErrorWithReason());let l=await o.waitForEvent(this,e,s);return o.dispose(),l})}async goBack(e={}){let t=Zn("waitUntil",e.waitUntil===void 0?"load":e.waitUntil);return rt.fromNullable((await this._channel.goBack({...e,waitUntil:t})).response)}async goForward(e={}){let t=Zn("waitUntil",e.waitUntil===void 0?"load":e.waitUntil);return rt.fromNullable((await this._channel.goForward({...e,waitUntil:t})).response)}async emulateMedia(e={}){await this._channel.emulateMedia({media:e.media===null?"no-override":e.media,colorScheme:e.colorScheme===null?"no-override":e.colorScheme,reducedMotion:e.reducedMotion===null?"no-override":e.reducedMotion,forcedColors:e.forcedColors===null?"no-override":e.forcedColors})}async setViewportSize(e){this._viewportSize=e,await this._channel.setViewportSize({viewportSize:e})}viewportSize(){return this._viewportSize}async evaluate(e,t){return dt(arguments.length,2),await this._mainFrame.evaluate(e,t)}async addInitScript(e,t){let n=await hi(e,t);await this._channel.addInitScript({source:n})}async route(e,t,n={}){this._routes.unshift(new Yn(this._browserContext._options.baseURL,e,t,n.times)),await this._updateInterceptionPatterns()}async routeFromHAR(e,t={}){if(t.update){await this._browserContext._recordIntoHAR(e,this,t);return}let n=await xi.create(this._connection.localUtils(),e,t.notFound||"abort",{urlMatch:t.url});this._harRouters.push(n),await n.addPageRoute(this)}_disposeHarRouters(){this._harRouters.forEach(e=>e.dispose()),this._harRouters=[]}async unrouteAll(e){await this._unrouteInternal(this._routes,[],e?.behavior),this._disposeHarRouters()}async unroute(e,t){let n=[],r=[];for(let s of this._routes)vo(s.url,e)&&(!t||s.handler===t)?n.push(s):r.push(s);await this._unrouteInternal(n,r,"default")}async _unrouteInternal(e,t,n){if(this._routes=t,await this._updateInterceptionPatterns(),!n||n==="default")return;let r=e.map(s=>s.stop(n));await Promise.all(r)}async _updateInterceptionPatterns(){let e=Yn.prepareInterceptionPatterns(this._routes);await this._channel.setNetworkInterceptionPatterns({patterns:e})}async screenshot(e={}){let t={...e,mask:void 0};t.type||(t.type=fu(e)),e.mask&&(t.mask=e.mask.map(r=>({frame:r._frame._channel,selector:r._selector})));let n=await this._channel.screenshot(t);return e.path&&(await We(e.path),await fs.promises.writeFile(e.path,n.binary)),n.binary}async _expectScreenshot(e){let t=e?.mask?e?.mask.map(r=>({frame:r._frame._channel,selector:r._selector})):void 0,n=e.locator?{frame:e.locator._frame._channel,selector:e.locator._selector}:void 0;return await this._channel.expectScreenshot({...e,isNot:!!e.isNot,locator:n,mask:t})}async title(){return await this._mainFrame.title()}async bringToFront(){await this._channel.bringToFront()}async[Symbol.asyncDispose](){await this.close()}async close(e={}){this._closeReason=e.reason,this._closeWasCalled=!0;try{this._ownedContext?await this._ownedContext.close():await this._channel.close(e)}catch(t){if(bt(t)&&!e.runBeforeUnload)return;throw t}}isClosed(){return this._closed}async click(e,t){return await this._mainFrame.click(e,t)}async dragAndDrop(e,t,n){return await this._mainFrame.dragAndDrop(e,t,n)}async dblclick(e,t){return await this._mainFrame.dblclick(e,t)}async tap(e,t){return await this._mainFrame.tap(e,t)}async fill(e,t,n){return await this._mainFrame.fill(e,t,n)}locator(e,t){return this.mainFrame().locator(e,t)}getByTestId(e){return this.mainFrame().getByTestId(e)}getByAltText(e,t){return this.mainFrame().getByAltText(e,t)}getByLabel(e,t){return this.mainFrame().getByLabel(e,t)}getByPlaceholder(e,t){return this.mainFrame().getByPlaceholder(e,t)}getByText(e,t){return this.mainFrame().getByText(e,t)}getByTitle(e,t){return this.mainFrame().getByTitle(e,t)}getByRole(e,t={}){return this.mainFrame().getByRole(e,t)}frameLocator(e){return this.mainFrame().frameLocator(e)}async focus(e,t){return await this._mainFrame.focus(e,t)}async textContent(e,t){return await this._mainFrame.textContent(e,t)}async innerText(e,t){return await this._mainFrame.innerText(e,t)}async innerHTML(e,t){return await this._mainFrame.innerHTML(e,t)}async getAttribute(e,t,n){return await this._mainFrame.getAttribute(e,t,n)}async inputValue(e,t){return await this._mainFrame.inputValue(e,t)}async isChecked(e,t){return await this._mainFrame.isChecked(e,t)}async isDisabled(e,t){return await this._mainFrame.isDisabled(e,t)}async isEditable(e,t){return await this._mainFrame.isEditable(e,t)}async isEnabled(e,t){return await this._mainFrame.isEnabled(e,t)}async isHidden(e,t){return await this._mainFrame.isHidden(e,t)}async isVisible(e,t){return await this._mainFrame.isVisible(e,t)}async hover(e,t){return await this._mainFrame.hover(e,t)}async selectOption(e,t,n){return await this._mainFrame.selectOption(e,t,n)}async setInputFiles(e,t,n){return await this._mainFrame.setInputFiles(e,t,n)}async type(e,t,n){return await this._mainFrame.type(e,t,n)}async press(e,t,n){return await this._mainFrame.press(e,t,n)}async check(e,t){return await this._mainFrame.check(e,t)}async uncheck(e,t){return await this._mainFrame.uncheck(e,t)}async setChecked(e,t,n){return await this._mainFrame.setChecked(e,t,n)}async waitForTimeout(e){return await this._mainFrame.waitForTimeout(e)}async waitForFunction(e,t,n){return await this._mainFrame.waitForFunction(e,t,n)}workers(){return[...this._workers]}async pause(){let e=this._browserContext._timeoutSettings.defaultNavigationTimeout(),t=this._browserContext._timeoutSettings.defaultTimeout();this._browserContext.setDefaultNavigationTimeout(0),this._browserContext.setDefaultTimeout(0),this._instrumentation?.onWillPause(),await this._closedOrCrashedScope.safeRace(this.context()._channel.pause()),this._browserContext.setDefaultNavigationTimeout(e),this._browserContext.setDefaultTimeout(t)}async pdf(e={}){let t={...e};t.margin&&(t.margin={...t.margin}),typeof e.width=="number"&&(t.width=e.width+"px"),typeof e.height=="number"&&(t.height=e.height+"px");for(let r of["top","right","bottom","left"]){let s=r;e.margin&&typeof e.margin[s]=="number"&&(t.margin[s]=t.margin[s]+"px")}let n=await this._channel.pdf(t);return e.path&&(await fs.promises.mkdir(Ey.dirname(e.path),{recursive:!0}),await fs.promises.writeFile(e.path,n.pdf)),n.pdf}},Pr=class extends G{static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r)}async call(e){try{let t=Ke.from(this._initializer.frame),n={context:t._page.context(),page:t._page,frame:t},r;this._initializer.handle?r=await e(n,De.from(this._initializer.handle)):r=await e(n,...this._initializer.args.map(Ue)),this._channel.resolve({result:we(r)}).catch(()=>{})}catch(t){this._channel.reject({error:Tf(t)}).catch(()=>{})}}}});var er,Pl=x(()=>{xe();er=class extends G{static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r),this._channel.on("event",({method:s,params:o})=>{this.emit(s,o)}),this.on=super.on,this.addListener=super.addListener,this.off=super.removeListener,this.removeListener=super.removeListener,this.once=super.once}async send(e,t){return(await this._channel.send({method:e,params:t})).result}async detach(){return await this._channel.detach()}}});import*as Kf from"util";var Si,wu=x(()=>{kn();Zs();Si=class{_page;_event;constructor(e){this._page="page"in e&&e.page?Be.from(e.page):null,this._event=e}page(){return this._page}type(){return this._event.type}text(){return this._event.text}args(){return this._event.args.map(De.from)}location(){return this._event.location}[Kf.inspect.custom](){return this.text()}}});var Pi,bu=x(()=>{xe();Zs();Pi=class extends G{static from(e){return e._object}_page;constructor(e,t,n,r){super(e,t,n,r),this._page=Be.fromNullable(r.page)}page(){return this._page}type(){return this._initializer.type}message(){return this._initializer.message}defaultValue(){return this._initializer.defaultValue}async accept(e){await this._channel.accept({promptText:e})}async dismiss(){await this._channel.dismiss()}}});var Cl,Jf=x(()=>{Cl=class{_page;_error;constructor(e,t){this._page=e,this._error=t}page(){return this._page}error(){return this._error}}});function kl(i){if(typeof i=="number")return{timeNumber:i};if(typeof i=="string")return{timeString:i};if(!isFinite(i.getTime()))throw new Error(`Invalid date: ${i}`);return{timeNumber:i.getTime()}}function Xf(i){return{ticksNumber:typeof i=="number"?i:void 0,ticksString:typeof i=="string"?i:void 0}}var El,Qf=x(()=>{El=class{_browserContext;constructor(e){this._browserContext=e}async install(e={}){await this._browserContext._channel.clockInstall(e.time!==void 0?kl(e.time):{})}async fastForward(e){await this._browserContext._channel.clockFastForward(Xf(e))}async pauseAt(e){await this._browserContext._channel.clockPauseAt(kl(e))}async resume(){await this._browserContext._channel.clockResume({})}async runFor(e){await this._browserContext._channel.clockRunFor(Xf(e))}async setFixedTime(e){await this._browserContext._channel.clockSetFixedTime(kl(e))}async setSystemTime(e){await this._browserContext._channel.clockSetSystemTime(kl(e))}}});import Ty from"path";async function Ry(i){if(typeof i.storageState!="string")return i.storageState;try{return JSON.parse(await fs.promises.readFile(i.storageState,"utf8"))}catch(e){throw ve(e,`Error reading storage state from ${i.storageState}:
`+e.message),e}}function Yf(i){if(i)return{path:i.path,content:i.content||(i.omitContent?"omit":void 0),urlGlob:ae(i.urlFilter)?i.urlFilter:void 0,urlRegexSource:je(i.urlFilter)?i.urlFilter.source:void 0,urlRegexFlags:je(i.urlFilter)?i.urlFilter.flags:void 0,mode:i.mode}}async function Ci(i){if(i.videoSize&&!i.videosPath)throw new Error('"videoSize" option requires "videosPath" to be specified');i.extraHTTPHeaders&&Ys(i.extraHTTPHeaders);let e={...i,viewport:i.viewport===null?void 0:i.viewport,noDefaultViewport:i.viewport===null,extraHTTPHeaders:i.extraHTTPHeaders?Ce(i.extraHTTPHeaders):void 0,storageState:await Ry(i),serviceWorkers:i.serviceWorkers,recordHar:Yf(i.recordHar),colorScheme:i.colorScheme===null?"no-override":i.colorScheme,reducedMotion:i.reducedMotion===null?"no-override":i.reducedMotion,forcedColors:i.forcedColors===null?"no-override":i.forcedColors,acceptDownloads:Ay(i.acceptDownloads),clientCertificates:await du(i.clientCertificates)};return!e.recordVideo&&i.videosPath&&(e.recordVideo={dir:i.videosPath,size:i.videoSize}),e.recordVideo&&e.recordVideo.dir&&(e.recordVideo.dir=Ty.resolve(process.cwd(),e.recordVideo.dir)),e}function Ay(i){if(i!==void 0)return i?"accept":"deny"}async function du(i){if(!i)return;let e=async(t,n)=>{if(t)return t;if(n)return await fs.promises.readFile(n)};return await Promise.all(i.map(async t=>({origin:t.origin,cert:await e(t.cert,t.certPath),key:await e(t.key,t.keyPath),pfx:await e(t.pfx,t.pfxPath),passphrase:t.passphrase})))}var $t,wi=x(()=>{Zs();yi();gi();xe();Jn();Tl();Js();En();bn();fi();O();Pl();wl();ui();Qs();Lt();gu();wu();bu();Jf();Tt();Qf();$t=class i extends G{_pages=new Set;_routes=[];_browser=null;_browserType;_bindings=new Map;_timeoutSettings=new Le;_ownerPage;_closedPromise;_options={};request;tracing;clock;_backgroundPages=new Set;_serviceWorkers=new Set;_isChromium;_harRecorders=new Map;_closeWasCalled=!1;_closeReason;_harRouters=[];static from(e){return e._object}static fromNullable(e){return e?i.from(e):null}constructor(e,t,n,r){super(e,t,n,r),e instanceof on&&(this._browser=e),this._browser?._contexts.add(this),this._isChromium=this._browser?._name==="chromium",this.tracing=Xn.from(r.tracing),this.request=Sr.from(r.requestContext),this.clock=new El(this),this._channel.on("bindingCall",({binding:s})=>this._onBinding(Pr.from(s))),this._channel.on("close",()=>this._onClose()),this._channel.on("page",({page:s})=>this._onPage(Be.from(s))),this._channel.on("route",({route:s})=>this._onRoute(Qn.from(s))),this._channel.on("backgroundPage",({page:s})=>{let o=Be.from(s);this._backgroundPages.add(o),this.emit(B.BrowserContext.BackgroundPage,o)}),this._channel.on("serviceWorker",({worker:s})=>{let o=rn.from(s);o._context=this,this._serviceWorkers.add(o),this.emit(B.BrowserContext.ServiceWorker,o)}),this._channel.on("console",s=>{let o=new Si(s);this.emit(B.BrowserContext.Console,o);let l=o.page();l&&l.emit(B.Page.Console,o)}),this._channel.on("pageError",({error:s,page:o})=>{let l=Be.from(o),c=dl(s);this.emit(B.BrowserContext.WebError,new Cl(l,c)),l&&l.emit(B.Page.PageError,c)}),this._channel.on("dialog",({dialog:s})=>{let o=Pi.from(s),l=this.emit(B.BrowserContext.Dialog,o),c=o.page();c&&(l=c.emit(B.Page.Dialog,o)||l),l||(o.type()==="beforeunload"?s.accept({}).catch(()=>{}):s.dismiss().catch(()=>{}))}),this._channel.on("request",({request:s,page:o})=>this._onRequest(At.from(s),Be.fromNullable(o))),this._channel.on("requestFailed",({request:s,failureText:o,responseEndTiming:l,page:c})=>this._onRequestFailed(At.from(s),l,o,Be.fromNullable(c))),this._channel.on("requestFinished",s=>this._onRequestFinished(s)),this._channel.on("response",({response:s,page:o})=>this._onResponse(rt.from(s),Be.fromNullable(o))),this._closedPromise=new Promise(s=>this.once(B.BrowserContext.Close,s)),this._setEventToSubscriptionMapping(new Map([[B.BrowserContext.Console,"console"],[B.BrowserContext.Dialog,"dialog"],[B.BrowserContext.Request,"request"],[B.BrowserContext.Response,"response"],[B.BrowserContext.RequestFinished,"requestFinished"],[B.BrowserContext.RequestFailed,"requestFailed"]]))}_setOptions(e,t){this._options=e,this._options.recordHar&&this._harRecorders.set("",{path:this._options.recordHar.path,content:this._options.recordHar.content}),this.tracing._tracesDir=t.tracesDir}_onPage(e){this._pages.add(e),this.emit(B.BrowserContext.Page,e),e._opener&&!e._opener.isClosed()&&e._opener.emit(B.Page.Popup,e)}_onRequest(e,t){this.emit(B.BrowserContext.Request,e),t&&t.emit(B.Page.Request,e)}_onResponse(e,t){this.emit(B.BrowserContext.Response,e),t&&t.emit(B.Page.Response,e)}_onRequestFailed(e,t,n,r){e._failureText=n||null,e._setResponseEndTiming(t),this.emit(B.BrowserContext.RequestFailed,e),r&&r.emit(B.Page.RequestFailed,e)}_onRequestFinished(e){let{responseEndTiming:t}=e,n=At.from(e.request),r=rt.fromNullable(e.response),s=Be.fromNullable(e.page);n._setResponseEndTiming(t),this.emit(B.BrowserContext.RequestFinished,n),s&&s.emit(B.Page.RequestFinished,n),r&&r._finishedPromise.resolve(null)}async _onRoute(e){e._context=this;let t=e.request()._safePage(),n=this._routes.slice();for(let r of n){if(t?._closeWasCalled||this._closeWasCalled)return;if(!r.matches(e.request().url()))continue;let s=this._routes.indexOf(r);if(s===-1)continue;r.willExpire()&&this._routes.splice(s,1);let o=await r.handle(e);if(this._routes.length||this._wrapApiCall(()=>this._updateInterceptionPatterns(),!0).catch(()=>{}),o)return}await e._innerContinue(!0).catch(()=>{})}async _onBinding(e){let t=this._bindings.get(e._initializer.name);t&&await e.call(t)}setDefaultNavigationTimeout(e){this._timeoutSettings.setDefaultNavigationTimeout(e),this._wrapApiCall(async()=>{this._channel.setDefaultNavigationTimeoutNoReply({timeout:e}).catch(()=>{})},!0)}setDefaultTimeout(e){this._timeoutSettings.setDefaultTimeout(e),this._wrapApiCall(async()=>{this._channel.setDefaultTimeoutNoReply({timeout:e}).catch(()=>{})},!0)}browser(){return this._browser}pages(){return[...this._pages]}async newPage(){if(this._ownerPage)throw new Error("Please use browser.newContext()");return Be.from((await this._channel.newPage()).page)}async cookies(e){return e||(e=[]),e&&typeof e=="string"&&(e=[e]),(await this._channel.cookies({urls:e})).cookies}async addCookies(e){await this._channel.addCookies({cookies:e})}async clearCookies(e={}){await this._channel.clearCookies({name:ae(e.name)?e.name:void 0,nameRegexSource:je(e.name)?e.name.source:void 0,nameRegexFlags:je(e.name)?e.name.flags:void 0,domain:ae(e.domain)?e.domain:void 0,domainRegexSource:je(e.domain)?e.domain.source:void 0,domainRegexFlags:je(e.domain)?e.domain.flags:void 0,path:ae(e.path)?e.path:void 0,pathRegexSource:je(e.path)?e.path.source:void 0,pathRegexFlags:je(e.path)?e.path.flags:void 0})}async grantPermissions(e,t){await this._channel.grantPermissions({permissions:e,...t})}async clearPermissions(){await this._channel.clearPermissions()}async setGeolocation(e){await this._channel.setGeolocation({geolocation:e||void 0})}async setExtraHTTPHeaders(e){Ys(e),await this._channel.setExtraHTTPHeaders({headers:Ce(e)})}async setOffline(e){await this._channel.setOffline({offline:e})}async setHTTPCredentials(e){await this._channel.setHTTPCredentials({httpCredentials:e||void 0})}async addInitScript(e,t){let n=await hi(e,t);await this._channel.addInitScript({source:n})}async exposeBinding(e,t,n={}){await this._channel.exposeBinding({name:e,needsHandle:n.handle}),this._bindings.set(e,t)}async exposeFunction(e,t){await this._channel.exposeBinding({name:e});let n=(r,...s)=>t(...s);this._bindings.set(e,n)}async route(e,t,n={}){this._routes.unshift(new Yn(this._options.baseURL,e,t,n.times)),await this._updateInterceptionPatterns()}async _recordIntoHAR(e,t,n={}){let{harId:r}=await this._channel.harStart({page:t?._channel,options:Yf({path:e,content:n.updateContent??"attach",mode:n.updateMode??"minimal",urlFilter:n.url})});this._harRecorders.set(r,{path:e,content:n.updateContent??"attach"})}async routeFromHAR(e,t={}){if(t.update){await this._recordIntoHAR(e,null,t);return}let n=await xi.create(this._connection.localUtils(),e,t.notFound||"abort",{urlMatch:t.url});this._harRouters.push(n),await n.addContextRoute(this)}_disposeHarRouters(){this._harRouters.forEach(e=>e.dispose()),this._harRouters=[]}async unrouteAll(e){await this._unrouteInternal(this._routes,[],e?.behavior),this._disposeHarRouters()}async unroute(e,t){let n=[],r=[];for(let s of this._routes)vo(s.url,e)&&(!t||s.handler===t)?n.push(s):r.push(s);await this._unrouteInternal(n,r,"default")}async _unrouteInternal(e,t,n){if(this._routes=t,await this._updateInterceptionPatterns(),!n||n==="default")return;let r=e.map(s=>s.stop(n));await Promise.all(r)}async _updateInterceptionPatterns(){let e=Yn.prepareInterceptionPatterns(this._routes);await this._channel.setNetworkInterceptionPatterns({patterns:e})}_effectiveCloseReason(){return this._closeReason||this._browser?._closeReason}async waitForEvent(e,t={}){return await this._wrapApiCall(async()=>{let n=this._timeoutSettings.timeout(typeof t=="function"?{}:t),r=typeof t=="function"?t:t.predicate,s=Rt.createForEvent(this,e);s.rejectOnTimeout(n,`Timeout ${n}ms exceeded while waiting for event "${e}"`),e!==B.BrowserContext.Close&&s.rejectOnEvent(this,B.BrowserContext.Close,()=>new Ge(this._effectiveCloseReason()));let o=await s.waitForEvent(this,e,r);return s.dispose(),o})}async storageState(e={}){let t=await this._channel.storageState();return e.path&&(await We(e.path),await fs.promises.writeFile(e.path,JSON.stringify(t,void 0,2),"utf8")),t}backgroundPages(){return[...this._backgroundPages]}serviceWorkers(){return[...this._serviceWorkers]}async newCDPSession(e){if(!(e instanceof Be)&&!(e instanceof Ke))throw new Error("page: expected Page or Frame");let t=await this._channel.newCDPSession(e instanceof Be?{page:e._channel}:{frame:e._channel});return er.from(t.session)}_onClose(){this._browser&&this._browser._contexts.delete(this),this._browserType?._contexts?.delete(this),this._disposeHarRouters(),this.tracing._resetStackCounter(),this.emit(B.BrowserContext.Close,this)}async[Symbol.asyncDispose](){await this.close()}async close(e={}){this._closeWasCalled||(this._closeReason=e.reason,this._closeWasCalled=!0,await this._wrapApiCall(async()=>{await this.request.dispose(e)},!0),await this._wrapApiCall(async()=>{await this._browserType?._willCloseContext(this);for(let[t,n]of this._harRecorders){let r=await this._channel.harExport({harId:t}),s=yt.from(r.artifact),o=n.content==="attach"||n.path.endsWith(".zip"),l=n.path.endsWith(".zip");o&&!l?(await s.saveAs(n.path+".tmp"),await this._connection.localUtils()._channel.harUnzip({zipFile:n.path+".tmp",harFile:n.path})):await s.saveAs(n.path),await s.delete()}},!0),await this._channel.close(e),await this._closedPromise)}async _enableRecorder(e){await this._channel.recorderSupplementEnable(e)}}});var on,Tl=x(()=>{wi();xe();En();Tt();Pl();ui();O();on=class extends G{_contexts=new Set;_isConnected=!0;_closedPromise;_shouldCloseConnectionOnClose=!1;_browserType;_options={};_name;_path;_connectHeaders;_closeReason;static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r),this._name=r.name,this._channel.on("close",()=>this._didClose()),this._closedPromise=new Promise(s=>this.once(B.Browser.Disconnected,s))}browserType(){return this._browserType}async newContext(e={}){return await this._innerNewContext(e,!1)}async _newContextForReuse(e={}){return await this._wrapApiCall(async()=>{for(let t of this._contexts){await this._browserType._willCloseContext(t);for(let n of t.pages())n._onClose();t._onClose()}return await this._innerNewContext(e,!0)},!0)}async _stopPendingOperations(e){return await this._wrapApiCall(async()=>{await this._channel.stopPendingOperations({reason:e})},!0)}async _innerNewContext(e={},t){e={...this._browserType._defaultContextOptions,...e};let n=await Ci(e),r=t?await this._channel.newContextForReuse(n):await this._channel.newContext(n),s=$t.from(r.context);return await this._browserType._didCreateContext(s,n,this._options,e.logger||this._logger),s}contexts(){return[...this._contexts]}version(){return this._initializer.version}async newPage(e={}){return await this._wrapApiCall(async()=>{let t=await this.newContext(e),n=await t.newPage();return n._ownedContext=t,t._ownerPage=n,n})}isConnected(){return this._isConnected}async newBrowserCDPSession(){return er.from((await this._channel.newBrowserCDPSession()).session)}async startTracing(e,t={}){this._path=t.path,await this._channel.startTracing({...t,page:e?e._channel:void 0})}async stopTracing(){let e=yt.from((await this._channel.stopTracing()).artifact),t=await e.readIntoBuffer();return await e.delete(),this._path&&(await We(this._path),await fs.promises.writeFile(this._path,t),this._path=void 0),t}async[Symbol.asyncDispose](){await this.close()}async close(e={}){this._closeReason=e.reason;try{this._shouldCloseConnectionOnClose?this._connection.close():await this._channel.close(e),await this._closedPromise}catch(t){if(bt(t))return;throw t}}_didClose(){this._isConnected=!1,this.emit(B.Browser.Disconnected,this)}}});var ki,yu=x(()=>{Tl();wi();xe();_u();En();Jn();O();Io();ki=class extends G{_serverLauncher;_contexts=new Set;_playwright;_defaultContextOptions;_defaultContextTimeout;_defaultContextNavigationTimeout;_defaultLaunchOptions;static from(e){return e._object}executablePath(){if(!this._initializer.executablePath)throw new Error("Browser is not supported on current platform");return this._initializer.executablePath}name(){return this._initializer.name}async launch(e={}){E(!e.userDataDir,"userDataDir option is not supported in `browserType.launch`. Use `browserType.launchPersistentContext` instead"),E(!e.port,"Cannot specify a port without launching as a server.");let t=e.logger||this._defaultLaunchOptions?.logger;e={...this._defaultLaunchOptions,...e};let n={...e,ignoreDefaultArgs:Array.isArray(e.ignoreDefaultArgs)?e.ignoreDefaultArgs:void 0,ignoreAllDefaultArgs:!!e.ignoreDefaultArgs&&!Array.isArray(e.ignoreDefaultArgs),env:e.env?vr(e.env):void 0};return await this._wrapApiCall(async()=>{let r=on.from((await this._channel.launch(n)).browser);return this._didLaunchBrowser(r,e,t),r})}async launchServer(e={}){if(!this._serverLauncher)throw new Error("Launching server is not supported");return e={...this._defaultLaunchOptions,...e},await this._serverLauncher.launchServer(e)}async launchPersistentContext(e,t={}){let n=t.logger||this._defaultLaunchOptions?.logger;E(!t.port,"Cannot specify a port without launching as a server."),t={...this._defaultLaunchOptions,...this._defaultContextOptions,...t};let r=await Ci(t),s={...r,ignoreDefaultArgs:Array.isArray(t.ignoreDefaultArgs)?t.ignoreDefaultArgs:void 0,ignoreAllDefaultArgs:!!t.ignoreDefaultArgs&&!Array.isArray(t.ignoreDefaultArgs),env:t.env?vr(t.env):void 0,channel:t.channel,userDataDir:e};return await this._wrapApiCall(async()=>{let o=await this._channel.launchPersistentContext(s),l=$t.from(o.context);return await this._didCreateContext(l,r,t,n),l})}async connect(e,t){return typeof e=="string"?await this._connect({...t,wsEndpoint:e}):(E(e.wsEndpoint,"options.wsEndpoint is required"),await this._connect(e))}async _connect(e){let t=e.logger;return await this._wrapApiCall(async()=>{let n=e.timeout?X()+e.timeout:0,r={"x-playwright-browser":this.name(),...e.headers},s=this._connection.localUtils(),o={wsEndpoint:e.wsEndpoint,headers:r,exposeNetwork:e.exposeNetwork??e._exposeNetwork,slowMo:e.slowMo,timeout:e.timeout};e.__testHookRedirectPortForwarding&&(o.socksProxyRedirectPortForTest=e.__testHookRedirectPortForwarding);let{pipe:l,headers:c}=await s._channel.connect(o),h=()=>l.close().catch(()=>{}),m=new Ei(s,this._instrumentation);m.markAsRemote(),m.on("close",h);let f,g,b=S=>{for(let _ of f?.contexts()||[]){for(let k of _.pages())k._onClose();_._onClose()}m.close(S||g),setTimeout(()=>f?._didClose(),0)};l.on("closed",S=>b(S.reason)),m.onmessage=S=>this._wrapApiCall(()=>l.send({message:S}).catch(()=>b()),!0),l.on("message",({message:S})=>{try{m.dispatch(S)}catch(_){g=String(_),h()}});let v=await Fo(async()=>{e.__testHookBeforeCreateBrowser&&await e.__testHookBeforeCreateBrowser();let S=await m.initializePlaywright();if(!S._initializer.preLaunchedBrowser)throw h(),new Error("Malformed endpoint. Did you use BrowserType.launchServer method?");return S._setSelectors(this._playwright.selectors),f=on.from(S._initializer.preLaunchedBrowser),this._didLaunchBrowser(f,{},t),f._shouldCloseConnectionOnClose=!0,f._connectHeaders=c,f.on(B.Browser.Disconnected,()=>this._wrapApiCall(()=>h(),!0)),f},n);if(v.timedOut)throw h(),new Error(`Timeout ${e.timeout}ms exceeded`);return v.result})}async connectOverCDP(e,t){if(typeof e=="string")return await this._connectOverCDP(e,t);let n="endpointURL"in e?e.endpointURL:e.wsEndpoint;return E(n,"Cannot connect over CDP without wsEndpoint."),await this.connectOverCDP(n,e)}async _connectOverCDP(e,t={}){if(this.name()!=="chromium")throw new Error("Connecting over CDP is only supported in Chromium.");let n=t.headers?Ce(t.headers):void 0,r=await this._channel.connectOverCDP({endpointURL:e,headers:n,slowMo:t.slowMo,timeout:t.timeout}),s=on.from(r.browser);return this._didLaunchBrowser(s,{},t.logger),r.defaultContext&&await this._didCreateContext($t.from(r.defaultContext),{},{},t.logger),s}_didLaunchBrowser(e,t,n){e._browserType=this,e._options=t,e._logger=n}async _didCreateContext(e,t,n,r){e._logger=r,e._browserType=this,this._contexts.add(e),e._setOptions(t,n),this._defaultContextTimeout!==void 0&&e.setDefaultTimeout(this._defaultContextTimeout),this._defaultContextNavigationTimeout!==void 0&&e.setDefaultNavigationTimeout(this._defaultContextNavigationTimeout),await this._instrumentation.runAfterCreateBrowserContext(e)}async _willCloseContext(e){this._contexts.delete(e),await this._instrumentation.runBeforeCloseBrowserContext(e)}}});var Rl,Cr,vu=x(()=>{Jn();xe();cu();Rl=class{_channels=new Set;_registrations=[];async register(e,t,n={}){let r=await hi(t,void 0,!1),s={...n,name:e,source:r};for(let o of this._channels)await o._channel.register(s);this._registrations.push(s)}setTestIdAttribute(e){Hf(e);for(let t of this._channels)t._channel.setTestIdAttributeName({testIdAttributeName:e}).catch(()=>{})}_addChannel(e){this._channels.add(e);for(let t of this._registrations)e._channel.register(t).catch(()=>{}),e._channel.setTestIdAttributeName({testIdAttributeName:mi()}).catch(()=>{})}_removeChannel(e){this._channels.delete(e)}},Cr=class extends G{static from(e){return e._object}}});var eo,Zf=x(()=>{Tt();yu();xe();Qs();vu();eo=class extends G{chromium;devices;selectors;request;errors;constructor(e,t,n,r){super(e,t,n,r),this.request=new bl(this),this.chromium=ki.from(r.chromium),this.chromium._playwright=this,this.devices=this._connection.localUtils()?.devices??{},this.selectors=new Rl,this.errors={TimeoutError:yr};let s=Cr.from(r.selectors);this.selectors._addChannel(s),this._connection.on("close",()=>{this.selectors._removeChannel(s)}),globalThis._playwrightInstance=this}_setSelectors(e){let t=Cr.from(this._initializer.selectors);this.selectors._removeChannel(t),this.selectors=e,this.selectors._addChannel(t)}static from(e){return e._object}}});var Al,to,eg=x(()=>{bn();wi();xe();Jn();En();kn();wu();fi();Tt();Al=class extends G{static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r)}async launch(e={}){let t={...await Ci(e),env:vr(e.env?e.env:process.env),tracesDir:e.tracesDir},n=to.from((await this._channel.launch(t)).electronApplication);return n._context._setOptions(t,e),n}},to=class extends G{_context;_windows=new Set;_timeoutSettings=new Le;static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r),this._context=$t.from(r.context);for(let s of this._context._pages)this._onPage(s);this._context.on(B.BrowserContext.Page,s=>this._onPage(s)),this._channel.on("close",()=>{this.emit(B.ElectronApplication.Close)}),this._channel.on("console",s=>this.emit(B.ElectronApplication.Console,new Si(s))),this._setEventToSubscriptionMapping(new Map([[B.ElectronApplication.Console,"console"]]))}process(){return this._toImpl().process()}_onPage(e){this._windows.add(e),this.emit(B.ElectronApplication.Window,e),e.once(B.Page.Close,()=>this._windows.delete(e))}windows(){return[...this._windows]}async firstWindow(e){return this._windows.size?this._windows.values().next().value:await this.waitForEvent("window",e)}context(){return this._context}async[Symbol.asyncDispose](){await this.close()}async close(){try{await this._context.close()}catch(e){if(bt(e))return;throw e}}async waitForEvent(e,t={}){return await this._wrapApiCall(async()=>{let n=this._timeoutSettings.timeout(typeof t=="function"?{}:t),r=typeof t=="function"?t:t.predicate,s=Rt.createForEvent(this,e);s.rejectOnTimeout(n,`Timeout ${n}ms exceeded while waiting for event "${e}"`),e!==B.ElectronApplication.Close&&s.rejectOnEvent(this,B.ElectronApplication.Close,()=>new Ge);let o=await s.waitForEvent(this,e,r);return s.dispose(),o})}async browserWindow(e){let t=await this._channel.browserWindow({page:e._channel});return De.from(t.handle)}async evaluate(e,t){let n=await this._channel.evaluateExpression({expression:String(e),isFunction:typeof e=="function",arg:we(t)});return Ue(n.value)}async evaluateHandle(e,t){let n=await this._channel.evaluateExpressionHandle({expression:String(e),isFunction:typeof e=="function",arg:we(t)});return De.from(n.handle)}}});var Fl,tg=x(()=>{xe();Fl=class extends G{static from(e){return e._object}constructor(e,t,n,r){super(e,t,n,r)}channel(){return this._channel}}});var Il,ng=x(()=>{xe();Il=class extends G{devices;constructor(e,t,n,r){super(e,t,n,r),this.devices={};for(let{name:s,descriptor:o}of r.deviceDescriptors)this.devices[s]=o}}});function rg(){let i=[];return new Proxy({},{get:(e,t)=>typeof t!="string"?e[t]:t==="addListener"?n=>i.push(n):t==="removeListener"?n=>i.splice(i.indexOf(n),1):t==="removeAllListeners"?()=>i.splice(0,i.length):t.startsWith("run")?async(...n)=>{for(let r of i)await r[t]?.(...n)}:t.startsWith("on")?(...n)=>{for(let r of i)r[t]?.(...n)}:e[t]})}var ig=x(()=>{});import{EventEmitter as Fy}from"events";var xu,Su,Ei,_u=x(()=>{Tl();wi();yu();xe();Ks();yi();kn();gi();Zs();Js();bu();Tt();Pl();Zf();eg();su();mu();Te();vu();ui();tg();Qs();ng();wl();cs();ig();O();xu=class extends G{constructor(e){super(e,"Root","",{})}async initialize(){return eo.from((await this._channel.initialize({sdkLanguage:"javascript"})).playwright)}},Su=class extends G{},Ei=class extends Fy{_objects=new Map;onmessage=e=>{};_lastId=0;_callbacks=new Map;_rootObject;_closedError;_isRemote=!1;_localUtils;_rawBuffers=!1;toImpl;_tracingCount=0;_instrumentation;constructor(e,t){super(),this._rootObject=new xu(this),this._localUtils=e,this._instrumentation=t||rg()}markAsRemote(){this._isRemote=!0}isRemote(){return this._isRemote}useRawBuffers(){this._rawBuffers=!0}rawBuffers(){return this._rawBuffers}localUtils(){return this._localUtils}async initializePlaywright(){return await this._rootObject.initialize()}getObjectWithKnownName(e){return this._objects.get(e)}setIsTracing(e){e?this._tracingCount++:this._tracingCount--}async sendMessageToServer(e,t,n,r,s,o){if(this._closedError)throw this._closedError;if(e._wasCollected)throw new Error("The object has been collected to prevent unbounded heap growth.");let l=e._guid,c=e._type,h=++this._lastId,m={id:h,guid:l,method:t,params:n};N.isEnabled("channel")&&N.log("channel","SEND> "+JSON.stringify(m));let f=s[0]?{file:s[0].file,line:s[0].line,column:s[0].column}:void 0,g={apiName:r,location:f,internal:!r,stepId:o};return this._tracingCount&&s&&c!=="LocalUtils"&&this._localUtils?._channel.addStackToTracingNoReply({callData:{stack:s,id:h}}).catch(()=>{}),$r.exitZones(()=>this.onmessage({...m,metadata:g})),await new Promise((b,v)=>this._callbacks.set(h,{resolve:b,reject:v,apiName:r,type:c,method:t}))}dispatch(e){if(this._closedError)return;let{id:t,guid:n,method:r,params:s,result:o,error:l,log:c}=e;if(t){N.isEnabled("channel")&&N.log("channel","<RECV "+JSON.stringify(e));let f=this._callbacks.get(t);if(!f)throw new Error(`Cannot find command to respond: ${t}`);if(this._callbacks.delete(t),l&&!o){let g=dl(l);ve(g,g.message+lh(c)),f.reject(g)}else{let g=ht(f.type,f.method,"Result");f.resolve(g(o,"",{tChannelImpl:this._tChannelImplFromWire.bind(this),binary:this._rawBuffers?"buffer":"fromBase64"}))}return}if(N.isEnabled("channel")&&N.log("channel","<EVENT "+JSON.stringify(e)),r==="__create__"){this._createRemoteObject(n,s.type,s.guid,s.initializer);return}let h=this._objects.get(n);if(!h)throw new Error(`Cannot find object to "${r}": ${n}`);if(r==="__adopt__"){let f=this._objects.get(s.guid);if(!f)throw new Error(`Unknown new child: ${s.guid}`);h._adopt(f);return}if(r==="__dispose__"){h._dispose(s.reason);return}let m=ht(h._type,r,"Event");h._channel.emit(r,m(s,"",{tChannelImpl:this._tChannelImplFromWire.bind(this),binary:this._rawBuffers?"buffer":"fromBase64"}))}close(e){if(!this._closedError){this._closedError=new Ge(e);for(let t of this._callbacks.values())t.reject(this._closedError);this._callbacks.clear(),this.emit("close")}}_tChannelImplFromWire(e,t,n,r){if(t&&typeof t=="object"&&typeof t.guid=="string"){let s=this._objects.get(t.guid);if(!s)throw new Error(`Object with guid ${t.guid} was not bound in the connection`);if(e!=="*"&&!e.includes(s._type))throw new he(`${n}: expected channel ${e.toString()}`);return s._channel}throw new he(`${n}: expected channel ${e.toString()}`)}_createRemoteObject(e,t,n,r){let s=this._objects.get(e);if(!s)throw new Error(`Cannot find parent object ${e} to create ${n}`);let o;switch(r=ht(t,"","Initializer")(r,"",{tChannelImpl:this._tChannelImplFromWire.bind(this),binary:this._rawBuffers?"buffer":"fromBase64"}),t){case"APIRequestContext":o=new Sr(s,t,n,r);break;case"Artifact":o=new yt(s,t,n,r);break;case"BindingCall":o=new Pr(s,t,n,r);break;case"Browser":o=new on(s,t,n,r);break;case"BrowserContext":o=new $t(s,t,n,r);break;case"BrowserType":o=new ki(s,t,n,r);break;case"CDPSession":o=new er(s,t,n,r);break;case"Dialog":o=new Pi(s,t,n,r);break;case"Electron":o=new Al(s,t,n,r);break;case"ElectronApplication":o=new to(s,t,n,r);break;case"ElementHandle":o=new Ye(s,t,n,r);break;case"Frame":o=new Ke(s,t,n,r);break;case"JSHandle":o=new De(s,t,n,r);break;case"JsonPipe":o=new Fl(s,t,n,r);break;case"LocalUtils":o=new Il(s,t,n,r),this._localUtils||(this._localUtils=o);break;case"Page":o=new Be(s,t,n,r);break;case"Playwright":o=new eo(s,t,n,r);break;case"Request":o=new At(s,t,n,r);break;case"Response":o=new rt(s,t,n,r);break;case"Route":o=new Qn(s,t,n,r);break;case"Stream":o=new _r(s,t,n,r);break;case"Selectors":o=new Cr(s,t,n,r);break;case"SocksSupport":o=new Su(s,t,n,r);break;case"Tracing":o=new Xn(s,t,n,r);break;case"WebSocket":o=new bi(s,t,n,r);break;case"Worker":o=new rn(s,t,n,r);break;case"WritableStream":o=new _i(s,t,n,r);break;default:throw new Error("Missing type "+t)}return o}}});var no,Ft,Pu,sg=x(()=>{Hr();ye();ba();Ga();O();no=ge(),Ft=class i extends se{static Events={StateChanged:"stateChanged",InspectRequested:"inspectRequested",SourceChanged:"sourceChanged",Paused:"paused",SetModeRequested:"setModeRequested"};_autoCloseTimer;_autoCloseAllowed=!1;_trackHierarchyListener;_playwright;_sdkLanguage="javascript";_codegenId="playwright-test";constructor(e){super({attribution:{isInternalPlaywright:!0},instrumentation:Do()},void 0,"DebugController"),this._playwright=e}initialize(e,t){this._codegenId=e,this._sdkLanguage=t}setAutoCloseAllowed(e){this._autoCloseAllowed=e}dispose(){this.setReportStateChanged(!1),this.setAutoCloseAllowed(!1)}setReportStateChanged(e){e&&!this._trackHierarchyListener?(this._trackHierarchyListener={onPageOpen:()=>this._emitSnapshot(),onPageClose:()=>this._emitSnapshot()},this._playwright.instrumentation.addListener(this._trackHierarchyListener,null)):!e&&this._trackHierarchyListener&&(this._playwright.instrumentation.removeListener(this._trackHierarchyListener),this._trackHierarchyListener=void 0)}async resetForReuse(){let e=new Set;for(let t of this._playwright.allPages())e.add(t.context());for(let t of e)await t.resetForReuse(no,null)}async navigate(e){for(let t of this._playwright.allPages())await t.mainFrame().goto(no,e)}async setRecorderMode(e){if(await this._closeBrowsersWithoutPages(),e.mode==="none"){for(let n of await this._allRecorders())n.hideHighlightedSelector(),n.setMode("none");this.setAutoCloseEnabled(!0);return}if(this._playwright.allBrowsers().length||await this._playwright.chromium.launch(no,{headless:!!process.env.PW_DEBUG_CONTROLLER_HEADLESS}),!this._playwright.allPages().length){let[n]=this._playwright.allBrowsers(),{context:r}=await n.newContextForReuse({},no);await r.newPage(no)}if(e.testIdAttributeName)for(let n of this._playwright.allPages())n.context().selectors().setTestIdAttributeName(e.testIdAttributeName);for(let n of await this._allRecorders())n.hideHighlightedSelector(),e.mode!=="inspecting"&&n.setOutput(this._codegenId,e.file),n.setMode(e.mode);this.setAutoCloseEnabled(!0)}async setAutoCloseEnabled(e){if(!this._autoCloseAllowed||(this._autoCloseTimer&&clearTimeout(this._autoCloseTimer),!e))return;let t=()=>{this._playwright.allPages().length?this._autoCloseTimer=setTimeout(t,5e3):Co(0)};this._autoCloseTimer=setTimeout(t,3e4)}async highlight(e){for(let t of await this._allRecorders())t.setHighlightedSelector(this._sdkLanguage,e)}async hideHighlight(){for(let e of await this._allRecorders())e.hideHighlightedSelector();await this._playwright.hideHighlight()}allBrowsers(){return[...this._playwright.allBrowsers()]}async resume(){for(let e of await this._allRecorders())e.resume()}async kill(){Co(0)}async closeAllBrowsers(){await Promise.all(this.allBrowsers().map(e=>e.close({reason:"Close all browsers requested"})))}_emitSnapshot(){let e=[],t=0;for(let n of this._playwright.allBrowsers()){let r={contexts:[]};e.push(r);for(let s of n.contexts()){let o={pages:[]};r.contexts.push(o);for(let l of s.pages())o.pages.push(l.mainFrame().url());t+=s.pages().length}}this.emit(i.Events.StateChanged,{pageCount:t})}async _allRecorders(){let e=new Set;for(let n of this._playwright.allPages())e.add(n.context());return(await Promise.all([...e].map(n=>Zt.show(n,()=>Promise.resolve(new Pu(this)),{omitCallTracking:!0})))).filter(Boolean)}async _closeBrowsersWithoutPages(){for(let e of this._playwright.allBrowsers()){for(let t of e.contexts())t.pages().length||await t.close({reason:"Browser collected"});e.contexts()||await e.close({reason:"Browser collected"})}}},Pu=class extends Fs{_debugController;constructor(e){super(),this._debugController=e}async setSelector(e){let t=ke(this._debugController._sdkLanguage,e);this._debugController.emit(Ft.Events.InspectRequested,{selector:e,locator:t})}async setSources(e){let t=e.find(l=>l.id===this._debugController._codegenId),{text:n,header:r,footer:s,actions:o}=t||{text:""};this._debugController.emit(Ft.Events.SourceChanged,{text:n,header:r,footer:s,actions:o})}async setPaused(e){this._debugController.emit(Ft.Events.Paused,{paused:e})}async setMode(e){this._debugController.emit(Ft.Events.SetModeRequested,{mode:e})}}});var Ll,og=x(()=>{O();sg();_e();Ll=class extends K{_type_DebugController;_listeners;constructor(e,t){super(e,t,"DebugController",{}),this._type_DebugController=!0,this._listeners=[L.addEventListener(this._object,Ft.Events.StateChanged,n=>{this._dispatchEvent("stateChanged",n)}),L.addEventListener(this._object,Ft.Events.InspectRequested,({selector:n,locator:r})=>{this._dispatchEvent("inspectRequested",{selector:n,locator:r})}),L.addEventListener(this._object,Ft.Events.SourceChanged,({text:n,header:r,footer:s,actions:o})=>{this._dispatchEvent("sourceChanged",{text:n,header:r,footer:s,actions:o})}),L.addEventListener(this._object,Ft.Events.Paused,({paused:n})=>{this._dispatchEvent("paused",{paused:n})}),L.addEventListener(this._object,Ft.Events.SetModeRequested,({mode:n})=>{this._dispatchEvent("setModeRequested",{mode:n})})]}async initialize(e){this._object.initialize(e.codegenId,e.sdkLanguage)}async setReportStateChanged(e){this._object.setReportStateChanged(e.enabled)}async resetForReuse(){await this._object.resetForReuse()}async navigate(e){await this._object.navigate(e.url)}async setRecorderMode(e){await this._object.setRecorderMode(e)}async highlight(e){await this._object.highlight(e.selector)}async hideHighlight(){await this._object.hideHighlight()}async resume(){await this._object.resume()}async kill(){await this._object.kill()}async closeAllBrowsers(){await this._object.closeAllBrowsers()}_onDispose(){L.removeEventListeners(this._listeners),this._object.dispose()}}});function ag(i){let e={...i};for(let t of Object.keys(e)){let n=t;e[n]===Ly[n]&&delete e[n]}for(let t of Oy)delete e[t];return JSON.stringify(e)}function Iy(i){return{channel:i.channel,args:i.args,ignoreAllDefaultArgs:i.ignoreAllDefaultArgs,ignoreDefaultArgs:i.ignoreDefaultArgs,timeout:i.timeout,headless:i.headless,proxy:i.proxy,chromiumSandbox:i.chromiumSandbox,firefoxUserPrefs:i.firefoxUserPrefs,slowMo:i.slowMo,executablePath:ce()?i.executablePath:void 0}}var Ol,Ly,Oy,lg=x(()=>{nu();Es();ye();mr();O();og();O();O();Te();Ol=class{_ws;_onClose;_dispatcherConnection;_cleanups=[];_id;_disconnected=!1;_preLaunched;_options;_root;_profileName;constructor(e,t,n,r,s,o,l){if(this._ws=n,this._preLaunched=s,this._options=r,r.launchOptions=Iy(r.launchOptions),(t==="reuse-browser"||t==="pre-launched-browser-or-android")&&E(s.playwright),t==="pre-launched-browser-or-android"&&E(s.browser||s.androidDevice),this._onClose=l,this._id=o,this._profileName=`${new Date().toISOString()}-${t}`,this._dispatcherConnection=new wn,this._dispatcherConnection.onmessage=async c=>{if(await e,n.readyState!==n.CLOSING){let h=JSON.stringify(c);N.isEnabled("server:channel")&&N.log("server:channel",`[${this._id}] ${X()*1e3} SEND \u25BA ${h}`),N.isEnabled("server:metadata")&&this.logServerMetadata(c,h,"SEND"),n.send(h)}},n.on("message",async c=>{await e;let h=Buffer.from(c).toString(),m=JSON.parse(h);N.isEnabled("server:channel")&&N.log("server:channel",`[${this._id}] ${X()*1e3} \u25C0 RECV ${h}`),N.isEnabled("server:metadata")&&this.logServerMetadata(m,h,"RECV"),this._dispatcherConnection.dispatch(m)}),n.on("close",()=>this._onDisconnect()),n.on("error",c=>this._onDisconnect(c)),t==="controller"){this._root=this._initDebugControllerMode();return}this._root=new lr(this._dispatcherConnection,async(c,h)=>{if(await Th(),t==="reuse-browser")return await this._initReuseBrowsersMode(c);if(t==="pre-launched-browser-or-android")return this._preLaunched.browser?await this._initPreLaunchedBrowserMode(c):await this._initPreLaunchedAndroidMode(c);if(t==="launch-browser")return await this._initLaunchBrowserMode(c,h);throw new Error("Unsupported client type: "+t)})}async _initLaunchBrowserMode(e,t){N.log("server",`[${this._id}] engaged launch mode for "${this._options.browserName}"`);let n=Bt({sdkLanguage:t.sdkLanguage,isServer:!0}),r=await this._createOwnedSocksProxy(n),s=await n[this._options.browserName].launch(ge(),this._options.launchOptions);return this._cleanups.push(async()=>{for(let o of n.allBrowsers())await o.close({reason:"Connection terminated"})}),s.on(Pt.Events.Disconnected,()=>{this.close({code:1001,reason:"Browser closed"})}),new nn(e,n,r,s)}async _initPreLaunchedBrowserMode(e){N.log("server",`[${this._id}] engaged pre-launched (browser) mode`);let t=this._preLaunched.playwright;this._preLaunched.socksProxy?.setPattern(this._options.socksProxyPattern);let n=this._preLaunched.browser;n.on(Pt.Events.Disconnected,()=>{this.close({code:1001,reason:"Browser closed"})});let r=new nn(e,t,this._preLaunched.socksProxy,n);for(let s of t.allBrowsers())s!==n&&await s.close({reason:"Connection terminated"});return this._cleanups.push(()=>r.cleanup()),r}async _initPreLaunchedAndroidMode(e){N.log("server",`[${this._id}] engaged pre-launched (Android) mode`);let t=this._preLaunched.playwright,n=this._preLaunched.androidDevice;n.on(AndroidDevice.Events.Close,()=>{this.close({code:1001,reason:"Android device disconnected"})});let r=new nn(e,t,void 0,void 0,n);return this._cleanups.push(()=>r.cleanup()),r}_initDebugControllerMode(){N.log("server",`[${this._id}] engaged reuse controller mode`);let e=this._preLaunched.playwright;return new Ll(this._dispatcherConnection,e.debugController)}async _initReuseBrowsersMode(e){N.log("server",`[${this._id}] engaged reuse browsers mode for ${this._options.browserName}`);let t=this._preLaunched.playwright,n=ag(this._options.launchOptions),r=t.allBrowsers().find(o=>o.options.name!==this._options.browserName?!1:ag(o.options.originalLaunchOptions)===n);for(let o of t.allBrowsers())o!==r&&o.options.name===this._options.browserName&&o.options.channel===this._options.launchOptions.channel&&await o.close({reason:"Connection terminated"});return r||(r=await t[this._options.browserName||"chromium"].launch(ge(),{...this._options.launchOptions,headless:!!process.env.PW_DEBUG_CONTROLLER_HEADLESS}),r.on(Pt.Events.Disconnected,()=>{this.close({code:1001,reason:"Browser closed"})})),this._cleanups.push(async()=>{for(let o of t.allBrowsers()){for(let l of o.contexts())l.pages().length?await l.stopPendingOperations("Connection closed"):await l.close({reason:"Connection terminated"});o.contexts()||await o.close({reason:"Connection terminated"})}}),new nn(e,t,void 0,r)}async _createOwnedSocksProxy(e){if(!this._options.socksProxyPattern)return;let t=new at;return t.setPattern(this._options.socksProxyPattern),e.options.socksProxyPort=await t.listen(0),N.log("server",`[${this._id}] started socks proxy on port ${e.options.socksProxyPort}`),this._cleanups.push(()=>t.close()),t}async _onDisconnect(e){this._disconnected=!0,N.log("server",`[${this._id}] disconnected. error: ${e}`),this._root._dispose(),N.log("server",`[${this._id}] starting cleanup`);for(let t of this._cleanups)await t().catch(()=>{});await Rh(this._profileName),this._onClose(),N.log("server",`[${this._id}] finished cleanup`)}logServerMetadata(e,t,n){let r={wallTime:Date.now(),id:e.id,guid:e.guid,method:e.method,payloadSizeInBytes:Buffer.byteLength(t,"utf-8")};N.log("server:metadata",(n==="SEND"?"SEND \u25BA ":"\u25C0 RECV ")+JSON.stringify(r))}async close(e){if(!this._disconnected){N.log("server",`[${this._id}] force closing connection: ${e?.reason||""} (${e?.code||0})`);try{this._ws.close(e?.code,e?.reason)}catch{}}}};Ly={ignoreAllDefaultArgs:!1,handleSIGINT:!1,handleSIGTERM:!1,handleSIGHUP:!1,headless:!0,devtools:!1},Oy=["headless","tracesDir"]});var Ml,cg=x(()=>{oi();lg();xc();Te();O();Pc();Ml=class{_preLaunchedPlaywright;_options;_wsServer;constructor(e){this._options=e,e.preLaunchedBrowser&&(this._preLaunchedPlaywright=e.preLaunchedBrowser.attribution.playwright),e.preLaunchedAndroidDevice&&(this._preLaunchedPlaywright=e.preLaunchedAndroidDevice._android.attribution.playwright);let t=new Dr(this._options.maxConnections),n=new Dr(1),r=new Dr(1);this._wsServer=new Lo({onUpgrade:(s,o)=>{let l=Lu(s.headers["user-agent"]||"");if(l)return{error:`HTTP/${s.httpVersion} 428 Precondition Required\r
\r
${l}`}},onHeaders:s=>{process.env.PWTEST_SERVER_WS_HEADERS&&s.push(process.env.PWTEST_SERVER_WS_HEADERS)},onConnection:(s,o,l,c)=>{let h=s.headers["x-playwright-browser"],m=o.searchParams.get("browser")||(Array.isArray(h)?h[0]:h)||null,f=s.headers["x-playwright-proxy"],g=o.searchParams.get("proxy")||(Array.isArray(f)?f[0]:f),b=s.headers["x-playwright-launch-options"]||"",v=Array.isArray(b)?b[0]:b,S=o.searchParams.get("launch-options"),_={};try{_=JSON.parse(S||v)}catch{}let k=this._options.mode==="extension";k&&(this._preLaunchedPlaywright||(this._preLaunchedPlaywright=Bt({sdkLanguage:"javascript",isServer:!0})));let D="launch-browser",H=t;return k&&o.searchParams.has("debug-controller")?(D="controller",H=n):k?(D="reuse-browser",H=r):this._options.mode==="launchServer"&&(D="pre-launched-browser-or-android",H=t),new Ol(H.acquire(),D,l,{socksProxyPattern:g,browserName:m,launchOptions:_},{playwright:this._preLaunchedPlaywright,browser:this._options.preLaunchedBrowser,androidDevice:this._options.preLaunchedAndroidDevice,socksProxy:this._options.preLaunchedSocksProxy},c,()=>H.release())},onClose:async()=>{N.log("server","closing browsers"),this._preLaunchedPlaywright&&await Promise.all(this._preLaunchedPlaywright.allBrowsers().map(s=>s.close({reason:"Playwright Server stopped"}))),N.log("server","closed browsers")}})}async listen(e=0,t){return this._wsServer.listen(e,t,this._options.path)}async close(){await this._wsServer.close()}}});function My(i){return i?(e,t)=>{i.isEnabled("protocol","verbose")&&i.log("protocol","verbose",(e==="send"?"SEND \u25BA ":"\u25C0 RECV ")+JSON.stringify(t),[],{})}:void 0}var Nl,dg=x(()=>{Jn();O();ye();oi();cg();Ot();Lt();mr();Nl=class{_browserName;constructor(e){this._browserName=e}async launchServer(e={}){let t=Bt({sdkLanguage:"javascript",isServer:!0}),n=void 0;t.options.socksProxyPort=await n?.listen(0);let r=ge(),s=await t[this._browserName].launch(r,{...e,ignoreDefaultArgs:Array.isArray(e.ignoreDefaultArgs)?e.ignoreDefaultArgs:void 0,ignoreAllDefaultArgs:!!e.ignoreDefaultArgs&&!Array.isArray(e.ignoreDefaultArgs),env:e.env?vr(e.env):void 0},My(e.logger)).catch(m=>{let f=le.formatBrowserLogs(r.log);throw ve(m,`${m.message} Failed to launch browser.${f}`),m}),o=e.wsPath?e.wsPath.startsWith("/")?e.wsPath:`/${e.wsPath}`:`/${Y()}`,l=new Ml({mode:"launchServer",path:o,maxConnections:1/0,preLaunchedBrowser:s,preLaunchedSocksProxy:n}),c=await l.listen(e.port,e.host),h=new ws.EventEmitter;return h.process=()=>s.options.browserProcess.process,h.wsEndpoint=()=>c,h.close=()=>s.options.browserProcess.close(),h[Symbol.asyncDispose]=h.close,h.kill=()=>s.options.browserProcess.kill(),h._disconnectForTest=()=>l.close(),h._userDataDirForTest=s._userDataDirForTest,s.options.browserProcess.onclose=(m,f)=>{n?.close().catch(()=>{}),l.close(),h.emit("close",m,f)},h}}});function ug(){let i=Bt({sdkLanguage:process.env.PW_LANG_NAME||"javascript"}),e=new Ei(void 0,void 0);e.useRawBuffers();let t=new wn(!0);t.onmessage=s=>e.dispatch(s),e.onmessage=s=>t.dispatch(s);let n=new lr(t);new nn(n,i);let r=e.getObjectWithKnownName("Playwright");return r.chromium._serverLauncher=new Nl("chromium"),t.onmessage=s=>or(()=>e.dispatch(s)),e.onmessage=s=>or(()=>t.dispatch(s)),e.toImpl=s=>s?t._dispatchers.get(s._guid)._object:t._dispatchers.get(""),r._toImpl=e.toImpl,r}var hg=x(()=>{nu();_u();dg();Ao()});var mg=so((wM,pg)=>{hg();pg.exports=ug()});var gg=so((bM,fg)=>{fg.exports=mg()});var Cu=Pg(gg(),1),yM=Cu.default.chromium,_M=Cu.default;export{yM as chromium,_M as default};
